!function(y,_){function N(e,t){return(t+"").toUpperCase()}function M(){v.addEventListener?(v.removeEventListener("DOMContentLoaded",M,!1),b.ready()):"complete"===v.readyState&&(v.detachEvent("onreadystatechange",M),b.ready())}var U,z,v=y.document,B=y.location,H=y.navigator,W=y.jQuery,$=y.$,G=Array.prototype.push,p=Array.prototype.slice,q=Array.prototype.indexOf,j=Object.prototype.toString,K=Object.prototype.hasOwnProperty,V=String.prototype.trim,b=function(e,t){return new b.fn.init(e,t,U)},Z=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,Y=/\S/,E=/\s+/,X=Y.test("Â ")?/^[\s\xA0]+|[\s\xA0]+$/g:/^\s+|\s+$/g,Q=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,J=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,ee=/^[\],:{}\s]*$/,te=/(?:^|:|,)(?:\s*\[)+/g,ie=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,re=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,ne=/^-ms-/,oe=/-([\da-z])/gi,se={},ae=(b.fn=b.prototype={constructor:b,init:function(e,t,i){var r,n;if(e)if(e.nodeType)this.context=this[0]=e,this.length=1;else{if("string"!=typeof e)return b.isFunction(e)?i.ready(e):(e.selector!==_&&(this.selector=e.selector,this.context=e.context),b.makeArray(e,this));if(!(r="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&3<=e.length?[null,e,null]:Q.exec(e))||!r[1]&&t)return(!t||t.jquery?t||i:this.constructor(t)).find(e);if(r[1])return n=(t=t instanceof b?t[0]:t)&&t.nodeType?t.ownerDocument||t:v,e=b.parseHTML(r[1],n,!0),J.test(r[1])&&b.isPlainObject(t)&&this.attr.call(e,t,!0),b.merge(this,e);if((n=v.getElementById(r[2]))&&n.parentNode){if(n.id!==r[2])return i.find(e);this.length=1,this[0]=n}this.context=v,this.selector=e}return this},selector:"",jquery:"1.8.0",length:0,size:function(){return this.length},toArray:function(){return p.call(this)},get:function(e){return null==e?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e,t,i){e=b.merge(this.constructor(),e);return e.prevObject=this,e.context=this.context,"find"===t?e.selector=this.selector+(this.selector?" ":"")+i:t&&(e.selector=this.selector+"."+t+"("+i+")"),e},each:function(e,t){return b.each(this,e,t)},ready:function(e){return b.ready.promise().done(e),this},eq:function(e){return-1===(e=+e)?this.slice(e):this.slice(e,e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(p.apply(this,arguments),"slice",p.call(arguments).join(","))},map:function(i){return this.pushStack(b.map(this,function(e,t){return i.call(e,t,e)}))},end:function(){return this.prevObject||this.constructor(null)},push:G,sort:[].sort,splice:[].splice},b.fn.init.prototype=b.fn,b.extend=b.fn.extend=function(){var e,t,i,r,n,o=arguments[0]||{},s=1,a=arguments.length,l=!1;for("boolean"==typeof o&&(l=o,o=arguments[1]||{},s=2),"object"==typeof o||b.isFunction(o)||(o={}),a===s&&(o=this,--s);s<a;s++)if(null!=(e=arguments[s]))for(t in e)n=o[t],o!==(i=e[t])&&(l&&i&&(b.isPlainObject(i)||(r=b.isArray(i)))?(n=r?(r=!1,n&&b.isArray(n)?n:[]):n&&b.isPlainObject(n)?n:{},o[t]=b.extend(l,n,i)):i!==_&&(o[t]=i));return o},b.extend({noConflict:function(e){return y.$===b&&(y.$=$),e&&y.jQuery===b&&(y.jQuery=W),b},isReady:!1,readyWait:1,holdReady:function(e){e?b.readyWait++:b.ready(!0)},ready:function(e){if(!0===e?!--b.readyWait:!b.isReady){if(!v.body)return setTimeout(b.ready,1);(b.isReady=!0)!==e&&0<--b.readyWait||(z.resolveWith(v,[b]),b.fn.trigger&&b(v).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===b.type(e)},isArray:Array.isArray||function(e){return"array"===b.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?String(e):se[j.call(e)]||"object"},isPlainObject:function(e){if(!e||"object"!==b.type(e)||e.nodeType||b.isWindow(e))return!1;try{if(e.constructor&&!K.call(e,"constructor")&&!K.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}for(var t in e);return t===_||K.call(e,t)},isEmptyObject:function(e){for(var t in e)return!1;return!0},error:function(e){throw new Error(e)},parseHTML:function(e,t,i){var r;return e&&"string"==typeof e?("boolean"==typeof t&&(i=t,t=0),t=t||v,(r=J.exec(e))?[t.createElement(r[1])]:(r=b.buildFragment([e],t,i?null:[]),b.merge([],(r.cacheable?b.clone(r.fragment):r.fragment).childNodes))):null},parseJSON:function(e){return e&&"string"==typeof e?(e=b.trim(e),y.JSON&&y.JSON.parse?y.JSON.parse(e):ee.test(e.replace(ie,"@").replace(re,"]").replace(te,""))?new Function("return "+e)():void b.error("Invalid JSON: "+e)):null},parseXML:function(e){var t;if(!e||"string"!=typeof e)return null;try{y.DOMParser?t=(new DOMParser).parseFromString(e,"text/xml"):((t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e))}catch(e){t=_}return t&&t.documentElement&&!t.getElementsByTagName("parsererror").length||b.error("Invalid XML: "+e),t},noop:function(){},globalEval:function(e){e&&Y.test(e)&&(y.execScript||function(e){y.eval.call(y,e)})(e)},camelCase:function(e){return e.replace(ne,"ms-").replace(oe,N)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toUpperCase()===t.toUpperCase()},each:function(e,t,i){var r,n=0,o=e.length,s=o===_||b.isFunction(e);if(i)if(s){for(r in e)if(!1===t.apply(e[r],i))break}else for(;n<o&&!1!==t.apply(e[n++],i););else if(s){for(r in e)if(!1===t.call(e[r],r,e[r]))break}else for(;n<o&&!1!==t.call(e[n],n,e[n++]););return e},trim:V?function(e){return null==e?"":V.call(e)}:function(e){return null==e?"":e.toString().replace(X,"")},makeArray:function(e,t){var i,t=t||[];return null!=e&&(i=b.type(e),null==e.length||"string"===i||"function"===i||"regexp"===i||b.isWindow(e)?G.call(t,e):b.merge(t,e)),t},inArray:function(e,t,i){var r;if(t){if(q)return q.call(t,e,i);for(r=t.length,i=i?i<0?Math.max(0,r+i):i:0;i<r;i++)if(i in t&&t[i]===e)return i}return-1},merge:function(e,t){var i=t.length,r=e.length,n=0;if("number"==typeof i)for(;n<i;n++)e[r++]=t[n];else for(;t[n]!==_;)e[r++]=t[n++];return e.length=r,e},grep:function(e,t,i){var r=[],n=0,o=e.length;for(i=!!i;n<o;n++)i!==!!t(e[n],n)&&r.push(e[n]);return r},map:function(e,t,i){var r,n,o=[],s=0,a=e.length;if(e instanceof b||a!==_&&"number"==typeof a&&(0<a&&e[0]&&e[a-1]||0===a||b.isArray(e)))for(;s<a;s++)null!=(r=t(e[s],s,i))&&(o[o.length]=r);else for(n in e)null!=(r=t(e[n],n,i))&&(o[o.length]=r);return o.concat.apply([],o)},guid:1,proxy:function(e,t){var i,r;return"string"==typeof t&&(r=e[t],t=e,e=r),b.isFunction(e)?(i=p.call(arguments,2),(r=function(){return e.apply(t,i.concat(p.call(arguments)))}).guid=e.guid=e.guid||r.guid||b.guid++,r):_},access:function(e,t,i,r,n,o,s){var a,l=null==i,c=0,p=e.length;if(i&&"object"==typeof i){for(c in i)b.access(e,t,c,i[c],1,o,r);n=1}else if(r!==_){if(a=s===_&&b.isFunction(r),t=l?a?(a=t,function(e,t,i){return a.call(b(e),i)}):(t.call(e,r),null):t)for(;c<p;c++)t(e[c],i,a?r.call(e[c],c,t(e[c],i)):r,s);n=1}return n?e:l?t.call(e):p?t(e[0],i):o},now:function(){return(new Date).getTime()}}),b.ready.promise=function(e){if(!z)if(z=b.Deferred(),"complete"===v.readyState||"loading"!==v.readyState&&v.addEventListener)setTimeout(b.ready,1);else if(v.addEventListener)v.addEventListener("DOMContentLoaded",M,!1),y.addEventListener("load",b.ready,!1);else{v.attachEvent("onreadystatechange",M),y.attachEvent("onload",b.ready);var i=!1;try{i=null==y.frameElement&&v.documentElement}catch(e){}i&&i.doScroll&&!function t(){if(!b.isReady){try{i.doScroll("left")}catch(e){return setTimeout(t,50)}b.ready()}}()}return z.promise(e)},b.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(e,t){se["[object "+t+"]"]=t.toLowerCase()}),U=b(v),{});b.Callbacks=function(r){var e,i;r="string"==typeof r?ae[r]||(i=ae[e=r]={},b.each(e.split(E),function(e,t){i[t]=!0}),i):b.extend({},r);function n(e){for(t=r.memory&&e,o=!0,c=a||0,a=0,l=p.length,s=!0;p&&c<l;c++)if(!1===p[c].apply(e[0],e[1])&&r.stopOnFalse){t=!1;break}s=!1,p&&(h?h.length&&n(h.shift()):t?p=[]:u.disable())}var t,o,s,a,l,c,p=[],h=!r.once&&[],u={add:function(){var e;return p&&(e=p.length,function i(e){b.each(e,function(e,t){!b.isFunction(t)||r.unique&&u.has(t)?t&&t.length&&i(t):p.push(t)})}(arguments),s?l=p.length:t&&(a=e,n(t))),this},remove:function(){return p&&b.each(arguments,function(e,t){for(var i;-1<(i=b.inArray(t,p,i));)p.splice(i,1),s&&(i<=l&&l--,i<=c)&&c--}),this},has:function(e){return-1<b.inArray(e,p)},empty:function(){return p=[],this},disable:function(){return p=h=t=_,this},disabled:function(){return!p},lock:function(){return h=_,t||u.disable(),this},locked:function(){return!h},fireWith:function(e,t){return t=[e,(t=t||[]).slice?t.slice():t],!p||o&&!h||(s?h.push(t):n(t)),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!o}};return u},b.extend({Deferred:function(e){var s=[["resolve","done",b.Callbacks("once memory"),"resolved"],["reject","fail",b.Callbacks("once memory"),"rejected"],["notify","progress",b.Callbacks("memory")]],n="pending",o={state:function(){return n},always:function(){return a.done(arguments).fail(arguments),this},then:function(){var o=arguments;return b.Deferred(function(n){b.each(s,function(e,t){var i=t[0],r=o[e];a[t[1]](b.isFunction(r)?function(){var e=r.apply(this,arguments);e&&b.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[i+"With"](this===a?n:this,[e])}:n[i])}),o=null}).promise()},promise:function(e){return"object"==typeof e?b.extend(e,o):o}},a={};return o.pipe=o.then,b.each(s,function(e,t){var i=t[2],r=t[3];o[t[1]]=i.add,r&&i.add(function(){n=r},s[1^e][2].disable,s[2][2].lock),a[t[0]]=i.fire,a[t[0]+"With"]=i.fireWith}),o.promise(a),e&&e.call(a,a),a},when:function(e){function t(t,i,r){return function(e){i[t]=this,r[t]=1<arguments.length?p.call(arguments):e,r===n?c.notifyWith(i,r):--l||c.resolveWith(i,r)}}var n,i,r,o=0,s=p.call(arguments),a=s.length,l=1!==a||e&&b.isFunction(e.promise)?a:0,c=1===l?e:b.Deferred();if(1<a)for(n=new Array(a),i=new Array(a),r=new Array(a);o<a;o++)s[o]&&b.isFunction(s[o].promise)?s[o].promise().done(t(o,r,s)).fail(c.reject).progress(t(o,i,n)):--l;return l||c.resolveWith(r,s),c.promise()}}),b.support=function(){var o,e,t,i,r,n,s,a,l=v.createElement("div");if(l.setAttribute("className","t"),l.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",t=l.getElementsByTagName("*"),(e=l.getElementsByTagName("a")[0]).style.cssText="top:1px;float:left;opacity:.5",!t||!t.length||!e)return{};a=(t=v.createElement("select")).appendChild(v.createElement("option")),i=l.getElementsByTagName("input")[0],o={leadingWhitespace:3===l.firstChild.nodeType,tbody:!l.getElementsByTagName("tbody").length,htmlSerialize:!!l.getElementsByTagName("link").length,style:/top/.test(e.getAttribute("style")),hrefNormalized:"/a"===e.getAttribute("href"),opacity:/^0.5/.test(e.style.opacity),cssFloat:!!e.style.cssFloat,checkOn:"on"===i.value,optSelected:a.selected,getSetAttribute:"t"!==l.className,enctype:!!v.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==v.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===v.compatMode,submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},i.checked=!0,o.noCloneChecked=i.cloneNode(!0).checked,t.disabled=!0,o.optDisabled=!a.disabled;try{delete l.test}catch(e){o.deleteExpando=!1}if(!l.addEventListener&&l.attachEvent&&l.fireEvent&&(l.attachEvent("onclick",a=function(){o.noCloneEvent=!1}),l.cloneNode(!0).fireEvent("onclick"),l.detachEvent("onclick",a)),(i=v.createElement("input")).value="t",i.setAttribute("type","radio"),o.radioValue="t"===i.value,i.setAttribute("checked","checked"),i.setAttribute("name","t"),l.appendChild(i),(a=v.createDocumentFragment()).appendChild(l.lastChild),o.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,o.appendChecked=i.checked,a.removeChild(i),a.appendChild(l),l.attachEvent)for(n in{submit:!0,change:!0,focusin:!0})(s=(r="on"+n)in l)||(l.setAttribute(r,"return;"),s="function"==typeof l[r]),o[n+"Bubbles"]=s;return b(function(){var e,t,i,r="padding:0;margin:0;border:0;display:block;overflow:hidden;",n=v.getElementsByTagName("body")[0];n&&((e=v.createElement("div")).style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",n.insertBefore(e,n.firstChild),t=v.createElement("div"),e.appendChild(t),t.innerHTML="<table><tr><td></td><td>t</td></tr></table>",(i=t.getElementsByTagName("td"))[0].style.cssText="padding:0;margin:0;border:0;display:none",s=0===i[0].offsetHeight,i[0].style.display="",i[1].style.display="none",o.reliableHiddenOffsets=s&&0===i[0].offsetHeight,t.innerHTML="",t.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",o.boxSizing=4===t.offsetWidth,o.doesNotIncludeMarginInBodyOffset=1!==n.offsetTop,y.getComputedStyle&&(o.pixelPosition="1%"!==(y.getComputedStyle(t,null)||{}).top,o.boxSizingReliable="4px"===(y.getComputedStyle(t,null)||{width:"4px"}).width,(i=v.createElement("div")).style.cssText=t.style.cssText=r,i.style.marginRight=i.style.width="0",t.style.width="1px",t.appendChild(i),o.reliableMarginRight=!parseFloat((y.getComputedStyle(i,null)||{}).marginRight)),void 0!==t.style.zoom&&(t.innerHTML="",t.style.cssText=r+"width:1px;padding:1px;display:inline;zoom:1",o.inlineBlockNeedsLayout=3===t.offsetWidth,t.style.display="block",t.style.overflow="visible",t.innerHTML="<div></div>",t.firstChild.style.width="5px",o.shrinkWrapBlocks=3!==t.offsetWidth,e.style.zoom=1),n.removeChild(e))}),a.removeChild(l),e=t=i=a=l=null,o}();var le=/^(?:\{.*\}|\[.*\])$/,ce=/([A-Z])/g;function pe(e,t,i){if(i===_&&1===e.nodeType){var r="data-"+t.replace(ce,"-$1").toLowerCase();if("string"==typeof(i=e.getAttribute(r))){try{i="true"===i||"false"!==i&&("null"===i?null:+i+""===i?+i:le.test(i)?b.parseJSON(i):i)}catch(e){}b.data(e,t,i)}else i=_}return i}function he(e){for(var t in e)if(("data"!==t||!b.isEmptyObject(e[t]))&&"toJSON"!==t)return;return 1}b.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(b.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return!!(e=e.nodeType?b.cache[e[b.expando]]:e[b.expando])&&!he(e)},data:function(e,t,i,r){if(b.acceptData(e)){var n,o=b.expando,s="string"==typeof t,a=e.nodeType,l=a?b.cache:e,c=a?e[o]:e[o]&&o;if(c&&l[c]&&(r||l[c].data)||!s||i!==_)return c||(a?e[o]=c=b.deletedIds.pop()||++b.uuid:c=o),l[c]||(l[c]={},a)||(l[c].toJSON=b.noop),"object"!=typeof t&&"function"!=typeof t||(r?l[c]=b.extend(l[c],t):l[c].data=b.extend(l[c].data,t)),e=l[c],r||(e.data||(e.data={}),e=e.data),i!==_&&(e[b.camelCase(t)]=i),s?null==(n=e[t])&&(n=e[b.camelCase(t)]):n=e,n}},removeData:function(e,t,i){if(b.acceptData(e)){var r,n,o,s=e.nodeType,a=s?b.cache:e,l=s?e[b.expando]:b.expando;if(a[l]){if(t&&(r=i?a[l]:a[l].data)){for((n=0,o=(t=b.isArray(t)?t:t in r||(t=b.camelCase(t))in r?[t]:t.split(" ")).length);n<o;n++)delete r[t[n]];if(!(i?he:b.isEmptyObject)(r))return}(i||(delete a[l].data,he(a[l])))&&(s?b.cleanData([e],!0):b.support.deleteExpando||a!=a.window?delete a[l]:a[l]=null)}}},_data:function(e,t,i){return b.data(e,t,i,!0)},acceptData:function(e){var t=e.nodeName&&b.noData[e.nodeName.toLowerCase()];return!t||!0!==t&&e.getAttribute("classid")===t}}),b.fn.extend({data:function(i,e){var r,n,t,o,s,a=this[0],l=0,c=null;if(i!==_)return"object"==typeof i?this.each(function(){b.data(this,i)}):((r=i.split(".",2))[1]=r[1]?"."+r[1]:"",n=r[1]+"!",b.access(this,function(t){if(t===_)return(c=this.triggerHandler("getData"+n,[r[0]]))===_&&a&&(c=b.data(a,i),c=pe(a,i,c)),c===_&&r[1]?this.data(r[0]):c;r[1]=t,this.each(function(){var e=b(this);e.triggerHandler("setData"+n,r),b.data(this,i,t),e.triggerHandler("changeData"+n,r)})},null,e,1<arguments.length,null,!1));if(this.length&&(c=b.data(a),1===a.nodeType)&&!b._data(a,"parsedAttrs")){for(s=(t=a.attributes).length;l<s;l++)0===(o=t[l].name).indexOf("data-")&&(o=b.camelCase(o.substring(5)),pe(a,o,c[o]));b._data(a,"parsedAttrs",!0)}return c},removeData:function(e){return this.each(function(){b.removeData(this,e)})}}),b.extend({queue:function(e,t,i){var r;if(e)return r=b._data(e,t=(t||"fx")+"queue"),i&&(!r||b.isArray(i)?r=b._data(e,t,b.makeArray(i)):r.push(i)),r||[]},dequeue:function(e,t){t=t||"fx";var i=b.queue(e,t),r=i.shift(),n=b._queueHooks(e,t);(r="inprogress"===r?i.shift():r)&&("fx"===t&&i.unshift("inprogress"),delete n.stop,r.call(e,function(){b.dequeue(e,t)},n)),!i.length&&n&&n.empty.fire()},_queueHooks:function(e,t){var i=t+"queueHooks";return b._data(e,i)||b._data(e,i,{empty:b.Callbacks("once memory").add(function(){b.removeData(e,t+"queue",!0),b.removeData(e,i,!0)})})}}),b.fn.extend({queue:function(t,i){var e=2;return"string"!=typeof t&&(i=t,t="fx",e--),arguments.length<e?b.queue(this[0],t):i===_?this:this.each(function(){var e=b.queue(this,t,i);b._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&b.dequeue(this,t)})},dequeue:function(e){return this.each(function(){b.dequeue(this,e)})},delay:function(r,e){return r=b.fx&&b.fx.speeds[r]||r,this.queue(e=e||"fx",function(e,t){var i=setTimeout(e,r);t.stop=function(){clearTimeout(i)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){function i(){--n||o.resolveWith(s,[s])}var r,n=1,o=b.Deferred(),s=this,a=this.length;for("string"!=typeof e&&(t=e,e=_),e=e||"fx";a--;)(r=b._data(s[a],e+"queueHooks"))&&r.empty&&(n++,r.empty.add(i));return i(),o.promise(t)}});function ue(e){return b.event.special.hover?e:e.replace(Ee,"mouseenter$1 mouseleave$1")}var a,de,fe,ge=/[\t\r\n]/g,me=/\r/g,ye=/^(?:button|input)$/i,ve=/^(?:button|input|object|select|textarea)$/i,Se=/^a(?:rea|)$/i,Ce=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,ke=b.support.getSetAttribute,_e=(b.fn.extend({attr:function(e,t){return b.access(this,b.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){b.removeAttr(this,e)})},prop:function(e,t){return b.access(this,b.prop,e,t,1<arguments.length)},removeProp:function(e){return e=b.propFix[e]||e,this.each(function(){try{this[e]=_,delete this[e]}catch(e){}})},addClass:function(t){var e,i,r,n,o,s,a;if(b.isFunction(t))return this.each(function(e){b(this).addClass(t.call(this,e,this.className))});if(t&&"string"==typeof t)for(e=t.split(E),i=0,r=this.length;i<r;i++)if(1===(n=this[i]).nodeType)if(n.className||1!==e.length){for(o=" "+n.className+" ",s=0,a=e.length;s<a;s++)~o.indexOf(" "+e[s]+" ")||(o+=e[s]+" ");n.className=b.trim(o)}else n.className=t;return this},removeClass:function(t){var e,i,r,n,o,s,a;if(b.isFunction(t))return this.each(function(e){b(this).removeClass(t.call(this,e,this.className))});if(t&&"string"==typeof t||t===_)for(e=(t||"").split(E),s=0,a=this.length;s<a;s++)if(1===(r=this[s]).nodeType&&r.className){for(i=(" "+r.className+" ").replace(ge," "),n=0,o=e.length;n<o;n++)for(;-1<i.indexOf(" "+e[n]+" ");)i=i.replace(" "+e[n]+" "," ");r.className=t?b.trim(i):""}return this},toggleClass:function(o,s){var a=typeof o,l="boolean"==typeof s;return b.isFunction(o)?this.each(function(e){b(this).toggleClass(o.call(this,e,this.className,s),s)}):this.each(function(){if("string"==a)for(var e,t=0,i=b(this),r=s,n=o.split(E);e=n[t++];)r=l?r:!i.hasClass(e),i[r?"addClass":"removeClass"](e);else"undefined"!=a&&"boolean"!=a||(this.className&&b._data(this,"__className__",this.className),this.className=!this.className&&!1!==o&&b._data(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",i=0,r=this.length;i<r;i++)if(1===this[i].nodeType&&-1<(" "+this[i].className+" ").replace(ge," ").indexOf(t))return!0;return!1},val:function(i){var r,e,n,t=this[0];return arguments.length?(n=b.isFunction(i),this.each(function(e){var t=b(this);1!==this.nodeType||(null==(e=n?i.call(this,e,t.val()):i)?e="":"number"==typeof e?e+="":b.isArray(e)&&(e=b.map(e,function(e){return null==e?"":e+""})),(r=b.valHooks[this.type]||b.valHooks[this.nodeName.toLowerCase()])&&"set"in r&&r.set(this,e,"value")!==_)||(this.value=e)})):t?(r=b.valHooks[t.type]||b.valHooks[t.nodeName.toLowerCase()])&&"get"in r&&(e=r.get(t,"value"))!==_?e:"string"==typeof(e=t.value)?e.replace(me,""):null==e?"":e:void 0}}),b.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,i,r,n=e.selectedIndex,o=[],s=e.options,a="select-one"===e.type;if(n<0)return null;for(t=a?n:0,i=a?n+1:s.length;t<i;t++)if((r=s[t]).selected&&(b.support.optDisabled?!r.disabled:null===r.getAttribute("disabled"))&&(!r.parentNode.disabled||!b.nodeName(r.parentNode,"optgroup"))){if(r=b(r).val(),a)return r;o.push(r)}return a&&!o.length&&s.length?b(s[n]).val():o},set:function(e,t){var i=b.makeArray(t);return b(e).find("option").each(function(){this.selected=0<=b.inArray(b(this).val(),i)}),i.length||(e.selectedIndex=-1),i}}},attrFn:{},attr:function(e,t,i,r){var n,o,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return r&&b.isFunction(b.fn[t])?b(e)[t](i):void 0===e.getAttribute?b.prop(e,t,i):((r=1!==s||!b.isXMLDoc(e))&&(t=t.toLowerCase(),o=b.attrHooks[t]||(Ce.test(t)?de:a)),i===_?!(o&&"get"in o&&r&&null!==(n=o.get(e,t)))&&null===(n=e.getAttribute(t))?_:n:null!==i?o&&"set"in o&&r&&(n=o.set(e,i,t))!==_?n:(e.setAttribute(t,""+i),i):void b.removeAttr(e,t))},removeAttr:function(e,t){var i,r,n,o,s=0;if(t&&1===e.nodeType)for(r=t.split(E);s<r.length;s++)(n=r[s])&&(i=b.propFix[n]||n,(o=Ce.test(n))||b.attr(e,n,""),e.removeAttribute(ke?n:i),o)&&i in e&&(e[i]=!1)},attrHooks:{type:{set:function(e,t){var i;if(ye.test(e.nodeName)&&e.parentNode)b.error("type property can't be changed");else if(!b.support.radioValue&&"radio"===t&&b.nodeName(e,"input"))return i=e.value,e.setAttribute("type",t),i&&(e.value=i),t}},value:{get:function(e,t){return a&&b.nodeName(e,"button")?a.get(e,t):t in e?e.value:null},set:function(e,t,i){if(a&&b.nodeName(e,"button"))return a.set(e,t,i);e.value=t}}},propFix:{tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,t,i){var r,n,o=e.nodeType;if(e&&3!==o&&8!==o&&2!==o)return(1!==o||!b.isXMLDoc(e))&&(t=b.propFix[t]||t,n=b.propHooks[t]),i!==_?n&&"set"in n&&(r=n.set(e,i,t))!==_?r:e[t]=i:n&&"get"in n&&null!==(r=n.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=e.getAttributeNode("tabindex");return t&&t.specified?parseInt(t.value,10):ve.test(e.nodeName)||Se.test(e.nodeName)&&e.href?0:_}}}}),de={get:function(e,t){var i=b.prop(e,t);return!0===i||"boolean"!=typeof i&&(i=e.getAttributeNode(t))&&!1!==i.nodeValue?t.toLowerCase():_},set:function(e,t,i){return!1===t?b.removeAttr(e,i):((t=b.propFix[i]||i)in e&&(e[t]=!0),e.setAttribute(i,i.toLowerCase())),i}},ke||(fe={name:!0,id:!0,coords:!0},a=b.valHooks.button={get:function(e,t){e=e.getAttributeNode(t);return e&&(fe[t]?""!==e.value:e.specified)?e.value:_},set:function(e,t,i){var r=e.getAttributeNode(i);return r||(r=v.createAttribute(i),e.setAttributeNode(r)),r.value=t+""}},b.each(["width","height"],function(e,i){b.attrHooks[i]=b.extend(b.attrHooks[i],{set:function(e,t){if(""===t)return e.setAttribute(i,"auto"),t}})}),b.attrHooks.contenteditable={get:a.get,set:function(e,t,i){a.set(e,t=""===t?"false":t,i)}}),b.support.hrefNormalized||b.each(["href","src","width","height"],function(e,t){b.attrHooks[t]=b.extend(b.attrHooks[t],{get:function(e){e=e.getAttribute(t,2);return null===e?_:e}})}),b.support.style||(b.attrHooks.style={get:function(e){return e.style.cssText.toLowerCase()||_},set:function(e,t){return e.style.cssText=""+t}}),b.support.optSelected||(b.propHooks.selected=b.extend(b.propHooks.selected,{get:function(e){e=e.parentNode;return e&&(e.selectedIndex,e.parentNode)&&e.parentNode.selectedIndex,null}})),b.support.enctype||(b.propFix.enctype="encoding"),b.support.checkOn||b.each(["radio","checkbox"],function(){b.valHooks[this]={get:function(e){return null===e.getAttribute("value")?"on":e.value}}}),b.each(["radio","checkbox"],function(){b.valHooks[this]=b.extend(b.valHooks[this],{set:function(e,t){if(b.isArray(t))return e.checked=0<=b.inArray(b(e).val(),t)}})}),/^(?:textarea|input|select)$/i),be=/^([^\.]*|)(?:\.(.+)|)$/,Ee=/(?:^|\s)hover(\.\S+|)\b/,we=/^key/,Te=/^(?:mouse|contextmenu)|click/,Pe=/^(?:focusinfocus|focusoutblur)$/;function l(){return!1}function Ie(){return!0}b.event={add:function(e,t,i,r,n){var o,s,a,l,c,p,h,u,d,f;if(3!==e.nodeType&&8!==e.nodeType&&t&&i&&(o=b._data(e)))for(i.handler&&(i=(u=i).handler,n=u.selector),i.guid||(i.guid=b.guid++),(a=o.events)||(o.events=a={}),(s=o.handle)||(o.handle=s=function(e){return void 0===b||e&&b.event.triggered===e.type?_:b.event.dispatch.apply(s.elem,arguments)},s.elem=e),t=b.trim(ue(t)).split(" "),l=0;l<t.length;l++)c=(h=be.exec(t[l])||[])[1],p=(h[2]||"").split(".").sort(),f=b.event.special[c]||{},c=(n?f.delegateType:f.bindType)||c,f=b.event.special[c]||{},h=b.extend({type:c,origType:h[1],data:r,handler:i,guid:i.guid,selector:n,namespace:p.join(".")},u),(d=a[c])||((d=a[c]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(e,r,p,s))||(e.addEventListener?e.addEventListener(c,s,!1):e.attachEvent&&e.attachEvent("on"+c,s)),f.add&&(f.add.call(e,h),h.handler.guid||(h.handler.guid=i.guid)),n?d.splice(d.delegateCount++,0,h):d.push(h),b.event.global[c]=!0},global:{},remove:function(e,t,i,r,n){var o,s,a,l,c,p,h,u,d,f,g=b.hasData(e)&&b._data(e);if(g&&(h=g.events)){for(t=b.trim(ue(t||"")).split(" "),o=0;o<t.length;o++)if(s=a=(c=be.exec(t[o])||[])[1],l=c[2],s){for(u=b.event.special[s]||{},c=(d=h[s=(r?u.delegateType:u.bindType)||s]||[]).length,l=l?new RegExp("(^|\\.)"+l.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null,p=0;p<d.length;p++)f=d[p],!n&&a!==f.origType||i&&i.guid!==f.guid||l&&!l.test(f.namespace)||r&&r!==f.selector&&("**"!==r||!f.selector)||(d.splice(p--,1),f.selector&&d.delegateCount--,u.remove&&u.remove.call(e,f));0===d.length&&c!==d.length&&(u.teardown&&!1!==u.teardown.call(e,l,g.handle)||b.removeEvent(e,s,g.handle),delete h[s])}else for(s in h)b.event.remove(e,s+t[o],i,r,!0);b.isEmptyObject(h)&&(delete g.handle,b.removeData(e,"events",!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(e,t,i,r){if(!i||3!==i.nodeType&&8!==i.nodeType){var n,o,s,a,l,c,p,h,u,d=e.type||e,f=[];if(!Pe.test(d+b.event.triggered)&&(0<=d.indexOf("!")&&(d=d.slice(0,-1),c=!0),0<=d.indexOf(".")&&(d=(f=d.split(".")).shift(),f.sort()),i&&!b.event.customEvent[d]||b.event.global[d]))if((e="object"==typeof e?e[b.expando]?e:new b.Event(d,e):new b.Event(d)).type=d,e.isTrigger=!0,e.exclusive=c,e.namespace=f.join("."),e.namespace_re=e.namespace?new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,l=d.indexOf(":")<0?"on"+d:"",i){if(e.result=_,e.target||(e.target=i),(t=null!=t?b.makeArray(t):[]).unshift(e),!(c=b.event.special[d]||{}).trigger||!1!==c.trigger.apply(i,t)){if(h=[[i,c.bindType||d]],!r&&!c.noBubble&&!b.isWindow(i)){for(u=c.delegateType||d,s=Pe.test(u+d)?i:i.parentNode,a=i;s;s=s.parentNode)h.push([s,u]),a=s;a===(i.ownerDocument||v)&&h.push([a.defaultView||a.parentWindow||y,u])}for(o=0;o<h.length&&!e.isPropagationStopped();o++)s=h[o][0],e.type=h[o][1],(p=(b._data(s,"events")||{})[e.type]&&b._data(s,"handle"))&&p.apply(s,t),(p=l&&s[l])&&b.acceptData(s)&&!1===p.apply(s,t)&&e.preventDefault();return e.type=d,r||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(i.ownerDocument,t)||"click"===d&&b.nodeName(i,"a")||!b.acceptData(i)||l&&i[d]&&("focus"!==d&&"blur"!==d||0!==e.target.offsetWidth)&&!b.isWindow(i)&&((a=i[l])&&(i[l]=null),i[b.event.triggered=d](),b.event.triggered=_,a)&&(i[l]=a),e.result}}else for(o in n=b.cache)n[o].events&&n[o].events[d]&&b.event.trigger(e,t,n[o].handle.elem,!0)}},dispatch:function(e){e=b.event.fix(e||y.event);var t,i,r,n,o,s,a,l,c,p,h=(b._data(this,"events")||{})[e.type]||[],u=h.delegateCount,d=[].slice.call(arguments),f=!e.exclusive&&!e.namespace,g=b.event.special[e.type]||{},m=[];if((d[0]=e).delegateTarget=this,!g.preDispatch||!1!==g.preDispatch.call(this,e)){if(u&&(!e.button||"click"!==e.type))for((n=b(this)).context=this,r=e.target;r!=this;r=r.parentNode||this)if(!0!==r.disabled||"click"!==e.type){for(s={},l=[],n[0]=r,t=0;t<u;t++)s[p=(c=h[t]).selector]===_&&(s[p]=n.is(p)),s[p]&&l.push(c);l.length&&m.push({elem:r,matches:l})}for(h.length>u&&m.push({elem:this,matches:h.slice(u)}),t=0;t<m.length&&!e.isPropagationStopped();t++)for(a=m[t],e.currentTarget=a.elem,i=0;i<a.matches.length&&!e.isImmediatePropagationStopped();i++)c=a.matches[i],(f||!e.namespace&&!c.namespace||e.namespace_re&&e.namespace_re.test(c.namespace))&&(e.data=c.data,e.handleObj=c,(o=((b.event.special[c.origType]||{}).handle||c.handler).apply(a.elem,d))!==_)&&!1===(e.result=o)&&(e.preventDefault(),e.stopPropagation());return g.postDispatch&&g.postDispatch.call(this,e),e.result}},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var i,r,n=t.button,o=t.fromElement;return null==e.pageX&&null!=t.clientX&&(i=(r=e.target.ownerDocument||v).documentElement,r=r.body,e.pageX=t.clientX+(i&&i.scrollLeft||r&&r.scrollLeft||0)-(i&&i.clientLeft||r&&r.clientLeft||0),e.pageY=t.clientY+(i&&i.scrollTop||r&&r.scrollTop||0)-(i&&i.clientTop||r&&r.clientTop||0)),!e.relatedTarget&&o&&(e.relatedTarget=o===e.target?t.toElement:o),e.which||n===_||(e.which=1&n?1:2&n?3:4&n?2:0),e}},fix:function(e){if(e[b.expando])return e;var t,i,r=e,n=b.event.fixHooks[e.type]||{},o=n.props?this.props.concat(n.props):this.props;for(e=b.Event(r),t=o.length;t;)e[i=o[--t]]=r[i];return e.target||(e.target=r.srcElement||v),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,n.filter?n.filter(e,r):e},special:{ready:{setup:b.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(e,t,i){b.isWindow(this)&&(this.onbeforeunload=i)},teardown:function(e,t){this.onbeforeunload===t&&(this.onbeforeunload=null)}}},simulate:function(e,t,i,r){e=b.extend(new b.Event,i,{type:e,isSimulated:!0,originalEvent:{}});r?b.event.trigger(e,null,t):b.event.dispatch.call(t,e),e.isDefaultPrevented()&&i.preventDefault()}},b.event.handle=b.event.dispatch,b.removeEvent=v.removeEventListener?function(e,t,i){e.removeEventListener&&e.removeEventListener(t,i,!1)}:function(e,t,i){t="on"+t;e.detachEvent&&(void 0===e[t]&&(e[t]=null),e.detachEvent(t,i))},b.Event=function(e,t){if(!(this instanceof b.Event))return new b.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||!1===e.returnValue||e.getPreventDefault&&e.getPreventDefault()?Ie:l):this.type=e,t&&b.extend(this,t),this.timeStamp=e&&e.timeStamp||b.now(),this[b.expando]=!0},b.Event.prototype={preventDefault:function(){this.isDefaultPrevented=Ie;var e=this.originalEvent;e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=Ie;var e=this.originalEvent;e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=Ie,this.stopPropagation()},isDefaultPrevented:l,isPropagationStopped:l,isImmediatePropagationStopped:l},b.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,n){b.event.special[e]={delegateType:n,bindType:n,handle:function(e){var t,i=e.relatedTarget,r=e.handleObj;r.selector;return i&&(i===this||b.contains(this,i))||(e.type=r.origType,t=r.handler.apply(this,arguments),e.type=n),t}}}),b.support.submitBubbles||(b.event.special.submit={setup:function(){if(b.nodeName(this,"form"))return!1;b.event.add(this,"click._submit keypress._submit",function(e){e=e.target,e=b.nodeName(e,"input")||b.nodeName(e,"button")?e.form:_;e&&!b._data(e,"_submit_attached")&&(b.event.add(e,"submit._submit",function(e){e._submit_bubble=!0}),b._data(e,"_submit_attached",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode)&&!e.isTrigger&&b.event.simulate("submit",this.parentNode,e,!0)},teardown:function(){if(b.nodeName(this,"form"))return!1;b.event.remove(this,"._submit")}}),b.support.changeBubbles||(b.event.special.change={setup:function(){if(_e.test(this.nodeName))return"checkbox"!==this.type&&"radio"!==this.type||(b.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),b.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),b.event.simulate("change",this,e,!0)})),!1;b.event.add(this,"beforeactivate._change",function(e){e=e.target;_e.test(e.nodeName)&&!b._data(e,"_change_attached")&&(b.event.add(e,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||b.event.simulate("change",this.parentNode,e,!0)}),b._data(e,"_change_attached",!0))})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||"radio"!==t.type&&"checkbox"!==t.type)return e.handleObj.handler.apply(this,arguments)},teardown:function(){return b.event.remove(this,"._change"),_e.test(this.nodeName)}}),b.support.focusinBubbles||b.each({focus:"focusin",blur:"focusout"},function(e,t){function i(e){b.event.simulate(t,e.target,b.event.fix(e),!0)}var r=0;b.event.special[t]={setup:function(){0==r++&&v.addEventListener(e,i,!0)},teardown:function(){0==--r&&v.removeEventListener(e,i,!0)}}}),b.fn.extend({on:function(e,t,i,r,n){var o,s;if("object"==typeof e){for(s in"string"!=typeof t&&(i=i||t,t=_),e)this.on(s,t,i,e[s],n);return this}if(null==i&&null==r?(r=t,i=t=_):null==r&&("string"==typeof t?(r=i,i=_):(r=i,i=t,t=_)),!1===r)r=l;else if(!r)return this;return 1===n&&(o=r,(r=function(e){return b().off(e),o.apply(this,arguments)}).guid=o.guid||(o.guid=b.guid++)),this.each(function(){b.event.add(this,e,r,i,t)})},one:function(e,t,i,r){return this.on(e,t,i,r,1)},off:function(e,t,i){var r,n;if(e&&e.preventDefault&&e.handleObj)r=e.handleObj,b(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler);else{if("object"!=typeof e)return!1!==t&&"function"!=typeof t||(i=t,t=_),!1===i&&(i=l),this.each(function(){b.event.remove(this,e,i,t)});for(n in e)this.off(n,t,e[n])}return this},bind:function(e,t,i){return this.on(e,null,t,i)},unbind:function(e,t){return this.off(e,null,t)},live:function(e,t,i){return b(this.context).on(e,this.selector,t,i),this},die:function(e,t){return b(this.context).off(e,this.selector||"**",t),this},delegate:function(e,t,i,r){return this.on(t,e,i,r)},undelegate:function(e,t,i){return 1==arguments.length?this.off(e,"**"):this.off(t,e||"**",i)},trigger:function(e,t){return this.each(function(){b.event.trigger(e,t,this)})},triggerHandler:function(e,t){if(this[0])return b.event.trigger(e,t,this[0],!0)},toggle:function(i){function e(e){var t=(b._data(this,"lastToggle"+i.guid)||0)%n;return b._data(this,"lastToggle"+i.guid,1+t),e.preventDefault(),r[t].apply(this,arguments)||!1}var r=arguments,t=i.guid||b.guid++,n=0;for(e.guid=t;n<r.length;)r[n++].guid=t;return this.click(e)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),b.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,i){b.fn[i]=function(e,t){return null==t&&(t=e,e=null),0<arguments.length?this.on(i,null,e,t):this.trigger(i)},we.test(i)&&(b.event.fixHooks[i]=b.event.keyHooks),Te.test(i)&&(b.event.fixHooks[i]=b.event.mouseHooks)});var xe=void 0;function Le(e){return e.sizzleFilter=!0,e}function e(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function Ae(i){return function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&e.type===i}}function t(e){var t=!1,i=f.createElement("div");try{t=e(i)}catch(e){}return t}var Re,De,Fe,h,Oe,f=y.document,i=f.documentElement,r="undefined",Ne=!1,Me=!0,Ue=0,S=[].slice,w=[].push,c=("sizcache"+Math.random()).replace(".",""),T="[\\x20\\t\\r\\n\\f]",n=(u="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+").replace("w","w#"),o=":("+u+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|((?:[^,]|\\\\,|(?:,(?=[^\\[]*\\]))|(?:,(?=[^\\(]*\\))))*))\\)|)",s=":(nth|eq|gt|lt|first|last|even|odd)(?:\\((\\d*)\\)|)(?=[^-]|$)",ze=T+"*([\\x20\\t\\r\\n\\f>+~])"+T+"*",Be="(?=[^\\x20\\t\\r\\n\\f])(?:\\\\.|"+(n="\\["+T+"*("+u+")"+T+"*(?:([*^$|!~]?=)"+T+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+n+")|)|)"+T+"*\\]")+"|"+o.replace(2,7)+"|[^\\\\(),])+",He=new RegExp("^"+T+"+|((?:^|[^\\\\])(?:\\\\.)*)"+T+"+$","g"),We=new RegExp("^"+ze),$e=new RegExp(Be+"?(?="+T+"*,|$)","g"),Ge=new RegExp("^(?:(?!,)(?:(?:^|,)"+T+"*"+Be+")*?|"+T+"*(.*?))(\\)|$)"),qe=new RegExp(Be.slice(19,-6)+"\\x20\\t\\r\\n\\f>+~])+|"+ze,"g"),je=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,Ke=/[\x20\t\r\n\f]*[+~]/,Ve=/:not\($/,Ze=/h\d/i,Ye=/input|select|textarea|button/i,C=/\\(?!\\)/g,P={ID:new RegExp("^#("+u+")"),CLASS:new RegExp("^\\.("+u+")"),NAME:new RegExp("^\\[name=['\"]?("+u+")['\"]?\\]"),TAG:new RegExp("^("+u.replace("[-","[-\\*")+")"),ATTR:new RegExp("^"+n),PSEUDO:new RegExp("^"+o),CHILD:new RegExp("^:(only|nth|last|first)-child(?:\\("+T+"*(even|odd|(([+-]|)(\\d*)n|)"+T+"*(?:([+-]|)"+T+"*(\\d+)|))"+T+"*\\)|)","i"),POS:new RegExp(s,"ig"),needsContext:new RegExp("^"+T+"*[>+~]|"+s,"i")},Xe={},Qe=[],Je={},et=[],tt=t(function(e){e.innerHTML="<select></select>";e=typeof e.lastChild.getAttribute("multiple");return"boolean"!=e&&"string"!=e}),Be=t(function(e){e.id=c+0,e.innerHTML="<a name='"+c+"'></a><div name='"+c+"'></div>",i.insertBefore(e,i.firstChild);var t=f.getElementsByName&&f.getElementsByName(c).length===2+f.getElementsByName(c+0).length;return Oe=!f.getElementById(c),i.removeChild(e),t}),ze=t(function(e){return e.appendChild(f.createComment("")),0===e.getElementsByTagName("*").length}),u=t(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!=r&&"#"===e.firstChild.getAttribute("href")}),it=t(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!(!e.getElementsByClassName||0===e.getElementsByClassName("e").length)&&(e.lastChild.className="e",1!==e.getElementsByClassName("e").length)}),I=function(e,t,i,r){i=i||[];var n,o,s,a,l=(t=t||f).nodeType;if(1!==l&&9!==l)return[];if(!e||"string"!=typeof e)return i;if(!(s=rt(t))&&!r&&(n=je.exec(e)))if(a=n[1]){if(9===l){if(!(o=t.getElementById(a))||!o.parentNode)return i;if(o.id===a)return i.push(o),i}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(a))&&nt(t,o)&&o.id===a)return i.push(o),i}else{if(n[2])return w.apply(i,S.call(t.getElementsByTagName(e),0)),i;if((a=n[3])&&it&&t.getElementsByClassName)return w.apply(i,S.call(t.getElementsByClassName(a),0)),i}return gt(e,t,i,r,s)},x=I.selectors={cacheLength:50,match:P,order:["ID","TAG"],attrHandle:{},createPseudo:Le,find:{ID:Oe?function(e,t,i){if(typeof t.getElementById!=r&&!i)return(i=t.getElementById(e))&&i.parentNode?[i]:[]}:function(e,t,i){if(typeof t.getElementById!=r&&!i)return(i=t.getElementById(e))?i.id===e||typeof i.getAttributeNode!=r&&i.getAttributeNode("id").value===e?[i]:xe:[]},TAG:ze?function(e,t){if(typeof t.getElementsByTagName!=r)return t.getElementsByTagName(e)}:function(e,t){var i=t.getElementsByTagName(e);if("*"!==e)return i;for(var r,n=[],o=0;r=i[o];o++)1===r.nodeType&&n.push(r);return n}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(C,""),e[3]=(e[4]||e[5]||"").replace(C,""),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1]?(e[2]||I.error(e[0]),e[3]=+(e[3]?e[4]+(e[5]||1):2*("even"===e[2]||"odd"===e[2])),e[4]=+(e[6]+e[7]||"odd"===e[2])):e[2]&&I.error(e[0]),e},PSEUDO:function(e){var t,i=e[4];return P.CHILD.test(e[0])?null:(i&&(t=Ge.exec(i))&&t.pop()&&(e[0]=e[0].slice(0,t[0].length-i.length-1),i=t[0].slice(0,-1)),e.splice(2,3,i||e[3]),e)}},filter:{ID:Oe?function(t){return t=t.replace(C,""),function(e){return e.getAttribute("id")===t}}:function(t){return t=t.replace(C,""),function(e){e=typeof e.getAttributeNode!=r&&e.getAttributeNode("id");return e&&e.value===t}},TAG:function(t){return"*"===t?function(){return!0}:(t=t.replace(C,"").toLowerCase(),function(e){return e.nodeName&&e.nodeName.toLowerCase()===t})},CLASS:function(e){var t=Xe[e];return t||(t=Xe[e]=new RegExp("(^|"+T+")"+e+"("+T+"|$)"),Qe.push(e),Qe.length>x.cacheLength&&delete Xe[Qe.shift()]),function(e){return t.test(e.className||typeof e.getAttribute!=r&&e.getAttribute("class")||"")}},ATTR:function(i,r,n){return r?function(e){var e=I.attr(e,i),t=e+"";if(null==e)return"!="===r;switch(r){case"=":return t===n;case"!=":return t!==n;case"^=":return n&&0===t.indexOf(n);case"*=":return n&&-1<t.indexOf(n);case"$=":return n&&t.substr(t.length-n.length)===n;case"~=":return-1<(" "+t+" ").indexOf(n);case"|=":return t===n||t.substr(0,n.length+1)===n+"-"}}:function(e){return null!=I.attr(e,i)}},CHILD:function(i,e,n,o){var s;return"nth"===i?(s=Ue++,function(e){var t,i=0,r=e;if(1===n&&0===o)return!0;if((t=e.parentNode)&&(t[c]!==s||!e.sizset)){for(r=t.firstChild;r&&(1!==r.nodeType||(r.sizset=++i,r!==e));r=r.nextSibling);t[c]=s}return t=e.sizset-o,0===n?0==t:t%n==0&&0<=t/n}):function(e){var t=e;switch(i){case"only":case"first":for(;t=t.previousSibling;)if(1===t.nodeType)return!1;if("first"===i)return!0;t=e;case"last":for(;t=t.nextSibling;)if(1===t.nodeType)return!1;return!0}}},PSEUDO:function(e,t,i,r){var n=x.pseudos[e]||x.pseudos[e.toLowerCase()];return n||I.error("unsupported pseudo: "+e),n.sizzleFilter?n(t,i,r):n}},pseudos:{not:Le(function(e,t,i){var r=ft(e.replace(He,"$1"),t,i);return function(e){return!r(e)}}),enabled:function(e){return!1===e.disabled},disabled:function(e){return!0===e.disabled},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},parent:function(e){return!x.pseudos.empty(e)},empty:function(e){var t;for(e=e.firstChild;e;){if("@"<e.nodeName||3===(t=e.nodeType)||4===t)return!1;e=e.nextSibling}return!0},contains:Le(function(t){return function(e){return-1<(e.textContent||e.innerText||ot(e)).indexOf(t)}}),has:Le(function(t){return function(e){return 0<I(t,e).length}}),header:function(e){return Ze.test(e.nodeName)},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===(t=e.type)&&(null==(e=e.getAttribute("type"))||e.toLowerCase()===t)},radio:e("radio"),checkbox:e("checkbox"),file:e("file"),password:e("password"),image:e("image"),submit:Ae("submit"),reset:Ae("reset"),button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},input:function(e){return Ye.test(e.nodeName)},focus:function(e){var t=e.ownerDocument;return e===t.activeElement&&(!t.hasFocus||t.hasFocus())&&!(!e.type&&!e.href)},active:function(e){return e===e.ownerDocument.activeElement}},setFilters:{first:function(e,t,i){return i?e.slice(1):[e[0]]},last:function(e,t,i){var r=e.pop();return i?e:[r]},even:function(e,t,i){for(var r=[],n=i?1:0,o=e.length;n<o;n+=2)r.push(e[n]);return r},odd:function(e,t,i){for(var r=[],n=i?0:1,o=e.length;n<o;n+=2)r.push(e[n]);return r},lt:function(e,t,i){return i?e.slice(+t):e.slice(0,+t)},gt:function(e,t,i){return i?e.slice(0,+t+1):e.slice(+t+1)},eq:function(e,t,i){t=e.splice(+t,1);return i?e:t}}};x.setFilters.nth=x.setFilters.eq,x.filters=x.pseudos,u||(x.attrHandle={href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}}),Be&&(x.order.push("NAME"),x.find.NAME=function(e,t){if(typeof t.getElementsByName!=r)return t.getElementsByName(e)}),it&&(x.order.splice(1,0,"CLASS"),x.find.CLASS=function(e,t,i){if(typeof t.getElementsByClassName!=r&&!i)return t.getElementsByClassName(e)});try{S.call(i.childNodes,0)[0].nodeType}catch(e){S=function(e){for(var t,i=[];t=this[e];e++)i.push(t);return i}}var rt=I.isXML=function(e){e=e&&(e.ownerDocument||e).documentElement;return!!e&&"HTML"!==e.nodeName},nt=I.contains=i.compareDocumentPosition?function(e,t){return!!(16&e.compareDocumentPosition(t))}:i.contains?function(e,t){var i=9===e.nodeType?e.documentElement:e,t=t.parentNode;return e===t||!!(t&&1===t.nodeType&&i.contains&&i.contains(t))}:function(e,t){for(;t=t.parentNode;)if(t===e)return!0;return!1},ot=I.getText=function(e){var t,i="",r=0,n=e.nodeType;if(n){if(1===n||9===n||11===n){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)i+=ot(e)}else if(3===n||4===n)return e.nodeValue}else for(;t=e[r];r++)i+=ot(t);return i};function st(e,t,i,r){for(var n=0,o=t.length;n<o;n++)I(e,t[n],i,r)}function at(e,t,i,r,n){function o(){for(var e=1,t=arguments.length-2;e<t;e++)arguments[e]===xe&&(s[e]=xe)}for(var s,a,l,c,p,h,u,d,f,g,m,y,v,S=0,C=n.length,k=P.POS,_=new RegExp("^"+k.source+"(?!"+T+")","i");S<C;S++){for(k.exec(""),e=n[S],l=[],a=0,c=r;s=k.exec(e);)a<(f=k.lastIndex=s.index+s[0].length)&&(p=e.slice(a,s.index),a=f,f=[t],We.test(p)&&(c&&(f=c),c=r),(m=Ve.test(p))&&(p=p.slice(0,-5).replace(We,"$&*")),1<s.length&&s[0].replace(_,o),h=p,u=s[1],d=s[2],f=f,g=c,m=m,v=y=void 0,(v=x.setFilters[u.toLowerCase()])||I.error(u),!h&&(y=g)||st(h||"*",f,y=[],g),c=0<y.length?v(y,d,m):[]);c?(l=l.concat(c),(p=e.slice(a))&&")"!==p?We.test(p)?st(p,l,i,r):I(p,t,i,r?r.concat(c):c):w.apply(i,l)):I(e,t,i,r)}return 1===C?i:I.uniqueSort(i)}function lt(e,t,i){for(var r,n,o=0;r=e[o];o++)n=x.relative[r.part]?function(o,e,t){var s=e.dir,a=Ue++;return o=o||function(e){return e===t},e.first?function(e,t){for(;e=e[s];)if(1===e.nodeType)return o(e,t)&&e}:function(e,t){for(var i,r=a+"."+De,n=r+"."+Re;e=e[s];)if(1===e.nodeType){if((i=e[c])===n)return e.sizset;if("string"==typeof i&&0===i.indexOf(r)){if(e.sizset)return e}else{if(e[c]=n,o(e,t))return e.sizset=!0,e;e.sizset=!1}}}}(n,x.relative[r.part],t):(r.captures.push(t,i),function(r,n){return r?function(e,t){var i=n(e,t);return i&&r(!0===i?e:i,t)}:n}(n,x.filter[r.part].apply(null,r.captures)));return n}I.attr=function(e,t){var i=rt(e);return i||(t=t.toLowerCase()),x.attrHandle[t]?x.attrHandle[t](e):tt||i?e.getAttribute(t):(i=e.getAttributeNode(t))?"boolean"==typeof e[t]?e[t]?t:null:i.specified?i.value:null:null},I.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},[0,0].sort(function(){return Me=0}),i.compareDocumentPosition?Fe=function(e,t){return e===t?(Ne=!0,0):(e.compareDocumentPosition&&t.compareDocumentPosition?4&e.compareDocumentPosition(t):e.compareDocumentPosition)?-1:1}:(Fe=function(e,t){if(e===t)return Ne=!0,0;if(e.sourceIndex&&t.sourceIndex)return e.sourceIndex-t.sourceIndex;var i=[],r=[],n=e.parentNode,o=t.parentNode,s=n;if(n===o)return h(e,t);if(!n)return-1;if(!o)return 1;for(;s;)i.unshift(s),s=s.parentNode;for(s=o;s;)r.unshift(s),s=s.parentNode;for(var a=i.length,l=r.length,c=0;c<a&&c<l;c++)if(i[c]!==r[c])return h(i[c],r[c]);return c===a?h(e,r[c],-1):h(i[c],t,1)},h=function(e,t,i){if(e===t)return i;for(var r=e.nextSibling;r;){if(r===t)return-1;r=r.nextSibling}return 1}),I.uniqueSort=function(e){var t,i=1;if(Fe&&(Ne=Me,e.sort(Fe),Ne))for(;t=e[i];i++)t===e[i-1]&&e.splice(i--,1);return e};var ct,pt,ht,ut,d,g,dt,ft=I.compile=function(e,t,i){var r,n,o,s,a=Je[e];if(!a||a.context!==t){for(n=function(e,t,i){for(var r,n,o,s=[],a=0,l=Ge.exec(e),c=!l.pop()&&!l.pop(),p=c&&e.match($e)||[""],h=x.preFilter,u=x.filter,d=!i&&t!==f;null!=(n=p[a])&&c;a++)for(s.push(r=[]),d&&(n=" "+n);n;){for(o in c=!1,(l=We.exec(n))&&(n=n.slice(l[0].length),c=r.push({part:l.pop().replace(He," "),captures:l})),u)!(l=P[o].exec(n))||h[o]&&!(l=h[o](l,t,i))||(n=n.slice(l.shift().length),c=r.push({part:o,captures:l}));if(!c)break}return c||I.error(e),s}(e,t,i),o=0;r=n[o];o++)n[o]=lt(r,t,i);(a=Je[e]=(s=n,function(e,t){for(var i,r=0;i=s[r];r++)if(i(e,t))return!0;return!1})).context=t,a.runs=a.dirruns=0,et.push(e),et.length>x.cacheLength&&delete Je[et.shift()]}return a},gt=(I.matches=function(e,t){return I(e,null,null,t)},I.matchesSelector=function(e,t){return 0<I(t,null,null,[e]).length},function(e,t,i,r,n){var o,s,a,l,c,p,h,u,d,f=(e=e.replace(He,"$1")).match($e),g=e.match(qe),m=t.nodeType;if(P.POS.test(e))return at(e,t,i,r,f);if(r)o=S.call(r,0);else if(f&&1===f.length){if(1<g.length&&9===m&&!n&&(f=P.ID.exec(g[0]))){if(!(t=x.find.ID(f[1],t,n)[0]))return i;e=e.slice(g.shift().length)}for(u=(f=Ke.exec(g[0]))&&!f.index&&t.parentNode||t,p=(d=g.pop()).split(":not")[0],a=0,l=x.order.length;a<l;a++)if(h=x.order[a],(f=P[h].exec(p))&&null!=(o=x.find[h]((f[1]||"").replace(C,""),u,n))){p!==d||(e=e.slice(0,e.length-d.length)+p.replace(P[h],""))||w.apply(i,S.call(o,0));break}}if(e)for(s=ft(e,t,n),De=s.dirruns++,null==o&&(o=x.find.TAG("*",Ke.test(e)&&t.parentNode||t)),a=0;c=o[a];a++)Re=s.runs++,s(c,t)&&i.push(c);return i}),mt=(f.querySelectorAll&&(pt=gt,ht=/'|\\/g,ut=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,d=[],g=[":active"],dt=i.matchesSelector||i.mozMatchesSelector||i.webkitMatchesSelector||i.oMatchesSelector||i.msMatchesSelector,t(function(e){e.innerHTML="<select><option selected></option></select>",e.querySelectorAll("[selected]").length||d.push("\\["+T+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||d.push(":checked")}),t(function(e){e.innerHTML="<p test=''></p>",e.querySelectorAll("[test^='']").length&&d.push("[*^$]="+T+"*(?:\"\"|'')"),e.innerHTML="<input type='hidden'>",e.querySelectorAll(":enabled").length||d.push(":enabled",":disabled")}),d=d.length&&new RegExp(d.join("|")),gt=function(e,t,i,r,n){if(!(r||n||d&&d.test(e)))if(9===t.nodeType)try{return w.apply(i,S.call(t.querySelectorAll(e),0)),i}catch(e){}else if(1===t.nodeType&&"object"!==t.nodeName.toLowerCase()){var o=t.getAttribute("id"),s=o||c,a=Ke.test(e)&&t.parentNode||t;o?s=s.replace(ht,"\\$&"):t.setAttribute("id",s);try{return w.apply(i,S.call(a.querySelectorAll(e.replace($e,"[id='"+s+"'] $&")),0)),i}catch(e){}finally{o||t.removeAttribute("id")}}return pt(e,t,i,r,n)},dt)&&(t(function(e){ct=dt.call(e,"div");try{dt.call(e,"[test!='']:sizzle"),g.push(x.match.PSEUDO)}catch(e){}}),g=new RegExp(g.join("|")),I.matchesSelector=function(e,t){if(t=t.replace(ut,"='$1']"),!(rt(e)||g.test(t)||d&&d.test(t)))try{var i=dt.call(e,t);if(i||ct||e.document&&11!==e.document.nodeType)return i}catch(e){}return 0<I(t,null,null,[e]).length}),I.attr=b.attr,b.find=I,b.expr=I.selectors,b.expr[":"]=b.expr.pseudos,b.unique=I.uniqueSort,b.text=I.getText,b.isXMLDoc=I.isXML,b.contains=I.contains,/Until$/),yt=/^(?:parents|prev(?:Until|All))/,vt=/^.[^:#\[\.,]*$/,St=b.expr.match.needsContext,Ct={children:!0,contents:!0,next:!0,prev:!0};function kt(e){return!e||!e.parentNode||11===e.parentNode.nodeType}function _t(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}function bt(e,i,r){if(i=i||0,b.isFunction(i))return b.grep(e,function(e,t){return!!i.call(e,t,e)===r});if(i.nodeType)return b.grep(e,function(e,t){return e===i===r});if("string"==typeof i){var t=b.grep(e,function(e){return 1===e.nodeType});if(vt.test(i))return b.filter(i,t,!r);i=b.filter(i,t)}return b.grep(e,function(e,t){return 0<=b.inArray(e,i)===r})}function Et(e){var t=wt.split("|"),i=e.createDocumentFragment();if(i.createElement)for(;t.length;)i.createElement(t.pop());return i}b.fn.extend({find:function(e){var t,i,r,n,o,s,a=this;if("string"!=typeof e)return b(e).filter(function(){for(t=0,i=a.length;t<i;t++)if(b.contains(a[t],this))return!0});for(s=this.pushStack("","find",e),t=0,i=this.length;t<i;t++)if(r=s.length,b.find(e,this[t],s),0<t)for(n=r;n<s.length;n++)for(o=0;o<r;o++)if(s[o]===s[n]){s.splice(n--,1);break}return s},has:function(e){var t,i=b(e,this),r=i.length;return this.filter(function(){for(t=0;t<r;t++)if(b.contains(this,i[t]))return!0})},not:function(e){return this.pushStack(bt(this,e,!1),"not",e)},filter:function(e){return this.pushStack(bt(this,e,!0),"filter",e)},is:function(e){return!!e&&("string"==typeof e?St.test(e)?0<=b(e,this.context).index(this[0]):0<b.filter(e,this).length:0<this.filter(e).length)},closest:function(e,t){for(var i,r=0,n=this.length,o=[],s=St.test(e)||"string"!=typeof e?b(e,t||this.context):0;r<n;r++)for(i=this[r];i&&i.ownerDocument&&i!==t&&11!==i.nodeType;){if(s?-1<s.index(i):b.find.matchesSelector(i,e)){o.push(i);break}i=i.parentNode}return o=1<o.length?b.unique(o):o,this.pushStack(o,"closest",e)},index:function(e){return e?"string"==typeof e?b.inArray(this[0],b(e)):b.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(e,t){t="string"==typeof e?b(e,t):b.makeArray(e&&e.nodeType?[e]:e),e=b.merge(this.get(),t);return this.pushStack(kt(t[0])||kt(e[0])?e:b.unique(e))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),b.fn.andSelf=b.fn.addBack,b.each({parent:function(e){e=e.parentNode;return e&&11!==e.nodeType?e:null},parents:function(e){return b.dir(e,"parentNode")},parentsUntil:function(e,t,i){return b.dir(e,"parentNode",i)},next:function(e){return _t(e,"nextSibling")},prev:function(e){return _t(e,"previousSibling")},nextAll:function(e){return b.dir(e,"nextSibling")},prevAll:function(e){return b.dir(e,"previousSibling")},nextUntil:function(e,t,i){return b.dir(e,"nextSibling",i)},prevUntil:function(e,t,i){return b.dir(e,"previousSibling",i)},siblings:function(e){return b.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return b.sibling(e.firstChild)},contents:function(e){return b.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:b.merge([],e.childNodes)}},function(r,n){b.fn[r]=function(e,t){var i=b.map(this,n,e);return(t=mt.test(r)?t:e)&&"string"==typeof t&&(i=b.filter(t,i)),i=1<this.length&&!Ct[r]?b.unique(i):i,1<this.length&&yt.test(r)&&(i=i.reverse()),this.pushStack(i,r,p.call(arguments).join(","))}}),b.extend({filter:function(e,t,i){return i&&(e=":not("+e+")"),1===t.length?b.find.matchesSelector(t[0],e)?[t[0]]:[]:b.find.matches(e,t)},dir:function(e,t,i){for(var r=[],n=e[t];n&&9!==n.nodeType&&(i===_||1!==n.nodeType||!b(n).is(i));)1===n.nodeType&&r.push(n),n=n[t];return r},sibling:function(e,t){for(var i=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&i.push(e);return i}});var wt="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",Tt=/ jQuery\d+="(?:null|\d+)"/g,Pt=/^\s+/,It=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,xt=/<([\w:]+)/,Lt=/<tbody/i,At=/<|&#?\w+;/,Rt=/<(?:script|style|link)/i,Dt=/<(?:script|object|embed|option|style)/i,Ft=new RegExp("<(?:"+wt+")[\\s/>]","i"),Ot=/^(?:checkbox|radio)$/,Nt=/checked\s*(?:[^=]|=\s*.checked.)/i,Mt=/\/(java|ecma)script/i,Ut=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,k={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},zt=Et(v),Bt=zt.appendChild(v.createElement("div"));function Ht(e,t){if(1===t.nodeType&&b.hasData(e)){var i,r,n,e=b._data(e),o=b._data(t,e),s=e.events;if(s)for(i in delete o.handle,o.events={},s)for(r=0,n=s[i].length;r<n;r++)b.event.add(t,i,s[i][r]);o.data&&(o.data=b.extend({},o.data))}}function Wt(e,t){var i;1===t.nodeType&&(t.clearAttributes&&t.clearAttributes(),t.mergeAttributes&&t.mergeAttributes(e),"object"===(i=t.nodeName.toLowerCase())?(t.parentNode&&(t.outerHTML=e.outerHTML),b.support.html5Clone&&e.innerHTML&&!b.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===i&&Ot.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===i?t.selected=e.defaultSelected:"input"===i||"textarea"===i?t.defaultValue=e.defaultValue:"script"===i&&t.text!==e.text&&(t.text=e.text),t.removeAttribute(b.expando))}function $t(e){return void 0!==e.getElementsByTagName?e.getElementsByTagName("*"):void 0!==e.querySelectorAll?e.querySelectorAll("*"):[]}function Gt(e){Ot.test(e.type)&&(e.defaultChecked=e.checked)}k.optgroup=k.option,k.tbody=k.tfoot=k.colgroup=k.caption=k.thead,k.th=k.td,b.support.htmlSerialize||(k._default=[1,"X<div>","</div>"]),b.fn.extend({text:function(e){return b.access(this,function(e){return e===_?b.text(this):this.empty().append((this[0]&&this[0].ownerDocument||v).createTextNode(e))},null,e,arguments.length)},wrapAll:function(t){var e;return b.isFunction(t)?this.each(function(e){b(this).wrapAll(t.call(this,e))}):(this[0]&&(e=b(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var e=this;e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild;return e}).append(this)),this)},wrapInner:function(i){return b.isFunction(i)?this.each(function(e){b(this).wrapInner(i.call(this,e))}):this.each(function(){var e=b(this),t=e.contents();t.length?t.wrapAll(i):e.append(i)})},wrap:function(t){var i=b.isFunction(t);return this.each(function(e){b(this).wrapAll(i?t.call(this,e):t)})},unwrap:function(){return this.parent().each(function(){b.nodeName(this,"body")||b(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){1!==this.nodeType&&11!==this.nodeType||this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){1!==this.nodeType&&11!==this.nodeType||this.insertBefore(e,this.firstChild)})},before:function(){var e;return kt(this[0])?arguments.length?(e=b.clean(arguments),this.pushStack(b.merge(e,this),"before",this.selector)):void 0:this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this)})},after:function(){var e;return kt(this[0])?arguments.length?(e=b.clean(arguments),this.pushStack(b.merge(this,e),"after",this.selector)):void 0:this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var i,r=0;null!=(i=this[r]);r++)e&&!b.filter(e,[i]).length||(t||1!==i.nodeType||(b.cleanData(i.getElementsByTagName("*")),b.cleanData([i])),i.parentNode&&i.parentNode.removeChild(i));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)for(1===e.nodeType&&b.cleanData(e.getElementsByTagName("*"));e.firstChild;)e.removeChild(e.firstChild);return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return b.clone(this,e,t)})},html:function(e){return b.access(this,function(e){var t=this[0]||{},i=0,r=this.length;if(e===_)return 1===t.nodeType?t.innerHTML.replace(Tt,""):_;if("string"==typeof e&&!Rt.test(e)&&(b.support.htmlSerialize||!Ft.test(e))&&(b.support.leadingWhitespace||!Pt.test(e))&&!k[(xt.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(It,"<$1></$2>");try{for(;i<r;i++)1===(t=this[i]||{}).nodeType&&(b.cleanData(t.getElementsByTagName("*")),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(r){return kt(this[0])?this.length?this.pushStack(b(b.isFunction(r)?r():r),"replaceWith",r):this:b.isFunction(r)?this.each(function(e){var t=b(this),i=t.html();t.replaceWith(r.call(this,e,i))}):("string"!=typeof r&&(r=b(r).detach()),this.each(function(){var e=this.nextSibling,t=this.parentNode;b(this).remove(),e?b(e).before(r):b(t).append(r)}))},detach:function(e){return this.remove(e,!0)},domManip:function(i,r,n){var e,t,o,s,a,l,c=0,p=(i=[].concat.apply([],i))[0],h=[],u=this.length;if(!b.support.checkClone&&1<u&&"string"==typeof p&&Nt.test(p))return this.each(function(){b(this).domManip(i,r,n)});if(b.isFunction(p))return this.each(function(e){var t=b(this);i[0]=p.call(this,e,r?t.html():_),t.domManip(i,r,n)});if(this[0]){if(t=(o=(e=b.buildFragment(i,this,h)).fragment).firstChild,1===o.childNodes.length&&(o=t),t)for(r=r&&b.nodeName(t,"tr"),s=e.cacheable||u-1;c<u;c++)n.call(r&&b.nodeName(this[c],"table")?(a=this[c],l="tbody",a.getElementsByTagName(l)[0]||a.appendChild(a.ownerDocument.createElement(l))):this[c],c===s?o:b.clone(o,!0,!0));o=null,h.length&&b.each(h,function(e,t){t.src?b.ajax?b.ajax({url:t.src,type:"GET",dataType:"script",async:!1,global:!1,throws:!0}):b.error("no ajax"):b.globalEval((t.text||t.textContent||t.innerHTML||"").replace(Ut,"")),t.parentNode&&t.parentNode.removeChild(t)})}return this}}),b.buildFragment=function(e,t,i){var r,n,o,s=e[0];return void 0===(t=((t=t||v)[0]||t).ownerDocument||t[0]||t).createDocumentFragment&&(t=v),!(1===e.length&&"string"==typeof s&&s.length<512&&t===v&&"<"===s.charAt(0))||Dt.test(s)||!b.support.checkClone&&Nt.test(s)||!b.support.html5Clone&&Ft.test(s)||(n=!0,o=(r=b.fragments[s])!==_),r||(r=t.createDocumentFragment(),b.clean(e,t,r,i),n&&(b.fragments[s]=o&&r)),{fragment:r,cacheable:n}},b.fragments={},b.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(s,a){b.fn[s]=function(e){var t,i=0,r=[],n=b(e),o=n.length,e=1===this.length&&this[0].parentNode;if((null==e||e&&11===e.nodeType&&1===e.childNodes.length)&&1===o)return n[a](this[0]),this;for(;i<o;i++)t=(0<i?this.clone(!0):this).get(),b(n[i])[a](t),r=r.concat(t);return this.pushStack(r,s,n.selector)}}),b.extend({clone:function(e,t,i){var r,n,o,s;if(b.support.html5Clone||b.isXMLDoc(e)||!Ft.test("<"+e.nodeName+">")?s=e.cloneNode(!0):(Bt.innerHTML=e.outerHTML,Bt.removeChild(s=Bt.firstChild)),!(b.support.noCloneEvent&&b.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||b.isXMLDoc(e)))for(Wt(e,s),r=$t(e),n=$t(s),o=0;r[o];++o)n[o]&&Wt(r[o],n[o]);if(t&&(Ht(e,s),i))for(r=$t(e),n=$t(s),o=0;r[o];++o)Ht(r[o],n[o]);return r=n=null,s},clean:function(e,t,i,r){for(var n,o,s,a,l,c,p,h,u,d,f=0,g=[],m=(t=t&&void 0!==t.createDocumentFragment?t:v)===v&&zt;null!=(o=e[f]);f++)if("number"==typeof o&&(o+=""),o){if("string"==typeof o)if(At.test(o)){for(m=m||Et(t),c=c||m.appendChild(t.createElement("div")),o=o.replace(It,"<$1></$2>"),s=(xt.exec(o)||["",""])[1].toLowerCase(),l=(a=k[s]||k._default)[0],c.innerHTML=a[1]+o+a[2];l--;)c=c.lastChild;if(!b.support.tbody)for(p=Lt.test(o),n=(h="table"!==s||p?"<table>"!==a[1]||p?[]:c.childNodes:c.firstChild&&c.firstChild.childNodes).length-1;0<=n;--n)b.nodeName(h[n],"tbody")&&!h[n].childNodes.length&&h[n].parentNode.removeChild(h[n]);!b.support.leadingWhitespace&&Pt.test(o)&&c.insertBefore(t.createTextNode(Pt.exec(o)[0]),c.firstChild),o=c.childNodes,c=m.lastChild}else o=t.createTextNode(o);o.nodeType?g.push(o):g=b.merge(g,o)}if(c&&(m.removeChild(c),o=c=m=null),!b.support.appendChecked)for(f=0;null!=(o=g[f]);f++)b.nodeName(o,"input")?Gt(o):void 0!==o.getElementsByTagName&&b.grep(o.getElementsByTagName("input"),Gt);if(i)for(u=function(e){if(!e.type||Mt.test(e.type))return r?r.push(e.parentNode?e.parentNode.removeChild(e):e):i.appendChild(e)},f=0;null!=(o=g[f]);f++)b.nodeName(o,"script")&&u(o)||(i.appendChild(o),void 0!==o.getElementsByTagName&&(d=b.grep(b.merge([],o.getElementsByTagName("script")),u),g.splice.apply(g,[f+1,0].concat(d)),f+=d.length));return g},cleanData:function(e,t){for(var i,r,n,o,s=0,a=b.expando,l=b.cache,c=b.support.deleteExpando,p=b.event.special;null!=(n=e[s]);s++)if((t||b.acceptData(n))&&(i=(r=n[a])&&l[r])){if(i.events)for(o in i.events)p[o]?b.event.remove(n,o):b.removeEvent(n,o,i.handle);l[r]&&(delete l[r],c?delete n[a]:n.removeAttribute?n.removeAttribute(a):n[a]=null,b.deletedIds.push(r))}}}),b.uaMatch=function(e){e=e.toLowerCase();e=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:e[1]||"",version:e[2]||"0"}},n={},(o=b.uaMatch(H.userAgent)).browser&&(n[o.browser]=!0,n.version=o.version),n.webkit&&(n.safari=!0),b.browser=n,b.sub=function(){function i(e,t){return new i.fn.init(e,t)}b.extend(!0,i,this),i.superclass=this,((i.fn=i.prototype=this()).constructor=i).sub=this.sub,i.fn.init=function(e,t){return t&&t instanceof b&&!(t instanceof i)&&(t=i(t)),b.fn.init.call(this,e,t,r)},i.fn.init.prototype=i.fn;var r=i(v);return i};var m,L,qt,jt=/alpha\([^)]*\)/i,Kt=/opacity=([^)]*)/,Vt=/^(top|right|bottom|left)$/,Zt=/^margin/,Yt=new RegExp("^("+Z+")(.*)$","i"),Xt=new RegExp("^("+Z+")(?!px)[a-z%]+$","i"),Qt=new RegExp("^([-+])=("+Z+")","i"),Jt={},ei={position:"absolute",visibility:"hidden",display:"block"},ti={letterSpacing:0,fontWeight:400,lineHeight:1},A=["Top","Right","Bottom","Left"],ii=["Webkit","O","Moz","ms"],ri=b.fn.toggle;function ni(e,t){if(t in e)return t;for(var i=t.charAt(0).toUpperCase()+t.slice(1),r=t,n=ii.length;n--;)if((t=ii[n]+i)in e)return t;return r}function oi(e,t){return"none"===b.css(e=t||e,"display")||!b.contains(e.ownerDocument,e)}function si(e,t){for(var i,r,n=[],o=0,s=e.length;o<s;o++)(i=e[o]).style&&(n[o]=b._data(i,"olddisplay"),t?(n[o]||"none"!==i.style.display||(i.style.display=""),""===i.style.display&&oi(i)&&(n[o]=b._data(i,"olddisplay",pi(i.nodeName)))):(r=m(i,"display"),n[o]||"none"===r||b._data(i,"olddisplay",r)));for(o=0;o<s;o++)!(i=e[o]).style||t&&"none"!==i.style.display&&""!==i.style.display||(i.style.display=t?n[o]||"":"none");return e}function ai(e,t,i){var r=Yt.exec(t);return r?Math.max(0,r[1]-(i||0))+(r[2]||"px"):t}function li(e,t,i,r){for(var n=i===(r?"border":"content")?4:"width"===t?1:0,o=0;n<4;n+=2)"margin"===i&&(o+=b.css(e,i+A[n],!0)),r?("content"===i&&(o-=parseFloat(m(e,"padding"+A[n]))||0),"margin"!==i&&(o-=parseFloat(m(e,"border"+A[n]+"Width"))||0)):(o+=parseFloat(m(e,"padding"+A[n]))||0,"padding"!==i&&(o+=parseFloat(m(e,"border"+A[n]+"Width"))||0));return o}function ci(e,t,i){var r="width"===t?e.offsetWidth:e.offsetHeight,n=!0,o=b.support.boxSizing&&"border-box"===b.css(e,"boxSizing");if(r<=0){if(((r=m(e,t))<0||null==r)&&(r=e.style[t]),Xt.test(r))return r;n=o&&(b.support.boxSizingReliable||r===e.style[t]),r=parseFloat(r)||0}return r+li(e,t,i||(o?"border":"content"),n)+"px"}function pi(e){var t,i;return Jt[e]||(i=(t=b("<"+e+">").appendTo(v.body)).css("display"),t.remove(),"none"!==i&&""!==i||(L=v.body.appendChild(L||b.extend(v.createElement("iframe"),{frameBorder:0,width:0,height:0})),qt&&L.createElement||((qt=(L.contentWindow||L.contentDocument).document).write("<!doctype html><html><body>"),qt.close()),t=qt.body.appendChild(qt.createElement(e)),i=m(t,"display"),v.body.removeChild(L)),Jt[e]=i)}b.fn.extend({css:function(e,t){return b.access(this,function(e,t,i){return i!==_?b.style(e,t,i):b.css(e,t)},e,t,1<arguments.length)},show:function(){return si(this,!0)},hide:function(){return si(this)},toggle:function(e,t){var i="boolean"==typeof e;return b.isFunction(e)&&b.isFunction(t)?ri.apply(this,arguments):this.each(function(){(i?e:oi(this))?b(this).show():b(this).hide()})}}),b.extend({cssHooks:{opacity:{get:function(e,t){if(t)return""===(t=m(e,"opacity"))?"1":t}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:b.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,t,i,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var n,o,s,a=b.camelCase(t),l=e.style;if(t=b.cssProps[a]||(b.cssProps[a]=ni(l,a)),s=b.cssHooks[t]||b.cssHooks[a],i===_)return s&&"get"in s&&(n=s.get(e,!1,r))!==_?n:l[t];if("string"===(o=typeof i)&&(n=Qt.exec(i))&&(i=(n[1]+1)*n[2]+parseFloat(b.css(e,t)),o="number"),!(null==i||"number"===o&&isNaN(i)||("number"!==o||b.cssNumber[a]||(i+="px"),s&&"set"in s&&(i=s.set(e,i,r))===_)))try{l[t]=i}catch(e){}}},css:function(e,t,i,r){var n,o=b.camelCase(t);return t=b.cssProps[o]||(b.cssProps[o]=ni(e.style,o)),"normal"===(n=(n=(o=b.cssHooks[t]||b.cssHooks[o])&&"get"in o?o.get(e,!0,r):n)===_?m(e,t):n)&&t in ti&&(n=ti[t]),(i||r!==_)&&(o=parseFloat(n),i||b.isNumeric(o))?o||0:n},swap:function(e,t,i){var r,n={};for(r in t)n[r]=e.style[r],e.style[r]=t[r];for(r in i=i.call(e),t)e.style[r]=n[r];return i}}),y.getComputedStyle?m=function(e,t){var i,r,n=getComputedStyle(e,null),o=e.style;return n&&(""!==(i=n[t])||b.contains(e.ownerDocument.documentElement,e)||(i=b.style(e,t)),Xt.test(i))&&Zt.test(t)&&(e=o.width,t=o.minWidth,r=o.maxWidth,o.minWidth=o.maxWidth=o.width=i,i=n.width,o.width=e,o.minWidth=t,o.maxWidth=r),i}:v.documentElement.currentStyle&&(m=function(e,t){var i,r,n=e.currentStyle&&e.currentStyle[t],o=e.style;return null==n&&o&&o[t]&&(n=o[t]),Xt.test(n)&&!Vt.test(t)&&(i=o.left,(r=e.runtimeStyle&&e.runtimeStyle.left)&&(e.runtimeStyle.left=e.currentStyle.left),o.left="fontSize"===t?"1em":n,n=o.pixelLeft+"px",o.left=i,r)&&(e.runtimeStyle.left=r),""===n?"auto":n}),b.each(["height","width"],function(e,r){b.cssHooks[r]={get:function(e,t,i){if(t)return 0!==e.offsetWidth||"none"!==m(e,"display")?ci(e,r,i):b.swap(e,ei,function(){return ci(e,r,i)})},set:function(e,t,i){return ai(0,t,i?li(e,r,i,b.support.boxSizing&&"border-box"===b.css(e,"boxSizing")):0)}}}),b.support.opacity||(b.cssHooks.opacity={get:function(e,t){return Kt.test((t&&e.currentStyle?e.currentStyle:e.style).filter||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var i=e.style,e=e.currentStyle,r=b.isNumeric(t)?"alpha(opacity="+100*t+")":"",n=e&&e.filter||i.filter||"";(i.zoom=1)<=t&&""===b.trim(n.replace(jt,""))&&i.removeAttribute&&(i.removeAttribute("filter"),e)&&!e.filter||(i.filter=jt.test(n)?n.replace(jt,r):n+" "+r)}}),b(function(){b.support.reliableMarginRight||(b.cssHooks.marginRight={get:function(e,t){return b.swap(e,{display:"inline-block"},function(){if(t)return m(e,"marginRight")})}}),!b.support.pixelPosition&&b.fn.position&&b.each(["top","left"],function(e,i){b.cssHooks[i]={get:function(e,t){if(t)return t=m(e,i),Xt.test(t)?b(e).position()[i]+"px":t}}})}),b.expr&&b.expr.filters&&(b.expr.filters.hidden=function(e){return 0===e.offsetWidth&&0===e.offsetHeight||!b.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||m(e,"display"))},b.expr.filters.visible=function(e){return!b.expr.filters.hidden(e)}),b.each({margin:"",padding:"",border:"Width"},function(n,o){b.cssHooks[n+o]={expand:function(e){for(var t="string"==typeof e?e.split(" "):[e],i={},r=0;r<4;r++)i[n+A[r]+o]=t[r]||t[r-2]||t[0];return i}},Zt.test(n)||(b.cssHooks[n+o].set=ai)});var hi=/%20/g,ui=/\[\]$/,di=/\r?\n/g,fi=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,gi=/^(?:select|textarea)/i;b.fn.extend({serialize:function(){return b.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?b.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||gi.test(this.nodeName)||fi.test(this.type))}).map(function(e,i){var t=b(this).val();return null==t?null:b.isArray(t)?b.map(t,function(e,t){return{name:i.name,value:e.replace(di,"\r\n")}}):{name:i.name,value:t.replace(di,"\r\n")}}).get()}}),b.param=function(e,t){function i(e,t){t=b.isFunction(t)?t():null==t?"":t,n[n.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)}var r,n=[];if(t===_&&(t=b.ajaxSettings&&b.ajaxSettings.traditional),b.isArray(e)||e.jquery&&!b.isPlainObject(e))b.each(e,function(){i(this.name,this.value)});else for(r in e)!function i(r,e,n,o){if(b.isArray(e))b.each(e,function(e,t){n||ui.test(r)?o(r,t):i(r+"["+("object"==typeof t?e:"")+"]",t,n,o)});else if(n||"object"!==b.type(e))o(r,e);else for(var t in e)i(r+"["+t+"]",e[t],n,o)}(r,e[r],t,i);return n.join("&").replace(hi,"+")};var R,D,mi=/#.*$/,yi=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,vi=/^(?:GET|HEAD)$/,Si=/^\/\//,Ci=/\?/,ki=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,_i=/([?&])_=[^&]*/,bi=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Ei=b.fn.load,wi={},Ti={},Pi=["*/"]+["*"];try{R=B.href}catch(e){(R=v.createElement("a")).href="",R=R.href}function Ii(a){return function(e,t){"string"!=typeof e&&(t=e,e="*");var i,r,n=e.toLowerCase().split(E),o=0,s=n.length;if(b.isFunction(t))for(;o<s;o++)i=n[o],(r=/^\+/.test(i))&&(i=i.substr(1)||"*"),(a[i]=a[i]||[])[r?"unshift":"push"](t)}}function xi(e,t,i,r,n,o){(o=o||{})[n=n||t.dataTypes[0]]=!0;for(var s,a=e[n],l=0,c=a?a.length:0,p=e===wi;l<c&&(p||!s);l++)"string"==typeof(s=a[l](t,i,r))&&(s=!p||o[s]?_:(t.dataTypes.unshift(s),xi(e,t,i,r,s,o)));return s=!p&&s||o["*"]?s:xi(e,t,i,r,"*",o)}function Li(e,t){var i,r,n=b.ajaxSettings.flatOptions||{};for(i in t)t[i]!==_&&((n[i]?e:r=r||{})[i]=t[i]);r&&b.extend(!0,e,r)}D=bi.exec(R.toLowerCase())||[],b.fn.load=function(e,t,i){var r,n,o,s,a;return"string"!=typeof e&&Ei?Ei.apply(this,arguments):(this.length&&(s=this,0<=(a=e.indexOf(" "))&&(r=e.slice(a,e.length),e=e.slice(0,a)),b.isFunction(t)?(i=t,t=_):"object"==typeof t&&(n="POST"),b.ajax({url:e,type:n,dataType:"html",data:t,complete:function(e,t){i&&s.each(i,o||[e.responseText,t,e])}}).done(function(e){o=arguments,s.html(r?b("<div>").append(e.replace(ki,"")).find(r):e)})),this)},b.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(e,t){b.fn[t]=function(e){return this.on(t,e)}}),b.each(["get","post"],function(e,n){b[n]=function(e,t,i,r){return b.isFunction(t)&&(r=r||i,i=t,t=_),b.ajax({type:n,url:e,data:t,success:i,dataType:r})}}),b.extend({getScript:function(e,t){return b.get(e,_,t,"script")},getJSON:function(e,t,i){return b.get(e,t,i,"json")},ajaxSetup:function(e,t){return t?Li(e,b.ajaxSettings):(t=e,e=b.ajaxSettings),Li(e,t),e},ajaxSettings:{url:R,isLocal:/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/.test(D[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":Pi},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":y.String,"text html":!0,"text json":b.parseJSON,"text xml":b.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:Ii(wi),ajaxTransport:Ii(Ti),ajax:function(e,t){"object"==typeof e&&(t=e,e=_);var c,p,i,h,u,r,d=b.ajaxSetup({},t=t||{}),f=d.context||d,g=f!==d&&(f.nodeType||f instanceof b)?b(f):b.event,m=b.Deferred(),y=b.Callbacks("once memory"),v=d.statusCode||{},n={},o={},S=0,s="canceled",C={readyState:0,setRequestHeader:function(e,t){var i;return S||(i=e.toLowerCase(),e=o[i]=o[i]||e,n[e]=t),this},getAllResponseHeaders:function(){return 2===S?p:null},getResponseHeader:function(e){var t;if(2===S){if(!i)for(i={};t=yi.exec(p);)i[t[1].toLowerCase()]=t[2];t=i[e.toLowerCase()]}return t===_?null:t},overrideMimeType:function(e){return S||(d.mimeType=e),this},abort:function(e){return e=e||s,h&&h.abort(e),a(0,e),this}};function a(e,t,i,r){var n,o,s,a,l=t;2!==S&&(S=2,u&&clearTimeout(u),h=_,p=r||"",C.readyState=0<e?4:0,i&&(a=function(e,t,i){var r,n,o,s,a=e.contents,l=e.dataTypes,c=e.responseFields;for(n in c)n in i&&(t[c[n]]=i[n]);for(;"*"===l[0];)l.shift(),r===_&&(r=e.mimeType||t.getResponseHeader("content-type"));if(r)for(n in a)if(a[n]&&a[n].test(r)){l.unshift(n);break}if(l[0]in i)o=l[0];else{for(n in i){if(!l[0]||e.converters[n+" "+l[0]]){o=n;break}s=s||n}o=o||s}if(o)return o!==l[0]&&l.unshift(o),i[o]}(d,C,i)),200<=e&&e<300||304===e?(d.ifModified&&((r=C.getResponseHeader("Last-Modified"))&&(b.lastModified[c]=r),r=C.getResponseHeader("Etag"))&&(b.etag[c]=r),n=304===e?(l="notmodified",!0):(l=(n=function(e,t){var i,r,n,o,s=e.dataTypes.slice(),a=s[0],l={},c=0;e.dataFilter&&(t=e.dataFilter(t,e.dataType));if(s[1])for(i in e.converters)l[i.toLowerCase()]=e.converters[i];for(;n=s[++c];)if("*"!==n){if("*"!==a&&a!==n){if(!(i=l[a+" "+n]||l["* "+n]))for(r in l)if((o=r.split(" "))[1]===n&&(i=l[a+" "+o[0]]||l["* "+o[0]])){!0===i?i=l[r]:!0!==l[r]&&(n=o[0],s.splice(c--,0,n));break}if(!0!==i)if(i&&e.throws)t=i(t);else try{t=i(t)}catch(e){return{state:"parsererror",error:i?e:"No conversion from "+a+" to "+n}}}a=n}return{state:"success",data:t}}(d,a)).state,o=n.data,!(s=n.error))):(s=l)&&!e||(l="error",e<0&&(e=0)),C.status=e,C.statusText=""+(t||l),n?m.resolveWith(f,[o,l,C]):m.rejectWith(f,[C,l,s]),C.statusCode(v),v=_,k&&g.trigger("ajax"+(n?"Success":"Error"),[C,d,n?o:s]),y.fireWith(f,[C,l]),k)&&(g.trigger("ajaxComplete",[C,d]),--b.active||b.event.trigger("ajaxStop"))}if(m.promise(C),C.success=C.done,C.error=C.fail,C.complete=y.add,C.statusCode=function(e){if(e)if(S<2)for(var t in e)v[t]=[v[t],e[t]];else t=e[C.status],C.always(t);return this},d.url=((e||d.url)+"").replace(mi,"").replace(Si,D[1]+"//"),d.dataTypes=b.trim(d.dataType||"*").toLowerCase().split(E),null==d.crossDomain&&(e=bi.exec(d.url.toLowerCase()),d.crossDomain=!(!e||e[1]==D[1]&&e[2]==D[2]&&(e[3]||("http:"===e[1]?80:443))==(D[3]||("http:"===D[1]?80:443)))),d.data&&d.processData&&"string"!=typeof d.data&&(d.data=b.param(d.data,d.traditional)),xi(wi,d,t,C),2!==S){var l,k=d.global;for(r in d.type=d.type.toUpperCase(),d.hasContent=!vi.test(d.type),k&&0==b.active++&&b.event.trigger("ajaxStart"),d.hasContent||(d.data&&(d.url+=(Ci.test(d.url)?"&":"?")+d.data,delete d.data),c=d.url,!1===d.cache&&(e=b.now(),l=d.url.replace(_i,"$1_="+e),d.url=l+(l===d.url?(Ci.test(d.url)?"&":"?")+"_="+e:""))),(d.data&&d.hasContent&&!1!==d.contentType||t.contentType)&&C.setRequestHeader("Content-Type",d.contentType),d.ifModified&&(c=c||d.url,b.lastModified[c]&&C.setRequestHeader("If-Modified-Since",b.lastModified[c]),b.etag[c])&&C.setRequestHeader("If-None-Match",b.etag[c]),C.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?", "+Pi+"; q=0.01":""):d.accepts["*"]),d.headers)C.setRequestHeader(r,d.headers[r]);if(d.beforeSend&&(!1===d.beforeSend.call(f,C,d)||2===S))return C.abort();for(r in s="abort",{success:1,error:1,complete:1})C[r](d[r]);if(h=xi(Ti,d,t,C)){C.readyState=1,k&&g.trigger("ajaxSend",[C,d]),d.async&&0<d.timeout&&(u=setTimeout(function(){C.abort("timeout")},d.timeout));try{S=1,h.send(n,a)}catch(e){if(!(S<2))throw e;a(-1,e)}}else a(-1,"No Transport")}return C},active:0,lastModified:{},etag:{}});var Ai=[],Ri=/\?/,Di=/(=)\?(?=&|$)|\?\?/,Fi=b.now();b.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Ai.pop()||b.expando+"_"+Fi++;return this[e]=!0,e}}),b.ajaxPrefilter("json jsonp",function(e,t,i){var r,n,o,s=e.data,a=e.url,l=!1!==e.jsonp,c=l&&Di.test(a),p=l&&!c&&"string"==typeof s&&!(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Di.test(s);if("jsonp"===e.dataTypes[0]||c||p)return r=e.jsonpCallback=b.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,n=y[r],c?e.url=a.replace(Di,"$1"+r):p?e.data=s.replace(Di,"$1"+r):l&&(e.url+=(Ri.test(a)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return o||b.error(r+" was not called"),o[0]},e.dataTypes[0]="json",y[r]=function(){o=arguments},i.always(function(){y[r]=n,e[r]&&(e.jsonpCallback=t.jsonpCallback,Ai.push(r)),o&&b.isFunction(n)&&n(o[0]),o=n=_}),"script"}),b.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(e){return b.globalEval(e),e}}}),b.ajaxPrefilter("script",function(e){e.cache===_&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),b.ajaxTransport("script",function(t){var r,n;if(t.crossDomain)return n=v.head||v.getElementsByTagName("head")[0]||v.documentElement,{send:function(e,i){(r=v.createElement("script")).async="async",t.scriptCharset&&(r.charset=t.scriptCharset),r.src=t.url,r.onload=r.onreadystatechange=function(e,t){!t&&r.readyState&&!/loaded|complete/.test(r.readyState)||(r.onload=r.onreadystatechange=null,n&&r.parentNode&&n.removeChild(r),r=_,t)||i(200,"success")},n.insertBefore(r,n.firstChild)},abort:function(){r&&r.onload(0,1)}}});var F,Oi=!!y.ActiveXObject&&function(){for(var e in F)F[e](0,1)},Ni=0;function Mi(){try{return new y.XMLHttpRequest}catch(e){}}b.ajaxSettings.xhr=y.ActiveXObject?function(){return!this.isLocal&&Mi()||function(){try{return new y.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}()}:Mi,s=b.ajaxSettings.xhr(),b.extend(b.support,{ajax:!!s,cors:!!s&&"withCredentials"in s}),b.support.ajax&&b.ajaxTransport(function(p){var h;if(!p.crossDomain||b.support.cors)return{send:function(e,a){var l,t,c=p.xhr();if(p.username?c.open(p.type,p.url,p.async,p.username,p.password):c.open(p.type,p.url,p.async),p.xhrFields)for(t in p.xhrFields)c[t]=p.xhrFields[t];p.mimeType&&c.overrideMimeType&&c.overrideMimeType(p.mimeType),p.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest");try{for(t in e)c.setRequestHeader(t,e[t])}catch(e){}c.send(p.hasContent&&p.data||null),h=function(e,t){var i,r,n,o,s;try{if(h&&(t||4===c.readyState))if(h=_,l&&(c.onreadystatechange=b.noop,Oi)&&delete F[l],t)4!==c.readyState&&c.abort();else{i=c.status,n=c.getAllResponseHeaders(),o={},(s=c.responseXML)&&s.documentElement&&(o.xml=s);try{o.text=c.responseText}catch(e){}try{r=c.statusText}catch(e){r=""}i||!p.isLocal||p.crossDomain?1223===i&&(i=204):i=o.text?200:404}}catch(e){t||a(-1,e)}o&&a(i,r,o,n)},p.async?4===c.readyState?setTimeout(h,0):(l=++Ni,Oi&&(F||(F={},b(y).unload(Oi)),F[l]=h),c.onreadystatechange=h):h()},abort:function(){h&&h(0,1)}}});var Ui,zi,Bi=/^(?:toggle|show|hide)$/,Hi=new RegExp("^(?:([-+])=|)("+Z+")([a-z%]*)$","i"),Wi=/queueHooks$/,$i=[function(t,e,i){var r,n,o,s,a,l,c,p,h=this,u=t.style,d={},f=[],g=t.nodeType&&oi(t);i.queue||(null==(c=b._queueHooks(t,"fx")).unqueued&&(c.unqueued=0,p=c.empty.fire,c.empty.fire=function(){c.unqueued||p()}),c.unqueued++,h.always(function(){h.always(function(){c.unqueued--,b.queue(t,"fx").length||c.empty.fire()})}));1===t.nodeType&&("height"in e||"width"in e)&&(i.overflow=[u.overflow,u.overflowX,u.overflowY],"inline"===b.css(t,"display"))&&"none"===b.css(t,"float")&&(b.support.inlineBlockNeedsLayout&&"inline"!==pi(t.nodeName)?u.zoom=1:u.display="inline-block");i.overflow&&(u.overflow="hidden",b.support.shrinkWrapBlocks||h.done(function(){u.overflow=i.overflow[0],u.overflowX=i.overflow[1],u.overflowY=i.overflow[2]}));for(r in e)o=e[r],Bi.exec(o)&&(delete e[r],o!==(g?"hide":"show"))&&f.push(r);if(s=f.length)for(a=b._data(t,"fxshow")||b._data(t,"fxshow",{}),g?b(t).show():h.done(function(){b(t).hide()}),h.done(function(){for(var e in b.removeData(t,"fxshow",!0),d)b.style(t,e,d[e])}),r=0;r<s;r++)n=f[r],l=h.createTween(n,g?a[n]:0),d[n]=a[n]||b.style(t,n),n in a||(a[n]=l.start,g&&(l.end=l.start,l.start="width"===n||"height"===n?1:0))}],Gi={"*":[function(e,t){var i,r,n,o=this.createTween(e,t),t=Hi.exec(t),s=o.cur(),a=+s||0,l=1;if(t){if(i=+t[2],"px"!==(r=t[3]||(b.cssNumber[e]?"":"px"))&&a)for(a=b.css(o.elem,e,!0)||i||1;n=l=l||".5",b.style(o.elem,e,(a/=l)+r),1!==(l=o.cur()/s)&&l!==n;);o.unit=r,o.start=a,o.end=t[1]?a+(t[1]+1)*i:i}return o}]};function qi(){return setTimeout(function(){Ui=_},0),Ui=b.now()}function ji(n,e,t){var i,r,o,s,a,l,c,p=0,h=$i.length,u=b.Deferred().always(function(){delete d.elem}),d=function(){for(var e=Ui||qi(),e=Math.max(0,f.startTime+f.duration-e),t=1-(e/f.duration||0),i=0,r=f.tweens.length;i<r;i++)f.tweens[i].run(t);return u.notifyWith(n,[f,t,e]),t<1&&r?e:(u.resolveWith(n,[f]),!1)},f=u.promise({elem:n,props:b.extend({},e),opts:b.extend(!0,{specialEasing:{}},t),originalProperties:e,originalOptions:t,startTime:Ui||qi(),duration:t.duration,tweens:[],createTween:function(e,t,i){t=b.Tween(n,f.opts,e,t,f.opts.specialEasing[e]||f.opts.easing);return f.tweens.push(t),t},stop:function(e){for(var t=0,i=e?f.tweens.length:0;t<i;t++)f.tweens[t].run(1);return e?u.resolveWith(n,[f,e]):u.rejectWith(n,[f,e]),this}}),g=f.props,m=g,y=f.opts.specialEasing;for(r in m)if(o=b.camelCase(r),s=y[o],a=m[r],b.isArray(a)&&(s=a[1],a=m[r]=a[0]),r!==o&&(m[o]=a,delete m[r]),(l=b.cssHooks[o])&&"expand"in l)for(r in a=l.expand(a),delete m[o],a)r in m||(m[r]=a[r],y[r]=s);else y[o]=s;for(;p<h;p++)if(i=$i[p].call(f,n,g,f.opts))return i;return c=f,b.each(g,function(e,t){for(var i=(Gi[e]||[]).concat(Gi["*"]),r=0,n=i.length;r<n;r++)if(i[r].call(c,e,t))return}),b.isFunction(f.opts.start)&&f.opts.start.call(n,f),b.fx.timer(b.extend(d,{anim:f,queue:f.opts.queue,elem:n})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function O(e,t,i,r,n){return new O.prototype.init(e,t,i,r,n)}function Ki(e,t){for(var i,r={height:e},n=0;n<4;n+=2-t)r["margin"+(i=A[n])]=r["padding"+i]=e;return t&&(r.opacity=r.width=e),r}b.Animation=b.extend(ji,{tweener:function(e,t){for(var i,r=0,n=(e=b.isFunction(e)?(t=e,["*"]):e.split(" ")).length;r<n;r++)i=e[r],Gi[i]=Gi[i]||[],Gi[i].unshift(t)},prefilter:function(e,t){t?$i.unshift(e):$i.push(e)}}),((b.Tween=O).prototype={constructor:O,init:function(e,t,i,r,n,o){this.elem=e,this.prop=i,this.easing=n||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(b.cssNumber[i]?"":"px")},cur:function(){var e=O.propHooks[this.prop];return(e&&e.get?e:O.propHooks._default).get(this)},run:function(e){var t=O.propHooks[this.prop];return this.pos=e=b.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration),this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),(t&&t.set?t:O.propHooks._default).set(this),this}}).init.prototype=O.prototype,(O.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=b.css(e.elem,e.prop,!1,""))&&"auto"!==t?t:0:e.elem[e.prop]},set:function(e){b.fx.step[e.prop]?b.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[b.cssProps[e.prop]]||b.cssHooks[e.prop])?b.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}}).scrollTop=O.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},b.each(["toggle","show","hide"],function(r,n){var o=b.fn[n];b.fn[n]=function(e,t,i){return null==e||"boolean"==typeof e||!r&&b.isFunction(e)&&b.isFunction(t)?o.apply(this,arguments):this.animate(Ki(n,!0),e,t,i)}}),b.fn.extend({fadeTo:function(e,t,i,r){return this.filter(oi).css("opacity",0).show().end().animate({opacity:t},e,i,r)},animate:function(t,e,i,r){function n(){var e=ji(this,b.extend({},t),s);o&&e.stop(!0)}var o=b.isEmptyObject(t),s=b.speed(e,i,r);return o||!1===s.queue?this.each(n):this.queue(s.queue,n)},stop:function(n,e,o){function s(e){var t=e.stop;delete e.stop,t(o)}return"string"!=typeof n&&(o=e,e=n,n=_),e&&!1!==n&&this.queue(n||"fx",[]),this.each(function(){var e=!0,t=null!=n&&n+"queueHooks",i=b.timers,r=b._data(this);if(t)r[t]&&r[t].stop&&s(r[t]);else for(t in r)r[t]&&r[t].stop&&Wi.test(t)&&s(r[t]);for(t=i.length;t--;)i[t].elem!==this||null!=n&&i[t].queue!==n||(i[t].anim.stop(o),e=!1,i.splice(t,1));!e&&o||b.dequeue(this,n)})}}),b.each({slideDown:Ki("show"),slideUp:Ki("hide"),slideToggle:Ki("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,r){b.fn[e]=function(e,t,i){return this.animate(r,e,t,i)}}),b.speed=function(e,t,i){var r=e&&"object"==typeof e?b.extend({},e):{complete:i||!i&&t||b.isFunction(e)&&e,duration:e,easing:i&&t||t&&!b.isFunction(t)&&t};return r.duration=b.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in b.fx.speeds?b.fx.speeds[r.duration]:b.fx.speeds._default,null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){b.isFunction(r.old)&&r.old.call(this),r.queue&&b.dequeue(this,r.queue)},r},b.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},b.timers=[],b.fx=O.prototype.init,b.fx.tick=function(){for(var e,t=b.timers,i=0;i<t.length;i++)(e=t[i])()||t[i]!==e||t.splice(i--,1);t.length||b.fx.stop()},b.fx.timer=function(e){e()&&b.timers.push(e)&&!zi&&(zi=setInterval(b.fx.tick,b.fx.interval))},b.fx.interval=13,b.fx.stop=function(){clearInterval(zi),zi=null},b.fx.speeds={slow:600,fast:200,_default:400},b.fx.step={},b.expr&&b.expr.filters&&(b.expr.filters.animated=function(t){return b.grep(b.timers,function(e){return t===e.elem}).length});var Vi=/^(?:body|html)$/i;function Zi(e){return b.isWindow(e)?e:9===e.nodeType&&(e.defaultView||e.parentWindow)}b.fn.offset=function(t){var e,i,r,n,o,s;return arguments.length?t===_?this:this.each(function(e){b.offset.setOffset(this,t,e)}):(s=(o=this[0])&&o.ownerDocument)?(r=s.body)===o?b.offset.bodyOffset(o):(e=s.documentElement,b.contains(e,o)?(o=o.getBoundingClientRect(),s=Zi(s),i=e.clientTop||r.clientTop||0,r=e.clientLeft||r.clientLeft||0,n=s.pageYOffset||e.scrollTop,s=s.pageXOffset||e.scrollLeft,{top:o.top+n-i,left:o.left+s-r}):{top:0,left:0}):void 0},b.offset={bodyOffset:function(e){var t=e.offsetTop,i=e.offsetLeft;return b.support.doesNotIncludeMarginInBodyOffset&&(t+=parseFloat(b.css(e,"marginTop"))||0,i+=parseFloat(b.css(e,"marginLeft"))||0),{top:t,left:i}},setOffset:function(e,t,i){var r,n=b.css(e,"position"),o=("static"===n&&(e.style.position="relative"),b(e)),s=o.offset(),a=b.css(e,"top"),l=b.css(e,"left"),c={},n=("absolute"===n||"fixed"===n)&&-1<b.inArray("auto",[a,l])?(r=(n=o.position()).top,n.left):(r=parseFloat(a)||0,parseFloat(l)||0);null!=(t=b.isFunction(t)?t.call(e,i,s):t).top&&(c.top=t.top-s.top+r),null!=t.left&&(c.left=t.left-s.left+n),"using"in t?t.using.call(e,c):o.css(c)}},b.fn.extend({position:function(){var e,t,i,r;if(this[0])return e=this[0],t=this.offsetParent(),i=this.offset(),r=Vi.test(t[0].nodeName)?{top:0,left:0}:t.offset(),i.top-=parseFloat(b.css(e,"marginTop"))||0,i.left-=parseFloat(b.css(e,"marginLeft"))||0,r.top+=parseFloat(b.css(t[0],"borderTopWidth"))||0,r.left+=parseFloat(b.css(t[0],"borderLeftWidth"))||0,{top:i.top-r.top,left:i.left-r.left}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||v.body;e&&!Vi.test(e.nodeName)&&"static"===b.css(e,"position");)e=e.offsetParent;return e||v.body})}}),b.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,n){var o=/Y/.test(n);b.fn[t]=function(e){return b.access(this,function(e,t,i){var r=Zi(e);if(i===_)return r?n in r?r[n]:r.document.documentElement[t]:e[t];r?r.scrollTo(o?b(r).scrollLeft():i,o?i:b(r).scrollTop()):e[t]=i},t,e,arguments.length,null)}}),b.each({Height:"height",Width:"width"},function(o,s){b.each({padding:"inner"+o,content:s,"":"outer"+o},function(r,e){b.fn[e]=function(e,t){var i=arguments.length&&(r||"boolean"!=typeof e),n=r||(!0===e||!0===t?"margin":"border");return b.access(this,function(e,t,i){var r;return b.isWindow(e)?e.document.documentElement["client"+o]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+o],r["scroll"+o],e.body["offset"+o],r["offset"+o],r["client"+o])):i===_?b.css(e,t,i,n):b.style(e,t,i,n)},s,i?e:_,i)}})}),y.jQuery=y.$=b,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return b})}(window),function(a){var e,t,i=0,r=/^ui-id-\d+$/;function n(e,t){var i,r,n,o=e.nodeName.toLowerCase();return"area"===o?(r=(i=e.parentNode).name,!(!e.href||!r||"map"!==i.nodeName.toLowerCase()||!(n=a("img[usemap=#"+r+"]")[0]))&&s(n)):(/input|select|textarea|button|object/.test(o)?!e.disabled:"a"===o&&e.href||t)&&s(e)}function s(e){return a.expr.filters.visible(e)&&!a(e).parents().addBack().filter(function(){return"hidden"===a.css(this,"visibility")}).length}a.ui=a.ui||{},a.extend(a.ui,{version:"1.10.3",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),a.fn.extend({focus:(e=a.fn.focus,function(t,i){return"number"==typeof t?this.each(function(){var e=this;setTimeout(function(){a(e).focus(),i&&i.call(e)},t)}):e.apply(this,arguments)}),scrollParent:function(){var e=(a.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.css(this,"position"))&&/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}):this.parents().filter(function(){return/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))})).eq(0);return/fixed/.test(this.css("position"))||!e.length?a(document):e},zIndex:function(e){if(void 0!==e)return this.css("zIndex",e);if(this.length)for(var t,i=a(this[0]);i.length&&i[0]!==document;){if(("absolute"===(t=i.css("position"))||"relative"===t||"fixed"===t)&&(t=parseInt(i.css("zIndex"),10),!isNaN(t))&&0!==t)return t;i=i.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++i)})},removeUniqueId:function(){return this.each(function(){r.test(this.id)&&a(this).removeAttr("id")})}}),a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(t){return function(e){return!!a.data(e,t)}}):function(e,t,i){return!!a.data(e,i[3])},focusable:function(e){return n(e,!isNaN(a.attr(e,"tabindex")))},tabbable:function(e){var t=a.attr(e,"tabindex"),i=isNaN(t);return(i||0<=t)&&n(e,!i)}}),a("<a>").outerWidth(1).jquery||a.each(["Width","Height"],function(e,i){var n="Width"===i?["Left","Right"]:["Top","Bottom"],r=i.toLowerCase(),o={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};function s(e,t,i,r){return a.each(n,function(){t-=parseFloat(a.css(e,"padding"+this))||0,i&&(t-=parseFloat(a.css(e,"border"+this+"Width"))||0),r&&(t-=parseFloat(a.css(e,"margin"+this))||0)}),t}a.fn["inner"+i]=function(e){return void 0===e?o["inner"+i].call(this):this.each(function(){a(this).css(r,s(this,e)+"px")})},a.fn["outer"+i]=function(e,t){return"number"!=typeof e?o["outer"+i].call(this,e):this.each(function(){a(this).css(r,s(this,e,!0,t)+"px")})}}),a.fn.addBack||(a.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),a("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(a.fn.removeData=(t=a.fn.removeData,function(e){return arguments.length?t.call(this,a.camelCase(e)):t.call(this)})),a.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),a.support.selectstart="onselectstart"in document.createElement("div"),a.fn.extend({disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),a.extend(a.ui,{plugin:{add:function(e,t,i){var r,n=a.ui[e].prototype;for(r in i)n.plugins[r]=n.plugins[r]||[],n.plugins[r].push([t,i[r]])},call:function(e,t,i){var r,n=e.plugins[t];if(n&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(r=0;r<n.length;r++)e.options[n[r][0]]&&n[r][1].apply(e.element,i)}},hasScroll:function(e,t){var i;return"hidden"!==a(e).css("overflow")&&(i=!1,0<e[t=t&&"left"===t?"scrollLeft":"scrollTop"]||(e[t]=1,i=0<e[t],e[t]=0,i))}})}(jQuery),function(c,a){var i=0,l=Array.prototype.slice,r=c.cleanData;c.cleanData=function(e){for(var t,i=0;null!=(t=e[i]);i++)try{c(t).triggerHandler("remove")}catch(e){}r(e)},c.widget=function(e,i,t){var r,n,o,s,a={},l=e.split(".")[0];e=e.split(".")[1],r=l+"-"+e,t||(t=i,i=c.Widget),c.expr[":"][r.toLowerCase()]=function(e){return!!c.data(e,r)},c[l]=c[l]||{},n=c[l][e],o=c[l][e]=function(e,t){if(!this._createWidget)return new o(e,t);arguments.length&&this._createWidget(e,t)},c.extend(o,n,{version:t.version,_proto:c.extend({},t),_childConstructors:[]}),(s=new i).options=c.widget.extend({},s.options),c.each(t,function(t,r){function n(){return i.prototype[t].apply(this,arguments)}function o(e){return i.prototype[t].apply(this,e)}c.isFunction(r)?a[t]=function(){var e,t=this._super,i=this._superApply;return this._super=n,this._superApply=o,e=r.apply(this,arguments),this._super=t,this._superApply=i,e}:a[t]=r}),o.prototype=c.widget.extend(s,{widgetEventPrefix:n?s.widgetEventPrefix:e},a,{constructor:o,namespace:l,widgetName:e,widgetFullName:r}),n?(c.each(n._childConstructors,function(e,t){var i=t.prototype;c.widget(i.namespace+"."+i.widgetName,o,t._proto)}),delete n._childConstructors):i._childConstructors.push(o),c.widget.bridge(e,o)},c.widget.extend=function(e){for(var t,i,r=l.call(arguments,1),n=0,o=r.length;n<o;n++)for(t in r[n])i=r[n][t],r[n].hasOwnProperty(t)&&i!==a&&(c.isPlainObject(i)?e[t]=c.isPlainObject(e[t])?c.widget.extend({},e[t],i):c.widget.extend({},i):e[t]=i);return e},c.widget.bridge=function(o,t){var s=t.prototype.widgetFullName||o;c.fn[o]=function(i){var e="string"==typeof i,r=l.call(arguments,1),n=this;return i=!e&&r.length?c.widget.extend.apply(null,[i].concat(r)):i,e?this.each(function(){var e,t=c.data(this,s);return t?c.isFunction(t[i])&&"_"!==i.charAt(0)?(e=t[i].apply(t,r))!==t&&e!==a?(n=e&&e.jquery?n.pushStack(e.get()):e,!1):void 0:c.error("no such method '"+i+"' for "+o+" widget instance"):c.error("cannot call methods on "+o+" prior to initialization; attempted to call method '"+i+"'")}):this.each(function(){var e=c.data(this,s);e?e.option(i||{})._init():c.data(this,s,new t(i,this))}),n}},c.Widget=function(){},c.Widget._childConstructors=[],c.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,t){t=c(t||this.defaultElement||this)[0],this.element=c(t),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=c.widget.extend({},this.options,this._getCreateOptions(),e),this.bindings=c(),this.hoverable=c(),this.focusable=c(),t!==this&&(c.data(t,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===t&&this.destroy()}}),this.document=c(t.style?t.ownerDocument:t.document||t),this.window=c(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:c.noop,_getCreateEventData:c.noop,_create:c.noop,_init:c.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(c.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:c.noop,widget:function(){return this.element},option:function(e,t){var i,r,n,o=e;if(0===arguments.length)return c.widget.extend({},this.options);if("string"==typeof e)if(o={},e=(i=e.split(".")).shift(),i.length){for(r=o[e]=c.widget.extend({},this.options[e]),n=0;n<i.length-1;n++)r[i[n]]=r[i[n]]||{},r=r[i[n]];if(e=i.pop(),t===a)return r[e]===a?null:r[e];r[e]=t}else{if(t===a)return this.options[e]===a?null:this.options[e];o[e]=t}return this._setOptions(o),this},_setOptions:function(e){for(var t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(n,o,e){var s,a=this;"boolean"!=typeof n&&(e=o,o=n,n=!1),e?(o=s=c(o),this.bindings=this.bindings.add(o)):(e=o,o=this.element,s=this.widget()),c.each(e,function(e,t){function i(){if(n||!0!==a.options.disabled&&!c(this).hasClass("ui-state-disabled"))return("string"==typeof t?a[t]:t).apply(a,arguments)}"string"!=typeof t&&(i.guid=t.guid=t.guid||i.guid||c.guid++);var e=e.match(/^(\w+)\s*(.*)$/),r=e[1]+a.eventNamespace,e=e[2];e?s.delegate(e,r,i):o.bind(r,i)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){var i=this;return setTimeout(function(){return("string"==typeof e?i[e]:e).apply(i,arguments)},t||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){c(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){c(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){c(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){c(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,t,i){var r,n,o=this.options[e];if(i=i||{},(t=c.Event(t)).type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),t.target=this.element[0],n=t.originalEvent)for(r in n)r in t||(t[r]=n[r]);return this.element.trigger(t,i),!(c.isFunction(o)&&!1===o.apply(this.element[0],[t].concat(i))||t.isDefaultPrevented())}},c.each({show:"fadeIn",hide:"fadeOut"},function(o,s){c.Widget.prototype["_"+o]=function(t,e,i){var r=(e="string"==typeof e?{effect:e}:e)?!0!==e&&"number"!=typeof e&&e.effect||s:o,n=!c.isEmptyObject(e="number"==typeof(e=e||{})?{duration:e}:e);e.complete=i,e.delay&&t.delay(e.delay),n&&c.effects&&c.effects.effect[r]?t[o](e):r!==o&&t[r]?t[r](e.duration,e.easing,i):t.queue(function(e){c(this)[o](),i&&i.call(t[0]),e()})}})}(jQuery),function(n){var o=!1;n(document).mouseup(function(){o=!1}),n.widget("ui.mouse",{version:"1.10.3",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(e){if(!0===n.data(e.target,t.widgetName+".preventClickEvent"))return n.removeData(e.target,t.widgetName+".preventClickEvent"),e.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&n(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){var t,i,r;if(!o)return this._mouseStarted&&this._mouseUp(e),i=1===(this._mouseDownEvent=e).which,r=!("string"!=typeof(t=this).options.cancel||!e.target.nodeName)&&n(e.target).closest(this.options.cancel).length,i&&!r&&this._mouseCapture(e)&&(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){t.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=!1!==this._mouseStart(e),!this._mouseStarted)?e.preventDefault():(!0===n.data(e.target,this.widgetName+".preventClickEvent")&&n.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return t._mouseMove(e)},this._mouseUpDelegate=function(e){return t._mouseUp(e)},n(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),o=!0)),!0},_mouseMove:function(e){return n.ui.ie&&(!document.documentMode||document.documentMode<9)&&!e.button?this._mouseUp(e):this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,e),this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){return n(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&n.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(d){function f(e,t,i){return t<e&&e<t+i}function g(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))}d.widget("ui.sortable",d.ui.mouse,{version:"1.10.3",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=!!this.items.length&&("x"===e.axis||g(this.items[0].item)),this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var e=this.items.length-1;0<=e;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_setOption:function(e,t){"disabled"===e?(this.options[e]=t,this.widget().toggleClass("ui-sortable-disabled",!!t)):d.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(e,t){var i=null,r=!1,n=this;return!(this.reverting||this.options.disabled||"static"===this.options.type||(this._refreshItems(e),d(e.target).parents().each(function(){if(d.data(this,n.widgetName+"-item")===n)return i=d(this),!1}),!(i=d.data(e.target,n.widgetName+"-item")===n?d(e.target):i))||(this.options.handle&&!t&&(d(this.options.handle,i).find("*").addBack().each(function(){this===e.target&&(r=!0)}),!r)||(this.currentItem=i,this._removeCurrentsFromItems(),0)))},_mouseStart:function(e,t,i){var r,n,o=this.options;if((this.currentContainer=this).refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},d.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),o.containment&&this._setContainment(),o.cursor&&"auto"!==o.cursor&&(n=this.document.find("body"),this.storedCursor=n.css("cursor"),n.css("cursor",o.cursor),this.storedStylesheet=d("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(n)),o.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",o.opacity)),o.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",o.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!i)for(r=this.containers.length-1;0<=r;r--)this.containers[r]._trigger("activate",e,this._uiHash(this));return d.ui.ddmanager&&(d.ui.ddmanager.current=this),d.ui.ddmanager&&!o.dropBehaviour&&d.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var t,i,r,n,o=this.options,s=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=s=this.scrollParent[0].scrollTop+o.scrollSpeed:e.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=s=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=s=this.scrollParent[0].scrollLeft+o.scrollSpeed:e.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=s=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(e.pageY-d(document).scrollTop()<o.scrollSensitivity?s=d(document).scrollTop(d(document).scrollTop()-o.scrollSpeed):d(window).height()-(e.pageY-d(document).scrollTop())<o.scrollSensitivity&&(s=d(document).scrollTop(d(document).scrollTop()+o.scrollSpeed)),e.pageX-d(document).scrollLeft()<o.scrollSensitivity?s=d(document).scrollLeft(d(document).scrollLeft()-o.scrollSpeed):d(window).width()-(e.pageX-d(document).scrollLeft())<o.scrollSensitivity&&(s=d(document).scrollLeft(d(document).scrollLeft()+o.scrollSpeed))),!1!==s)&&d.ui.ddmanager&&!o.dropBehaviour&&d.ui.ddmanager.prepareOffsets(this,e),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),t=this.items.length-1;0<=t;t--)if(r=(i=this.items[t]).item[0],(n=this._intersectsWithPointer(i))&&i.instance===this.currentContainer&&!(r===this.currentItem[0]||this.placeholder[1===n?"next":"prev"]()[0]===r||d.contains(this.placeholder[0],r)||"semi-dynamic"===this.options.type&&d.contains(this.element[0],r))){if(this.direction=1===n?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(i))break;this._rearrange(e,i),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),d.ui.ddmanager&&d.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,t){var i,r,n,o;if(e)return d.ui.ddmanager&&!this.options.dropBehaviour&&d.ui.ddmanager.drop(this,e),this.options.revert?(r=(i=this).placeholder.offset(),o={},(n=this.options.axis)&&"x"!==n||(o.left=r.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),n&&"y"!==n||(o.top=r.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,d(this.helper).animate(o,parseInt(this.options.revert,10)||500,function(){i._clear(e)})):this._clear(e,t),!1},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var e=this.containers.length-1;0<=e;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),d.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?d(this.domPosition.prev).after(this.currentItem):d(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var e=this._getItemsAsjQuery(t&&t.connected),i=[];return t=t||{},d(e).each(function(){var e=(d(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);e&&i.push((t.key||e[1]+"[]")+"="+(t.key&&t.expression?e[1]:e[2]))}),!i.length&&t.key&&i.push(t.key+"="),i.join("&")},toArray:function(e){var t=this._getItemsAsjQuery(e&&e.connected),i=[];return e=e||{},t.each(function(){i.push(d(e.item||this).attr(e.attribute||"id")||"")}),i},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,r=this.positionAbs.top,n=r+this.helperProportions.height,o=e.left,s=o+e.width,a=e.top,l=a+e.height,c=this.offset.click.top,p=this.offset.click.left,c="x"===this.options.axis||a<r+c&&r+c<l,p="y"===this.options.axis||o<t+p&&t+p<s;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?c&&p:o<t+this.helperProportions.width/2&&i-this.helperProportions.width/2<s&&a<r+this.helperProportions.height/2&&n-this.helperProportions.height/2<l},_intersectsWithPointer:function(e){var t="x"===this.options.axis||f(this.positionAbs.top+this.offset.click.top,e.top,e.height),e="y"===this.options.axis||f(this.positionAbs.left+this.offset.click.left,e.left,e.width),t=t&&e,e=this._getDragVerticalDirection(),i=this._getDragHorizontalDirection();return!!t&&(this.floating?i&&"right"===i||"down"===e?2:1:e&&("down"===e?2:1))},_intersectsWithSides:function(e){var t=f(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),e=f(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),i=this._getDragVerticalDirection(),r=this._getDragHorizontalDirection();return this.floating&&r?"right"===r&&e||"left"===r&&!e:i&&("down"===i&&t||"up"===i&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!=e&&(0<e?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!=e&&(0<e?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(e){var t,i,r,n,o=[],s=[],a=this._connectWith();if(a&&e)for(t=a.length-1;0<=t;t--)for(i=(r=d(a[t])).length-1;0<=i;i--)(n=d.data(r[i],this.widgetFullName))&&n!==this&&!n.options.disabled&&s.push([d.isFunction(n.options.items)?n.options.items.call(n.element):d(n.options.items,n.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),n]);for(s.push([d.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):d(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),t=s.length-1;0<=t;t--)s[t][0].each(function(){o.push(this)});return d(o)},_removeCurrentsFromItems:function(){var i=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=d.grep(this.items,function(e){for(var t=0;t<i.length;t++)if(i[t]===e.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var t,i,r,n,o,s,a,l,c=this.items,p=[[d.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):d(this.options.items,this.element),this]],h=this._connectWith();if(h&&this.ready)for(t=h.length-1;0<=t;t--)for(i=(r=d(h[t])).length-1;0<=i;i--)(n=d.data(r[i],this.widgetFullName))&&n!==this&&!n.options.disabled&&(p.push([d.isFunction(n.options.items)?n.options.items.call(n.element[0],e,{item:this.currentItem}):d(n.options.items,n.element),n]),this.containers.push(n));for(t=p.length-1;0<=t;t--)for(o=p[t][1],l=(s=p[t][i=0]).length;i<l;i++)(a=d(s[i])).data(this.widgetName+"-item",o),c.push({item:a,instance:o,width:0,height:0,left:0,top:0})},refreshPositions:function(e){var t,i,r,n;for(this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset()),t=this.items.length-1;0<=t;t--)(i=this.items[t]).instance!==this.currentContainer&&this.currentContainer&&i.item[0]!==this.currentItem[0]||(r=this.options.toleranceElement?d(this.options.toleranceElement,i.item):i.item,e||(i.width=r.outerWidth(),i.height=r.outerHeight()),n=r.offset(),i.left=n.left,i.top=n.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(t=this.containers.length-1;0<=t;t--)n=this.containers[t].element.offset(),this.containers[t].containerCache.left=n.left,this.containers[t].containerCache.top=n.top,this.containers[t].containerCache.width=this.containers[t].element.outerWidth(),this.containers[t].containerCache.height=this.containers[t].element.outerHeight();return this},_createPlaceholder:function(i){var r,n=(i=i||this).options;n.placeholder&&n.placeholder.constructor!==String||(r=n.placeholder,n.placeholder={element:function(){var e=i.currentItem[0].nodeName.toLowerCase(),t=d("<"+e+">",i.document[0]).addClass(r||i.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===e?i.currentItem.children().each(function(){d("<td>&#160;</td>",i.document[0]).attr("colspan",d(this).attr("colspan")||1).appendTo(t)}):"img"===e&&t.attr("src",i.currentItem.attr("src")),r||t.css("visibility","hidden"),t},update:function(e,t){r&&!n.forcePlaceholderSize||(t.height()||t.height(i.currentItem.innerHeight()-parseInt(i.currentItem.css("paddingTop")||0,10)-parseInt(i.currentItem.css("paddingBottom")||0,10)),t.width())||t.width(i.currentItem.innerWidth()-parseInt(i.currentItem.css("paddingLeft")||0,10)-parseInt(i.currentItem.css("paddingRight")||0,10))}}),i.placeholder=d(n.placeholder.element.call(i.element,i.currentItem)),i.currentItem.after(i.placeholder),n.placeholder.update(i,i.placeholder)},_contactContainers:function(e){for(var t,i,r,n,o,s,a,l,c,p=null,h=null,u=this.containers.length-1;0<=u;u--)d.contains(this.currentItem[0],this.containers[u].element[0])||(this._intersectsWith(this.containers[u].containerCache)?p&&d.contains(this.containers[u].element[0],p.element[0])||(p=this.containers[u],h=u):this.containers[u].containerCache.over&&(this.containers[u]._trigger("out",e,this._uiHash(this)),this.containers[u].containerCache.over=0));if(p)if(1===this.containers.length)this.containers[h].containerCache.over||(this.containers[h]._trigger("over",e,this._uiHash(this)),this.containers[h].containerCache.over=1);else{for(i=1e4,r=null,o=(c=p.floating||g(this.currentItem))?"width":"height",s=this.positionAbs[n=c?"left":"top"]+this.offset.click[n],t=this.items.length-1;0<=t;t--)!d.contains(this.containers[h].element[0],this.items[t].item[0])||this.items[t].item[0]===this.currentItem[0]||c&&!f(this.positionAbs.top+this.offset.click.top,this.items[t].top,this.items[t].height)||(a=this.items[t].item.offset()[n],l=!1,Math.abs(a-s)>Math.abs(a+this.items[t][o]-s)&&(l=!0,a+=this.items[t][o]),Math.abs(a-s)<i&&(i=Math.abs(a-s),r=this.items[t],this.direction=l?"up":"down"));(r||this.options.dropOnEmpty)&&this.currentContainer!==this.containers[h]&&(r?this._rearrange(e,r,null,!0):this._rearrange(e,null,this.containers[h].element,!0),this._trigger("change",e,this._uiHash()),this.containers[h]._trigger("change",e,this._uiHash(this)),this.currentContainer=this.containers[h],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[h]._trigger("over",e,this._uiHash(this)),this.containers[h].containerCache.over=1)}},_createHelper:function(e){var t=this.options,e=d.isFunction(t.helper)?d(t.helper.apply(this.element[0],[e,this.currentItem])):"clone"===t.helper?this.currentItem.clone():this.currentItem;return e.parents("body").length||d("parent"!==t.appendTo?t.appendTo:this.currentItem[0].parentNode)[0].appendChild(e[0]),e[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),e[0].style.width&&!t.forceHelperSize||e.width(this.currentItem.width()),e[0].style.height&&!t.forceHelperSize||e.height(this.currentItem.height()),e},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),"left"in(e=d.isArray(e)?{left:+e[0],top:+e[1]||0}:e)&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&d.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),{top:(e=this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&d.ui.ie?{top:0,left:0}:e).top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){var e;return"relative"===this.cssPosition?{top:(e=this.currentItem.position()).top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}:{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,t,i=this.options;"parent"===i.containment&&(i.containment=this.helper[0].parentNode),"document"!==i.containment&&"window"!==i.containment||(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,d("document"===i.containment?document:window).width()-this.helperProportions.width-this.margins.left,(d("document"===i.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(i.containment)||(e=d(i.containment)[0],i=d(i.containment).offset(),t="hidden"!==d(e).css("overflow"),this.containment=[i.left+(parseInt(d(e).css("borderLeftWidth"),10)||0)+(parseInt(d(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(d(e).css("borderTopWidth"),10)||0)+(parseInt(d(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(t?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(d(e).css("borderLeftWidth"),10)||0)-(parseInt(d(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(t?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(d(e).css("borderTopWidth"),10)||0)-(parseInt(d(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,t){t=t||this.position;var e="absolute"===e?1:-1,i="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&d.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,r=/(html|body)/i.test(i[0].tagName);return{top:t.top+this.offset.relative.top*e+this.offset.parent.top*e-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():r?0:i.scrollTop())*e,left:t.left+this.offset.relative.left*e+this.offset.parent.left*e-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():r?0:i.scrollLeft())*e}},_generatePosition:function(e){var t=this.options,i=e.pageX,r=e.pageY,n="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&d.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(n[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(i=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(r=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(i=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3])&&(r=this.containment[3]+this.offset.click.top),t.grid)&&(e=this.originalPageY+Math.round((r-this.originalPageY)/t.grid[1])*t.grid[1],r=!this.containment||e-this.offset.click.top>=this.containment[1]&&e-this.offset.click.top<=this.containment[3]?e:e-this.offset.click.top>=this.containment[1]?e-t.grid[1]:e+t.grid[1],e=this.originalPageX+Math.round((i-this.originalPageX)/t.grid[0])*t.grid[0],i=!this.containment||e-this.offset.click.left>=this.containment[0]&&e-this.offset.click.left<=this.containment[2]?e:e-this.offset.click.left>=this.containment[0]?e-t.grid[0]:e+t.grid[0]),{top:r-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:n.scrollTop()),left:i-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:n.scrollLeft())}},_rearrange:function(e,t,i,r){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!r)})},_clear:function(e,t){this.reverting=!1;var i,r=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(i in this._storedCSS)"auto"!==this._storedCSS[i]&&"static"!==this._storedCSS[i]||(this._storedCSS[i]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&r.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||r.push(function(e){this._trigger("update",e,this._uiHash())}),this===this.currentContainer||t||(r.push(function(e){this._trigger("remove",e,this._uiHash())}),r.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),r.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer))),i=this.containers.length-1;0<=i;i--)t||r.push(function(t){return function(e){t._trigger("deactivate",e,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over&&(r.push(function(t){return function(e){t._trigger("out",e,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!t){for(this._trigger("beforeStop",e,this._uiHash()),i=0;i<r.length;i++)r[i].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1}if(t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!t){for(i=0;i<r.length;i++)r[i].call(this,e);this._trigger("stop",e,this._uiHash())}return!(this.fromOutside=!1)},_trigger:function(){!1===d.Widget.prototype._trigger.apply(this,arguments)&&this.cancel()},_uiHash:function(e){var t=e||this;return{helper:t.helper,placeholder:t.placeholder||d([]),position:t.position,originalPosition:t.originalPosition,offset:t.positionAbs,item:t.currentItem,sender:e?e.element:null}}})}(jQuery),function(e){"function"==typeof define&&define.amd?define(["jquery","jquery-ui"],e):e(jQuery)}(function(l){if(l.mspointer=window.navigator.msPointerEnabled,l.touch="ontouchstart"in document||"ontouchstart"in window||window.TouchEvent||window.DocumentTouch&&document instanceof DocumentTouch||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints,(l.touch||l.mspointer)&&l.ui.mouse){let e=l.ui.mouse.prototype,t=e._mouseInit,i=e._mouseDestroy,r,n=0,o=(e._touchStart=function(e){this._startedMove=e.timeStamp,this._startPos=c(e),!r&&this._mouseCapture(e.originalEvent.changedTouches[0])&&(r=!0,this._touchMoved=!1,p(e,"mouseover"),p(e,"mousemove"),p(e,"mousedown"))},e._touchMove=function(e){r&&(this._touchMoved=!0,p(e,"mousemove"))},e._touchEnd=function(e){var t;r&&(p(e,"mouseup"),p(e,"mouseout"),t=e.timeStamp-this._startedMove,!this._touchMoved||t<500?(e.timeStamp-n<400?p(e,"dblclick"):p(e,"click"),n=e.timeStamp):(t=c(e),Math.abs(t.x-this._startPos.x)<10&&Math.abs(t.y-this._startPos.y)<10&&(this._touchMoved&&"stylus"!==e.originalEvent.changedTouches[0].touchType||p(e,"click"))),this._touchMoved=!1,r=!1)},e._touchStart.bind(e)),s=e._touchMove.bind(e),a=e._touchEnd.bind(e);function c(e){return{x:e.originalEvent.changedTouches[0].pageX,y:e.originalEvent.changedTouches[0].pageY}}function p(e,t){var i;1<e.originalEvent.touches.length||l(e.target).is("input")||l(e.target).is("textarea")||(e.cancelable&&e.preventDefault(),i=e.originalEvent.changedTouches[0],t=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,screenX:i.screenX,screenY:i.screenY,clientX:i.clientX,clientY:i.clientY}),e.target.dispatchEvent(t))}e._mouseInit=function(){l.support.mspointer&&(this.element[0].style.msTouchAction="none"),this.element.on({touchstart:o,touchmove:s,touchend:a}),t.call(this)},e._mouseDestroy=function(){this.element.off({touchstart:o,touchmove:s,touchend:a}),i.call(this)}}}),function(e){var t=e({});e.subscribe=function(){t.on.apply(t,arguments)},e.unsubscribe=function(){t.off.apply(t,arguments)},e.publish=function(){t.trigger.apply(t,arguments)}}(jQuery),function(r){"use strict";function n(e,t){this.init("tooltip",e,t)}n.prototype={constructor:n,init:function(e,t,i){this.type=e,this.$element=r(t),this.options=this.getOptions(i),this.enabled=!0,"click"==this.options.trigger?this.$element.on("click."+this.type,this.options.selector,r.proxy(this.toggle,this)):"manual"!=this.options.trigger&&(e="hover"==this.options.trigger?"mouseenter":"focus",t="hover"==this.options.trigger?"mouseleave":"blur",this.$element.on(e+"."+this.type,this.options.selector,r.proxy(this.enter,this)),this.$element.on(t+"."+this.type,this.options.selector,r.proxy(this.leave,this))),this.options.selector?this._options=r.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(e){return(e=r.extend({},r.fn[this.type].defaults,e,this.$element.data())).delay&&"number"==typeof e.delay&&(e.delay={show:e.delay,hide:e.delay}),e},enter:function(e){var t=r(e.currentTarget)[this.type](this._options).data(this.type);if(!t.options.delay||!t.options.delay.show)return t.show();clearTimeout(this.timeout),t.hoverState="in",this.timeout=setTimeout(function(){"in"==t.hoverState&&t.show()},t.options.delay.show)},leave:function(e){var t=r(e.currentTarget)[this.type](this._options).data(this.type);if(this.timeout&&clearTimeout(this.timeout),!t.options.delay||!t.options.delay.hide)return t.hide();t.hoverState="out",this.timeout=setTimeout(function(){"out"==t.hoverState&&t.hide()},t.options.delay.hide)},show:function(){var e,t,i,r,n,o,s;if(this.hasContent()&&this.enabled){switch(e=this.tip(),this.setContent(),this.options.animation&&e.addClass("fade"),o="function"==typeof this.options.placement?this.options.placement.call(this,e[0],this.$element[0]):this.options.placement,t=/in/.test(o),e.remove().css({top:0,left:0,display:"block"}).appendTo(t?this.$element:document.body),i=this.getPosition(t),r=e[0].offsetWidth,n=e[0].offsetHeight,t?o.split(" ")[1]:o){case"bottom":s={top:i.top+i.height,left:i.left+i.width/2-r/2};break;case"top":s={top:i.top-n,left:i.left+i.width/2-r/2};break;case"left":s={top:i.top+i.height/2-n/2,left:i.left-r};break;case"right":s={top:i.top+i.height/2-n/2,left:i.left+i.width}}e.css(s).addClass(o).addClass("in")}},setContent:function(){var e=this.tip(),t=this.getTitle();e.find(".tooltip-inner")[this.options.html?"html":"text"](t),e.removeClass("fade in top bottom left right")},hide:function(){var e,t=this.tip();return t.removeClass("in"),r.support.transition&&this.$tip.hasClass("fade")?(e=setTimeout(function(){t.off(r.support.transition.end).remove()},500),t.one(r.support.transition.end,function(){clearTimeout(e),t.remove()})):t.remove(),this},fixTitle:function(){var e=this.$element;!e.attr("title")&&"string"==typeof e.attr("data-original-title")||e.attr("data-original-title",e.attr("title")||"").removeAttr("title")},hasContent:function(){return this.getTitle()},getPosition:function(e){return r.extend({},e?{top:0,left:0}:this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var e=this.$element,t=this.options;return e.attr("data-original-title")||("function"==typeof t.title?t.title.call(e[0]):t.title)},tip:function(){return this.$tip=this.$tip||r(this.options.template)},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass("in")?"hide":"show"]()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}},r.fn.tooltip=function(i){return this.each(function(){var e=r(this),t=e.data("tooltip");t||e.data("tooltip",t=new n(this,"object"==typeof i&&i)),"string"==typeof i&&t[i]()})},r.fn.tooltip.Constructor=n,r.fn.tooltip.defaults={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover",title:"",delay:0,html:!0}}(window.jQuery);var Constants={DEFAULT:{HEIGHT:16,WIDTH:16,FPS:24,LAYER_OPACITY:.2},MODEL_VERSION:2,MAX_HEIGHT:1024,MAX_WIDTH:1024,MAX_PALETTE_COLORS:256,MAX_WORKER_COLORS:256,PREVIEW_FILM_SIZE:96,ANIMATED_PREVIEW_WIDTH:200,RIGHT_COLUMN_PADDING_LEFT:10,DEFAULT_PEN_COLOR:"#000000",TRANSPARENT_COLOR:"rgba(0, 0, 0, 0)",SEAMLESS_MODE_OVERLAY_COLOR:"rgba(255, 255, 255, 0)",CURRENT_COLORS_PALETTE_ID:"__current-colors",SELECTION_TRANSPARENT_COLOR:"rgba(160, 215, 240, 0.6)",TOOL_HIGHLIGHT_COLOR_LIGHT:"rgba(255, 255, 255, 0.2)",TOOL_HIGHLIGHT_COLOR_DARK:"rgba(0, 0, 0, 0.2)",ZOOMED_OUT_BACKGROUND_COLOR:"#A0A0A0",LEFT_BUTTON:0,MIDDLE_BUTTON:1,RIGHT_BUTTON:2,MOUSEMOVE_THROTTLING:10,ABSTRACT_FUNCTION:function(){throw"abstract method should be implemented"},EMPTY_FUNCTION:function(){},DRAWING_TEST_FOLDER:"drawing",APPENGINE_SAVE_LIMIT:1048576,CONFIRM_OVERWRITE:"This will replace your current animation, are you sure you want to continue?",APPENGINE_SAVE_URL:"save",IMAGE_SERVICE_UPLOAD_URL:"{{protocol}}://piskel-imgstore-b.appspot.com/__/upload",IMAGE_SERVICE_GET_URL:"{{protocol}}://piskel-imgstore-b.appspot.com/img/"},Events={TOOL_SELECTED:"TOOL_SELECTED",SELECT_TOOL:"SELECT_TOOL",TOOL_RELEASED:"TOOL_RELEASED",TOOL_PRESSED:"TOOL_PRESSED",SELECT_PRIMARY_COLOR:"SELECT_PRIMARY_COLOR",SELECT_SECONDARY_COLOR:"SELECT_SECONDARY_COLOR",PRIMARY_COLOR_SELECTED:"PRIMARY_COLOR_SELECTED",SECONDARY_COLOR_SELECTED:"SECONDARY_COLOR_SELECTED",CURSOR_MOVED:"CURSOR_MOVED",DRAG_START:"DRAG_START",DRAG_END:"DRAG_END",DIALOG_SHOW:"DIALOG_SHOW",DIALOG_HIDE:"DIALOG_HIDE",PALETTE_LIST_UPDATED:"PALETTE_LIST_UPDATED",USER_SETTINGS_CHANGED:"USER_SETTINGS_CHANGED",SHORTCUTS_CHANGED:"SHORTCUTS_CHANGED",CLOSE_SETTINGS_DRAWER:"CLOSE_SETTINGS_DRAWER",PISKEL_RESET:"PISKEL_RESET",PISKEL_SAVE_STATE:"PISKEL_SAVE_STATE",PISKEL_DESCRIPTOR_UPDATED:"PISKEL_DESCRIPTOR_UPDATED",PISKEL_SAVED_STATUS_UPDATE:"PISKEL_SAVED_STATUS_UPDATE",PISKEL_ADDED:"PISKEL_ADDED",PISKEL_REMOVED:"PISKEL_REMOVED",PISKEL_CHANGED:"PISKEL_CHANGED",HISTORY_STATE_SAVED:"HISTORY_STATE_SAVED",HISTORY_STATE_LOADED:"HISTORY_STATE_LOADED",HISTORY_DATA:"HISTORY_DATA",FORCE_REFRESH:"FORCE_REFRESH",PEN_SIZE_CHANGED:"PEN_SIZE_CHANGED",PISKEL_SAVED:"PISKEL_SAVED",BEFORE_SAVING_PISKEL:"BEFORE_SAVING_PISKEL",AFTER_SAVING_PISKEL:"AFTER_SAVING_PISKEL",FRAME_SIZE_CHANGED:"FRAME_SIZE_CHANGED",FPS_CHANGED:"FPS_CHANGED",SELECTION_CREATED:"SELECTION_CREATED",SELECTION_MOVE_REQUEST:"SELECTION_MOVE_REQUEST",SELECTION_DISMISSED:"SELECTION_DISMISSED",CLIPBOARD_COPY:"CLIPBOARD_COPY",CLIPBOARD_CUT:"CLIPBOARD_CUT",CLIPBOARD_PASTE:"CLIPBOARD_PASTE",SHOW_NOTIFICATION:"SHOW_NOTIFICATION",HIDE_NOTIFICATION:"HIDE_NOTIFICATION",SHOW_PROGRESS:"SHOW_PROGRESS",UPDATE_PROGRESS:"UPDATE_PROGRESS",HIDE_PROGRESS:"HIDE_PROGRESS",ZOOM_CHANGED:"ZOOM_CHANGED",EXPORT_SCALE_CHANGED:"EXPORT_SCALE_CHANGED",CURRENT_COLORS_UPDATED:"CURRENT_COLORS_UPDATED",PERFORMANCE_REPORT_CHANGED:"PERFORMANCE_REPORT_CHANGED",PISKEL_FILE_IMPORT_FAILED:"PISKEL_FILE_IMPORT_FAILED",MOUSE_EVENT:"MOUSE_EVENT",KEYBOARD_EVENT:"KEYBOARD_EVENT",TRANSFORMATION_EVENT:"TRANSFORMATION_EVENT",TEST_RECORD_END:"TEST_RECORD_END",TEST_CASE_END:"TEST_CASE_END",TEST_SUITE_END:"TEST_SUITE_END"},ns=(jQuery.namespace=function(){for(var e=arguments,t=null,i=0;i<e.length;i++)for(var r=e[i].split("."),t=window,n=0;n<r.length;n++)t[r[n]]=t[r[n]]||{},t=t[r[n]];return t},Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");function e(){var e=i.concat(Array.prototype.slice.call(arguments));return r.apply(this instanceof n&&t?this:t,e)}var i=Array.prototype.slice.call(arguments,1),r=this,n=function(){};return n.prototype=this.prototype,e.prototype=new n,e}),Uint32Array.prototype.fill||(Uint32Array.prototype.fill=function(e,t,i){i=void 0===i?this.length:i,(t=void 0===t?0:t)<0&&(t=this.length+t),i<0&&(i=this.length+i);for(var r=t;r<i;r++)this[r]=e}),!function(){var i=$.namespace("pskl.utils"),r=(i.rgbToHex=function(e,t,i){return"#"+pskl.utils.componentToHex(e)+pskl.utils.componentToHex(t)+pskl.utils.componentToHex(i)},i.componentToHex=function(e){e=e.toString(16);return 1==e.length?"0"+e:e},{}),n=(i.intToHex=function(e){var t;return r[e]||(t=i.rgbToHex(255&e,e>>8&255,e>>16&255),r[e]=t)},i.normalize=function(e,t){return null==e?t:e},i.inherit=function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).prototype.superclass=t.prototype},i.wrap=function(e,t){for(var i in t)"function"==typeof t[i]&&void 0===e[i]&&(e[i]=t[i].bind(t))},i.hashCode=function(e){var t=0;if(0!==e.length)for(var i=0,r=e.length;i<r;i++)t=31*t+e.charCodeAt(i),t|=0;return t},i.copy=function(e){return JSON.parse(JSON.stringify(e))},{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"}),o=(i.escapeHtml=function(e){return String(e).replace(/[&<>"'\/]/g,function(e){return n[e]})},{}),s={},a=(i.colorToInt=function(e){var t,i;return"number"==typeof e?e:void 0!==o[e]?o[e]:(t=window.tinycolor(e))&&t.ok?(t=t.toRgb(),t=((i=Math.round(255*t.a))<<24>>>0)+(t.b<<16)+(t.g<<8)+t.r,o[e]=t=0===i?0:t,s[t]=e,t):((i=document.createElement("div")).style.color=e,document.body.appendChild(i),e=window.getComputedStyle(i).color,document.body.removeChild(i),pskl.utils.colorToInt(e))},i.intToColor=function(e){var t;return"string"==typeof e?e:void 0!==s[e]?s[e]:(o[t="rgba("+(255&e)+","+(e>>8&255)+","+(e>>16&255)+","+(e>>24>>>0&255)/255+")"]=e,s[e]=t)},{});i.unescapeHtml=function(t){return Object.keys(n).forEach(function(e){a[e]=a[e]||new RegExp(n[e],"g"),t=t.replace(a[e],e)}),t}}(),!function(){var t=$.namespace("pskl.utils"),e=navigator.userAgent;t.UserAgent={isIE:/MSIE/i.test(e),isIE11:/trident/i.test(e),isEdge:/edge\//i.test(e),isFirefox:/Firefox/i.test(e),isMac:/Mac/.test(e),isOpera:/OPR\//.test(e),hasChrome:/Chrome/i.test(e),hasSafari:/Safari\//.test(e)};t.UserAgent.isChrome=t.UserAgent.hasChrome&&!t.UserAgent.isOpera&&!t.UserAgent.isEdge,t.UserAgent.isSafari=t.UserAgent.hasSafari&&!t.UserAgent.isOpera&&!t.UserAgent.isEdge,t.UserAgent.supportedUserAgents=["isIE11","isEdge","isChrome","isFirefox"],t.UserAgent.version=pskl.utils.UserAgent.isIE?parseInt(/MSIE\s?(\d+)/i.exec(e)[1],10):pskl.utils.UserAgent.isChrome?parseInt(/Chrome\/(\d+)/i.exec(e)[1],10):pskl.utils.UserAgent.isFirefox?parseInt(/Firefox\/(\d+)/i.exec(e)[1],10):void 0,t.UserAgent.isUnsupported=function(){return t.UserAgent.supportedUserAgents.every(function(e){return!t.UserAgent[e]})},t.UserAgent.getDisplayName=function(){return t.UserAgent.isIE?"Internet Explorer":t.UserAgent.isChrome?"Chrome":t.UserAgent.isFirefox?"Firefox":t.UserAgent.isSafari?"Safari":t.UserAgent.isOpera?"Opera":e}}(),$.namespace("pskl.utils").Array={find:function(e,t){var i=null,e=(e=Array.isArray(e)?e:[]).filter(t);return i=e.length?e[0]:i},chunk:function(e,t){for(var i=[],r=(t=Math.min(t,e.length),t=Math.max(1,t),Math.round(e.length/t)),n=0;n<t;n++){var o=n==t-1?e.length:(n+1)*r;i.push(e.slice(n*r,o))}return i}},!function(){var p,e=$.namespace("pskl.utils");Uint8Array&&(p=new Uint8Array([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51])),e.Base64={toText:function(e){return window.atob(e.replace(/data\:.*?\;base64\,/,""))},decode:function(e){for(var t=0,i=[0,0],r=0,n=0,o=e.length,s=0,a=new Uint8Array(o/4*3|0);o--;){var l=e.charCodeAt(s++),c=p[l-43];255!==c&&void 0!==c&&(i[1]=i[0],i[0]=l,n=n<<6|c,4===++r)&&(a[t++]=n>>>16,61!==i[1]&&(a[t++]=n>>>8),61!==i[0]&&(a[t++]=n),r=0)}return a.buffer}}}(),!function(){var e=$.namespace("pskl.utils"),s=/\s*;\s*base64\s*(?:;|$)/i;e.BlobUtils={dataToBlob:function(e,t,i){var r,n=e.indexOf(","),o=e.substring(n+1),e=s.test(e.substring(0,n));Blob.fake?((r=new Blob).encoding=e?"base64":"URI",r.data=o,r.size=o.length):Uint8Array&&(n=e?pskl.utils.Base64.decode(o):decodeURIComponent(o),r=new Blob([n],{type:t})),i(r)},canvasToBlob:function(e,t,i){var r;i=i||"image/png",e.mozGetAsFile?t(e.mozGetAsFile("canvas",i)):(r=Array.prototype.slice.call(arguments,2),r=e.toDataURL.apply(e,r),pskl.utils.BlobUtils.dataToBlob(r,i,t))},stringToBlob:function(e,t,i){i=i||"text/plain",pskl.utils.BlobUtils.dataToBlob("data:"+i+","+e,i,t)}}}(),$.namespace("pskl.utils").CanvasUtils={createCanvas:function(e,t,i){var r=document.createElement("canvas");if(r.setAttribute("width",e),r.setAttribute("height",t),"string"==typeof i&&(i=[i]),Array.isArray(i))for(var n=0;n<i.length;n++)r.classList.add(i[n]);return r},createFromImageData:function(e){var t=pskl.utils.CanvasUtils.createCanvas(e.width,e.height);return t.getContext("2d").putImageData(e,0,0),t},createFromImage:function(e){var t=pskl.utils.CanvasUtils.createCanvas(e.width,e.height);return t.getContext("2d").drawImage(e,0,0),t},createFramesFromImage:function(e,t,i,r,n,o,s){for(var a=[],l=t,c=i,p=pskl.utils.CanvasUtils.createCanvas(r,n).toDataURL();l+r<=e.width&&c+n<=e.height;){var h=pskl.utils.CanvasUtils.createCanvas(r,n);h.getContext("2d").drawImage(e,l,c,r,n,0,0,r,n),s&&h.toDataURL()===p||a.push(h),o?(l+=r)+r>e.width&&(l=t,c+=n):(c+=n)+n>e.height&&(l+=r,c=i)}return a},disableImageSmoothing:function(e){pskl.utils.CanvasUtils.setImageSmoothing(e,!1)},enableImageSmoothing:function(e){pskl.utils.CanvasUtils.setImageSmoothing(e,!0)},setImageSmoothing:function(e,t){e=e.getContext("2d");e.imageSmoothingEnabled=t,e.mozImageSmoothingEnabled=t,e.oImageSmoothingEnabled=t,e.webkitImageSmoothingEnabled=t,e.msImageSmoothingEnabled=t},clear:function(e){e&&e.getContext("2d").clearRect(0,0,e.width,e.height)},clone:function(e){var t=pskl.utils.CanvasUtils.createCanvas(e.width,e.height);return t.getContext("2d").drawImage(e,0,0),t},getImageDataFromCanvas:function(e){return e.getContext("2d").getImageData(0,0,e.width,e.height).data},getBase64FromCanvas:function(e,t){e=e.toDataURL("image/"+(t=t||"png"));return e.substr(e.indexOf(",")+1)}},$.namespace("pskl.utils").ColorUtils={getUnusedColor:function(e){for(var t={},i=((e=e||[]).forEach(function(e){t[e.toUpperCase()]=!0}),{r:255,g:255,b:0}),r=null;;){var n=window.tinycolor(i).toHexString().toUpperCase();if(!t[n]){r=n;break}n=(i.r?"r":i.g&&"g")||i.b&&"b";if(!n)break;i[n]=i[n]-1}return r}},!function(){function i(e){return e<10?"0"+e:""+e}var e=$.namespace("pskl.utils");e.DateUtils={format:function(e,t){return e=new Date(e),pskl.utils.Template.replace(t,{Y:e.getFullYear(),M:i(e.getMonth()+1),D:i(e.getDate()),H:i(e.getHours()),m:i(e.getMinutes()),s:i(e.getSeconds())})}}}(),!function(){var i=$.namespace("pskl.utils");i.Dom={isParent:function(e,t,i){if(e&&t)for(i&&(e=e.parentNode);e;){if(e===t)return!0;e=e.parentNode}return!1},getParentWithData:function(e,t){for(;e;){if(e.dataset&&void 0!==e.dataset[t])return e;e=e.parentNode}return null},getData:function(e,t){e=i.Dom.getParentWithData(e,t);if(null!==e)return e.dataset[t]},removeClass:function(e,t){for(var i=(t=t||document).querySelectorAll("."+e),r=0;r<i.length;r++)i[r].classList.remove(e)}}}(),!function(){var e=$.namespace("pskl.utils");e.Event={},e.Event.addEventListener=function(e,t,i,r,n){n={el:e="string"==typeof e?document.querySelector(e):e,type:t,callback:i,handler:n?i.bind(r,n):i.bind(r)};r.__pskl_listeners=r.__pskl_listeners||[],r.__pskl_listeners.push(n),e.addEventListener(t,n.handler)},e.Event.removeEventListener=function(e,t,i,r){if(r&&r.__pskl_listeners)for(var n=r.__pskl_listeners,o=0;o<n.length;o++){var s=n[o];if(s.callback===i&&s.el===e&&s.type===t){e.removeEventListener(t,n[o].handler),n.splice(o,1);break}}},e.Event.removeAllEventListeners=function(e){if(e&&e.__pskl_listeners){for(var t=e.__pskl_listeners,i=0;i<t.length;i++){var r=t[i];r.el.removeEventListener(r.type,r.handler)}e.__pskl_listeners=[]}}}(),$.namespace("pskl.utils").Environment={detectNative:function(){return void 0!==window.NL_ISNEUTRALINO&&window.NL_ISNEUTRALINO},isIntegrationTest:function(){return-1!==window.location.href.indexOf("integration-test")},isDebug:function(){return-1!==window.location.href.indexOf("debug")},isHttps:function(){return 0===window.location.href.indexOf("https://")}},$.namespace("pskl.utils").FunctionUtils={memo:function(t,i,r){return function(){var e=Array.prototype.join.call(arguments,"-");return i[e]||(i[e]=t.apply(r,arguments)),i[e]}},throttle:function(t,i){var r,n;return function(){var e=Date.now();r&&e<r+i?(clearTimeout(n),n=setTimeout(function(){r=e,t()},i)):(r=e,t())}}},$.namespace("pskl.utils").Math={minmax:function(e,t,i){return Math.max(Math.min(e,i),t)},distance:function(e,t,i,r){t=Math.abs(t-e),e=Math.abs(r-i);return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))}},!function(){function r(e){e.stopPropagation()}var n=$.namespace("pskl.utils");n.FileUtils={getFilePath:function(e){return"string"==typeof e?e:e.name},getFileName:function(e){},isFilePiskel:function(e){return/\.piskel$/.test("string"==typeof e?e:e.name)},isFileImage:function(e){return!this.isFilePiskel(e)},readFile:function(e,t){var i=new FileReader;i.addEventListener("loadend",function(){t(i.result)}),i.readAsDataURL(e)},readFileAsArrayBuffer:function(e,t){var i=new FileReader;i.addEventListener("loadend",function(){t(i.result)}),i.readAsArrayBuffer(e)},readImageFile:function(e,i){pskl.utils.Environment.detectNative()?n.FileUtilsDesktop.readFileBinary(e).then(e=>{var e=new Uint8Array(e),e=btoa(String.fromCharCode(...new Uint8Array(e))),t=new Image;t.onload=i.bind(null,t),t.src="data:image/png;base64,"+e}):n.FileUtils.readFile(e,function(e){var t=new Image;t.onload=i.bind(null,t),t.src=e})},downloadAsFile:function(e,t){var i=window.saveAs||navigator.msSaveBlob&&navigator.msSaveBlob.bind(navigator);i?i(e,t):pskl.utils.Environment.detectNative()?"zip"!=(i=t.split(".").pop())&&"png"!=i||Neutralino.os.showSaveDialog("Save to file",{defaultPath:t,filters:{zip:[{name:"Zip file",extensions:["zip"]}],png:[{name:"PNG image",extensions:["png"]}]}[i]}).then(t=>{e.arrayBuffer().then(e=>{n.FileUtilsDesktop.saveToFileBinary(e,t)})}):(i=document.createElement("a"),e=window.URL.createObjectURL(e),i.setAttribute("href",e),i.setAttribute("download",t),document.body.appendChild(i),i.addEventListener("click",r),i.click(),i.removeEventListener("click",r),document.body.removeChild(i))}}}(),$.namespace("pskl.utils").FileUtilsDesktop={chooseFilenameDialogOpen:function(){return Neutralino.os.showOpenDialog("Open file",{filters:[{name:"All supported",extensions:["piskel","jpg","png","bmp"]},{name:"Images",extensions:["jpg","png","bmp"]},{name:"Piskel files",extensions:["piskel"]}]})},chooseFilenameDialogSave:function(e){return Neutralino.os.showSaveDialog("Save to file",{defaultPath:e,filters:[{name:"Piskel files",extensions:["piskel"]}]})},saveToFile:function(e,t){return Neutralino.filesystem.writeFile(t,e)},saveToFileBinary:function(e,t){return Neutralino.filesystem.writeBinaryFile(t,e)},readFile:function(e){return Neutralino.filesystem.readFile(e)},readFileBinary:function(e){return console.log(e),Neutralino.filesystem.readBinaryFile(e)},addPiskelFromFile:function(t){const i=Q.defer();return pskl.utils.FileUtilsDesktop.readFile(t).then(function(e){pskl.utils.PiskelFileUtils.decodePiskelFile(e,function(e){e.savePath=t;e=pskl.app.piskelController.addPiskel(e);pskl.app.tabsController.add(e),i.resolve(e)})}),i.promise},addPiskels:function(e,t){e=e.map(e=>pskl.utils.FileUtilsDesktop.addPiskelFromFile(e));const i=pskl.app.piskelController.getPiskelIds();Q.all(e).fin(function(){pskl.app.piskelController.selectPiskel(i[i.length-1]),t()})}},!function(){var o=$.namespace("pskl.utils"),h={},u={};o.FrameUtils={toImage:function(e,t,i){t=t||1,i=isNaN(i)?1:i;e=new pskl.rendering.CanvasRenderer(e,t);return e.drawTransparentAs(Constants.TRANSPARENT_COLOR),e.setOpacity(i),e.render()},drawToCanvas:function(e,t,i,r){t=t.getContext("2d");if(r=isNaN(r)?1:r,t.globalAlpha=r,i=i||Constants.TRANSPARENT_COLOR,e instanceof pskl.model.frame.RenderedFrame)t.fillRect(i,0,0,e.getWidth(),e.getHeight()),t.drawImage(e.getRenderedFrame(),0,0);else{var r=e.getWidth(),n=e.getHeight(),o=e.pixels,s=pskl.utils.colorToInt(Constants.TRANSPARENT_COLOR),a=pskl.utils.colorToInt(i);if(a!=s)for(var l=0,c=(o=e.getPixels()).length;l<c;l++)o[l]==s&&(o[l]=a);var p,i=r+"-"+n,e=u[i]||(u[i]=t.createImageData(r,n)),i=new Uint8ClampedArray(o.buffer),i=(e.data.set(i),r+"-"+n);h[i]?p=h[i]:(p=h[i]=pskl.utils.CanvasUtils.createCanvas(r,n)).context=p.getContext("2d"),p.context.putImageData(e,0,0),t.drawImage(p,0,0,r,n),t.globalAlpha=1}},renderLine_:function(e,t,i,r,n){e!==Constants.TRANSPARENT_COLOR&&null!==e&&(n.fillStyle=e,n.fillRect(t,i,1,r))},merge:function(e){var t=null;if(e.length)for(var t=e[0].clone(),i=1;i<e.length;i++)pskl.utils.FrameUtils.mergeFrames_(t,e[i]);return t},mergeFrames_:function(e,t){for(var i=pskl.utils.colorToInt(Constants.TRANSPARENT_COLOR),r=0,n=e.getWidth()*e.getHeight();r<n;++r)t.pixels[r]!=i&&e.pixels[r]!=t.pixels[r]&&(e.pixels[r]=t.pixels[r])},addImageToFrame:function(r,e,n,o){e=pskl.utils.FrameUtils.createFromImage(e);n=Math.max(0,n),o=Math.max(0,o),e.width<=r.width&&(n=Math.min(n,r.width-e.width)),e.height<=r.height&&(o=Math.min(o,r.height-e.height)),e.forEachPixel(function(e,t,i){e!=pskl.utils.colorToInt(Constants.TRANSPARENT_COLOR)&&r.setPixel(n+t,o+i,e)})},resize:function(e,t,i,r){e=pskl.utils.FrameUtils.toImage(e),e=pskl.utils.ImageResizer.resize(e,t,i,r);return pskl.utils.FrameUtils.createFromImage(e)},removeTransparency:function(o){o.forEachPixel(function(e,t,i){var r,n=e>>24>>>0&255;n&&255!=n&&(r=255*Math.round(n/255),o.setPixel(t,i,e-(n<<24>>>0)+(r<<24>>>0)))})},createFromCanvas:function(e,t,i,r,n,o){e=e.getContext("2d").getImageData(t,i,r,n).data;return pskl.utils.FrameUtils.createFromImageData_(e,r,n,o)},createFromImageSrc:function(e,i,r){var n=new Image;n.addEventListener("load",function e(){n.removeEventListener("load",e);var t=o.FrameUtils.createFromImage(n,i);r(t)}),n.src=e},createFromImage:function(e,t){var i=e.width,r=e.height,n=pskl.utils.CanvasUtils.createCanvas(i,r).getContext("2d"),e=(n.drawImage(e,0,0,i,r,0,0,i,r),n.getImageData(0,0,i,r).data);return pskl.utils.FrameUtils.createFromImageData_(e,i,r,t)},createFromImageData_:function(e,t,i,r){t=new pskl.model.Frame(t,i);return t.pixels=new Uint32Array(e.buffer),r||pskl.utils.FrameUtils.removeTransparency(t),t},createFramesFromSpritesheet:function(e,t){for(var i=[],r=0;r<t;r++)i.push([r]);return pskl.utils.FrameUtils.createFramesFromChunk(e,i).map(function(e){return e.frame})},createFramesFromChunk:function(e,t){for(var i=e.width,r=e.height,n=i/t.length,o=r/t[0].length,s=pskl.utils.CanvasUtils.createCanvas(n,o),a=s.getContext("2d"),l=[],c=0;c<t.length;c++)for(var p=t[c],h=0;h<p.length;h++){a.clearRect(0,0,n,o),a.drawImage(e,n*c,o*h,n,o,0,0,n,o);var u=pskl.utils.FrameUtils.createFromCanvas(s,0,0,n,o);l.push({index:t[c][h],frame:u})}return l},toFrameGrid:function(e){for(var t=[],i=e[0].length,r=e.length,n=0;n<i;n++){t[n]=[];for(var o=0;o<r;o++)t[n][o]=e[o][n]}return t}}}(),!function(){var r=$.namespace("pskl.utils");r.ImageResizer={scale:function(e,t,i){return r.ImageResizer.resize(e,e.width*t,e.height*t,i)},resize:function(e,t,i,r){var n=pskl.utils.CanvasUtils.createCanvas(t,i),o=n.getContext("2d");return o.save(),r||pskl.utils.CanvasUtils.disableImageSmoothing(n),o.translate(n.width/2,n.height/2),o.scale(t/e.width,i/e.height),o.drawImage(e,-e.width/2,-e.height/2),o.restore(),n}}}(),!function(){var a=$.namespace("pskl.utils");a.LayerUtils={clone:function(e){var t=e.getFrames().map(function(e){return e.clone()});return pskl.model.Layer.fromFrames(e.getName()+" (clone)",t)},mergeLayers:function(e,t){var i=e.getFrames(),r=t.getFrames(),n=[];return i.forEach(function(e,t){t=r[t];n.push(pskl.utils.FrameUtils.merge([t,e]))}),pskl.model.Layer.fromFrames(e.getName(),n)},getFrameHashAt:function(e,i){var r=[];return e.forEach(function(e){var t=e.getFrameAt(i);return r.push(t.getHash()),r.push(e.getOpacity()),t}),r.join("-")},mergeFrameAt:function(e,t){return e.some(function(e){return e.isTransparent()})?pskl.utils.LayerUtils.mergeTransparentFrameAt_(e,t):pskl.utils.LayerUtils.mergeOpaqueFrameAt_(e,t)},mergeTransparentFrameAt_:function(e,t){var i=pskl.utils.LayerUtils.getFrameHashAt(e,t),r=e[0].frames[0].getWidth(),n=e[0].frames[0].getHeight();return new pskl.model.frame.RenderedFrame(function(){return pskl.utils.LayerUtils.flattenFrameAt(e,t,!0)},r,n,i)},mergeOpaqueFrameAt_:function(e,t){var i=pskl.utils.LayerUtils.getFrameHashAt(e,t),e=e.map(function(e){return e.getFrameAt(t)}),e=pskl.utils.FrameUtils.merge(e);return e.id=i,e.version=0,e},renderFrameAt:function(e,t,i){i=i?e.getOpacity():1,e=e.getFrameAt(t);return pskl.utils.FrameUtils.toImage(e,1,i)},flattenFrameAt:function(e,t,i){var r=e[0].getFrameAt(t).getWidth(),n=e[0].getFrameAt(t).getHeight(),o=pskl.utils.CanvasUtils.createCanvas(r,n),s=o.getContext("2d");return e.forEach(function(e){e=a.LayerUtils.renderFrameAt(e,t,i);s.drawImage(e,0,0,r,n,0,0,r,n)}),o}}}(),!function(){var a=$.namespace("pskl.utils");a.MergeUtils={merge:function(o,e,t){(e.getWidth()>o.getWidth()||e.getHeight()>o.getHeight())&&"expand"===t.resize?o=pskl.utils.ResizeUtils.resizePiskel(o,{width:Math.max(o.getWidth(),e.getWidth()),height:Math.max(o.getHeight(),e.getHeight()),origin:t.origin,resizeContent:!1}):e=pskl.utils.ResizeUtils.resizePiskel(e,{width:o.getWidth(),height:o.getHeight(),origin:t.origin,resizeContent:!1});for(var s=t.insertIndex,i=("insert"===t.insertMode&&(s-=1),e.getFrameCount()),r=0;r<i;r++){var n=r+s;("add"===t.insertMode||n>=o.getFrameCount())&&a.MergeUtils.addFrameToLayers_(o,n)}return e.getLayers().forEach(function(e){for(var t=e.getName()+" (imported)",i=new pskl.model.Layer(t),r=0;r<o.getFrameCount();r++){var n=r-s,n=(n=e.getFrameAt(n))||a.MergeUtils.createEmptyFrame_(o);i.addFrame(n)}o.addLayer(i)}),o},createEmptyFrame_:function(e){return new pskl.model.Frame(e.getWidth(),e.getHeight())},addFrameToLayers_:function(t,i){t.getLayers().forEach(function(e){e.addFrameAt(a.MergeUtils.createEmptyFrame_(t),i)})}}}(),$.namespace("pskl").PixelUtils={getRectanglePixels:function(e,t,i,r){for(var n=this.getOrderedRectangleCoordinates(e,t,i,r),o=[],s=n.x0;s<=n.x1;s++)for(var a=n.y0;a<=n.y1;a++)o.push({col:s,row:a});return o},getOrderedRectangleCoordinates:function(e,t,i,r){return{x0:Math.min(e,i),y0:Math.min(t,r),x1:Math.max(e,i),y1:Math.max(t,r)}},getSimilarConnectedPixelsFromFrame:function(i,e,t){var r,n=i.getPixel(e,t);return null===n?[]:(r={},pskl.PixelUtils.visitConnectedPixels({col:e,row:t},i,function(e){var t=e.col+"-"+e.row;return!r[t]&&(r[t]=!0,i.getPixel(e.col,e.row)==n)}))},resizePixel:function(e,t,i){for(var r=[],n=0;n<i;n++)for(var o=0;o<i;o++)r.push([e-Math.floor(i/2)+o,t-Math.floor(i/2)+n]);return r},resizePixels:function(e,i){return e.reduce(function(e,t){return e.concat(pskl.PixelUtils.resizePixel(t.col,t.row,i))},[])},paintSimilarConnectedPixelsFromFrame:function(t,e,i,r){var n;"string"==typeof r&&(r=pskl.utils.colorToInt(r));try{n=t.getPixel(e,i)}catch(e){}if(null!==n&&n!=r)return pskl.PixelUtils.visitConnectedPixels({col:e,row:i},t,function(e){return t.getPixel(e.col,e.row)==n&&(t.setPixel(e.col,e.row,r),!0)})},outlineSimilarConnectedPixelsFromFrame:function(o,e,t,i,s){var a;"string"==typeof i&&(i=pskl.utils.colorToInt(i)),void 0===s&&(s=!1);try{a=o.getPixel(e,t)}catch(e){}if(null!==a&&a!=i){var r,n=[];for(r of pskl.PixelUtils.getSimilarConnectedPixelsFromFrame(o,e,t).filter(e=>{for(var t=e,i=-1;i<=1;i++)for(var r=-1;r<=1;r++)if((0!=r||0!=i)&&(s||0==r||0==i))try{var n=o.getPixel(t.col+r,t.row+i);if(null!==n&&n!==a)return!0}catch(e){}return!1}))o.setPixel(r.col,r.row,i),n.push(r);return n}},visitConnectedPixels:function(e,t,i){e.col,e.row;for(var r=[],n=[],o=[-1,0,1,0],s=[0,1,0,-1],a=(r.push(e),n.push(e),i(e),0),l=t.getWidth()*t.getHeight();0<r.length;){a++;for(var c=r.pop(),p=0;p<4;p++){var h=c.col+s[p],u=c.row+o[p];try{var d={col:h,row:u};i(d)&&(r.push(d),n.push(d))}catch(e){}}if(10*l<a){console.log("loop breaker called");break}}return n},calculateZoomForContainer:function(e,t,i){return this.calculateZoom(e.height(),e.width(),t,i)},getLinePixels:function(e,t,i,r){for(var n=[],o=(t=pskl.utils.normalize(t,0),r=pskl.utils.normalize(r,0),Math.abs(t-e)),s=Math.abs(r-i),a=e<t?1:-1,l=i<r?1:-1,c=o-s;n.push({col:e,row:i}),e!=t||i!=r;){var p=2*c;-s<p&&(c-=s,e+=a),p<o&&(c+=o,i+=l)}return n},getUniformLinePixels:function(e,t,i,r){for(var n=[],o=(t=pskl.utils.normalize(t,0),r=pskl.utils.normalize(r,0),Math.abs(t-e)+1),s=Math.abs(r-i)+1,a=e<t?1:-1,l=i<r?1:-1,c=Math.max(o,s)/Math.min(o,s),p=Math.round(c)||0,h=(p>Math.min(o,s)&&(p=1/0),pskl.utils.Math.distance(e,t,i,r)),u=e,d=i,f=0;f++,n.push({col:u,row:d}),!(pskl.utils.Math.distance(e,u,i,d)>=h);){var g=f%p==0;(s<=o||g)&&(u+=a),(o<=s||g)&&(d+=l)}return n},getNoiseColor:function(){var e=[0,-.25,-.5,-.75,-1],e=e[Math.floor(Math.random()*e.length)];return pskl.PixelUtils.pSBC(e,pskl.app.selectedColorsService.getPrimaryColor(),pskl.app.selectedColorsService.getSecondaryColor(),!0)},paintNoiseSimilarConnectedPixelsFromFrame:function(t,e,i){var r,n=pskl.utils.colorToInt(pskl.PixelUtils.getNoiseColor());try{r=t.getPixel(e,i)}catch(e){}if(null!==r&&r!=n)return pskl.PixelUtils.visitConnectedPixels({col:e,row:i},t,function(e){return t.getPixel(e.col,e.row)==r&&(t.setPixel(e.col,e.row,pskl.utils.colorToInt(pskl.PixelUtils.getNoiseColor())),!0)})},pSBCr:function(e){let t=e.length;var i={};if(9<t){if([r,g,b,a]=e=e.split(","),(t=e.length)<3||4<t)return null;i.r=parseInt("a"==r[3]?r.slice(5):r.slice(4)),i.g=parseInt(g),i.b=parseInt(b),i.a=a?parseFloat(a):-1}else{if(8==t||6==t||t<4)return null;t<6&&(e="#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+(4<t?e[4]+e[4]:"")),e=parseInt(e.slice(1),16),9==t||5==t?(i.r=e>>24&255,i.g=e>>16&255,i.b=e>>8&255,i.a=Math.round((255&e)/.255)/1e3):(i.r=e>>16,i.g=e>>8&255,i.b=255&e,i.a=-1)}return i},pSBC:function(e,t,i,r){let n=0,o=0,s=0;var a,l,c="string"==typeof i;return!("number"!=typeof e||e<-1||1<e||"string"!=typeof t||"r"!=t[0]&&"#"!=t[0]||i&&!c)&&(l=9<t.length,l=c?9<i.length||"c"==i&&!l:l,t=pskl.PixelUtils.pSBCr(t),a=e<0,i=i&&"c"!=i?pskl.PixelUtils.pSBCr(i):a?{r:0,g:0,b:0,a:-1}:{r:255,g:255,b:255,a:-1},a=1-(e=a?-1*e:e),t)&&i?(s=r?(n=Math.round(a*t.r+e*i.r),o=Math.round(a*t.g+e*i.g),Math.round(a*t.b+e*i.b)):(n=Math.round((a*t.r**2+e*i.r**2)**.5),o=Math.round((a*t.g**2+e*i.g**2)**.5),Math.round((a*t.b**2+e*i.b**2)**.5)),c=t.a,i=i.a,c=(t=0<=c||0<=i)?c<0?i:i<0?c:c*a+i*e:0,l?"rgb"+(t?"a(":"(")+n+","+o+","+s+(t?","+Math.round(1e3*c)/1e3:"")+")":"#"+(4294967296+16777216*n+65536*o+256*s+(t?Math.round(255*c):0)).toString(16).slice(1,t?void 0:-2)):null}},!function(){var n=$.namespace("pskl.utils");n.PiskelFileUtils={FAILURE:{EMPTY:"No data found in piskel file",INVALID:"Invalid piskel file, contact us on twitter @piskelapp",DESERIALIZATION:"Piskel data deserialization failed"},loadFromFile:function(t,i,r){pskl.utils.Environment.detectNative()?pskl.utils.FileUtilsDesktop.readFile(t).then(function(e){n.PiskelFileUtils.decodePiskelFile(e,function(e){e.savePath=t,i(e)},r)}):pskl.utils.FileUtils.readFile(t,function(e){e=pskl.utils.Base64.toText(e);n.PiskelFileUtils.decodePiskelFile(e,function(e){i(e)},r)})},decodePiskelFile:function(e,t,i){var r;if(0===e.length)i(n.PiskelFileUtils.FAILURE.EMPTY);else{try{r=JSON.parse(e)}catch(e){return void i(n.PiskelFileUtils.FAILURE.INVALID)}r.piskel;pskl.utils.serialization.Deserializer.deserialize(r,t,function(){i(n.PiskelFileUtils.FAILURE.DESERIALIZATION)})}}}}(),!function(){var s=$.namespace("pskl.utils");s.ResizeUtils={resizePiskel:function(e,t){var i=e.getFPS(),r=e.getLayers().map(function(e){return s.ResizeUtils.resizeLayer(e,t)}),r=pskl.model.Piskel.fromLayers(r,i,e.getDescriptor());return r.savePath=e.savePath,r},resizeLayer:function(e,t){var i=e.getOpacity(),r=e.getFrames().map(function(e){return s.ResizeUtils.resizeFrame(e,t)}),e=pskl.model.Layer.fromFrames(e.getName(),r);return e.setOpacity(i),e},resizeFrame:function(r,e){var n,t=e.width,i=e.height,o=e.origin;return e.resizeContent?pskl.utils.FrameUtils.resize(r,t,i,!1):(n=new pskl.model.Frame(t,i),r.forEachPixel(function(e,t,i){t=s.ResizeUtils.translateCoordinates(t,i,r,n,o);n.containsPixel(t.x,t.y)&&n.setPixel(t.x,t.y,e)}),n)},translateCoordinates:function(e,t,i,r,n){return{x:s.ResizeUtils.translateX(e,i.width,r.width,n),y:s.ResizeUtils.translateY(t,i.height,r.height,n)}},translateX:function(e,t,i,r){return-1!=r.indexOf("LEFT")?e:-1!=r.indexOf("RIGHT")?e-(t-i):e-Math.round((t-i)/2)},translateY:function(e,t,i,r){return-1!=r.indexOf("TOP")?e:-1!=r.indexOf("BOTTOM")?e-(t-i):e-Math.round((t-i)/2)}}}(),$.namespace("pskl.utils").StringUtils={leftPad:function(e,t,i){return(new Array(t).join(i)+e).slice(-t)},formatSize:function(e,t){return e+"Ã"+t}},!function(){var n=$.namespace("pskl.utils"),i={};n.Template={get:function(e){var t;return i[e]||((t=document.getElementById(e))?i[e]=t.innerHTML:console.error("Could not find template for id :",e)),i[e]},getAsHTML:function(e){e=n.Template.get(e);if(e)return n.Template.createFromHTML(e)},createFromHTML:function(e){var t=n.Template._getDummyEl(),e=(t.innerHTML=e,t.children[0]);return pskl.utils.UserAgent.isIE11||(t.innerHTML=""),e},replace:function(e,t){for(var i in t){var r;t.hasOwnProperty(i)&&(r=t[i],-1!==i.indexOf(":")&&(!0===r?r=i.split(":")[1]:!1===r&&(r="")),/^!.*!$/.test(i)||(r=n.Template.sanitize(r)),e=e.replace(new RegExp("\\{\\{"+i+"\\}\\}","g"),r))}return e},getAndReplace:function(e,t){var i="",e=pskl.utils.Template.get(e);return i=e?pskl.utils.Template.replace(e,t):i},sanitize:function(e){var t=n.Template._getDummyEl(),e=(t.textContent=e,t.innerHTML);return pskl.utils.UserAgent.isIE11||(t.innerHTML=""),e},_getDummyEl:pskl.utils.UserAgent.isIE11?function(){return document.createElement("div")}:function(){return n.Template._dummyEl||(n.Template._dummyEl=document.createElement("div")),n.Template._dummyEl}}}(),!function(){var e=$.namespace("pskl.utils");e.TooltipFormatter={},e.TooltipFormatter.format=function(e,t,i){var r=pskl.utils.Template.get("tooltip-container-template");return t=t?"("+t.getDisplayKey()+")":"",pskl.utils.Template.replace(r,{helptext:e,shortcut:t,"!descriptors!":this.formatDescriptors_(i)})},e.TooltipFormatter.formatDescriptors_=function(e){return(e=e||[]).reduce(function(e,t){return e+this.formatDescriptor_(t)}.bind(this),"")},e.TooltipFormatter.formatDescriptor_=function(e){var t;return e.key?(t=pskl.utils.Template.get("tooltip-modifier-descriptor-template"),e.key=e.key.toUpperCase(),pskl.utils.UserAgent.isMac&&(e.key=e.key.replace("CTRL","CMD"),e.key=e.key.replace("ALT","OPTION"))):t=pskl.utils.Template.get("tooltip-simple-descriptor-template"),pskl.utils.Template.replace(t,e)}}(),$.namespace("pskl").UserSettings={GRID_COLOR:"GRID_COLOR",GRID_ENABLED:"GRID_ENABLED",GRID_WIDTH:"GRID_WIDTH",GRID_SPACING:"GRID_SPACING",MAX_FPS:"MAX_FPS",DEFAULT_SIZE:"DEFAULT_SIZE",CANVAS_BACKGROUND:"CANVAS_BACKGROUND",SELECTED_PALETTE:"SELECTED_PALETTE",SEAMLESS_OPACITY:"SEAMLESS_OPACITY",SEAMLESS_MODE:"SEAMLESS_MODE",PREVIEW_SIZE:"PREVIEW_SIZE",ONION_SKIN:"ONION_SKIN",LAYER_PREVIEW:"LAYER_PREVIEW",LAYER_OPACITY:"LAYER_OPACITY",EXPORT_SCALE:"EXPORT_SCALE",EXPORT_TAB:"EXPORT_TAB",EXPORT_GIF_REPEAT:"EXPORT_GIF_REPEAT",PEN_SIZE:"PEN_SIZE",RESIZE_SETTINGS:"RESIZE_SETTINGS",COLOR_FORMAT:"COLOR_FORMAT",TRANSFORM_SHOW_MORE:"TRANSFORM_SHOW_MORE",PREFERENCES_TAB:"PREFERENCES_TAB",KEY_TO_DEFAULT_VALUE_MAP_:{GRID_COLOR:Constants.TRANSPARENT_COLOR,GRID_ENABLED:!1,GRID_WIDTH:1,GRID_SPACING:1,MAX_FPS:24,DEFAULT_SIZE:{width:Constants.DEFAULT.WIDTH,height:Constants.DEFAULT.HEIGHT},CANVAS_BACKGROUND:"lowcont-dark-canvas-background",SELECTED_PALETTE:Constants.CURRENT_COLORS_PALETTE_ID,SEAMLESS_OPACITY:.3,SEAMLESS_MODE:!1,PREVIEW_SIZE:"original",ONION_SKIN:!1,LAYER_OPACITY:.2,LAYER_PREVIEW:!0,EXPORT_SCALE:1,EXPORT_TAB:"gif",EXPORT_GIF_REPEAT:!0,PEN_SIZE:1,RESIZE_SETTINGS:{maintainRatio:!0,resizeContent:!1,origin:"TOPLEFT"},COLOR_FORMAT:"hex",TRANSFORM_SHOW_MORE:!1,PREFERENCES_TAB:"misc"},cache_:{},get:function(e){var t;return this.checkKeyValidity_(e),e in this.cache_||(t=this.readFromLocalStorage_(e),this.cache_[e]=null!=t?t:this.readFromDefaults_(e)),this.cache_[e]},set:function(e,t){this.checkKeyValidity_(e),this.cache_[e]=t,this.writeToLocalStorage_(e,t),$.publish(Events.USER_SETTINGS_CHANGED,[e,t])},readFromLocalStorage_:function(e){e=window.localStorage[e];return e=void 0!==e?JSON.parse(e):e},writeToLocalStorage_:function(e,t){window.localStorage[e]=JSON.stringify(t)},readFromDefaults_:function(e){return this.KEY_TO_DEFAULT_VALUE_MAP_[e]},checkKeyValidity_:function(e){if(0===e.indexOf(pskl.service.keyboard.Shortcut.USER_SETTINGS_PREFIX))return!0;e in this.KEY_TO_DEFAULT_VALUE_MAP_||console.error("UserSettings key <"+e+"> not found in supported keys.")}},!function(){var e=$.namespace("pskl.utils");e.Uuid={generate:function(){return"ss-s-s-s-sss".replace(/s/g,function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)})}}}(),!function(){var i=$.namespace("pskl.utils"),r={};i.WorkerUtils={createWorker:function(e,t){return r[t]||(r[t]=i.WorkerUtils.createWorkerURL(e)),new Worker(r[t])},createWorkerURL:function(e){e=[(e+"").replace(/function\s*\(\)\s*\{/,"").replace(/\}[^}]*$/,"")],e=new Blob(e,{type:"application/javascript"});return window.URL.createObjectURL(e)}}}(),!function(){var s=$.namespace("pskl.utils");s.Xhr={get:function(e,t,i){s.Xhr.xhr_(e,"GET",t,i).send()},post:function(e,t,i,r){var e=s.Xhr.xhr_(e,"POST",i,r),n=new FormData;if("object"==typeof t)for(var o in t)t.hasOwnProperty(o)&&n.append(o,t[o]);e.send(n)},xhr_:function(e,t,i,r){i=i||function(){},r=r||function(){};var n=new XMLHttpRequest;return n.open(t,e,!0),n.onload=function(e){200==this.status?i(this):this.onerror(this,e)},n.onerror=function(e){r(e,this)},n}}}(),!function(){var l=$.namespace("pskl.utils.serialization");l.Serializer={serialize:function(e){var t=e.getLayers().map(function(e){return pskl.utils.serialization.Serializer.serializeLayer(e)});return JSON.stringify({modelVersion:Constants.MODEL_VERSION,piskel:{name:e.getDescriptor().name,description:e.getDescriptor().description,fps:pskl.app.piskelController.getFPS(),height:e.getHeight(),width:e.getWidth(),layers:t,hiddenFrames:e.hiddenFrames}})},serializeLayer:function(e){for(var t,i=e.getFrames(),e={name:e.getName(),opacity:e.getOpacity(),frameCount:i.length},r=[];!(t=r).length||!t.every(function(e){return e.base64PNG&&"data:,"!==e.base64PNG});){if(r.length>=i.length){r=[];break}for(var n=pskl.utils.Array.chunk(i,r.length+1),r=[],o=0,s=0;s<n.length;s++){var a=n[s];r.push({layout:function(e,t){for(var i=[],r=0;r<e;r++)i.push([r+t]);return i}(a.length,o),base64PNG:l.Serializer.serializeFramesToBase64(a)}),o+=a.length}}return e.chunks=r,JSON.stringify(e)},serializeFramesToBase64:function(e){try{return new pskl.rendering.FramesheetRenderer(e).renderAsCanvas().toDataURL()}catch(e){return""}}}}(),!function(){var n=$.namespace("pskl.utils.serialization");n.Deserializer=function(e,t){this.layersToLoad_=0,this.data_=e,this.callback_=t,this.piskel_=null,this.layers_=[]},n.Deserializer.deserialize=function(e,t,i){try{var r=new(e.modelVersion==Constants.MODEL_VERSION?n.Deserializer:1==e.modelVersion?n.backward.Deserializer_v1:n.backward.Deserializer_v0)(e,t);r.deserialize()}catch(e){console.error(e),"function"==typeof i&&i(e)}},n.Deserializer.prototype.deserialize=function(){var e=this.data_.piskel,t=e.name||"Deserialized piskel",i=e.description||"",r=void 0!==e.fps?e.fps:12,t=new pskl.model.piskel.Descriptor(t,i);this.piskel_=new pskl.model.Piskel(e.width,e.height,r,t),this.hiddenFrames=e.hiddenFrames||[],this.layersToLoad_=e.layers.length,e.layers.forEach(this.deserializeLayer.bind(this))},n.Deserializer.prototype.deserializeLayer=function(e,t){var e=JSON.parse(e),i=new pskl.model.Layer(e.name),e=(i.setOpacity(e.opacity),void 0===e.chunks&&e.base64PNG&&this.normalizeLayerData_(e),e.chunks),r=[];return Q.all(e.map(function(e){var t=Q.defer(),i=new Image;return i.onload=function(){pskl.utils.FrameUtils.createFramesFromChunk(i,e.layout).forEach(function(e){r[e.index]=e.frame}),t.resolve()},i.src=e.base64PNG,t.promise})).then(function(){r.forEach(function(e){i.addFrame(e)}),this.layers_[t]=i,this.onLayerLoaded_()}.bind(this)).catch(function(e){console.error("Failed to deserialize layer"),console.error(e)}),i},n.Deserializer.prototype.onLayerLoaded_=function(){this.layersToLoad_=this.layersToLoad_-1,0===this.layersToLoad_&&(this.layers_.forEach(function(e){this.piskel_.addLayer(e)}.bind(this)),this.piskel_.hiddenFrames=this.hiddenFrames,this.callback_(this.piskel_))},n.Deserializer.prototype.normalizeLayerData_=function(e){for(var t=[],i=0;i<e.frameCount;i++)t.push([i]);e.chunks=[{base64PNG:e.base64PNG,layout:t}]}}(),$.namespace("pskl.utils.serialization.arraybuffer").ArrayBufferDeserializer={deserialize:function(e,t){for(var i=new Uint8Array(e),r=new Uint16Array(i.buffer),e=(r[0],r[1]),n=r[2],o=r[3],s=r[4],a=r[5],l=r[6],c=r[7],p=8,h="",u=0;u<s;u++)h+=String.fromCharCode(r[p+u]);p+=s;var d="";for(u=0;u<a;u++)d=String.fromCharCode(r[8+s+u]);p+=a;var f="";for(u=0;u<c;u++)f=String.fromCharCode(r[8+s+u]);var g=f.split("-"),m=(p+=c,[]);for(u=0;u<l;u++){for(var y={},v=r[p],S=r[p+1]/65535,C=r[p+2],k=r[p+3],_=r[p+4]>>>0|k<<16>>>0,b="",E=0;E<v;E++)b+=String.fromCharCode(r[p+5+E]);var w="";for(E=0;E<_;E++)w+=String.fromCharCode(i[2*(p+5+v)+E]);w="data:image/png;base64,"+w,p+=Math.ceil(5+v+_/2),y.name=b,y.opacity=S,y.frameCount=C,y.dataUri=w,m.push(y)}function T(t,e){var i=new Image;i.onload=function(){pskl.utils.FrameUtils.createFramesFromSpritesheet(this,t.frameCount).forEach(function(e){t.model.addFrame(e)}),++x==l&&e(I)},i.src=t.dataUri}var P=new pskl.model.piskel.Descriptor(h,d),I=new pskl.model.Piskel(e,n,o,P),x=(I.hiddenFrames=g,0);for(u=0;u<l;u++){y=m[u];var L=new pskl.model.Layer(y.name);(y.model=L).setOpacity(y.opacity),I.addLayer(L),T.bind(this,y,t)()}}},!function(){var _=$.namespace("pskl.utils.serialization.arraybuffer");_.ArrayBufferSerializer={calculateRequiredBytes:function(e,t){e.getWidth(),e.getHeight();for(var i=e.getDescriptor().name.length,r=e.getDescriptor().description.length,n=(e.getLayers().length,0),n=(n=(n+=8)+4+2)+2*i+2*r,o=0,s=e.getLayers();o<s.length;o++)(n=(n=(n+=10)+2*s[o].name.length)+t[o].length)%2==1&&n++;return n},serialize:function(e){for(var t,i=[],r=0,n=e.getLayers();r<n.length;r++){var o,s=(o=new pskl.rendering.FramesheetRenderer(n[r].getFrames()).renderAsCanvas().toDataURL().split(",")[1]).length;i.push({uri:o,length:s})}pskl.app.piskelController.getLayerAt(0).getFrames();var a=e.hiddenFrames.join("-"),l=_.ArrayBufferSerializer.calculateRequiredBytes(e,i,a),l=new ArrayBuffer(l),c=new Uint8Array(l),p=new Uint16Array(l),h=e.getWidth(),u=e.getHeight(),d=e.getDescriptor().name,f=d.length,g=e.getDescriptor().description,m=g.length,y=(p[0]=Constants.MODEL_VERSION,p[1]=h,p[2]=u,p[3]=pskl.app.piskelController.getFPS(),p[4]=f,p[5]=m,p[6]=e.getLayers().length,p[7]=a.length,8);for(r=0;r<f;r++)p[y+r]=d.charCodeAt(r);for(y+=f,r=0;r<m;r++)p[y+r]=g.charCodeAt(r);for(y+=m,r=0;r<a.length;r++)p[y+r]=a.charCodeAt(r);for(y+=a.length,r=0,n=e.getLayers();r<n.length;r++){var v=n[r],S=v.getFrames(),C=v.getName(),k=C.length,v=v.getOpacity(),S=S.length;for(o=i[r].uri,s=i[r].length,p[y]=k,p[y+1]=Math.floor(65535*v),p[y+2]=S,p[y+3]=(4294901760&s)>>16>>>0,p[y+4]=(65535&s)>>>0,t=0;t<k;t++)p[y+5+t]=C.charCodeAt(t);for(t=0;t<s;t++)c[2*(y+5+k)+t]=o.charCodeAt(t);y+=Math.ceil(5+k+s/2)}return l}}}(),!function(){var e=$.namespace("pskl.utils.serialization.backward");e.Deserializer_v0=function(e,t){this.data_=e,this.callback_=t},e.Deserializer_v0.prototype.deserialize=function(){var e=this.data_.map(function(e){return pskl.model.Frame.fromPixelGrid(e)}),t=new pskl.model.piskel.Descriptor("Deserialized piskel",""),e=pskl.model.Layer.fromFrames("Layer 1",e);this.callback_(pskl.model.Piskel.fromLayers([e],Constants.DEFAULT.FPS,t))}}(),!function(){var e=$.namespace("pskl.utils.serialization.backward");e.Deserializer_v1=function(e,t){this.callback_=t,this.data_=e},e.Deserializer_v1.prototype.deserialize=function(){var e=this.data_.piskel,t=new pskl.model.piskel.Descriptor("Deserialized piskel",""),i=new pskl.model.Piskel(e.width,e.height,Constants.DEFAULT.FPS,t);e.layers.forEach(function(e){e=this.deserializeLayer(e);i.addLayer(e)}.bind(this)),this.callback_(i)},e.Deserializer_v1.prototype.deserializeLayer=function(e){var e=JSON.parse(e),t=new pskl.model.Layer(e.name);return e.frames.forEach(function(e){e=this.deserializeFrame(e);t.addFrame(e)}.bind(this)),t},e.Deserializer_v1.prototype.deserializeFrame=function(e){e=JSON.parse(e);return pskl.model.Frame.fromPixelGrid(e)}}(),!function(){function e(){!function(e){function p(e,t){if({}.hasOwnProperty.call(p.cache,e))return p.cache[e];var i,r=p.resolve(e);if(r)return i={id:e,require:p,filename:e,exports:{},loaded:!1,parent:t,children:[]},t&&t.children.push(i),t=e.slice(0,e.lastIndexOf("/")+1),p.cache[e]=i.exports,r.call(i.exports,i,i.exports,t,e),i.loaded=!0,p.cache[e]=i.exports;throw new Error("Failed to resolve module "+e)}p.modules={},p.cache={},p.resolve=function(e){return{}.hasOwnProperty.call(p.modules,e)?p.modules[e]:void 0},p.define=function(e,t){p.modules[e]=t},p.define("/gif.worker.coffee",function(e,t,i,r){var o=p("/GIFEncoder.js",e),n=function(r){var n,e=new o(r.width,r.height);return 0===r.index?e.writeHeader():e.firstFrame=!1,e.setTransparent(r.transparent),e.setRepeat(r.repeat),e.setDelay(r.delay),e.setQuality(r.quality),e.setPreserveColors(r.preserveColors),e.addFrame(r.data),r.last&&e.finish(),e=e.stream(),r.data=e.pages,r.cursor=e.cursor,r.pageSize=e.constructor.pageSize,r.canTransfer?(e=function(e){for(var t=0,i=r.data.length;t<i;++t)n=r.data[t],e.push(n.buffer);return e}.call(this,[]),self.postMessage(r,e)):self.postMessage(r)};self.onmessage=function(e){return n(e.data)}}),p.define("/GIFEncoder.js",function(e,t,i,r){function n(){this.page=-1,this.pages=[],this.newPage()}function o(e,t){this.width=~~e,this.height=~~t,this.transparent=null,this.transIndex=0,this.repeat=-1,this.delay=0,this.image=null,this.pixels=null,this.indexedPixels=null,this.colorDepth=null,this.colorTab=null,this.usedEntry=new Array,this.palSize=7,this.dispose=-1,this.firstFrame=!0,this.sample=10,this.out=new n}var s=p("/TypedNeuQuant.js",e),a=p("/SimpleQuant.js",e),l=p("/LZWEncoder.js",e);n.pageSize=4096,n.charMap={};for(var c=0;c<256;c++)n.charMap[c]=String.fromCharCode(c);n.prototype.newPage=function(){this.pages[++this.page]=new Uint8Array(n.pageSize),this.cursor=0},n.prototype.getData=function(){for(var e="",t=0;t<this.pages.length;t++)for(var i=0;i<n.pageSize;i++)e+=n.charMap[this.pages[t][i]];return e},n.prototype.writeByte=function(e){this.cursor>=n.pageSize&&this.newPage(),this.pages[this.page][this.cursor++]=e},n.prototype.writeUTFBytes=function(e){for(var t=e.length,i=0;i<t;i++)this.writeByte(e.charCodeAt(i))},n.prototype.writeBytes=function(e,t,i){for(var r=i||e.length,n=t||0;n<r;n++)this.writeByte(e[n])},o.prototype.setDelay=function(e){this.delay=Math.round(e/10)},o.prototype.setFrameRate=function(e){this.delay=Math.round(100/e)},o.prototype.setDispose=function(e){0<=e&&(this.dispose=e)},o.prototype.setRepeat=function(e){this.repeat=e},o.prototype.setTransparent=function(e){this.transparent=e},o.prototype.setPreserveColors=function(e){this.preserveColors=e},o.prototype.addFrame=function(e){this.image=e,this.getImagePixels(),this.analyzePixels(),this.firstFrame&&(this.writeLSD(),this.writePalette(),0<=this.repeat)&&this.writeNetscapeExt(),this.writeGraphicCtrlExt(),this.writeImageDesc(),this.firstFrame||this.writePalette(),this.writePixels(),this.firstFrame=!1},o.prototype.finish=function(){this.out.writeByte(59)},o.prototype.setQuality=function(e){this.sample=e=e<1?1:e},o.prototype.writeHeader=function(){this.out.writeUTFBytes("GIF89a")},o.prototype.analyzePixels=function(){for(var e,t,i=this.pixels.length/3,r=(this.indexedPixels=new Uint8Array(i),(t=this.preserveColors?(e=this.toRGBComponents(this.transparent),new a(this.pixels,this.sample,e)):new s(this.pixels,this.sample)).buildColormap(),this.colorTab=t.getColormap(),0),n=0;n<i;n++){var o=t.lookupRGB(255&this.pixels[r++],255&this.pixels[r++],255&this.pixels[r++]);this.usedEntry[o]=!0,this.indexedPixels[n]=o}this.pixels=null,this.colorDepth=8,this.palSize=7,null!==this.transparent&&(this.transIndex=this.findClosest(this.transparent))},o.prototype.toRGBComponents=function(e){return e?{r:(16711680&e)>>16,g:(65280&e)>>8,b:255&e}:null},o.prototype.findClosest=function(e){if(null===this.colorTab)return-1;for(var t=(16711680&e)>>16,i=(65280&e)>>8,r=255&e,n=0,o=16777216,s=this.colorTab.length,a=0;a<s;){var l=t-(255&this.colorTab[a++]),c=i-(255&this.colorTab[a++]),p=r-(255&this.colorTab[a]),l=l*l+c*c+p*p,c=parseInt(a/3);(this.preserveColors||this.usedEntry[c])&&l<o&&(o=l,n=c),a++}return n},o.prototype.getImagePixels=function(){for(var e=this.width,t=this.height,i=(this.pixels=new Uint8Array(e*t*3),this.image),r=0,n=0;n<t;n++)for(var o=0;o<e;o++){var s=n*e*4+4*o;this.pixels[r++]=i[s],this.pixels[r++]=i[1+s],this.pixels[r++]=i[2+s]}},o.prototype.writeGraphicCtrlExt=function(){var e,t;this.out.writeByte(33),this.out.writeByte(249),this.out.writeByte(4),t=null===this.transparent?e=0:(e=1,2),0<=this.dispose&&(t=7&dispose),this.out.writeByte(0|(t<<=2)|e),this.writeShort(this.delay),this.out.writeByte(this.transIndex),this.out.writeByte(0)},o.prototype.writeImageDesc=function(){this.out.writeByte(44),this.writeShort(0),this.writeShort(0),this.writeShort(this.width),this.writeShort(this.height),this.firstFrame?this.out.writeByte(0):this.out.writeByte(128|this.palSize)},o.prototype.writeLSD=function(){this.writeShort(this.width),this.writeShort(this.height),this.out.writeByte(240|this.palSize),this.out.writeByte(0),this.out.writeByte(0)},o.prototype.writeNetscapeExt=function(){this.out.writeByte(33),this.out.writeByte(255),this.out.writeByte(11),this.out.writeUTFBytes("NETSCAPE2.0"),this.out.writeByte(3),this.out.writeByte(1),this.writeShort(this.repeat),this.out.writeByte(0)},o.prototype.writePalette=function(){this.out.writeBytes(this.colorTab);for(var e=768-this.colorTab.length,t=0;t<e;t++)this.out.writeByte(0)},o.prototype.writeShort=function(e){this.out.writeByte(255&e),this.out.writeByte(e>>8&255)},o.prototype.writePixels=function(){new l(this.width,this.height,this.indexedPixels,this.colorDepth).encode(this.out)},o.prototype.stream=function(){return this.out},e.exports=o}),p.define("/LZWEncoder.js",function(e,t,i,r){var E=-1,w=12,T=5003,P=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];e.exports=function(t,i,e,r){function n(e,t){v[d++]=e,254<=d&&s(t)}function c(e){for(var t=0;t<e;++t)S[t]=-1}function o(e,t){var i,r,n,o,s,a,l;for(b=!1,n_bits=g=e,f=p(n_bits),y=(m=1<<e-1)+1,_=m+2,d=0,n=h(),a=0,i=T;i<65536;i*=2)++a;a=8-a,c(s=T),u(m,t);e:for(;(l=h())!=E;)if(S[r=l<<a^n]===(i=(l<<w)+n))n=C[r];else{if(0<=S[r]){o=0===r?1:s-r;do{if((r-=o)<0&&(r+=s),S[r]===i){n=C[r];continue e}}while(0<=S[r])}u(n,t),n=l,_<1<<w?(C[r]=_++,S[r]=i):(l=t,c(T),_=m+2,b=!0,u(m,l))}u(n,t),u(y,t)}function s(e){0<d&&(e.writeByte(d),e.writeBytes(v,0,d),d=0)}function p(e){return(1<<e)-1}function h(){return 0===remaining?E:(--remaining,255&e[curPixel++])}function u(e,t){for(a&=P[k],0<k?a|=e<<k:a=e,k+=n_bits;8<=k;)n(255&a,t),a>>=8,k-=8;if((f<_||b)&&(b?(f=p(n_bits=g),b=!1):(++n_bits,f=n_bits==w?1<<w:p(n_bits))),e==y){for(;0<k;)n(255&a,t),a>>=8,k-=8;s(t)}}var a,d,f,g,m,y,l=Math.max(2,r),v=new Uint8Array(256),S=new Int32Array(T),C=new Int32Array(T),k=0,_=0,b=!1;this.encode=function(e){e.writeByte(l),remaining=t*i,curPixel=0,o(l+1,e),e.writeByte(0)}}}),p.define("/SimpleQuant.js",function(e,t,i,r){function n(e,t,i){return[e,t,i].join(".")}e.exports=function(e,t,s){this.pixels=e,this.palette=[],this.paletteIndex={},this.getColormap=function(){return this.palette},this.buildColormap=function(){for(var e=this.pixels.length/3,t=0,i=0;i<e;i++){var r=this.pixels[t++],n=this.pixels[t++],o=this.pixels[t++];this.addColorToPalette(r,n,o)}s&&this.addColorToPalette(s.r,s.g,s.b)},this.addColorToPalette=function(e,t,i){var r=n(e,t,i);this.paletteIndex.hasOwnProperty(r)||(this.palette.push(e),this.palette.push(t),this.palette.push(i),this.paletteIndex[r]=this.palette.length/3-1)},this.lookupRGB=function(e,t,i){return this.paletteIndex[n(e,t,i)]}}}),p.define("/TypedNeuQuant.js",function(e,t,i,r){var O=100,N=256,d=N-1,M=4,U=16,f=1<<U,z=10,B=10,H=f>>B,W=f<<z-B,$=6,G=(N>>3)*(1<<$),q=30,j=1024,K=256,V=1<<18,Z=499,Y=491,X=487,Q=503,J=3*Q;e.exports=function(x,L){function h(){var e=x.length,t=30+(L-1)/3,i=e/(3*L),r=~~(i/O),n=j,o=G,s=o>>$;for(s<=1&&(s=0),m=0;m<s;m++)F[m]=n*((s*s-m*m)*K/(s*s));for(var a,l,c,p,h,u,d,f=e<J?(L=1,3):e%Z!=0?3*Z:e%Y!=0?3*Y:e%X!=0?3*X:3*Q,g=0,m=0;m<i;){if(a=(255&x[g])<<M,l=(255&x[g+1])<<M,c=(255&x[g+2])<<M,p=function(e,t,i){for(var r,n=2147483647,o=n,s=-1,a=s,l=0;l<N;l++)r=A[l],(r=Math.abs(r[0]-e)+Math.abs(r[1]-t)+Math.abs(r[2]-i))<n&&(n=r,s=l),(r=r-(R[l]>>U-M))<o&&(o=r,a=l),r=D[l]>>B,D[l]-=r,R[l]+=r<<z;return D[s]+=H,R[s]-=W,a}(a,l,c),h=n,y=a,v=l,d=c,A[u=p][0]-=h*(A[u][0]-y)/j,A[u][1]-=h*(A[u][1]-v)/j,A[u][2]-=h*(A[u][2]-d)/j,0!==s){b=_=I=P=T=w=E=k=C=S=v=y=void 0;for(var y=s,v=p,S=a,C=l,k=c,_,b,E=Math.abs(v-y),w=Math.min(v+y,N),T=v+1,P=v-1,I=1;T<w||E<P;)b=F[I++],T<w&&((_=A[T++])[0]-=b*(_[0]-S)/V,_[1]-=b*(_[1]-C)/V,_[2]-=b*(_[2]-k)/V),E<P&&((_=A[P--])[0]-=b*(_[0]-S)/V,_[1]-=b*(_[1]-C)/V,_[2]-=b*(_[2]-k)/V)}if(e<=(g+=f)&&(g-=e),++m%(r=0===r?1:r)==0)for(n-=n/t,(s=(o-=o/q)>>$)<=1&&(s=0),p=0;p<s;p++)F[p]=n*((s*s-p*p)*K/(s*s))}}var A,u,R,D,F;this.buildColormap=function(){var e,t;for(A=[],u=new Int32Array(256),R=new Int32Array(N),D=new Int32Array(N),F=new Int32Array(N>>3),e=0;e<N;e++)t=(e<<M+8)/N,A[e]=new Float64Array([t,t,t,0]),D[e]=f/N,R[e]=0;h();for(var i=0;i<N;i++)A[i][0]>>=M,A[i][1]>>=M,A[i][2]>>=M,A[i][3]=i;for(var r,n,o,s,a,l=0,c=0,p=0;p<N;p++){for(a=(n=A[s=p])[1],r=p+1;r<N;r++)(o=A[r])[1]<a&&(s=r,a=o[1]);if(o=A[s],p!=s&&(r=o[0],o[0]=n[0],n[0]=r,r=o[1],o[1]=n[1],n[1]=r,r=o[2],o[2]=n[2],n[2]=r,r=o[3],o[3]=n[3],n[3]=r),a!=l){for(u[l]=c+p>>1,r=l+1;r<a;r++)u[r]=p;l=a,c=p}}for(u[l]=c+d>>1,r=l+1;r<256;r++)u[r]=d},this.getColormap=function(){for(var e=[],t=[],i=0;i<N;i++)t[A[i][3]]=i;for(var r=0,n=0;n<N;n++){var o=t[n];e[r++]=A[o][0],e[r++]=A[o][1],e[r++]=A[o][2]}return e},this.lookupRGB=function(e,t,i){for(var r,n,o,s=1e3,a=-1,l=u[t],c=l-1;l<N||0<=c;)l<N&&(s<=(o=(n=A[l])[1]-t)?l=N:(l++,o<0&&(o=-o),(o+=r=(r=n[0]-e)<0?-r:r)<s&&(o+=r=(r=n[2]-i)<0?-r:r)<s&&(s=o,a=n[3]))),0<=c&&(s<=(o=t-(n=A[c])[1])?c=-1:(c--,o<0&&(o=-o),(o+=r=(r=n[0]-e)<0?-r:r)<s&&(o+=r=(r=n[2]-i)<0?-r:r)<s&&(s=o,a=n[3])));return a}}}),p("/gif.worker.coffee")}.call(this,this)}var t,i,r;try{pskl.utils.UserAgent.isIE11?(r="js/lib/gif/gif.ie.worker.js",window.pskl&&window.pskl.appEngineToken_&&(r="../"+r)):(t=(e+"").replace(/function\s?\(\)\s?\{/,"").replace(/\}[^}]*$/,""),i=new Blob([t],{type:"application/javascript"}),r=URL.createObjectURL(i)),window.GifWorkerURL=r}catch(e){console.error("Could not create worker",e.message)}}(),!function(e){function p(e,t){if({}.hasOwnProperty.call(p.cache,e))return p.cache[e];var i,r=p.resolve(e);if(r)return i={id:e,require:p,filename:e,exports:{},loaded:!1,parent:t,children:[]},t&&t.children.push(i),t=e.slice(0,e.lastIndexOf("/")+1),p.cache[e]=i.exports,r.call(i.exports,i,i.exports,t,e),i.loaded=!0,p.cache[e]=i.exports;throw new Error("Failed to resolve module "+e)}p.modules={},p.cache={},p.resolve=function(e){return{}.hasOwnProperty.call(p.modules,e)?p.modules[e]:void 0},p.define=function(e,t){p.modules[e]=t};t="/";var t,n={title:"browser",version:"v0.8.19",browser:!0,env:{},argv:[],nextTick:e.setImmediate||function(e){setTimeout(e,0)},cwd:function(){return t},chdir:function(e){t=e}};p.define("/gif.coffee",function(e,t,i,r){function o(e,t){return{}.hasOwnProperty.call(e,t)}var s,a,l=p("events",e).EventEmitter,c=p("/browser.coffee",e),n=function(){function e(e){var t,i;for(t in this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(e),s)i=s[t],null!=this.options[t]?this.options[t]:this.options[t]=i}var t,i=e,r=l;function n(){this.constructor=i}for(t in r)o(r,t)&&(i[t]=r[t]);return n.prototype=r.prototype,i.prototype=new n,i.__super__=r.prototype,s={workerScript:window.GifWorkerURL,workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,preserveColors:!1},a={delay:500,copy:!1},e.prototype.setOption=function(e,t){return this.options[e]=t,null==this._canvas||"width"!==e&&"height"!==e?void 0:this._canvas[e]=t},e.prototype.setOptions=function(t){var i,r;return function(e){for(i in t)o(t,i)&&(r=t[i],e.push(this.setOption(i,r)));return e}.call(this,[])},e.prototype.addFrame=function(e,t){var i,r;for(r in null==t&&(t={}),(i={}).transparent=this.options.transparent,a)i[r]=t[r]||a[r];if(null==this.options.width&&this.setOption("width",e.width),null==this.options.height&&this.setOption("height",e.height),"undefined"!=typeof ImageData&&null!=ImageData&&e instanceof ImageData)i.data=e.data;else if("undefined"!=typeof CanvasRenderingContext2D&&null!=CanvasRenderingContext2D&&e instanceof CanvasRenderingContext2D||"undefined"!=typeof WebGLRenderingContext&&null!=WebGLRenderingContext&&e instanceof WebGLRenderingContext)t.copy?i.data=this.getContextData(e):i.context=e;else{if(null==e.childNodes)throw new Error("Invalid image");t.copy?i.data=this.getImageData(e):i.image=e}return this.frames.push(i)},e.prototype.render=function(){if(this.running)throw new Error("Already running");if(null==this.options.width||null==this.options.height)throw new Error("Width and height must be set prior to rendering");this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(e){for(var t=function(){for(var e=[],t=0;0<=this.frames.length?t<this.frames.length:t>this.frames.length;0<=this.frames.length?++t:--t)e.push(t);return e}.apply(this,arguments),i=0,r=t.length;i<r;++i)t[i],e.push(null);return e}.call(this,[]);for(var i=this.spawnWorkers(),e=function(){for(var e=[],t=0;0<=i?t<i:i<t;0<=i?++t:--t)e.push(t);return e}.apply(this,arguments),t=0,r=e.length;t<r;++t)e[t],this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},e.prototype.abort=function(){for(var e;null!=(e=this.activeWorkers.shift());)console.log("killing active worker"),e.terminate();return this.running=!1,this.emit("abort")},e.prototype.spawnWorkers=function(){var r,i=Math.min(this.options.workers,this.frames.length);return function(){for(var e=[],t=this.freeWorkers.length;this.freeWorkers.length<=i?t<i:i<t;this.freeWorkers.length<=i?++t:--t)e.push(t);return e}.apply(this,arguments).forEach((r=this,function(e){var t,i;return console.log("spawning worker "+e),(t=new Worker(r.options.workerScript)).onmessage=(i=r,function(e){return i.activeWorkers.splice(i.activeWorkers.indexOf(t),1),i.freeWorkers.push(t),i.frameFinished(e.data)}),r.freeWorkers.push(t)})),i},e.prototype.frameFinished=function(e){return console.log("frame "+e.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[e.index]=e,function(e,t){for(var i=0,r=t.length;i<r;++i)if(i in t&&t[i]===e)return 1}(null,this.imageParts)?this.renderNextFrame():this.finishRendering()},e.prototype.finishRendering=function(){for(var e,t,i,r=0,n=0,o=this.imageParts.length;n<o;++n)r+=((p=this.imageParts[n]).data.length-1)*p.pageSize+p.cursor;r+=p.pageSize-p.cursor,console.log("rendering finished - filesize "+Math.round(r/1e3)+"kb");for(var s=new Uint8Array(r),a=0,l=0,c=this.imageParts.length;l<c;++l)for(var p,h=0,u=(p=this.imageParts[l]).data.length;h<u;++h)i=p.data[h],e=h,s.set(i,a),e===p.data.length-1?a+=p.cursor:a+=p.pageSize;return t=new Blob([s],{type:"image/gif"}),this.emit("finished",t,s)},e.prototype.renderNextFrame=function(){var e,t;if(0===this.freeWorkers.length)throw new Error("No free workers");return this.nextFrame>=this.frames.length?void 0:(e=this.frames[this.nextFrame++],t=this.freeWorkers.shift(),e=this.getTask(e),console.log("starting frame "+(e.index+1)+" of "+this.frames.length),this.activeWorkers.push(t),t.postMessage(e))},e.prototype.getContextData=function(e){return e.getImageData(0,0,this.options.width,this.options.height).data},e.prototype.getImageData=function(e){var t;return null==this._canvas&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),(t=this._canvas.getContext("2d")).setFill=this.options.background,t.fillRect(0,0,this.options.width,this.options.height),t.drawImage(e,0,0),this.getContextData(t)},e.prototype.getTask=function(e){var t=this.frames.indexOf(e),t={index:t,last:t===this.frames.length-1,delay:e.delay,transparent:e.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,preserveColors:this.options.preserveColors,repeat:this.options.repeat,canTransfer:"chrome"===c.name};if(null!=e.data)t.data=e.data;else if(null!=e.context)t.data=this.getContextData(e.context);else{if(null==e.image)throw new Error("Invalid frame");t.data=this.getImageData(e.image)}return t},e}();e.exports=n}),p.define("/browser.coffee",function(e,t,i,r){var n=navigator.userAgent.toLowerCase(),o=navigator.platform.toLowerCase(),s=n.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],a="ie"===s[1]&&document.documentMode,a={name:"version"===s[1]?s[3]:s[1],version:a||parseFloat("opera"===s[1]&&s[4]?s[4]:s[2]),platform:{name:n.match(/ip(?:ad|od|hone)/)?"ios":(n.match(/(?:webos|android)/)||o.match(/mac|win|linux/)||["other"])[0]}};a[a.name]=!0,a[a.name+parseInt(a.version,10)]=!0,a.platform[a.platform.name]=!0,e.exports=a}),p.define("events",function(e,t,i,r){n.EventEmitter||(n.EventEmitter=function(){});var t=t.EventEmitter=n.EventEmitter,s="function"==typeof Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};t.prototype.setMaxListeners=function(e){this._events||(this._events={}),this._events.maxListeners=e},t.prototype.emit=function(e){if("error"===e&&(!this._events||!this._events.error||s(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var t=this._events[e];if(!t)return!1;if("function"!=typeof t){if(s(t)){for(var i=Array.prototype.slice.call(arguments,1),r=t.slice(),n=0,o=r.length;n<o;n++)r[n].apply(this,i);return!0}return!1}switch(arguments.length){case 1:t.call(this);break;case 2:t.call(this,arguments[1]);break;case 3:t.call(this,arguments[1],arguments[2]);break;default:i=Array.prototype.slice.call(arguments,1);t.apply(this,i)}return!0},t.prototype.addListener=function(e,t){if("function"!=typeof t)throw new Error("addListener only takes instances of Function");var i;return this._events||(this._events={}),this.emit("newListener",e,t),this._events[e]?s(this._events[e])?(this._events[e].warned||(i=void 0!==this._events.maxListeners?this._events.maxListeners:10)&&0<i&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace()),this._events[e].push(t)):this._events[e]=[this._events[e],t]:this._events[e]=t,this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(t,i){var r=this;return r.on(t,function e(){r.removeListener(t,e),i.apply(this,arguments)}),this},t.prototype.removeListener=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");if(this._events&&this._events[e]){var i=this._events[e];if(s(i)){var r=i.indexOf(t);if(r<0)return this;i.splice(r,1),0==i.length&&delete this._events[e]}else this._events[e]===t&&delete this._events[e]}return this},t.prototype.removeAllListeners=function(e){return e&&this._events&&this._events[e]&&(this._events[e]=null),this},t.prototype.listeners=function(e){return this._events||(this._events={}),this._events[e]||(this._events[e]=[]),s(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]}}),e.GIF=p("/gif.coffee")}.call(this,this),!function(e){"use strict";function t(e){this.data=e,this.len=this.data.length,this.pos=0}t.prototype.readByte=function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return 255&this.data.charCodeAt(this.pos++)},t.prototype.readBytes=function(e){for(var t=[],i=0;i<e;i++)t.push(this.readByte());return t},t.prototype.read=function(e){for(var t="",i=0;i<e;i++)t+=String.fromCharCode(this.readByte());return t},t.prototype.readUnsigned=function(){var e=this.readBytes(2);return(e[1]<<8)+e[0]},(e.SuperGIF=e.SuperGIF||{}).Stream=t}(window),!function(k){"use strict";function _(e){this.data=e,this.len=this.data.length,this.pos=0,this.readByte=function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return 255&e.charCodeAt(this.pos++)},this.readBytes=function(e){for(var t=[],i=0;i<e;i++)t.push(this.readByte());return t},this.read=function(e){for(var t="",i=0;i<e;i++)t+=String.fromCharCode(this.readByte());return t},this.readUnsigned=function(){var e=this.readBytes(2);return(e[1]<<8)+e[0]}}function b(o,s){function a(){for(var e,t="";e=o.readByte(),t+=o.read(e),0!==e;);return t}s=s||{};var r=function(e){for(var t=[],i=0;i<e;i++)t.push(o.readBytes(3));return t},t=function(e){function t(e){var t;o.readByte(),e.identifier=o.read(8),e.authCode=o.read(3),"NETSCAPE"===e.identifier?(t=e,o.readByte(),t.unknown=o.readByte(),t.iterations=o.readUnsigned(),t.terminator=o.readByte(),s.app&&s.app.NETSCAPE&&s.app.NETSCAPE(t)):((t=e).appData=a(),s.app&&s.app[t.identifier]&&s.app[t.identifier](t))}var i,r;switch(e.label=o.readByte(),e.label){case 249:e.extType="gce",n=e,o.readByte(),r=p(o.readByte()),n.reserved=r.splice(0,3),n.disposalMethod=c(r.splice(0,3)),n.userInput=r.shift(),n.transparencyGiven=r.shift(),n.delayTime=o.readUnsigned(),n.transparencyIndex=o.readByte(),n.terminator=o.readByte(),s.gce&&s.gce(n);break;case 254:e.extType="com",(r=e).comment=a(),s.com&&s.com(r);break;case 1:e.extType="pte";var n=e;o.readByte(),n.ptHeader=o.readBytes(12),n.ptData=a(),s.pte&&s.pte(n);break;case 255:e.extType="app",t(e);break;default:e.extType="unknown",(i=e).data=a(),s.unknown&&s.unknown(i)}},i=function(e){function t(e,t){for(var i=new Array(e.length),r=e.length/t,n=[0,4,2,1],o=[8,8,4,2],s=0,a=0;a<4;a++)for(var l=n[a];l<r;l+=o[a]){var c=l,p=s;p=e.slice(p*t,(p+1)*t),i.splice.apply(i,[c*t,t].concat(p)),s++}return i}e.leftPos=o.readUnsigned(),e.topPos=o.readUnsigned(),e.width=o.readUnsigned(),e.height=o.readUnsigned();var i=p(o.readByte()),i=(e.lctFlag=i.shift(),e.interlaced=i.shift(),e.sorted=i.shift(),e.reserved=i.splice(0,2),e.lctSize=c(i.splice(0,3)),e.lctFlag&&(e.lct=r(1<<e.lctSize+1)),e.lzwMinCodeSize=o.readByte(),a());e.pixels=h(e.lzwMinCodeSize,i),e.interlaced&&(e.pixels=t(e.pixels,e.width)),s.img&&s.img(e)},n=function(){var e={};switch(e.sentinel=o.readByte(),String.fromCharCode(e.sentinel)){case"!":e.type="ext",t(e);break;case",":e.type="img",i(e);break;case";":e.type="eof",s.eof&&s.eof(e);break;default:return s.onError(new Error("Unknown block: 0x"+e.sentinel.toString(16)))}"eof"!==e.type&&setTimeout(n,0)},e={};if(e.sig=o.read(3),e.ver=o.read(3),"GIF"!==e.sig)throw s.onError(),new Error("Not a GIF file.");e.width=o.readUnsigned(),e.height=o.readUnsigned();var l=p(o.readByte());e.gctFlag=l.shift(),e.colorRes=c(l.splice(0,3)),e.sorted=l.shift(),e.gctSize=c(l.splice(0,3)),e.bgColor=o.readByte(),e.pixelAspectRatio=o.readByte(),e.gctFlag&&(e.gct=r(1<<e.gctSize+1)),s.hdr&&s.hdr(e),setTimeout(n,0)}var c=function(e){return e.reduce(function(e,t){return 2*e+t},0)},p=function(e){for(var t=[],i=7;0<=i;i--)t.push(!!(e&1<<i));return t},h=function(e,r){for(var t,i,n=0,o=[],s=1<<e,a=1+s,l=e+1,c=[];;)if(i=t,(t=function(e){for(var t=0,i=0;i<e;i++)r.charCodeAt(n>>3)&1<<(7&n)&&(t|=1<<i),n++;return t}(l))===s){p=void 0,c=[],l=e+1;for(var p=0;p<s;p++)c[p]=[p];c[s]=[],c[a]=null}else{if(t===a)break;if(t<c.length)i!==s&&c.push(c[i].concat(c[t][0]));else{if(t!==c.length)throw new Error("Invalid LZW code.");c.push(c[i].concat(c[i][0]))}o.push.apply(o,c[t]),c.length===1<<l&&l<12&&l++}return o};k.SuperGif=function(e){var t,i,n,r={vp_l:0,vp_t:0,vp_w:null,vp_h:null,c_w:null,c_h:null};for(t in e)r[t]=e[t];r.vp_w&&r.vp_h&&(r.is_vp=!0);function o(){try{b(i,y)}catch(e){s("parse")}}function s(e){n={width:m.width,height:m.height},g=[]}function a(){d&&g.push({data:d.getImageData(0,0,n.width,n.height),delay:c})}var l=null,c=null,p=null,h=0,u=null,d=null,f=null,g=[],m=r.gif,y={hdr:function(e){var t;e=(n=e).width,t=n.height,C.width=e,C.height=t,C.getContext("2d").setTransform(1,0,0,1,0,0)},gce:function(e){a(),u=p,d=p=c=l=null,l=e.transparencyGiven?e.transparencyIndex:null,c=e.delayTime,p=e.disposalMethod},img:function(e){d=d||C.getContext("2d");var t=g.length,i=e.lctFlag?e.lct:n.gct,t=(0<t&&(3===u?d.putImageData(g[h].data,0,0):h=t-1,2===u)&&d.clearRect(f.leftPos,f.topPos,f.width,f.height),d.getImageData(e.leftPos,e.topPos,e.width,e.height)),r=t.data;e.pixels.forEach(function(e,t){e!==l&&(r[4*t+0]=i[e][0],r[4*t+1]=i[e][1],r[4*t+2]=i[e][2],r[4*t+3]=255)}),d.putImageData(t,e.leftPos,e.topPos),f=e},eof:function(e){a(),v&&v()},onError:function(e){S&&S()}},v=!1,S=!1,C=document.createElement("canvas");return{load:function(e){var t;v=e.success,e.step,S=e.error,-1!==m.src.indexOf("data:")?(e=m.src.substring(m.src.indexOf(",")+1),i=new _(k.atob(e)),o()):((t=new XMLHttpRequest).overrideMimeType("text/plain; charset=x-user-defined"),t.onload=function(e){i=new _(t.responseText),setTimeout(o,0)},t.onerror=function(){s("xhr")},t.open("GET",m.getAttribute("data-animated-src")||m.src,!0),t.send())},getFrames:function(){return g}}}}(window),!function(e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(e):"undefined"!=typeof window?window.JSZip=e():"undefined"!=typeof global?global.JSZip=e():"undefined"!=typeof self&&(self.JSZip=e())}(function(){return function r(n,o,s){function a(i,e){if(!o[i]){if(!n[i]){var t="function"==typeof require&&require;if(!e&&t)return t(i,!0);if(l)return l(i,!0);throw new Error("Cannot find module '"+i+"'")}e=o[i]={exports:{}};n[i][0].call(e.exports,function(e){var t=n[i][1][e];return a(t||e)},e,e.exports,r,n,o,s)}return o[i].exports}for(var l="function"==typeof require&&require,e=0;e<s.length;e++)a(s[e]);return a}({1:[function(e,t,i){"use strict";var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(e){for(var t,i,r,n,o,s,a="",l=0;l<e.length;)r=(t=e.charCodeAt(l++))>>2,n=(3&t)<<4|(t=e.charCodeAt(l++))>>4,o=(15&t)<<2|(i=e.charCodeAt(l++))>>6,s=63&i,isNaN(t)?o=s=64:isNaN(i)&&(s=64),a=a+c.charAt(r)+c.charAt(n)+c.charAt(o)+c.charAt(s);return a},i.decode=function(e){var t,i,r,n,o,s,a="",l=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<e.length;)r=c.indexOf(e.charAt(l++)),t=(15&(n=c.indexOf(e.charAt(l++))))<<4|(o=c.indexOf(e.charAt(l++)))>>2,i=(3&o)<<6|(s=c.indexOf(e.charAt(l++))),a+=String.fromCharCode(r<<2|n>>4),64!=o&&(a+=String.fromCharCode(t)),64!=s&&(a+=String.fromCharCode(i));return a}},{}],2:[function(e,t){"use strict";function i(){this.compressedSize=0,this.uncompressedSize=0,this.crc32=0,this.compressionMethod=null,this.compressedContent=null}i.prototype={getContent:function(){return null},getCompressedContent:function(){return null}},t.exports=i},{}],3:[function(e,t,i){"use strict";i.STORE={magic:"\0\0",compress:function(e){return e},uncompress:function(e){return e},compressInputType:null,uncompressInputType:null},i.DEFLATE=e("./flate")},{"./flate":6}],4:[function(e,t){"use strict";function i(){this.data=null,this.length=0,this.index=0}var r=e("./utils");i.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(){},readInt:function(e){var t,i=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)i=(i<<8)+this.byteAt(t);return this.index+=e,i},readString:function(e){return r.transformTo("string",this.readData(e))},readData:function(){},lastIndexOfSignature:function(){},readDate:function(){var e=this.readInt(4);return new Date(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1)}},t.exports=i},{"./utils":14}],5:[function(e,t,i){"use strict";i.base64=!1,i.binary=!1,i.dir=!1,i.date=null,i.compression=null},{}],6:[function(e,t,i){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,n=e("zlibjs/bin/rawdeflate.min").Zlib,o=e("zlibjs/bin/rawinflate.min").Zlib;i.uncompressInputType=r?"uint8array":"array",i.compressInputType=r?"uint8array":"array",i.magic="\b\0",i.compress=function(e){return new n.RawDeflate(e).compress()},i.uncompress=function(e){return new o.RawInflate(e).decompress()}},{"zlibjs/bin/rawdeflate.min":19,"zlibjs/bin/rawinflate.min":20}],7:[function(e,t){"use strict";function i(e,t){return this instanceof i?(this.files={},this.root="",e&&this.load(e,t),void(this.clone=function(){var e,t=new i;for(e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t})):new i(e,t)}(i.prototype=e("./object")).load=e("./load"),i.support=e("./support"),i.defaults=e("./defaults"),i.utils=e("./utils"),i.base64=e("./base64"),i.compressions=e("./compressions"),t.exports=i},{"./base64":1,"./compressions":3,"./defaults":5,"./load":8,"./object":9,"./support":12,"./utils":14}],8:[function(e,t){"use strict";var o=e("./base64"),s=e("./zipEntries");t.exports=function(e,t){var i,r,n;for((t=t||{}).base64&&(e=o.decode(e)),i=new s(e,t).files,r=0;r<i.length;r++)n=i[r],this.file(n.fileName,n.decompressed,{binary:!0,optimizedBinaryString:!0,date:n.date,dir:n.dir});return this}},{"./base64":1,"./zipEntries":15}],9:[function(e,t){"use strict";function i(e){var t;return e._data instanceof h&&(e._data=e._data.getContent(),e.options.binary=!0,e.options.base64=!1,"uint8array"===v.getTypeOf(e._data))&&(t=e._data,e._data=new Uint8Array(t.length),0!==t.length&&e._data.set(t,0)),e._data}function n(e){var t=i(e);if("string"!==v.getTypeOf(t))return t;if(!e.options.binary){if(a)return a.encode(t);if(c.nodebuffer)return u(t,"utf-8")}return e.asBinary()}function r(e){var t=i(this);return null==t?"":(this.options.base64&&(t=C.decode(t)),t=e&&this.options.binary?E.utf8decode(t):v.transformTo("string",t),t=e||this.options.binary?t:E.utf8encode(t))}function o(e,t,i){this.name=e,this._data=t,this.options=i}function d(e,t){for(var i="",r=0;r<t;r++)i+=String.fromCharCode(255&e),e>>>=8;return i}function s(e){return"/"!=e.slice(-1)&&(e+="/"),this.files[e]||b.call(this,e,null,{dir:!0}),this.files[e]}function f(e,t){var i,r=new h;return e._data instanceof h?(r.uncompressedSize=e._data.uncompressedSize,r.crc32=e._data.crc32,0===r.uncompressedSize||e.options.dir?(t=k.STORE,r.compressedContent="",r.crc32=0):e._data.compressionMethod===t.magic?r.compressedContent=e._data.getCompressedContent():(i=e._data.getContent(),r.compressedContent=t.compress(v.transformTo(t.compressInputType,i)))):((i=n(e))&&0!==i.length&&!e.options.dir||(t=k.STORE,i=""),r.uncompressedSize=i.length,r.crc32=this.crc32(i),r.compressedContent=t.compress(v.transformTo(t.compressInputType,i))),r.compressedSize=r.compressedContent.length,r.compressionMethod=t.magic,r}function g(e,t,i,r){i.compressedContent;var n,o=this.utf8encode(t.name),s=o!==t.name,a=t.options,l="",c=a.date.getHours(),a=(c=(c=((c<<=6)|a.date.getMinutes())<<5)|a.date.getSeconds()/2,n=a.date.getFullYear()-1980,n=(n=((n<<=4)|a.date.getMonth()+1)<<5)|a.date.getDate(),s&&(a=d(1,1)+d(this.crc32(o),4)+o,l+="up"+d(a.length,2)+a),""),a=(a=(a=(a=(a=(a=(a=(a=(a+="\n\0")+(s?"\0\b":"\0\0")+i.compressionMethod)+d(c,2))+d(n,2))+d(i.crc32,4))+d(i.compressedSize,4))+d(i.uncompressedSize,4))+d(o.length,2))+d(l.length,2);return{fileRecord:S.LOCAL_FILE_HEADER+a+o+l,dirRecord:S.CENTRAL_FILE_HEADER+"\0"+a+"\0\0\0\0\0\0"+(!0===t.options.dir?"\0\0\0":"\0\0\0\0")+d(r,4)+o+l,compressedObject:i}}function m(){this.data=[]}function y(e){this.data=new Uint8Array(e),this.index=0}var a,l,c=e("./support"),v=e("./utils"),S=e("./signature"),p=e("./defaults"),C=e("./base64"),k=e("./compressions"),h=e("./compressedObject"),u=e("./nodeBuffer"),_=(c.uint8array&&"function"==typeof TextEncoder&&"function"==typeof TextDecoder&&(a=new TextEncoder("utf-8"),l=new TextDecoder("utf-8")),o.prototype={asText:function(){return r.call(this,!0)},asBinary:function(){return r.call(this,!1)},asNodeBuffer:function(){var e=n(this);return v.transformTo("nodebuffer",e)},asUint8Array:function(){var e=n(this);return v.transformTo("uint8array",e)},asArrayBuffer:function(){return this.asUint8Array().buffer}},function(){for(var e,t={},i=0;i<arguments.length;i++)for(e in arguments[i])arguments[i].hasOwnProperty(e)&&void 0===t[e]&&(t[e]=arguments[i][e]);return t}),b=function(e,t,i){var r=0<(n=(r="/"==(r=e).slice(-1)?r.substring(0,r.length-1):r).lastIndexOf("/"))?r.substring(0,n):"",n=v.getTypeOf(t);if(r&&s.call(this,r),!0!==(r=(r=i)||{}).base64||null!==r.binary&&void 0!==r.binary||(r.binary=!0),(r=_(r,p)).date=r.date||new Date,null!==r.compression&&(r.compression=r.compression.toUpperCase()),(i=r).dir||null==t)i.base64=!1,i.binary=!1,t=null;else if("string"===n)i.binary&&!i.base64&&!0!==i.optimizedBinaryString&&(t=v.string2binary(t));else{if(i.base64=!1,i.binary=!0,!(n||t instanceof h))throw new Error("The data of '"+e+"' is in an unsupported format !");"arraybuffer"===n&&(t=v.transformTo("uint8array",t))}r=new o(e,t,i);return this.files[e]=r},E=(m.prototype={append:function(e){e=v.transformTo("string",e),this.data.push(e)},finalize:function(){return this.data.join("")}},y.prototype={append:function(e){0!==e.length&&(e=v.transformTo("uint8array",e),this.data.set(e,this.index),this.index+=e.length)},finalize:function(){return this.data}},{load:function(){throw new Error("Load method is not defined. Is the file jszip-load.js included ?")},filter:function(e){var t,i,r,n=[];for(t in this.files)this.files.hasOwnProperty(t)&&(r=this.files[t],r=new o(r.name,r._data,_(r.options)),i=t.slice(this.root.length,t.length),t.slice(0,this.root.length)===this.root)&&e(i,r)&&n.push(r);return n},file:function(i,e,t){var r;return 1===arguments.length?v.isRegExp(i)?(r=i,this.filter(function(e,t){return!t.options.dir&&r.test(e)})):this.filter(function(e,t){return!t.options.dir&&e===i})[0]||null:(i=this.root+i,b.call(this,i,e,t),this)},folder:function(i){var e,t;return i?v.isRegExp(i)?this.filter(function(e,t){return t.options.dir&&i.test(e)}):(e=this.root+i,e=s.call(this,e),(t=this.clone()).root=e.name,t):this},remove:function(i){i=this.root+i;var e=this.files[i];if(e||("/"!=i.slice(-1)&&(i+="/"),e=this.files[i]),e)if(e.options.dir)for(var t=this.filter(function(e,t){return t.name.slice(0,i.length)===i}),r=0;r<t.length;r++)delete this.files[t[r].name];else delete this.files[i];return this},generate:function(e){e=_(e||{},{base64:!0,compression:"STORE",type:"base64"}),v.checkSupport(e.type);var t,i=[],r=0,n=0;for(t in this.files)if(this.files.hasOwnProperty(t)){var o=this.files[t],s=o.options.compression||e.compression.toUpperCase(),a=k[s];if(!a)throw new Error(s+" is not a valid compression method !");s=f.call(this,o,a),a=g.call(this,t,o,s,r);r+=a.fileRecord.length+s.compressedSize,n+=a.dirRecord.length,i.push(a)}for(var l=S.CENTRAL_DIRECTORY_END+"\0\0\0\0"+d(i.length,2)+d(i.length,2)+d(n,4)+d(r,4)+"\0\0",c=e.type.toLowerCase(),p="uint8array"===c||"arraybuffer"===c||"blob"===c||"nodebuffer"===c?new y(r+n+l.length):new m,h=0;h<i.length;h++)p.append(i[h].fileRecord),p.append(i[h].compressedObject.compressedContent);for(h=0;h<i.length;h++)p.append(i[h].dirRecord);p.append(l);var u=p.finalize();switch(e.type.toLowerCase()){case"uint8array":case"arraybuffer":case"nodebuffer":return v.transformTo(e.type.toLowerCase(),u);case"blob":return v.arrayBuffer2Blob(v.transformTo("arraybuffer",u));case"base64":return e.base64?C.encode(u):u;default:return u}},crc32:function(e,t){if(void 0===e||!e.length)return 0;var i="string"!==v.getTypeOf(e),r=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];void 0===t&&(t=0);t^=-1;for(var n=0,o=e.length;n<o;n++)t=t>>>8^r[255&(t^(i?e[n]:e.charCodeAt(n)))];return-1^t},utf8encode:function(e){var t;if(a)return t=a.encode(e),v.transformTo("string",t);if(c.nodebuffer)return v.transformTo("string",u(e,"utf-8"));for(var i=[],r=0,n=0;n<e.length;n++){var o=e.charCodeAt(n);o<128?i[r++]=String.fromCharCode(o):(127<o&&o<2048?i[r++]=String.fromCharCode(o>>6|192):(i[r++]=String.fromCharCode(o>>12|224),i[r++]=String.fromCharCode(o>>6&63|128)),i[r++]=String.fromCharCode(63&o|128))}return i.join("")},utf8decode:function(e){var t,i,r=[],n=0,o="string"!==v.getTypeOf(e),s=0,a=0;if(l)return l.decode(v.transformTo("uint8array",e));if(c.nodebuffer)return v.transformTo("nodebuffer",e).toString("utf-8");for(;s<e.length;)(t=o?e[s]:e.charCodeAt(s))<128?(r[n++]=String.fromCharCode(t),s++):191<t&&t<224?(a=o?e[s+1]:e.charCodeAt(s+1),r[n++]=String.fromCharCode((31&t)<<6|63&a),s+=2):(a=o?e[s+1]:e.charCodeAt(s+1),i=o?e[s+2]:e.charCodeAt(s+2),r[n++]=String.fromCharCode((15&t)<<12|(63&a)<<6|63&i),s+=3);return r.join("")}});t.exports=E},{"./base64":1,"./compressedObject":2,"./compressions":3,"./defaults":5,"./nodeBuffer":17,"./signature":10,"./support":12,"./utils":14}],10:[function(e,t,i){"use strict";i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\b"},{}],11:[function(e,t){"use strict";function i(e,t){this.data=e,t||(this.data=n.string2binary(this.data)),this.length=this.data.length,this.index=0}var r=e("./dataReader"),n=e("./utils");(i.prototype=new r).byteAt=function(e){return this.data.charCodeAt(e)},i.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)},i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t},t.exports=i},{"./dataReader":4,"./utils":14}],12:[function(t,e,i){t=t("__browserify_process");if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,i.nodebuffer=!t.browser,i.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)i.blob=!1;else{t=new ArrayBuffer(0);try{i.blob=0===new Blob([t],{type:"application/zip"}).size}catch(e){try{var r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);r.append(t),i.blob=0===r.getBlob("application/zip").size}catch(e){i.blob=!1}}}},{__browserify_process:18}],13:[function(e,t){"use strict";function i(e){e&&(this.data=e,this.length=this.data.length,this.index=0)}e=e("./dataReader");(i.prototype=new e).byteAt=function(e){return this.data[e]},i.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),i=e.charCodeAt(1),r=e.charCodeAt(2),n=e.charCodeAt(3),o=this.length-4;0<=o;--o)if(this.data[o]===t&&this.data[o+1]===i&&this.data[o+2]===r&&this.data[o+3]===n)return o;return-1},i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.subarray(this.index,this.index+e);return this.index+=e,t},t.exports=i},{"./dataReader":4}],14:[function(e,t,c){"use strict";function i(e){return e}function r(e,t){for(var i=0;i<e.length;++i)t[i]=255&e.charCodeAt(i);return t}function n(e){var t=65536,i=[],r=e.length,n=c.getTypeOf(e),o=0,s=!0;try{switch(n){case"uint8array":String.fromCharCode.apply(null,new Uint8Array(0));break;case"nodebuffer":String.fromCharCode.apply(null,p(0))}}catch(e){s=!1}if(!s){for(var a="",l=0;l<e.length;l++)a+=String.fromCharCode(e[l]);return a}for(;o<r&&1<t;)try{i.push("array"===n||"nodebuffer"===n?String.fromCharCode.apply(null,e.slice(o,Math.min(o+t,r))):String.fromCharCode.apply(null,e.subarray(o,Math.min(o+t,r)))),o+=t}catch(e){t=Math.floor(t/2)}return i.join("")}function o(e,t){for(var i=0;i<e.length;i++)t[i]=e[i];return t}var s=e("./support"),a=e("./compressions"),p=e("./nodeBuffer"),l=(c.string2binary=function(e){for(var t="",i=0;i<e.length;i++)t+=String.fromCharCode(255&e.charCodeAt(i));return t},c.string2Uint8Array=function(e){return c.transformTo("uint8array",e)},c.uint8Array2String=function(e){return c.transformTo("string",e)},c.string2Blob=function(e){e=c.transformTo("arraybuffer",e);return c.arrayBuffer2Blob(e)},c.arrayBuffer2Blob=function(t){c.checkSupport("blob");try{return new Blob([t],{type:"application/zip"})}catch(e){try{var i=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);return i.append(t),i.getBlob("application/zip")}catch(e){throw new Error("Bug : can't construct the Blob.")}}},{});l.string={string:i,array:function(e){return r(e,new Array(e.length))},arraybuffer:function(e){return l.string.uint8array(e).buffer},uint8array:function(e){return r(e,new Uint8Array(e.length))},nodebuffer:function(e){return r(e,p(e.length))}},l.array={string:n,array:i,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return p(e)}},l.arraybuffer={string:function(e){return n(new Uint8Array(e))},array:function(e){return o(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:i,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return p(new Uint8Array(e))}},l.uint8array={string:n,array:function(e){return o(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:i,nodebuffer:function(e){return p(e)}},l.nodebuffer={string:n,array:function(e){return o(e,new Array(e.length))},arraybuffer:function(e){return l.nodebuffer.uint8array(e).buffer},uint8array:function(e){return o(e,new Uint8Array(e.length))},nodebuffer:i},c.transformTo=function(e,t){if(t=t||"",!e)return t;c.checkSupport(e);var i=c.getTypeOf(t);return l[i][e](t)},c.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":s.nodebuffer&&p.test(e)?"nodebuffer":s.uint8array&&e instanceof Uint8Array?"uint8array":s.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},c.checkSupport=function(e){if(!s[e.toLowerCase()])throw new Error(e+" is not supported by this browser")},c.MAX_VALUE_16BITS=65535,c.MAX_VALUE_32BITS=-1,c.pretty=function(e){for(var t,i="",r=0;r<(e||"").length;r++)i+="\\x"+((t=e.charCodeAt(r))<16?"0":"")+t.toString(16).toUpperCase();return i},c.findCompression=function(e){for(var t in a)if(a.hasOwnProperty(t)&&a[t].magic===e)return a[t];return null},c.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}},{"./compressions":3,"./nodeBuffer":17,"./support":12}],15:[function(e,t){"use strict";function i(e,t){this.files=[],this.loadOptions=t,e&&this.load(e)}var r=e("./stringReader"),n=e("./nodeBufferReader"),o=e("./uint8ArrayReader"),s=e("./utils"),a=e("./signature"),l=e("./zipEntry"),c=e("./support");i.prototype={checkSignature:function(e){var t=this.reader.readString(4);if(t!==e)throw new Error("Corrupted zip or bug : unexpected signature ("+s.pretty(t)+", expected "+s.pretty(e)+")")},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2),this.zipComment=this.reader.readString(this.zipCommentLength)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.versionMadeBy=this.reader.readString(2),this.versionNeeded=this.reader.readInt(2),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,i,r=this.zip64EndOfCentralSize-44;0<r;)e=this.reader.readInt(2),t=this.reader.readInt(4),i=this.reader.readString(t),this.zip64ExtensibleData[e]={id:e,length:t,value:i}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){for(var e,t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readString(4)===a.CENTRAL_FILE_HEADER;)(e=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(-1===e)throw new Error("Corrupted zip : can't find end of central directory");if(this.reader.setIndex(e),this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,-1===(e=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR)))throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");this.reader.setIndex(e),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}},prepareReader:function(e){var t=s.getTypeOf(e);this.reader="string"!==t||c.uint8array?"nodebuffer"===t?new n(e):new o(s.transformTo("uint8array",e)):new r(e,this.loadOptions.optimizedBinaryString)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=i},{"./nodeBufferReader":17,"./signature":10,"./stringReader":11,"./support":12,"./uint8ArrayReader":13,"./utils":14,"./zipEntry":16}],16:[function(e,t){"use strict";function i(e,t){this.options=e,this.loadOptions=t}var r=e("./stringReader"),o=e("./utils"),n=e("./compressedObject"),s=e("./object");i.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},prepareCompressedContent:function(i,r,n){return function(){var e=i.index,t=(i.setIndex(r),i.readData(n));return i.setIndex(e),t}},prepareContent:function(e,t,i,r,n){return function(){var e=o.transformTo(r.uncompressInputType,this.getCompressedContent()),e=r.uncompress(e);if(e.length!==n)throw new Error("Bug : uncompressed data size mismatch");return e}},readLocalPart:function(e){var t;if(e.skip(22),this.fileNameLength=e.readInt(2),t=e.readInt(2),this.fileName=e.readString(this.fileNameLength),e.skip(t),-1==this.compressedSize||-1==this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize == -1 || uncompressedSize == -1)");if(null===(t=o.findCompression(this.compressionMethod)))throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+this.fileName+")");if(this.decompressed=new n,this.decompressed.compressedSize=this.compressedSize,this.decompressed.uncompressedSize=this.uncompressedSize,this.decompressed.crc32=this.crc32,this.decompressed.compressionMethod=this.compressionMethod,this.decompressed.getCompressedContent=this.prepareCompressedContent(e,e.index,this.compressedSize,t),this.decompressed.getContent=this.prepareContent(e,e.index,this.compressedSize,t,this.uncompressedSize),this.loadOptions.checkCRC32&&(this.decompressed=o.transformTo("string",this.decompressed.getContent()),s.crc32(this.decompressed)!==this.crc32))throw new Error("Corrupted zip : CRC32 mismatch")},readCentralPart:function(e){if(this.versionMadeBy=e.readString(2),this.versionNeeded=e.readInt(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4),this.fileNameLength=e.readInt(2),this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");this.fileName=e.readString(this.fileNameLength),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readString(this.fileCommentLength),this.dir=!!(16&this.externalFileAttributes)},parseZIP64ExtraField:function(){var e;this.extraFields[1]&&(e=new r(this.extraFields[1].value),this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS)&&(this.diskNumberStart=e.readInt(4))},readExtraFields:function(e){var t,i,r,n=e.index;for(this.extraFields=this.extraFields||{};e.index<n+this.extraFieldsLength;)t=e.readInt(2),i=e.readInt(2),r=e.readString(i),this.extraFields[t]={id:t,length:i,value:r}},handleUTF8:function(){var e;this.useUTF8()?(this.fileName=s.utf8decode(this.fileName),this.fileComment=s.utf8decode(this.fileComment)):null!==(e=this.findExtraFieldUnicodePath())&&(this.fileName=e)},findExtraFieldUnicodePath:function(){var e,t=this.extraFields[28789];return!t||1!==(e=new r(t.value)).readInt(1)||s.crc32(this.fileName)!==e.readInt(4)?null:s.utf8decode(e.readString(t.length-5))}},t.exports=i},{"./compressedObject":2,"./object":9,"./stringReader":11,"./utils":14}],17:[function(){},{}],18:[function(e,t){var i,r,n,t=t.exports={};t.nextTick=(r="undefined"!=typeof window&&window.setImmediate,n="undefined"!=typeof window&&window.postMessage&&window.addEventListener,r?function(e){return window.setImmediate(e)}:n?(i=[],window.addEventListener("message",function(e){var t=e.source;(t===window||null===t)&&"process-tick"===e.data&&(e.stopPropagation(),0<i.length)&&i.shift()()},!0),function(e){i.push(e),window.postMessage("process-tick","*")}):function(e){setTimeout(e,0)}),t.title="browser",t.browser=!0,t.env={},t.argv=[],t.binding=function(){throw new Error("process.binding is not supported")},t.cwd=function(){return"/"},t.chdir=function(){throw new Error("process.chdir is not supported")}},{}],19:[function(){!function(){"use strict";function e(e,t){var i,r=e.split("."),n=o;r[0]in n||!n.execScript||n.execScript("var "+r[0]);for(;r.length&&(i=r.shift());)r.length||t===ie?n=n[i]||(n[i]={}):n[i]=t}function Q(e,t){if(this.index="number"==typeof t?t:0,this.d=0,this.buffer=e instanceof(ne?Uint8Array:Array)?e:new(ne?Uint8Array:Array)(32768),2*this.buffer.length<=this.index)throw Error("invalid index");this.buffer.length<=this.index&&l(this)}function l(e){var t,i=e.buffer,r=i.length,n=new(ne?Uint8Array:Array)(r<<1);if(ne)n.set(i);else for(t=0;t<r;++t)n[t]=i[t];return e.buffer=n}function p(e){this.buffer=new(ne?Uint16Array:Array)(2*e),this.length=0}function t(e,t){this.e=oe,this.f=0,this.input=ne&&e instanceof Array?new Uint8Array(e):e,this.c=0,t&&(t.lazy&&(this.f=t.lazy),"number"==typeof t.compressionType&&(this.e=t.compressionType),t.outputBuffer&&(this.b=ne&&t.outputBuffer instanceof Array?new Uint8Array(t.outputBuffer):t.outputBuffer),"number"==typeof t.outputIndex)&&(this.c=t.outputIndex),this.b||(this.b=new(ne?Uint8Array:Array)(32768))}function S(e,t){this.length=e,this.g=t}function J(e,t){function i(e,t){var i,r,n,o=e.g,s=[],a=0,l=C[e.length];switch(s[a++]=65535&l,s[a++]=l>>16&255,s[a++]=l>>24,re){case 1===o:i=[0,o-1,0];break;case 2===o:i=[1,o-2,0];break;case 3===o:i=[2,o-3,0];break;case 4===o:i=[3,o-4,0];break;case o<=6:i=[4,o-5,1];break;case o<=8:i=[5,o-7,1];break;case o<=12:i=[6,o-9,2];break;case o<=16:i=[7,o-13,2];break;case o<=24:i=[8,o-17,3];break;case o<=32:i=[9,o-25,3];break;case o<=48:i=[10,o-33,4];break;case o<=64:i=[11,o-49,4];break;case o<=96:i=[12,o-65,5];break;case o<=128:i=[13,o-97,5];break;case o<=192:i=[14,o-129,6];break;case o<=256:i=[15,o-193,6];break;case o<=384:i=[16,o-257,7];break;case o<=512:i=[17,o-385,7];break;case o<=768:i=[18,o-513,8];break;case o<=1024:i=[19,o-769,8];break;case o<=1536:i=[20,o-1025,9];break;case o<=2048:i=[21,o-1537,9];break;case o<=3072:i=[22,o-2049,10];break;case o<=4096:i=[23,o-3073,10];break;case o<=6144:i=[24,o-4097,11];break;case o<=8192:i=[25,o-6145,11];break;case o<=12288:i=[26,o-8193,12];break;case o<=16384:i=[27,o-12289,12];break;case o<=24576:i=[28,o-16385,13];break;case o<=32768:i=[29,o-24577,13];break;default:throw"invalid distance"}for(l=i,s[a++]=l[0],s[+a]=l[1],s[5]=l[2],r=0,n=s.length;r<n;++r)d[f++]=s[r];m[s[0]]++,y[s[3]]++,g=e.length+t-1,p=null}var r,n,o,s,a,l,c,p,h,u={},d=ne?new Uint16Array(2*t.length):[],f=0,g=0,m=new(ne?Uint32Array:Array)(286),y=new(ne?Uint32Array:Array)(30),v=e.f;if(!ne){for(o=0;o<=285;)m[o++]=0;for(o=0;o<=29;)y[o++]=0}for(m[256]=1,r=0,n=t.length;r<n;++r){for(o=a=0,s=3;o<s&&r+o!==n;++o)a=a<<8|t[r+o];if(u[a]===ie&&(u[a]=[]),l=u[a],!(0<g--)){for(;0<l.length&&32768<r-l[0];)l.shift();if(n<=r+3){for(p&&i(p,-1),o=0,s=n-r;o<s;++o)h=t[r+o],d[f++]=h,++m[h];break}0<l.length?(c=function(e,t,i){var r,n,o,s,a,l,c=0,p=e.length;s=0,l=i.length;e:for(;s<l;s++){if(r=i[l-s-1],(o=3)<c){for(a=c;3<a;a--)if(e[r+a-1]!==e[t+a-1])continue e;o=c}for(;o<258&&t+o<p&&e[r+o]===e[t+o];)++o;if(c<o&&(n=r,c=o),258===o)break}return new S(c,t-n)}(t,r,l),p?p.length<c.length?(h=t[r-1],d[f++]=h,++m[h],i(c,0)):i(p,-1):c.length<v?p=c:i(c,0)):p?i(p,-1):(h=t[r],d[f++]=h,++m[h])}l.push(r)}return d[f++]=256,m[256]++,e.j=m,e.i=y,ne?d.subarray(0,f):d}function ee(e,t){var i,r,n,o,s,a=e.length,l=new p(572),c=new(ne?Uint8Array:Array)(a);if(!ne)for(o=0;o<a;o++)c[o]=0;for(o=0;o<a;++o)0<e[o]&&l.push(o,e[o]);if(i=Array(l.length/2),r=new(ne?Uint32Array:Array)(l.length/2),1===i.length)c[l.pop().index]=1;else{for(o=0,s=l.length/2;o<s;++o)i[o]=l.pop(),r[o]=i[o].value;for(n=function(e,r,t){var i,n,o,s,a,l=new(ne?Uint16Array:Array)(t),c=new(ne?Uint8Array:Array)(t),p=new(ne?Uint8Array:Array)(r),h=Array(t),u=Array(t),d=Array(t),f=(1<<t)-r,g=1<<t-1;for(l[t-1]=r,n=0;n<t;++n)f<g?c[n]=0:(c[n]=1,f-=g),f<<=1,l[t-2-n]=(l[t-1-n]/2|0)+r;for(l[0]=c[0],h[0]=Array(l[0]),u[0]=Array(l[0]),n=1;n<t;++n)l[n]>2*l[n-1]+c[n]&&(l[n]=2*l[n-1]+c[n]),h[n]=Array(l[n]),u[n]=Array(l[n]);for(i=0;i<r;++i)p[i]=t;for(o=0;o<l[t-1];++o)h[t-1][o]=e[o],u[t-1][o]=o;for(i=0;i<t;++i)d[i]=0;for(1===c[t-1]&&(--p[0],++d[t-1]),n=t-2;0<=n;--n){for(s=i=0,a=d[n+1],o=0;o<l[n];o++)(s=h[n+1][a]+h[n+1][a+1])>e[i]?(h[n][o]=s,u[n][o]=r,a+=2):(h[n][o]=e[i],u[n][o]=i,++i);d[n]=0,1===c[n]&&function e(t){var i=u[t][d[t]];i===r?(e(t+1),e(t+1)):--p[i],++d[t]}(n)}return p}(r,r.length,t),o=0,s=i.length;o<s;++o)c[i[o].index]=n[o]}return c}function te(e){for(var t,i,r=new(ne?Uint16Array:Array)(e.length),n=[],o=[],s=0,a=0,l=e.length;a<l;a++)n[e[a]]=1+(0|n[e[a]]);for(a=1,l=16;a<=l;a++)s=(o[a]=s)+(0|n[a])<<1;for(a=0,l=e.length;a<l;a++)for(s=o[e[a]],o[e[a]]+=1,t=r[a]=0,i=e[a];t<i;t++)r[a]=r[a]<<1|1&s,s>>>=1;return r}var ie=void 0,re=!0,o=this,ne="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;Q.prototype.a=function(e,t,i){var r,n=this.buffer,o=this.index,s=this.d,a=n[o];if(i&&1<t&&(e=8<t?(c[255&e]<<24|c[e>>>8&255]<<16|c[e>>>16&255]<<8|c[e>>>24&255])>>32-t:c[e]>>8-t),t+s<8)a=a<<t|e,s+=t;else for(r=0;r<t;++r)a=a<<1|e>>t-r-1&1,8==++s&&(s=0,n[o++]=c[a],a=0,o===n.length)&&(n=l(this));n[o]=a,this.buffer=n,this.d=s,this.index=o},Q.prototype.finish=function(){var e=this.buffer,t=this.index;return 0<this.d&&(e[t]<<=8-this.d,e[t]=c[e[t]],t++),ne?e.subarray(0,t):(e.length=t,e)};for(var i=new(ne?Uint8Array:Array)(256),r=0;r<256;++r){for(var n=a=r,s=7,a=a>>>1;a;a>>>=1)n=n<<1|1&a,--s;i[r]=(n<<s&255)>>>0}var c=i;p.prototype.getParent=function(e){return 2*((e-2)/4|0)},p.prototype.push=function(e,t){var i,r,n=this.buffer,o=this.length;for(n[this.length++]=t,n[this.length++]=e;0<o&&(i=this.getParent(o),n[o]>n[i]);)r=n[o],n[o]=n[i],n[i]=r,r=n[o+1],n[o+1]=n[i+1],n[i+1]=r,o=i;return this.length},p.prototype.pop=function(){var e,t,i,r=this.buffer,n=r[0],o=r[1];for(this.length-=2,r[0]=r[this.length],r[1]=r[this.length+1],i=0;!((t=2*i+2)>=this.length)&&(t+2<this.length&&r[t+2]>r[t]&&(t+=2),r[t]>r[i]);)e=r[i],r[i]=r[t],r[t]=e,e=r[i+1],r[i+1]=r[t+1],r[t+1]=e,i=t;return{index:o,value:n,length:this.length}};for(var oe=2,se=[],h=0;h<288;h++)switch(re){case h<=143:se.push([h+48,8]);break;case h<=255:se.push([h-144+400,9]);break;case h<=279:se.push([h-256,7]);break;case h<=287:se.push([h-280+192,8]);break;default:throw"invalid literal: "+h}t.prototype.h=function(){var e,t,N,i=this.input;switch(this.e){case 0:for(t=0,N=i.length;t<N;){var M,U,r=n=ne?i.subarray(t,t+65535):i.slice(t,t+65535),n=(t+=n.length)===N,o=ie,s=this.b,a=this.c;if(ne){for(s=new Uint8Array(this.b.buffer);s.length<=a+r.length+5;)s=new Uint8Array(s.length<<1);s.set(this.b)}if(s[a++]=0|(n?1:0),M=65536+~(n=r.length)&65535,s[a++]=255&n,s[a++]=n>>>8&255,s[a++]=255&M,s[a++]=M>>>8&255,ne)s.set(r,a),a+=r.length,s=s.subarray(0,a);else{for(o=0,U=r.length;o<U;++o)s[a++]=r[o];s.length=a}this.c=a,this.b=s}break;case 1:var l=new Q(ne?new Uint8Array(this.b.buffer):this.b,this.c);l.a(1,1,re),l.a(1,2,re);for(var c,p=J(this,i),h=0,z=p.length;h<z;h++)if(c=p[h],Q.prototype.a.apply(l,se[c]),256<c)l.a(p[++h],p[++h],re),l.a(p[++h],5),l.a(p[++h],p[++h],re);else if(256===c)break;this.b=l.finish(),this.c=this.b.length;break;case oe:var u,d,f,g,m,y,v,B,S,C,k,H,_=new Q(ne?new Uint8Array(this.b.buffer):this.b,this.c),W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],$=Array(19),b=oe;for(_.a(1,1,re),_.a(b,2,re),u=J(this,i),b=te(m=ee(this.j,15)),F=te(y=ee(this.i,7)),d=286;257<d&&0===m[d-1];d--);for(f=30;1<f&&0===y[f-1];f--);for(var E,w,T,P,I,G=d,q=f,x=new(ne?Uint32Array:Array)(G+q),L=new(ne?Uint32Array:Array)(316),A=new(ne?Uint8Array:Array)(19),R=E=0;R<G;R++)x[E++]=m[R];for(R=0;R<q;R++)x[E++]=y[R];if(!ne)for(R=0,T=A.length;R<T;++R)A[R]=0;for(R=P=0,T=x.length;R<T;R+=E){for(E=1;R+E<T&&x[R+E]===x[R];++E);if(w=E,0===x[R])if(w<3)for(;0<w--;)A[L[P++]=0]++;else for(;0<w;)(I=w-3<(I=w<138?w:138)&&I<w?w-3:I)<=10?(L[P++]=17,L[P++]=I-3,A[17]++):(L[P++]=18,L[P++]=I-11,A[18]++),w-=I;else if(L[P++]=x[R],A[x[R]]++,--w<3)for(;0<w--;)L[P++]=x[R],A[x[R]]++;else for(;0<w;)w-3<(I=w<6?w:6)&&I<w&&(I=w-3),L[P++]=16,L[P++]=I-3,A[16]++,w-=I}for(e=ne?L.subarray(0,P):L.slice(0,P),v=ee(A,7),k=0;k<19;k++)$[k]=v[W[k]];for(g=19;4<g&&0===$[g-1];g--);for(B=te(v),_.a(d-257,5,re),_.a(f-1,5,re),_.a(g-4,4,re),k=0;k<g;k++)_.a($[k],3,re);for(k=0,H=e.length;k<H;k++)if(S=e[k],_.a(B[S],v[S],re),16<=S){switch(k++,S){case 16:C=2;break;case 17:C=3;break;case 18:C=7;break;default:throw"invalid code: "+S}_.a(e[k],C,re)}for(var D,j,b=[b,m],F=[F,y],K=b[0],V=b[1],Z=F[0],Y=F[1],O=0,X=u.length;O<X;++O)if(D=u[O],_.a(K[D],V[D],re),256<D)_.a(u[++O],u[++O],re),j=u[++O],_.a(Z[j],Y[j],re),_.a(u[++O],u[++O],re);else if(256===D)break;this.b=_.finish(),this.c=this.b.length;break;default:throw"invalid compression type"}return this.b};var u=function(){for(var e,t=[],i=3;i<=258;i++)e=function(e){switch(re){case 3===e:return[257,e-3,0];case 4===e:return[258,e-4,0];case 5===e:return[259,e-5,0];case 6===e:return[260,e-6,0];case 7===e:return[261,e-7,0];case 8===e:return[262,e-8,0];case 9===e:return[263,e-9,0];case 10===e:return[264,e-10,0];case e<=12:return[265,e-11,1];case e<=14:return[266,e-13,1];case e<=16:return[267,e-15,1];case e<=18:return[268,e-17,1];case e<=22:return[269,e-19,2];case e<=26:return[270,e-23,2];case e<=30:return[271,e-27,2];case e<=34:return[272,e-31,2];case e<=42:return[273,e-35,3];case e<=50:return[274,e-43,3];case e<=58:return[275,e-51,3];case e<=66:return[276,e-59,3];case e<=82:return[277,e-67,4];case e<=98:return[278,e-83,4];case e<=114:return[279,e-99,4];case e<=130:return[280,e-115,4];case e<=162:return[281,e-131,5];case e<=194:return[282,e-163,5];case e<=226:return[283,e-195,5];case e<=257:return[284,e-227,5];case 258===e:return[285,e-258,0];default:throw"invalid length: "+e}}(i),t[i]=e[2]<<24|e[1]<<16|e[0];return t}(),C=ne?new Uint32Array(u):u;e("Zlib.RawDeflate",t),e("Zlib.RawDeflate.prototype.compress",t.prototype.h);var d,f,g,m,y={NONE:0,FIXED:1,DYNAMIC:oe};if(Object.keys)d=Object.keys(y);else for(f in d=[],g=0,y)d[g++]=f;for(g=0,m=d.length;g<m;++g)e("Zlib.RawDeflate.CompressionType."+(f=d[g]),y[f])}.call(this)},{}],20:[function(){!function(){"use strict";function e(e,t){var i,r=e.split("."),n=o;r[0]in n||!n.execScript||n.execScript("var "+r[0]);for(;r.length&&(i=r.shift());)r.length||void 0===t?n=n[i]||(n[i]={}):n[i]=t}function v(e){for(var t,i,r,n,o,s,a,l,c,p=e.length,h=0,u=Number.POSITIVE_INFINITY,d=0;d<p;++d)e[d]>h&&(h=e[d]),e[d]<u&&(u=e[d]);for(t=1<<h,i=new(k?Uint32Array:Array)(t),r=1,n=0,o=2;r<=h;){for(d=0;d<p;++d)if(e[d]===r){for(a=n,l=s=0;l<r;++l)s=s<<1|1&a,a>>=1;for(c=r<<16|d,l=s;l<t;l+=o)i[l]=c;++n}++r,n<<=1,o<<=1}return[i,h,u]}function t(e,t){switch(this.g=[],this.h=32768,this.c=this.f=this.d=this.k=0,this.input=k?new Uint8Array(e):e,this.l=!1,this.i=1,this.q=!1,(t?(t.index&&(this.d=t.index),t.bufferSize&&(this.h=t.bufferSize),t.bufferType&&(this.i=t.bufferType),t.resize):(t={},0))&&(this.q=t.resize),this.i){case 0:this.a=32768,this.b=new(k?Uint8Array:Array)(32768+this.h+258);break;case 1:this.a=0,this.b=new(k?Uint8Array:Array)(this.h),this.e=this.v,this.m=this.s,this.j=this.t;break;default:throw Error("invalid inflate mode")}}function S(e,t){for(var i,r=e.f,n=e.c,o=e.input,s=e.d,a=o.length;n<t;){if(a<=s)throw Error("input buffer is broken");r|=o[s++]<<n,n+=8}return i=r&(1<<t)-1,e.f=r>>>t,e.c=n-t,e.d=s,i}function C(e,t){for(var i=e.f,r=e.c,n=e.input,o=e.d,s=n.length,a=t[0],l=t[1];r<l&&!(s<=o);)i|=n[o++]<<r,r+=8;return t=a[i&(1<<l)-1],e.f=i>>(a=t>>>16),e.c=r-a,e.d=o,65535&t}var o=this,k="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;t.prototype.u=function(){for(;!this.l;){var e=S(this,3);switch(1&e&&(this.l=!0),e>>>=1){case 0:var t=this.input,i=this.d,r=this.b,n=this.a,o=t.length,s=void 0,a=r.length,l=void 0;if(this.c=this.f=0,o<=i+1)throw Error("invalid uncompressed block header: LEN");if(s=t[i++]|t[i++]<<8,o<=i+1)throw Error("invalid uncompressed block header: NLEN");if(s===~(t[i++]|t[i++]<<8))throw Error("invalid uncompressed block header: length verify");if(i+s>t.length)throw Error("input buffer is broken");switch(this.i){case 0:for(;n+s>r.length;){if(s-=l=a-n,k)r.set(t.subarray(i,i+l),n),n+=l,i+=l;else for(;l--;)r[n++]=t[i++];this.a=n,r=this.e(),n=this.a}break;case 1:for(;n+s>r.length;)r=this.e({o:2});break;default:throw Error("invalid inflate mode")}if(k)r.set(t.subarray(i,i+s),n),n+=s,i+=s;else for(;s--;)r[n++]=t[i++];this.d=i,this.a=n,this.b=r;break;case 1:this.j(b,E);break;case 2:m=g=f=d=y=p=c=o=h=void 0;for(var c,p,h=this,u=function(e,t,i){for(var r,n,o=this.p,s=0;s<e;)switch(r=C(this,t)){case 16:for(n=3+S(this,2);n--;)i[s++]=o;break;case 17:for(n=3+S(this,3);n--;)i[s++]=0;o=0;break;case 18:for(n=11+S(this,7);n--;)i[s++]=0;o=0;break;default:o=i[s++]=r}return this.p=o,i},d=S(h,5)+257,f=S(h,5)+1,g=S(h,4)+4,m=new(k?Uint8Array:Array)(_.length),y=0;y<g;++y)m[_[y]]=S(h,3);if(!k)for(y=g,g=m.length;y<g;++y)m[_[y]]=0;o=v(m),c=new(k?Uint8Array:Array)(d),p=new(k?Uint8Array:Array)(f),h.p=0,h.j(v(u.call(h,d,o,c)),v(u.call(h,f,o,p)));break;default:throw Error("unknown BTYPE: "+e)}}return this.m()};for(var i=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],_=k?new Uint16Array(i):i,i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],c=k?new Uint16Array(i):i,i=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],p=k?new Uint8Array(i):i,i=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],h=k?new Uint16Array(i):i,i=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],u=k?new Uint8Array(i):i,r=new(k?Uint8Array:Array)(288),n=0,s=r.length;n<s;++n)r[n]=n<=143?8:n<=255?9:n<=279?7:8;for(var b=v(r),a=new(k?Uint8Array:Array)(30),l=0,d=a.length;l<d;++l)a[l]=5;var E=v(a);t.prototype.j=function(e,t){var i=this.b,r=this.a;this.n=e;for(var n,o,s,a,l=i.length-258;256!==(n=C(this,e));)if(n<256)l<=r&&(this.a=r,i=this.e(),r=this.a),i[r++]=n;else for(a=c[o=n-257],0<p[o]&&(a+=S(this,p[o])),n=C(this,t),s=h[n],0<u[n]&&(s+=S(this,u[n])),l<=r&&(this.a=r,i=this.e(),r=this.a);a--;)i[r]=i[r++-s];for(;8<=this.c;)this.c-=8,this.d--;this.a=r},t.prototype.t=function(e,t){var i=this.b,r=this.a;this.n=e;for(var n,o,s,a,l=i.length;256!==(n=C(this,e));)if(n<256)l<=r&&(l=(i=this.e()).length),i[r++]=n;else for(a=c[o=n-257],0<p[o]&&(a+=S(this,p[o])),n=C(this,t),s=h[n],0<u[n]&&(s+=S(this,u[n])),l<r+a&&(l=(i=this.e()).length);a--;)i[r]=i[r++-s];for(;8<=this.c;)this.c-=8,this.d--;this.a=r},t.prototype.e=function(){var e,t,i=new(k?Uint8Array:Array)(this.a-32768),r=this.a-32768,n=this.b;if(k)i.set(n.subarray(32768,i.length));else for(e=0,t=i.length;e<t;++e)i[e]=n[e+32768];if(this.g.push(i),this.k+=i.length,k)n.set(n.subarray(r,32768+r));else for(e=0;e<32768;++e)n[e]=n[r+e];return this.a=32768,n},t.prototype.v=function(e){var t,i=this.input.length/this.d+1|0,r=this.input,n=this.b;return e&&("number"==typeof e.o&&(i=e.o),"number"==typeof e.r)&&(i+=e.r),r=i<2?(e=(r.length-this.d)/this.n[2]/2*258|0)<n.length?n.length+e:n.length<<1:n.length*i,k?(t=new Uint8Array(r)).set(n):t=n,this.b=t},t.prototype.m=function(){var e,t,i,r,n,o=0,s=this.b,a=this.g,l=new(k?Uint8Array:Array)(this.k+(this.a-32768));if(0===a.length)return k?this.b.subarray(32768,this.a):this.b.slice(32768,this.a);for(t=0,i=a.length;t<i;++t)for(r=0,n=(e=a[t]).length;r<n;++r)l[o++]=e[r];for(t=32768,i=this.a;t<i;++t)l[o++]=s[t];return this.g=[],this.buffer=l},t.prototype.s=function(){var e,t=this.a;return k?this.q?(e=new Uint8Array(t)).set(this.b.subarray(0,t)):e=this.b.subarray(0,t):(this.b.length>t&&(this.b.length=t),e=this.b),this.buffer=e},e("Zlib.RawInflate",t),e("Zlib.RawInflate.prototype.decompress",t.prototype.u);var f,g,m,y,w={ADAPTIVE:1,BLOCK:0};if(Object.keys)f=Object.keys(w);else for(g in f=[],m=0,w)f[m++]=g;for(m=0,y=f.length;m<y;++m)e("Zlib.RawInflate.BufferType."+(g=f[m]),w[g])}.call(this)},{}]},{},[7])(7)}),Element.prototype.scrollIntoViewIfNeeded||(Element.prototype.scrollIntoViewIfNeeded=function(e){e=0===arguments.length||!!e;var t=this.parentNode,i=window.getComputedStyle(t,null),r=parseInt(i.getPropertyValue("border-top-width")),i=parseInt(i.getPropertyValue("border-left-width")),n=this.offsetTop-t.offsetTop<t.scrollTop,o=this.offsetTop-t.offsetTop+this.clientHeight-r>t.scrollTop+t.clientHeight,s=this.offsetLeft-t.offsetLeft<t.scrollLeft,a=this.offsetLeft-t.offsetLeft+this.clientWidth-i>t.scrollLeft+t.clientWidth,l=n&&!o;(n||o)&&e&&(t.scrollTop=this.offsetTop-t.offsetTop-t.clientHeight/2-r+this.clientHeight/2),(s||a)&&e&&(t.scrollLeft=this.offsetLeft-t.offsetLeft-t.clientWidth/2-i+this.clientWidth/2),(n||o||s||a)&&!e&&this.scrollIntoView(l)}),!function(h,u){"use strict";function e(){var e,r,a,l;function c(e,t){this.scrollLeft=e,this.scrollTop=t}function n(e){if("object"!=typeof e||void 0===e.behavior||"auto"===e.behavior||"instant"===e.behavior)return 1;if("object"!=typeof e||"smooth"!==e.behavior)throw new TypeError("behavior not valid")}function p(e){e.frame=h.requestAnimationFrame(p.bind(h,e));var t=l(),t=1<(t=(t-e.startTime)/r)?1:t,t=.5*(1-Math.cos(Math.PI*t)),i=e.startX+(e.x-e.startX)*t,t=e.startY+(e.y-e.startY)*t;e.method.call(e.scrollable,i,t),i===e.x&&t===e.y&&h.cancelAnimationFrame(e.frame)}function o(e,t,i){var r,n,o,s=l(),e=e===u.body?(n=(r=h).scrollX||h.pageXOffset,o=h.scrollY||h.pageYOffset,a.scroll):(n=(r=e).scrollLeft,o=e.scrollTop,c);p({scrollable:r,method:e,startTime:s,startX:n,startY:o,x:t,y:i,frame:void 0})}"scrollBehavior"in u.documentElement.style||(e=h.HTMLElement||h.Element,r=468,a={scroll:h.scroll||h.scrollTo,scrollBy:h.scrollBy,scrollIntoView:e.prototype.scrollIntoView},l=h.performance&&h.performance.now?h.performance.now.bind(h.performance):Date.now,h.scroll=h.scrollTo=function(){n(arguments[0])?a.scroll.call(h,arguments[0].left||arguments[0],arguments[0].top||arguments[1]):o.call(h,u.body,~~arguments[0].left,~~arguments[0].top)},h.scrollBy=function(){n(arguments[0])?a.scrollBy.call(h,arguments[0].left||arguments[0],arguments[0].top||arguments[1]):o.call(h,u.body,~~arguments[0].left+(h.scrollX||h.pageXOffset),~~arguments[0].top+(h.scrollY||h.pageYOffset))},e.prototype.scrollIntoView=function(){var e,t,i;n(arguments[0])?a.scrollIntoView.call(this,arguments[0]||!0):(t=(e=function(e){for(;(e=e.parentNode)!==u.body&&!(e.clientHeight<e.scrollHeight||e.clientWidth<e.scrollWidth););return e}(this)).getBoundingClientRect(),i=this.getBoundingClientRect(),e!==u.body?(o.call(this,e,e.scrollLeft+i.left-t.left,e.scrollTop+i.top-t.top),h.scrollBy({left:t.left,top:t.top,behavior:"smooth"})):h.scrollBy({left:i.left,top:i.top,behavior:"smooth"}))})}"object"==typeof exports?module.exports={polyfill:e}:e()}(window,document),!function(be,Ee){var we={beforeShow:t,move:t,change:t,show:t,hide:t,color:!1,flat:!1,showInput:!1,showButtons:!0,clickoutFiresChange:!1,showInitial:!1,showPalette:!1,showPaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",preferredFormat:!1,className:"",showAlpha:!1,theme:"sp-light",palette:["fff","000"],selectionPalette:[],disabled:!1},Te=[],Pe=!!/msie/i.exec(be.navigator.userAgent),Ie=((s=document.createElement("div").style).cssText="background-color:rgba(0,0,0,.5)",e(s.backgroundColor,"rgba")||e(s.backgroundColor,"hsla")),De=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),Fe=function(){var e="";if(Pe)for(var t=1;t<=6;t++)e+="<div class='sp-"+t+"'></div>";return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",e,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button class='sp-choose'></button>","</div>","</div>","</div>"].join("")}();function e(e,t){return!!~(""+e).indexOf(t)}function xe(e,t,i){for(var r=[],n=0;n<e.length;n++){var o=Re(e[n]),s=o.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light",a=(s+=Re.equals(t,e[n])?" sp-thumb-active":"",Ie?"background-color:"+o.toRgbString():"filter:"+o.toFilter());r.push('<span title="'+o.toRgbString()+'" data-color="'+o.toRgbString()+'" class="'+s+'"><span class="sp-thumb-inner" style="'+a+';" /></span>')}return"<div class='sp-cf "+i+"'>"+r.join("")+"</div>"}function p(e,t){t=t,o=e,(t=Ee.extend({},we,t)).callbacks={move:Le(t.move,o),change:Le(t.change,o),show:Le(t.show,o),hide:Le(t.hide,o),beforeShow:Le(t.beforeShow,o)};var N,M,U,i,s=t,r=s.flat,z=s.showSelectionPalette,n=s.localStorageKey,o=s.theme,a=s.callbacks,B=(N=F,function(){var e=this,t=arguments;U&&clearTimeout(i),!U&&i||(i=setTimeout(function(){i=null,N.apply(e,t)},M))}),l=!(M=10),c=0,p=0,h=0,u=0,H=0,W=0,$=0,d=0,f=0,g=0,m=1,t=s.palette.slice(0),y=Ee.isArray(t[0])?t:[t],v=s.selectionPalette.slice(0),G=s.maxSelectionSize,q="sp-dragging",S=null,C=e.ownerDocument,k=(C.body,Ee(e)),j=!1,_=Ee(Fe,C).addClass(o),K=_.find(".sp-color"),V=_.find(".sp-dragger"),Z=_.find(".sp-hue"),Y=_.find(".sp-slider"),b=_.find(".sp-alpha-inner"),X=_.find(".sp-alpha"),Q=_.find(".sp-alpha-handle"),E=_.find(".sp-input"),J=_.find(".sp-palette"),ee=_.find(".sp-initial"),t=_.find(".sp-cancel"),e=_.find(".sp-choose"),te=k.is("input"),ie=te&&!r,w=ie?Ee(De).addClass(o).addClass(s.className):Ee([]),T=ie?w:k,re=w.find(".sp-preview-inner"),o=s.color||te&&k.val(),P=!1,ne=s.preferredFormat,I=ne,oe=!s.showButtons||s.clickoutFiresChange;function se(){s.showPaletteOnly&&(s.showPalette=!0),_.toggleClass("sp-flat",r),_.toggleClass("sp-input-disabled",!s.showInput),_.toggleClass("sp-alpha-enabled",s.showAlpha),_.toggleClass("sp-buttons-disabled",!s.showButtons),_.toggleClass("sp-palette-disabled",!s.showPalette),_.toggleClass("sp-palette-only",s.showPaletteOnly),_.toggleClass("sp-initial-disabled",!s.showInitial),_.addClass(s.className),F()}function ae(e){if(z){e=Re(e).toRgbString();if(-1===Ee.inArray(e,v))for(v.push(e);v.length>G;)v.shift();if(n&&be.localStorage)try{be.localStorage[n]=v.join(";")}catch(e){}}}function le(){var i=A(),e=Ee.map(y,function(e,t){return xe(e,i,"sp-palette-row sp-palette-row-"+t)});v&&e.push(xe(function(){var e,t=[],i=v,r={};if(s.showPalette){for(var n=0;n<y.length;n++)for(var o=0;o<y[n].length;o++)r[e=Re(y[n][o]).toRgbString()]=!0;for(n=0;n<i.length;n++)e=Re(i[n]).toRgbString(),r.hasOwnProperty(e)||(t.push(i[n]),r[e]=!0)}return t.reverse().slice(0,s.maxSelectionSize)}(),i,"sp-palette-row sp-palette-row-selection")),J.html(e.join(""))}function ce(){var e,t;s.showInitial&&(e=P,t=A(),ee.html(xe([e,t],t,"sp-palette-row-initial")))}function pe(){(p<=0||c<=0||u<=0)&&F(),_.addClass(q),S=null}function he(){_.removeClass(q)}function ue(){var e=Re(E.val());e.ok?L(e):E.addClass("sp-validation-error")}function de(){(l?x:fe)()}function fe(){var e=Ee.Event("beforeShow.spectrum");if(l)F();else if(P=A(),k.trigger(e,[P]),!1!==a.beforeShow(P)&&!e.isDefaultPrevented()){L(P);for(var t=0;t<Te.length;t++)Te[t]&&Te[t].hide();l=!0,Ee(C).bind("mousedown.spectrum",ge),r||Ee(C).bind("mouseup.spectrum",me),Ee(be).bind("resize.spectrum",B),w.addClass("sp-active"),_.removeClass("sp-hidden"),s.showPalette&&le(),F(),D(),ce(),a.show(P),k.trigger("show.spectrum",[P])}}function ge(e){var t=Ee(e.target);t.parents().is(_)||t.is(_)||x(e)}function me(e){Re.equals(A(),P)||(oe&&"cancel"!==e?ve(!0):L(P,!0))}function x(e){e&&"click"==e.type&&2==e.button||l&&!r&&(l=!1,Ee(C).unbind("mousedown.spectrum",ge),Ee(C).unbind("mouseup.spectrum",me),Ee(be).unbind("resize.spectrum",B),w.removeClass("sp-active"),_.addClass("sp-hidden"),me(e),ae(A()),a.hide(A()),k.trigger("hide.spectrum",[A()]))}function L(e,t){var i;Re.equals(e,A())||(i=(e=Re(e)).toHsv(),d=i.h%360/360,f=i.s,g=i.v,m=i.a,D(),e.ok&&!t&&(I=ne||e.format))}function A(e){return e=e||{},Re.fromRatio({h:d,s:f,v:g,a:Math.round(100*m)/100},{format:e.format||I})}function R(){D(),a.move(A()),k.trigger("move.spectrum",[A()])}function D(){E.removeClass("sp-validation-error"),ye();var e,t=Re.fromRatio({h:d,s:1,v:1}),t=(K.css("background-color",t.toHexString()),I),t=(m<1&&("hex"!==I&&"hex3"!==I&&"hex6"!==I&&"name"!==I||(t="rgb")),A({format:t})),i=t.toHexString(),r=t.toRgbString();Ie||1===t.alpha?re.css("background-color",r):(re.css("background-color","transparent"),re.css("filter",t.toFilter())),s.showAlpha&&((r=t.toRgb()).a=0,e="linear-gradient(left, "+(r=Re(r).toRgbString())+", "+i+")",Pe?b.css("filter",Re(r).toFilter({gradientType:1},i)):(b.css("background","-webkit-"+e),b.css("background","-moz-"+e),b.css("background","-ms-"+e),b.css("background",e))),s.showInput&&(r=pskl.UserSettings.get(pskl.UserSettings.COLOR_FORMAT),E.val(t.toString(r))),s.showPalette&&le(),ce()}function ye(){var e=f*c,t=p-g*p,e=Math.max(-h/2,Math.min(c-h/2,e-h/2)),t=Math.max(-h/2,Math.min(p-h/2,t-h/2)),t=(V.css({top:t,left:e}),m*H),e=(Q.css({left:t-W/2}),d*u);Y.css({top:e-$/2})}function ve(e){var t=A(),i=(te&&k.val(t.toString(I)),!Re.equals(t,P));P=t,e&&i&&(a.change(t),k.trigger("change",[t]))}function F(){c=K.width(),p=K.height(),h=V.height()+4,Z.width(),u=Z.height(),$=Y.height()+4,H=X.width(),W=Q.width(),r||(_.css("position","absolute"),_.offset(function(e,t){var i=e.outerWidth(),r=e.outerHeight(),n=t.outerHeight(),o=e[0].ownerDocument,s=o.documentElement,a=s.clientWidth+Ee(o).scrollLeft(),s=s.clientHeight+Ee(o).scrollTop(),o=t.offset();o.top+=n,Math.min(o.left,o.left+i>a&&i<a)?(o.left-=Math.abs(o.left+i-a),e.attr("data-x-position","right")):(o.left-=0,e.attr("data-x-position","left"));Math.min(o.top,o.top+r>s&&r<s)?(o.top-=Math.abs(+(r+n)),e.attr("data-y-position","top")):(o.top-=0,e.attr("data-y-position","bottom"));return o}(_,T))),ye()}function Se(){x(),j=!0,k.attr("disabled",!0),T.addClass("sp-disabled")}if(Pe&&_.find("*:not(input)").attr("unselectable","on"),se(),ie&&k.after(w).hide(),r?k.after(_).hide():(O=1!==(O="parent"===s.appendTo?k.parent():Ee(s.appendTo)).length?Ee("body"):O).append(_),n&&be.localStorage){try{var Ce=be.localStorage[n].split(",#");1<Ce.length&&(delete be.localStorage[n],Ee.each(Ce,function(e,t){ae(t)}))}catch(e){}try{v=be.localStorage[n].split(";")}catch(e){}}function ke(e){return(e.data&&e.data.ignore?(L(Ee(this).data("color")),R):(L(Ee(this).data("color")),ve(!0),R(),x))(),!1}T.bind("click.spectrum touchstart.spectrum",function(e){j||de(),e.stopPropagation(),Ee(e.target).is("input")||e.preventDefault()}),!k.is(":disabled")&&!0!==s.disabled||Se(),_.click(Oe),E.change(ue),E.bind("paste",function(){setTimeout(ue,1)}),E.keydown(function(e){13==e.keyCode&&ue()}),t.text(s.cancelText),t.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),x("cancel")}),e.text(s.chooseText),e.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),E.hasClass("sp-validation-error")||(ve(!0),x())}),Ae(X,function(e,t,i){m=e/H,i.shiftKey&&(m=Math.round(10*m)/10),R()}),Ae(Z,function(e,t){d=parseFloat(t/u),R()},pe,he),Ae(K,function(e,t,i){i.shiftKey?S||(i=f*c,r=p-g*p,i=Math.abs(e-i)>Math.abs(t-r),S=i?"x":"y"):S=null;var r=!S||"x"===S,i=!S||"y"===S;r&&(f=parseFloat(e/c)),i&&(g=parseFloat((p-t)/p)),R()},pe,he),o?(L(o),D(),I=ne||Re(o).format,ae(o)):D(),r&&fe();var O=Pe?"mousedown.spectrum":"click.spectrum touchstart.spectrum",_e=(J.delegate(".sp-thumb-el",O,ke),ee.delegate(".sp-thumb-el:nth-child(1)",O,{ignore:!0},ke),{show:fe,hide:x,toggle:de,reflow:F,option:function(e,t){return void 0===e?Ee.extend({},s):void 0===t?s[e]:(s[e]=t,void se())},enable:function(){j=!1,k.attr("disabled",!1),T.removeClass("sp-disabled")},disable:Se,set:function(e){L(e),ve()},get:A,destroy:function(){k.show(),T.unbind("click.spectrum touchstart.spectrum"),_.remove(),w.remove(),Te[_e.id]=null},container:_});return _e.id=Te.push(_e)-1,_e}function t(){}function Oe(e){e.stopPropagation()}function Le(e,t){var i=Array.prototype.slice,r=i.call(arguments,2);return function(){return e.apply(t,r.concat(i.call(arguments)))}}function Ae(r,n,i,e){n=n||function(){},i=i||function(){},e=e||function(){};var o=r.ownerDocument||document,s=!1,a={},l=0,c=0,p="ontouchstart"in be,h={};function u(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1}function d(e){if(s){if(Pe&&document.documentMode<9&&!e.button)return f();var t=e.originalEvent.touches,i=(t?t[0]:e).pageX,t=(t?t[0]:e).pageY,i=Math.max(0,Math.min(i-a.left,c)),t=Math.max(0,Math.min(t-a.top,l));p&&u(e),n.apply(r,[i,t,e])}}function f(){s&&(Ee(o).unbind(h),Ee(o.body).removeClass("sp-dragging"),e.apply(r,arguments)),s=!1}h.selectstart=u,h.dragstart=u,h["touchmove mousemove"]=d,h["touchend mouseup"]=f,Ee(r).bind("touchstart mousedown",function(e){var t=e.which?3==e.which:2==e.button;e.originalEvent.touches,t||s||!1!==i.apply(r,arguments)&&(s=!0,l=Ee(r).height(),c=Ee(r).width(),a=Ee(r).offset(),Ee(o).bind(h),Ee(o.body).addClass("sp-dragging"),p||d(e),u(e))})}var o,h,i,u,n,d,f,r,g,m,s,a,y,l="spectrum.id";function v(e,s){var a,l,c,p,r,t;return s=s||{},"object"==typeof(e=e||"")&&e.hasOwnProperty("_tc_id")?e:(e=function(e){var t={r:0,g:0,b:0},i=1,r=!1,n=!1;"string"==typeof e&&(e=function(e){e=e.replace(o,"").replace(h,"").toLowerCase();var t,i=!1;if(g[e])e=g[e],i=!0;else if("transparent"==e)return{r:0,g:0,b:0,a:0,format:"name"};if(t=y.rgb.exec(e))return{r:t[1],g:t[2],b:t[3]};if(t=y.rgba.exec(e))return{r:t[1],g:t[2],b:t[3],a:t[4]};if(t=y.hsl.exec(e))return{h:t[1],s:t[2],l:t[3]};if(t=y.hsla.exec(e))return{h:t[1],s:t[2],l:t[3],a:t[4]};if(t=y.hsv.exec(e))return{h:t[1],s:t[2],v:t[3]};if(t=y.hex6.exec(e))return{r:E(t[1]),g:E(t[2]),b:E(t[3]),format:i?"name":"hex"};if(t=y.hex3.exec(e))return{r:E(t[1]+""+t[1]),g:E(t[2]+""+t[2]),b:E(t[3]+""+t[3]),format:i?"name":"hex"};return!1}(e));"object"==typeof e&&(e.hasOwnProperty("r")&&e.hasOwnProperty("g")&&e.hasOwnProperty("b")?(t=function(e,t,i){return{r:255*b(e,255),g:255*b(t,255),b:255*b(i,255)}}(e.r,e.g,e.b),r=!0,n="%"===String(e.r).substr(-1)?"prgb":"rgb"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("v")?(e.s=T(e.s),e.v=T(e.v),t=function(e,t,i){e=6*b(e,360),t=b(t,100),i=b(i,100);var r=u.floor(e),e=e-r,n=i*(1-t),o=i*(1-e*t),e=i*(1-(1-e)*t),t=r%6;return{r:255*[i,o,n,n,e,i][t],g:255*[e,i,i,o,n,n][t],b:255*[n,n,e,i,i,o][t]}}(e.h,e.s,e.v),r=!0,n="hsv"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("l")&&(e.s=T(e.s),e.l=T(e.l),t=function(e,t,i){var r,n,o;function s(e,t,i){return i<0&&(i+=1),1<i&&--i,i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}e=b(e,360),t=b(t,100),i=b(i,100),0===t?r=n=o=i:(r=s(t=2*i-(i=i<.5?i*(1+t):i+t-i*t),i,e+1/3),n=s(t,i,e),o=s(t,i,e-1/3));return{r:255*r,g:255*n,b:255*o}}(e.h,e.s,e.l),r=!0,n="hsl"),e.hasOwnProperty("a"))&&(i=e.a);return i=_(i),{ok:r,format:e.format||n,r:d(255,f(t.r,0)),g:d(255,f(t.g,0)),b:d(255,f(t.b,0)),a:i}}(e),a=e.r,l=e.g,c=e.b,p=e.a,r=n(100*p)/100,t=s.format||e.format,a<1&&(a=n(a)),l<1&&(l=n(l)),c<1&&(c=n(c)),{ok:e.ok,format:t,_tc_id:i++,alpha:p,getAlpha:function(){return p},setAlpha:function(e){p=_(e),r=n(100*p)/100},toHsv:function(){var e=C(a,l,c);return{h:360*e.h,s:e.s,v:e.v,a:p}},toHsvString:function(){var e=C(a,l,c),t=n(360*e.h),i=n(100*e.s),e=n(100*e.v);return 1==p?"hsv("+t+", "+i+"%, "+e+"%)":"hsva("+t+", "+i+"%, "+e+"%, "+r+")"},toHsl:function(){var e=S(a,l,c);return{h:360*e.h,s:e.s,l:e.l,a:p}},toHslString:function(){var e=S(a,l,c),t=n(360*e.h),i=n(100*e.s),e=n(100*e.l);return 1==p?"hsl("+t+", "+i+"%, "+e+"%)":"hsla("+t+", "+i+"%, "+e+"%, "+r+")"},toHex:function(e){return k(a,l,c,e)},toHexString:function(e){return"#"+k(a,l,c,e)},toRgb:function(){return{r:n(a),g:n(l),b:n(c),a:p}},toRgbString:function(){return 1==p?"rgb("+n(a)+", "+n(l)+", "+n(c)+")":"rgba("+n(a)+", "+n(l)+", "+n(c)+", "+r+")"},toPercentageRgb:function(){return{r:n(100*b(a,255))+"%",g:n(100*b(l,255))+"%",b:n(100*b(c,255))+"%",a:p}},toPercentageRgbString:function(){return 1==p?"rgb("+n(100*b(a,255))+"%, "+n(100*b(l,255))+"%, "+n(100*b(c,255))+"%)":"rgba("+n(100*b(a,255))+"%, "+n(100*b(l,255))+"%, "+n(100*b(c,255))+"%, "+r+")"},toName:function(){return 0===p?"transparent":m[k(a,l,c,!0)]||!1},toFilter:function(e){var t=k(a,l,c),i=t,r=Math.round(255*parseFloat(p)).toString(16),n=r,o=s&&s.gradientType?"GradientType = 1, ":"";return e&&(i=(e=v(e)).toHex(),n=Math.round(255*parseFloat(e.alpha)).toString(16)),"progid:DXImageTransform.Microsoft.gradient("+o+"startColorstr=#"+w(r)+t+",endColorstr=#"+w(n)+i+")"},toString:function(e){var t=!!e,i=(e=e||this.format,!1),t=!t&&p<1&&0<p&&("hex"===e||"hex6"===e||"hex3"===e||"name"===e);return"rgb"===e&&(i=this.toRgbString()),"prgb"===e&&(i=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(i=this.toHexString()),"hex3"===e&&(i=this.toHexString(!0)),"name"===e&&(i=this.toName()),"hsl"===e&&(i=this.toHslString()),"hsv"===e&&(i=this.toHsvString()),t?this.toRgbString():i||this.toHexString()}})}function S(e,t,i){e=b(e,255),t=b(t,255),i=b(i,255);var r,n=f(e,t,i),o=d(e,t,i),s=(n+o)/2;if(n==o)r=l=0;else{var a=n-o,l=.5<s?a/(2-n-o):a/(n+o);switch(n){case e:r=(t-i)/a+(t<i?6:0);break;case t:r=(i-e)/a+2;break;case i:r=(e-t)/a+4}r/=6}return{h:r,s:l,l:s}}function C(e,t,i){e=b(e,255),t=b(t,255),i=b(i,255);var r,n=f(e,t,i),o=d(e,t,i),s=n,a=n-o,l=0===n?0:a/n;if(n==o)r=0;else{switch(n){case e:r=(t-i)/a+(t<i?6:0);break;case t:r=(i-e)/a+2;break;case i:r=(e-t)/a+4}r/=6}return{h:r,s:l,v:s}}function k(e,t,i,r){e=[w(n(e).toString(16)),w(n(t).toString(16)),w(n(i).toString(16))];return r&&e[0].charAt(0)==e[0].charAt(1)&&e[1].charAt(0)==e[1].charAt(1)&&e[2].charAt(0)==e[2].charAt(1)?e[0].charAt(0)+e[1].charAt(0)+e[2].charAt(0):e.join("")}function _(e){return e=parseFloat(e),e=isNaN(e)||e<0||1<e?1:e}function b(e,t){"string"==typeof(i=e)&&-1!=i.indexOf(".")&&1===parseFloat(i)&&(e="100%");var i="string"==typeof(i=e)&&-1!=i.indexOf("%");return e=d(t,f(0,parseFloat(e))),i&&(e=parseInt(e*t,10)/100),u.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function c(e){return d(1,f(0,e))}function E(e){return parseInt(e,16)}function w(e){return 1==e.length?"0"+e:""+e}function T(e){return e=e<=1?100*e+"%":e}Ee.fn.spectrum=function(i,e){var r,n;return"string"==typeof i?(r=this,n=Array.prototype.slice.call(arguments,1),this.each(function(){var e=Te[Ee(this).data(l)];if(e){var t=e[i];if(!t)throw new Error("Spectrum: no such method: '"+i+"'");"get"==i?r=e.get():"container"==i?r=e.container:"option"==i?r=e.option.apply(e,n):"destroy"==i?(e.destroy(),Ee(this).removeData(l)):t.apply(e,n)}}),r):this.spectrum("destroy").each(function(){var e=p(this,i);Ee(this).data(l,e.id)})},Ee.fn.spectrum.load=!0,Ee.fn.spectrum.loadOpts={},Ee.fn.spectrum.draggable=Ae,Ee.fn.spectrum.defaults=we,Ee.spectrum={},Ee.spectrum.localization={},Ee.spectrum.palettes={},Ee.fn.spectrum.processNativeColorInputs=function(){var e=Ee("<input type='color' value='!' />")[0];"color"===e.type&&"!"!=e.value||Ee("input[type=color]").spectrum({preferredFormat:"hex6"})},o=/^[\s,#]+/,h=/\s+$/,i=0,u=Math,n=u.round,d=u.min,f=u.max,r=u.random,v.fromRatio=function(e,t){if("object"==typeof e){var i,r={};for(i in e)e.hasOwnProperty(i)&&(r[i]="a"===i?e[i]:T(e[i]));e=r}return v(e,t)},v.equals=function(e,t){return!(!e||!t)&&v(e).toRgbString()==v(t).toRgbString()},v.random=function(){return v.fromRatio({r:r(),g:r(),b:r()})},v.desaturate=function(e,t){t=0===t?0:t||10;e=v(e).toHsl();return e.s-=t/100,e.s=c(e.s),v(e)},v.saturate=function(e,t){t=0===t?0:t||10;e=v(e).toHsl();return e.s+=t/100,e.s=c(e.s),v(e)},v.greyscale=function(e){return v.desaturate(e,100)},v.lighten=function(e,t){t=0===t?0:t||10;e=v(e).toHsl();return e.l+=t/100,e.l=c(e.l),v(e)},v.darken=function(e,t){t=0===t?0:t||10;e=v(e).toHsl();return e.l-=t/100,e.l=c(e.l),v(e)},v.complement=function(e){e=v(e).toHsl();return e.h=(e.h+180)%360,v(e)},v.triad=function(e){var t=v(e).toHsl(),i=t.h;return[v(e),v({h:(i+120)%360,s:t.s,l:t.l}),v({h:(i+240)%360,s:t.s,l:t.l})]},v.tetrad=function(e){var t=v(e).toHsl(),i=t.h;return[v(e),v({h:(i+90)%360,s:t.s,l:t.l}),v({h:(i+180)%360,s:t.s,l:t.l}),v({h:(i+270)%360,s:t.s,l:t.l})]},v.splitcomplement=function(e){var t=v(e).toHsl(),i=t.h;return[v(e),v({h:(i+72)%360,s:t.s,l:t.l}),v({h:(i+216)%360,s:t.s,l:t.l})]},v.analogous=function(e,t,i){t=t||6,i=i||30;var r=v(e).toHsl(),n=360/i,o=[v(e)];for(r.h=(r.h-(n*t>>1)+720)%360;--t;)r.h=(r.h+n)%360,o.push(v(r));return o},v.monochromatic=function(e,t){t=t||6;for(var e=v(e).toHsv(),i=e.h,r=e.s,n=e.v,o=[],s=1/t;t--;)o.push(v({h:i,s:r,v:n})),n=(n+s)%1;return o},v.readability=function(e,t){var e=v(e).toRgb(),t=v(t).toRgb(),i=(299*e.r+587*e.g+114*e.b)/1e3,r=(299*t.r+587*t.g+114*t.b)/1e3,e=Math.max(e.r,t.r)-Math.min(e.r,t.r)+Math.max(e.g,t.g)-Math.min(e.g,t.g)+Math.max(e.b,t.b)-Math.min(e.b,t.b);return{brightness:Math.abs(i-r),color:e}},v.readable=function(e,t){e=v.readability(e,t);return 125<e.brightness&&500<e.color},v.mostReadable=function(e,t){for(var i=null,r=0,n=!1,o=0;o<t.length;o++){var s=v.readability(e,t[o]),a=125<s.brightness&&500<s.color,s=s.brightness/125*3+s.color/500;(a&&!n||a&&n&&r<s||!a&&!n&&r<s)&&(n=a,r=s,i=v(t[o]))}return i},g=v.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},m=v.hexNames=function(e){var t,i={};for(t in e)e.hasOwnProperty(t)&&(i[e[t]]=t);return i}(g),a="[\\s|\\(]+("+(s="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+s+")[,|\\s]+("+s+")\\s*\\)?",s="[\\s|\\(]+("+s+")[,|\\s]+("+s+")[,|\\s]+("+s+")[,|\\s]+("+s+")\\s*\\)?",y={rgb:new RegExp("rgb"+a),rgba:new RegExp("rgba"+s),hsl:new RegExp("hsl"+a),hsla:new RegExp("hsla"+s),hsv:new RegExp("hsv"+a),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/},be.tinycolor=v;var Re=be.tinycolor;Ee(function(){Ee.fn.spectrum.load&&Ee.fn.spectrum.processNativeColorInputs()})}(window,jQuery),!function(e){"use strict";if("function"==typeof bootstrap)bootstrap("promise",e);else if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else if("undefined"!=typeof ses)ses.ok()&&(ses.makeQ=e);else{if("undefined"==typeof self)throw new Error("This environment was not anticipated by Q. Please file a bug.");self.Q=e()}}(function(){"use strict";var a=!1;try{throw new Error}catch(e){a=!!e.stack}function t(){}var o,e,i,r,n,s,l,c,p,N=k();s=n={task:void 0,next:null},c=void 0,p=l=!1,e=function(e){s=s.next={task:e,domain:p&&process.domain,next:null},l||(l=!0,c())},c="undefined"!=typeof process&&process.nextTick?(p=!0,function(){process.nextTick(h)}):"function"==typeof setImmediate?"undefined"!=typeof window?setImmediate.bind(window,h):function(){setImmediate(h)}:"undefined"!=typeof MessageChannel?((i=new MessageChannel).port1.onmessage=function(){c=r,(i.port1.onmessage=h)()},r=function(){i.port2.postMessage(0)},function(){setTimeout(h,0),r()}):function(){setTimeout(h,0)};function h(){for(;n.next;){var e=(n=n.next).task,t=(n.task=void 0,n.domain);t&&(n.domain=void 0,t.enter());try{e()}catch(e){if(p)throw t&&t.exit(),setTimeout(h,0),t&&t.enter(),e;setTimeout(function(){throw e},0)}t&&t.exit()}l=!1}var M=Function.call;function u(e){return function(){return M.apply(e,arguments)}}var d=u(Array.prototype.slice),f=u(Array.prototype.reduce||function(e,t){var i=0,r=this.length;if(1===arguments.length)for(;;){if(i in this){t=this[i++];break}if(++i>=r)throw new TypeError}for(;i<r;i++)i in this&&(t=e(t,this[i],i));return t}),U=u(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),g=u(Array.prototype.map||function(r,n){var o=this,s=[];return f(o,function(e,t,i){s.push(r.call(n,t,i,o))},void 0),s}),m=Object.create||function(e){function t(){}return t.prototype=e,new t},z=u(Object.prototype.hasOwnProperty),B=Object.keys||function(e){var t,i=[];for(t in e)z(e,t)&&i.push(t);return i},H=u(Object.prototype.toString);var y="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e},v="From previous event:";function S(e,t){if(a&&t.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf(v)){for(var i=[],r=t;r;r=r.source)r.stack&&i.unshift(r.stack);i.unshift(e.stack);t=i.join("\n"+v+"\n");e.stack=function(e){for(var t=e.split("\n"),i=[],r=0;r<t.length;++r){var n=t[r];!function(e){var t,e=C(e);return e&&(t=e[0],e=e[1],t===o)&&N<=e&&e<=X}(n)&&!function(e){return-1!==e.indexOf("(module.js:")||-1!==e.indexOf("(node.js:")}(n)&&n&&i.push(n)}return i.join("\n")}(t)}}function C(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);return(t=t||/at ([^ ]+):(\d+):(?:\d+)$/.exec(e))?[t[1],Number(t[2])]:(t=/.*@(.+):(\d+)$/.exec(e))?[t[1],Number(t[2])]:void 0}function k(){if(a)try{throw new Error}catch(e){var t=e.stack.split("\n"),t=C(0<t[0].indexOf("@")?t[1]:t[2]);if(t)return o=t[0],t[1]}}function _(e){return e instanceof w?e:G(e)?(t=e,i=b(),_.nextTick(function(){try{t.then(i.resolve,i.reject,i.notify)}catch(e){i.reject(e)}}),i.promise):F(e);var t,i}function b(){var n,o=[],s=[],e=m(b.prototype),t=m(w.prototype);if(t.promiseDispatch=function(e,t,i){var r=d(arguments);o?(o.push(r),"when"===t&&i[1]&&s.push(i[1])):_.nextTick(function(){n.promiseDispatch.apply(n,r)})},t.valueOf=function(){var e;return o?t:(P(e=$(n))&&(n=e),e)},t.inspect=function(){return n?n.inspect():{state:"pending"}},_.longStackSupport&&a)try{throw new Error}catch(e){t.stack=e.stack.substring(e.stack.indexOf("\n")+1)}function i(i){n=i,t.source=i,f(o,function(e,t){_.nextTick(function(){i.promiseDispatch.apply(i,t)})},void 0),s=o=void 0}return e.promise=t,e.resolve=function(e){n||i(_(e))},e.fulfill=function(e){n||i(F(e))},e.reject=function(e){n||i(D(e))},e.notify=function(i){n||f(s,function(e,t){_.nextTick(function(){t(i)})},void 0)},e}function E(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var t=b();try{e(t.resolve,t.reject,t.notify)}catch(e){t.reject(e)}return t.promise}function W(n){return E(function(e,t){for(var i=0,r=n.length;i<r;i++)_(n[i]).then(e,t)})}function w(n,o,t){void 0===o&&(o=function(e){return D(new Error("Promise does not support operation: "+e))}),void 0===t&&(t=function(){return{state:"unknown"}});var e,s=m(w.prototype);return s.promiseDispatch=function(e,t,i){var r;try{r=n[t]?n[t].apply(s,i):o.call(s,t,i)}catch(e){r=D(e)}e&&e(r)},(s.inspect=t)&&("rejected"===(e=t()).state&&(s.exception=e.reason),s.valueOf=function(){var e=t();return"pending"===e.state||"rejected"===e.state?s:e.value}),s}function T(e,t,i,r){return _(e).then(t,i,r)}function $(e){if(P(e)){var t=e.inspect();if("fulfilled"===t.state)return t.value}return e}function P(e){return e instanceof w}function G(e){return e===Object(e)&&"function"==typeof e.then}(_.resolve=_).nextTick=e,_.longStackSupport=!1,"object"==typeof process&&process&&process.env&&process.env.Q_DEBUG&&(_.longStackSupport=!0),(_.defer=b).prototype.makeNodeResolver=function(){var i=this;return function(e,t){e?i.reject(e):2<arguments.length?i.resolve(d(arguments,1)):i.resolve(t)}},_.Promise=E,(_.promise=E).race=W,E.all=O,E.reject=D,(E.resolve=_).passByCopy=function(e){return e},w.prototype.passByCopy=function(){return this},_.join=function(e,t){return _(e).join(t)},w.prototype.join=function(e){return _([this,e]).spread(function(e,t){if(e===t)return e;throw new Error("Can't join: not the same: "+e+" "+t)})},_.race=W,w.prototype.race=function(){return this.then(_.race)},(_.makePromise=w).prototype.toString=function(){return"[object Promise]"},w.prototype.then=function(t,i,n){var r=this,o=b(),s=!1;return _.nextTick(function(){r.promiseDispatch(function(e){s||(s=!0,o.resolve(function(e){try{return"function"==typeof t?t(e):e}catch(e){return D(e)}}(e)))},"when",[function(e){s||(s=!0,o.resolve(function(e){if("function"==typeof i){S(e,r);try{return i(e)}catch(e){return D(e)}}return D(e)}(e)))}])}),r.promiseDispatch(void 0,"when",[void 0,function(e){var t,i,r=!1;try{i=e,t="function"==typeof n?n(i):i}catch(e){if(r=!0,!_.onerror)throw e;_.onerror(e)}r||o.notify(t)}]),o.promise},_.tap=function(e,t){return _(e).tap(t)},w.prototype.tap=function(t){return t=_(t),this.then(function(e){return t.fcall(e).thenResolve(e)})},_.when=T,w.prototype.thenResolve=function(e){return this.then(function(){return e})},_.thenResolve=function(e,t){return _(e).thenResolve(t)},w.prototype.thenReject=function(e){return this.then(function(){throw e})},_.thenReject=function(e,t){return _(e).thenReject(t)},_.nearer=$,_.isPromise=P,_.isPromiseAlike=G,_.isPending=function(e){return P(e)&&"pending"===e.inspect().state},w.prototype.isPending=function(){return"pending"===this.inspect().state},_.isFulfilled=function(e){return!P(e)||"fulfilled"===e.inspect().state},w.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},_.isRejected=function(e){return P(e)&&"rejected"===e.inspect().state},w.prototype.isRejected=function(){return"rejected"===this.inspect().state};var I,q,j,x=[],L=[],A=!0;function R(){x.length=0,L.length=0,A=A||!0}function D(i){var e,t,r=w({when:function(e){var t;return e&&(t=this,A)&&-1!==(t=U(L,t))&&(L.splice(t,1),x.splice(t,1)),e?e(i):this}},function(){return this},function(){return{state:"rejected",reason:i}});return e=r,t=i,A&&(L.push(e),t&&void 0!==t.stack?x.push(t.stack):x.push("(no stack) "+t)),r}function F(i){return w({when:function(){return i},get:function(e){return i[e]},set:function(e,t){i[e]=t},delete:function(e){delete i[e]},post:function(e,t){return null==e?i.apply(void 0,t):i[e].apply(i,t)},apply:function(e,t){return i.apply(e,t)},keys:function(){return B(i)}},void 0,function(){return{state:"fulfilled",value:i}})}function K(e,t,i){return _(e).spread(t,i)}function V(e,t,i){return _(e).dispatch(t,i)}function O(e){return T(e,function(n){var o=0,s=b();return f(n,function(e,t,i){var r;P(t)&&"fulfilled"===(r=t.inspect()).state?n[i]=r.value:(++o,T(t,function(e){n[i]=e,0==--o&&s.resolve(n)},s.reject,function(e){s.notify({index:i,value:e})}))},void 0),0===o&&s.resolve(n),s.promise})}function Z(n){var o,s;return 0===n.length?_.resolve():(o=_.defer(),f(n,function(e,t,i){var r=n[i];s++,T(r,function(e){o.resolve(e)},function(){0==--s&&o.reject(new Error("Can't get fulfillment value from any promise, all promises were rejected."))},function(e){o.notify({index:i,value:e})})},void(s=0)),o.promise)}function Y(e){return T(e,function(e){return e=g(e,_),T(O(g(e,function(e){return T(e,t,t)})),function(){return e})})}_.resetUnhandledRejections=R,_.getUnhandledReasons=function(){return x.slice()},_.stopUnhandledRejectionTracking=function(){R(),A=!1},R(),_.reject=D,_.fulfill=F,_.master=function(i){return w({isDef:function(){}},function(e,t){return V(i,e,t)},function(){return _(i).inspect()})},_.spread=K,w.prototype.spread=function(t,e){return this.all().then(function(e){return t.apply(void 0,e)},e)},_.async=function(t){return function(){function e(t,e){var i;if("undefined"==typeof StopIteration){try{i=r[t](e)}catch(e){return D(e)}return i.done?_(i.value):T(i.value,n,o)}try{i=r[t](e)}catch(e){return"[object StopIteration]"===H(t=e)||t instanceof y?_(e.value):D(e)}return T(i,n,o)}var r=t.apply(this,arguments),n=e.bind(e,"next"),o=e.bind(e,"throw");return n()}},_.spawn=function(e){_.done(_.async(e)())},_.return=function(e){throw new y(e)},_.promised=function(i){return function(){return K([this,O(arguments)],function(e,t){return i.apply(e,t)})}},_.dispatch=V,w.prototype.dispatch=function(e,t){var i=this,r=b();return _.nextTick(function(){i.promiseDispatch(r.resolve,e,t)}),r.promise},_.get=function(e,t){return _(e).dispatch("get",[t])},w.prototype.get=function(e){return this.dispatch("get",[e])},_.set=function(e,t,i){return _(e).dispatch("set",[t,i])},w.prototype.set=function(e,t){return this.dispatch("set",[e,t])},_.del=_.delete=function(e,t){return _(e).dispatch("delete",[t])},w.prototype.del=w.prototype.delete=function(e){return this.dispatch("delete",[e])},_.mapply=_.post=function(e,t,i){return _(e).dispatch("post",[t,i])},w.prototype.mapply=w.prototype.post=function(e,t){return this.dispatch("post",[e,t])},_.send=_.mcall=_.invoke=function(e,t){return _(e).dispatch("post",[t,d(arguments,2)])},w.prototype.send=w.prototype.mcall=w.prototype.invoke=function(e){return this.dispatch("post",[e,d(arguments,1)])},_.fapply=function(e,t){return _(e).dispatch("apply",[void 0,t])},w.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},_.try=_.fcall=function(e){return _(e).dispatch("apply",[void 0,d(arguments,1)])},w.prototype.fcall=function(){return this.dispatch("apply",[void 0,d(arguments)])},_.fbind=function(e){var t=_(e),i=d(arguments,1);return function(){return t.dispatch("apply",[this,i.concat(d(arguments))])}},w.prototype.fbind=function(){var e=this,t=d(arguments);return function(){return e.dispatch("apply",[this,t.concat(d(arguments))])}},_.keys=function(e){return _(e).dispatch("keys",[])},w.prototype.keys=function(){return this.dispatch("keys",[])},_.all=O,w.prototype.all=function(){return O(this)},_.any=Z,w.prototype.any=function(){return Z(this)},_.allResolved=(I=Y,q="allResolved",j="allSettled",function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(q+" is deprecated, use "+j+" instead.",new Error("").stack),I.apply(I,arguments)}),w.prototype.allResolved=function(){return Y(this)},_.allSettled=function(e){return _(e).allSettled()},w.prototype.allSettled=function(){return this.then(function(e){return O(g(e,function(e){function t(){return e.inspect()}return(e=_(e)).then(t,t)}))})},_.fail=_.catch=function(e,t){return _(e).then(void 0,t)},w.prototype.fail=w.prototype.catch=function(e){return this.then(void 0,e)},_.progress=function(e,t){return _(e).then(void 0,void 0,t)},w.prototype.progress=function(e){return this.then(void 0,void 0,e)},_.fin=_.finally=function(e,t){return _(e).finally(t)},w.prototype.fin=w.prototype.finally=function(t){return t=_(t),this.then(function(e){return t.fcall().then(function(){return e})},function(e){return t.fcall().then(function(){throw e})})},_.done=function(e,t,i,r){return _(e).done(t,i,r)},w.prototype.done=function(e,t,i){var r=function(e){_.nextTick(function(){if(S(e,n),!_.onerror)throw e;_.onerror(e)})},n=e||t||i?this.then(e,t,i):this;"object"==typeof process&&process&&process.domain&&(r=process.domain.bind(r)),n.then(void 0,r)},_.timeout=function(e,t,i){return _(e).timeout(t,i)},w.prototype.timeout=function(e,t){var i=b(),r=setTimeout(function(){t&&"string"!=typeof t||((t=new Error(t||"Timed out after "+e+" ms")).code="ETIMEDOUT"),i.reject(t)},e);return this.then(function(e){clearTimeout(r),i.resolve(e)},function(e){clearTimeout(r),i.reject(e)},i.notify),i.promise},_.delay=function(e,t){return void 0===t&&(t=e,e=void 0),_(e).delay(t)},w.prototype.delay=function(i){return this.then(function(e){var t=b();return setTimeout(function(){t.resolve(e)},i),t.promise})},_.nfapply=function(e,t){return _(e).nfapply(t)},w.prototype.nfapply=function(e){var t=b(),e=d(e);return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},_.nfcall=function(e){var t=d(arguments,1);return _(e).nfapply(t)},w.prototype.nfcall=function(){var e=d(arguments),t=b();return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},_.nfbind=_.denodeify=function(i){var r=d(arguments,1);return function(){var e=r.concat(d(arguments)),t=b();return e.push(t.makeNodeResolver()),_(i).fapply(e).fail(t.reject),t.promise}},w.prototype.nfbind=w.prototype.denodeify=function(){var e=d(arguments);return e.unshift(this),_.denodeify.apply(void 0,e)},_.nbind=function(i,r){var n=d(arguments,2);return function(){var e=n.concat(d(arguments)),t=b();return e.push(t.makeNodeResolver()),_(function(){return i.apply(r,arguments)}).fapply(e).fail(t.reject),t.promise}},w.prototype.nbind=function(){var e=d(arguments,0);return e.unshift(this),_.nbind.apply(void 0,e)},_.nmapply=_.npost=function(e,t,i){return _(e).npost(t,i)},w.prototype.nmapply=w.prototype.npost=function(e,t){var t=d(t||[]),i=b();return t.push(i.makeNodeResolver()),this.dispatch("post",[e,t]).fail(i.reject),i.promise},_.nsend=_.nmcall=_.ninvoke=function(e,t){var i=d(arguments,2),r=b();return i.push(r.makeNodeResolver()),_(e).dispatch("post",[t,i]).fail(r.reject),r.promise},w.prototype.nsend=w.prototype.nmcall=w.prototype.ninvoke=function(e){var t=d(arguments,1),i=b();return t.push(i.makeNodeResolver()),this.dispatch("post",[e,t]).fail(i.reject),i.promise},_.nodeify=function(e,t){return _(e).nodeify(t)},w.prototype.nodeify=function(t){if(!t)return this;this.then(function(e){_.nextTick(function(){t(null,e)})},function(e){_.nextTick(function(){t(e)})})};var X=k();return _}),!function(){var e=$.namespace("pskl.rendering");e.DrawingLoop=function(){this.requestAnimationFrame=this.getRequestAnimationFrameShim_(),this.isRunning=!1,this.previousTime=0,this.callbacks=[],this.loop_=this.loop_.bind(this)},e.DrawingLoop.prototype.addCallback=function(e,t,i){e={fn:e,scope:t,args:i};return this.callbacks.push(e),e},e.DrawingLoop.prototype.removeCallback=function(e){e=this.callbacks.indexOf(e);-1!=e&&this.callbacks.splice(e,1)},e.DrawingLoop.prototype.start=function(){this.isRunning=!0,this.loop_()},e.DrawingLoop.prototype.loop_=function(){var e=Date.now(),t=e-this.previousTime;this.executeCallbacks_(t),this.previousTime=e,this.requestAnimationFrame.call(window,this.loop_)},e.DrawingLoop.prototype.executeCallbacks_=function(e){for(var t=0;t<this.callbacks.length;t++){var i=this.callbacks[t];i.fn.call(i.scope,e,i.args)}},e.DrawingLoop.prototype.stop=function(){this.isRunning=!1},e.DrawingLoop.prototype.getRequestAnimationFrameShim_=function(){return window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}}(),!function(){var i=$.namespace("pskl.model"),r=0,n=(i.Frame=function(e,t){if(!e||!t)throw"Bad arguments in pskl.model.Frame constructor : "+e+", "+t;this.width=e,this.height=t,this.id=r++,this.version=0,this.pixels=i.Frame.createEmptyPixelGrid_(e,t),this.stateIndex=0},i.Frame.fromPixelGrid=function(e,t,i){if(e.length){if(e[0].length)for(var r=e.length,n=e[0].length,o=[],s=0;s<n;s++)for(var a=0;a<r;a++)"string"==typeof e[a][s]?o[s*r+a]=pskl.utils.colorToInt(e[a][s]):o[s*r+a]=e[a][s];else{if(!t||!i)throw"Bad arguments in pskl.model.frame.fromPixelGrid, missing width and height";r=t,n=i,o=e}t=new pskl.model.Frame(r,n);return t.setPixels(o),t}throw"Bad arguments in pskl.model.Frame.fromPixelGrid"},{});i.Frame.createEmptyPixelGrid_=function(e,t){var i,r=e+"-"+t;return n[r]?i=n[r]:(i=n[r]=new Uint32Array(e*t),r=pskl.utils.colorToInt(Constants.TRANSPARENT_COLOR),i.fill(r)),new Uint32Array(i)},i.Frame.createEmptyFromFrame=function(e){return new i.Frame(e.getWidth(),e.getHeight())},i.Frame.prototype.clone=function(){var e=new i.Frame(this.width,this.height);return e.setPixels(this.pixels),e},i.Frame.prototype.getPixels=function(){return this.clonePixels_(this.pixels)},i.Frame.prototype.setPixels=function(e){this.pixels=this.clonePixels_(e),this.version++},i.Frame.prototype.clear=function(){this.pixels=i.Frame.createEmptyPixelGrid_(this.getWidth(),this.getHeight()),this.version++},i.Frame.prototype.clonePixels_=function(e){return new Uint32Array(e)},i.Frame.prototype.getHash=function(){return[this.id,this.version].join("-")},i.Frame.prototype.setPixel=function(e,t,i){this.containsPixel(e,t)&&(t=t*this.width+e,this.pixels[t]!==(i=pskl.utils.colorToInt(i)))&&(this.pixels[t]=i||pskl.utils.colorToInt(Constants.TRANSPARENT_COLOR),this.version++)},i.Frame.prototype.getPixel=function(e,t){return this.containsPixel(e,t)?this.pixels[t*this.width+e]:null},i.Frame.prototype.forEachPixel=function(e){for(var t=this.getWidth(),i=t*this.getHeight(),r=0;r<i;r++)e(this.pixels[r],r%t,Math.floor(r/t),this)},i.Frame.prototype.getWidth=function(){return this.width},i.Frame.prototype.getHeight=function(){return this.height},i.Frame.prototype.containsPixel=function(e,t){return 0<=e&&0<=t&&e<this.width&&t<this.height},i.Frame.prototype.isSameSize=function(e){return this.getHeight()==e.getHeight()&&this.getWidth()==e.getWidth()}}(),!function(){var i=$.namespace("pskl.model");i.Layer=function(e){if(!e)throw"Invalid arguments in Layer constructor : 'name' is mandatory";this.name=e,this.frames=[],this.opacity=1},i.Layer.prototype.clone=function(){const t=new i.Layer(this.name);return t.opacity=this.opacity,this.frames.forEach(e=>{t.frames.push(e.clone())}),t},i.Layer.fromFrames=function(e,t){e=new i.Layer(e);return t.forEach(e.addFrame.bind(e)),e},i.Layer.prototype.getName=function(){return this.name},i.Layer.prototype.setName=function(e){this.name=e},i.Layer.prototype.getOpacity=function(){return this.opacity},i.Layer.prototype.setOpacity=function(e){null===(e="string"==typeof e?parseFloat(e):e)||isNaN(e)||e<0||1<e||(this.opacity=+e.toFixed(3))},i.Layer.prototype.isTransparent=function(){return this.opacity<1},i.Layer.prototype.getFrames=function(){return this.frames},i.Layer.prototype.getFrameAt=function(e,t=!1){return t&&(e=Math.min(Math.max(e,0),this.frames.length-1)),this.frames[e]},i.Layer.prototype.addFrame=function(e){this.frames.push(e)},i.Layer.prototype.addFrameAt=function(e,t){this.frames.splice(t,0,e)},i.Layer.prototype.removeFrame=function(e){e=this.frames.indexOf(e);this.removeFrameAt(e)},i.Layer.prototype.removeFrameAt=function(e){this.frames[e]?this.frames.splice(e,1):console.error("Invalid index in removeFrameAt : %s (size : %s)",e,this.size())},i.Layer.prototype.moveFrame=function(e,t){e=this.frames.splice(e,1)[0];this.frames.splice(t,0,e)},i.Layer.prototype.swapFramesAt=function(e,t){var i=this.frames[e],r=this.frames[t];i&&r?(this.frames[t]=i,this.frames[e]=r):console.error("Frame not found in moveFrameAt (from %s, to %s)",e,t)},i.Layer.prototype.duplicateFrame=function(e){e=this.frames.indexOf(e);this.duplicateFrameAt(e)},i.Layer.prototype.duplicateFrameAt=function(e){var t=this.frames[e];t?(t=t.clone(),this.addFrameAt(t,e)):console.error("Frame not found in duplicateFrameAt (at %s)",e)},i.Layer.prototype.size=function(){return this.frames.length},i.Layer.prototype.getHash=function(){return this.frames.map(function(e){return e.getHash()}).join("-")}}(),$.namespace("pskl.model.piskel").Descriptor=function(e,t,i){this.name=e,this.description=t,this.isPublic=i},!function(){function e(e){return pskl.utils.FrameUtils.toImage(e)}function t(e){return e}var i=$.namespace("pskl.model.frame"),o="__cache_default__";i.CachedFrameProcessor=function(){this.cache_={},this.cacheQueue_=[],this.frameProcessor=e,this.outputCloner=t,this.defaultNamespace=o},i.CachedFrameProcessor.prototype.clear=function(){this.cache_={}},i.CachedFrameProcessor.prototype.setFrameProcessor=function(e){this.frameProcessor=e},i.CachedFrameProcessor.prototype.setOutputCloner=function(e){this.outputCloner=e},i.CachedFrameProcessor.prototype.get=function(e,t){var i=null,r=(this.cache_[t=t||o]||(this.cache_[t]={}),this.cache_[t]),n=e.getHash();return r[n]?i=r[n]:(i=this.frameProcessor(e),r[n]=i,this.cacheQueue_.unshift([t,n]),100<this.cacheQueue_.length&&(e=this.cacheQueue_.pop(),this.cache_[e[0]][e[1]]=null)),i}}(),!function(){var t=$.namespace("pskl.model.frame");t.AsyncCachedFrameProcessor=function(e){t.CachedFrameProcessor.call(this,e)},pskl.utils.inherit(t.AsyncCachedFrameProcessor,t.CachedFrameProcessor),t.AsyncCachedFrameProcessor.prototype.get=function(e,t){var i=null,r=(t=t||this.defaultNamespace,this.cache_[t]||(this.cache_[t]={}),Q.defer()),t=this.cache_[t],n=e.getHash();return t[n]?i=t[n]:(t=this.onProcessorComplete_.bind(this,r,t,n),this.frameProcessor(e,t)),i&&r.resolve(i),r.promise},t.AsyncCachedFrameProcessor.prototype.onProcessorComplete_=function(e,t,i,r){t[i]=r,e.resolve(r)}}(),!function(){var e=$.namespace("pskl.model.frame");e.RenderedFrame=function(e,t,i,r){this.width=t,this.height=i,this.id=r,this.renderFn=e},e.RenderedFrame.prototype.getRenderedFrame=function(){return this.renderFn()},e.RenderedFrame.prototype.getHash=function(){return this.id},e.RenderedFrame.prototype.getWidth=function(){return this.width},e.RenderedFrame.prototype.getHeight=function(){return this.height},e.RenderedFrame.prototype.getPixels=Constants.ABSTRACT_FUNCTION,e.RenderedFrame.prototype.containsPixel=Constants.ABSTRACT_FUNCTION,e.RenderedFrame.prototype.isSameSize=Constants.ABSTRACT_FUNCTION,e.RenderedFrame.prototype.clone=Constants.ABSTRACT_FUNCTION,e.RenderedFrame.prototype.setPixels=Constants.ABSTRACT_FUNCTION,e.RenderedFrame.prototype.clear=Constants.ABSTRACT_FUNCTION,e.RenderedFrame.prototype.setPixel=Constants.ABSTRACT_FUNCTION,e.RenderedFrame.prototype.getPixel=Constants.ABSTRACT_FUNCTION,e.RenderedFrame.prototype.forEachPixel=Constants.ABSTRACT_FUNCTION}(),!function(){var i=$.namespace("pskl.model");i.Palette=function(e,t,i){this.id=e,this.name=t,this.colors=i},i.Palette.fromObject=function(e){var t=e.colors.slice(0,e.colors.length);return new i.Palette(e.id,e.name,t)},i.Palette.prototype.getColors=function(){return this.colors},i.Palette.prototype.setColors=function(e){this.colors=e},i.Palette.prototype.get=function(e){return this.colors[e]},i.Palette.prototype.set=function(e,t){this.colors[e]=t},i.Palette.prototype.add=function(e){this.colors.push(e)},i.Palette.prototype.size=function(){return this.colors.length},i.Palette.prototype.removeAt=function(e){this.colors.splice(e,1)},i.Palette.prototype.move=function(e,t){this.colors.splice(t,0,this.colors.splice(e,1)[0])}}(),!function(){var e=$.namespace("pskl.model");e.Piskel=function(e,t,i,r){if(!(e&&t&&r))throw"Missing arguments in Piskel constructor : "+Array.prototype.join.call(arguments,",");this.layers=[],this.width=e,this.height=t,this.descriptor=r,this.savePath=null,this.fps=i,this.hiddenFrames=[]},e.Piskel.prototype.clone=function(){const t=new e.Piskel(this.width,this.height,this.fps,this.descriptor);return t.savePath=this.savePath,this.layers.forEach(e=>{t.layers.push(e.clone())}),this.hiddenFrames.forEach(e=>{t.hiddenFrames.push(e)}),t},e.Piskel.fromLayers=function(e,t,i){var r,n=null;if(0<e.length&&0<e[0].size())return r=e[0].getFrameAt(0),n=new pskl.model.Piskel(r.getWidth(),r.getHeight(),t,i),e.forEach(n.addLayer.bind(n)),n;throw"Piskel.fromLayers expects array of non empty pskl.model.Layer as first argument"},e.Piskel.prototype.getLayers=function(){return this.layers},e.Piskel.prototype.getHeight=function(){return this.height},e.Piskel.prototype.getWidth=function(){return this.width},e.Piskel.prototype.getFPS=function(){return this.fps},e.Piskel.prototype.getLayers=function(){return this.layers},e.Piskel.prototype.getLayerAt=function(e){return this.layers[e]},e.Piskel.prototype.getLayersByName=function(t){return this.layers.filter(function(e){return e.getName()==t})},e.Piskel.prototype.getFrameCount=function(){return this.getLayerAt(0).size()},e.Piskel.prototype.addLayer=function(e){this.layers.push(e)},e.Piskel.prototype.addLayerAt=function(e,t){this.layers.splice(t,0,e)},e.Piskel.prototype.moveLayerUp=function(e,t){e=this.layers.indexOf(e),t=t?this.layers.length-1:e+1;this.moveLayer_(e,t)},e.Piskel.prototype.moveLayerDown=function(e,t){e=this.layers.indexOf(e);this.moveLayer_(e,t?0:e-1)},e.Piskel.prototype.moveLayer_=function(e,t){-1!=e&&-1!=t&&e!=t&&(t=pskl.utils.Math.minmax(t,0,this.layers.length-1),e=this.layers.splice(e,1)[0],this.layers.splice(t,0,e))},e.Piskel.prototype.removeLayer=function(e){e=this.layers.indexOf(e);-1!=e&&this.layers.splice(e,1)},e.Piskel.prototype.removeLayerAt=function(e){this.layers.splice(e,1)},e.Piskel.prototype.getDescriptor=function(){return this.descriptor},e.Piskel.prototype.setDescriptor=function(e){this.descriptor=e,$.publish(Events.PISKEL_DESCRIPTOR_UPDATED)},e.Piskel.prototype.setName=function(e){this.descriptor.name=e,$.publish(Events.PISKEL_DESCRIPTOR_UPDATED)},e.Piskel.prototype.getHash=function(){return this.layers.map(function(e){return e.getHash()}).join("-")}}(),!function(){function t(e){var t=Q.defer();return e.onsuccess=t.resolve.bind(t),e.onerror=t.reject.bind(t),t.promise}var e=$.namespace("pskl.database"),i="PiskelSessionsDatabase";e.BackupDatabase=function(){this.db=null},e.BackupDatabase.DB_NAME=i,e.BackupDatabase.prototype.init=function(){var e=window.indexedDB.open(i,1);return e.onupgradeneeded=this.onUpgradeNeeded_.bind(this),t(e).then(function(e){return this.db=e.target.result,this.db}.bind(this)).catch(function(e){console.log("Could not initialize the piskel backup database")})},e.BackupDatabase.prototype.onUpgradeNeeded_=function(e){this.db=e.target.result;e=this.db.createObjectStore("snapshots",{keyPath:"id",autoIncrement:!0});e.createIndex("session_id","session_id",{unique:!1}),e.createIndex("date","date",{unique:!1}),e.createIndex("session_id, date",["session_id","date"],{unique:!1}),e.transaction.oncomplete=function(e){}.bind(this)},e.BackupDatabase.prototype.openObjectStore_=function(){return this.db.transaction(["snapshots"],"readwrite").objectStore("snapshots")},e.BackupDatabase.prototype.createSnapshot=function(e){e=this.openObjectStore_().add(e);return t(e)},e.BackupDatabase.prototype.updateSnapshot=function(e){e=this.openObjectStore_().put(e);return t(e)},e.BackupDatabase.prototype.deleteSnapshot=function(e){e=this.openObjectStore_().delete(e.id);return t(e)},e.BackupDatabase.prototype.getSnapshot=function(e){e=this.openObjectStore_().get(e);return t(e).then(function(e){return e.target.result})},e.BackupDatabase.prototype.findLastSnapshot=function(i){var r=Q.defer(),e=this.db.transaction(["snapshots"]).objectStore("snapshots").index("date"),t=IDBKeyRange.upperBound(1/0);return e.openCursor(t,"prev").onsuccess=function(e){var e=e.target.result,t=e&&e.value;t?i(t)?r.resolve(t):e.continue():r.resolve(null)},r.promise},e.BackupDatabase.prototype.getSnapshotsBySessionId=function(e){var t=Q.defer(),i=this.db.transaction(["snapshots"]).objectStore("snapshots").index("session_id, date"),e=IDBKeyRange.bound([e,0],[e,1/0]),r=[];return i.openCursor(e,"prev").onsuccess=function(e){e=e.target.result;e?(r.push(e.value),e.continue()):t.resolve(r)},t.promise},e.BackupDatabase.prototype.getSessions=function(){var n=Q.defer(),e=this.db.transaction(["snapshots"]).objectStore("snapshots"),o={},e=e.index("date"),t=IDBKeyRange.upperBound(1/0);return e.openCursor(t,"prev").onsuccess=function(e){var t,i,e=e.target.result,r=e&&e.value;r?(o[r.session_id]?((i=o[(t=r).session_id]).startDate=Math.min(i.startDate,t.date),i.endDate=Math.max(i.endDate,t.date),i.count++,i.endDate===t.date&&(i.name=t.name,i.description=t.description)):o[r.session_id]={startDate:r.date,endDate:r.date,name:r.name,description:r.description,id:r.session_id,count:1},e.continue()):n.resolve(o)},n.promise.then(function(t){return Object.keys(t).map(function(e){return t[e]})})},e.BackupDatabase.prototype.deleteSnapshotsForSession=function(e){var t=Q.defer(),i=this.openObjectStore_().index("session_id"),e=IDBKeyRange.only(e);return i.openCursor(e).onsuccess=function(e){e=e.target.result;e?(e.delete(),e.continue()):t.resolve()},t.promise}}(),!function(){function o(e){var t=Q.defer();return e.onsuccess=t.resolve.bind(t),e.onerror=t.reject.bind(t),t.promise}var e=$.namespace("pskl.database"),t="PiskelDatabase";e.PiskelDatabase=function(e){this.db=null},e.PiskelDatabase.DB_NAME=t,e.PiskelDatabase.prototype.init=function(){var e=window.indexedDB.open(t,1);return e.onupgradeneeded=this.onUpgradeNeeded_.bind(this),o(e).then(function(e){return this.db=e.target.result,this.db}.bind(this))},e.PiskelDatabase.prototype.onUpgradeNeeded_=function(e){this.db=e.target.result,this.db.createObjectStore("piskels",{keyPath:"name"}).transaction.oncomplete=function(e){pskl.database.migrate.MigrateLocalStorageToIndexedDb.migrate(this)}.bind(this)},e.PiskelDatabase.prototype.openObjectStore_=function(){return this.db.transaction(["piskels"],"readwrite").objectStore("piskels")},e.PiskelDatabase.prototype.get=function(e){var t=this.openObjectStore_();return o(t.get(e)).then(function(e){return e.target.result})},e.PiskelDatabase.prototype.list=function(){var t=Q.defer(),i=[],e=this.openObjectStore_().openCursor();return e.onsuccess=function(e){e=e.target.result;e?(i.push({name:e.value.name,date:e.value.date,description:e.value.description}),e.continue()):t.resolve(i)},e.onerror=function(){t.reject()},t.promise},e.PiskelDatabase.prototype.update=function(e,t,i,r){var n={},e=(n.name=e,n.serialized=r,n.date=i,n.description=t,this.openObjectStore_());return o(e.put(n))},e.PiskelDatabase.prototype.create=function(e,t,i,r){var n={},e=(n.name=e,n.serialized=r,n.date=i,n.description=t,this.openObjectStore_());return o(e.add(n))},e.PiskelDatabase.prototype.delete=function(e){var t=this.openObjectStore_();return o(t.delete(e))}}(),!function(){var s=$.namespace("pskl.database.migrate");s.MigrateLocalStorageToIndexedDb={},s.MigrateLocalStorageToIndexedDb.migrate=function(e){function r(t){var i=o[t];i?s.MigrateLocalStorageToIndexedDb.save_(e,i).then(function(){r(t+1)}).catch(function(e){console.error("Failed to migrate local storage sprite for name: "+i.name),r(t+1)}):(console.log("Data migration from local storage to indexed db finished."),console.log("Local storage piskels successfully migrated. Old copies will be deleted."),s.MigrateLocalStorageToIndexedDb.deleteLocalStoragePiskels(),n.resolve())}var n=Q.defer(),t=pskl.app.localStorageService,o=t.getKeys().map(function(e){return{name:e.name,description:e.description,date:e.date,serialized:t.getPiskel(e.name)}});return r(0),n.promise},s.MigrateLocalStorageToIndexedDb.save_=function(t,i){return t.get(i.name).then(function(e){return void 0!==e?t.update(i.name,i.description,i.date,i.serialized):t.create(i.name,i.description,i.date,i.serialized)})},s.MigrateLocalStorageToIndexedDb.deleteLocalStoragePiskels=function(){pskl.app.localStorageService.getKeys().forEach(function(e){window.localStorage.removeItem("piskel."+e.name)}),window.localStorage.removeItem("piskel.keys")}}(),!function(){var e=$.namespace("pskl.selection"),i="REPLAY_PASTE",n="REPLAY_ERASE";e.SelectionManager=function(e){this.piskelController=e,this.currentSelection=null},e.SelectionManager.prototype.init=function(){$.subscribe(Events.SELECTION_CREATED,this.onSelectionCreated_.bind(this)),$.subscribe(Events.SELECTION_DISMISSED,this.onSelectionDismissed_.bind(this)),$.subscribe(Events.SELECTION_MOVE_REQUEST,this.onSelectionMoved_.bind(this)),$.subscribe(Events.CLIPBOARD_COPY,this.copy.bind(this)),$.subscribe(Events.CLIPBOARD_CUT,this.copy.bind(this)),$.subscribe(Events.CLIPBOARD_PASTE,this.paste.bind(this));var e=pskl.service.keyboard.Shortcuts;pskl.app.shortcutService.registerShortcut(e.SELECTION.DELETE,this.onDeleteShortcut_.bind(this)),pskl.app.shortcutService.registerShortcut(e.SELECTION.COMMIT,this.commit.bind(this)),$.subscribe(Events.TOOL_SELECTED,this.onToolSelected_.bind(this))},e.SelectionManager.prototype.cleanSelection_=function(){this.currentSelection&&(this.currentSelection.reset(),this.currentSelection=null)},e.SelectionManager.prototype.onToolSelected_=function(e,t){t instanceof pskl.tools.drawing.selection.BaseSelect||this.cleanSelection_()},e.SelectionManager.prototype.onSelectionDismissed_=function(e){this.cleanSelection_()},e.SelectionManager.prototype.onDeleteShortcut_=function(e){if(!this.currentSelection)return!0;this.erase()},e.SelectionManager.prototype.erase=function(){for(var e=this.currentSelection.pixels,t=this.piskelController.getCurrentFrame(),i=0,r=e.length;i<r;i++)t.setPixel(e[i].col,e[i].row,Constants.TRANSPARENT_COLOR);$.publish(Events.PISKEL_SAVE_STATE,{type:pskl.service.HistoryService.REPLAY,scope:this,replay:{type:n,pixels:JSON.parse(JSON.stringify(e))}})},e.SelectionManager.prototype.copy=function(e,t){this.currentSelection&&this.piskelController.getCurrentFrame()&&(this.currentSelection.fillSelectionFromFrame(this.piskelController.getCurrentFrame()),navigator.clipboard.writeText(this.currentSelection.stringify()).then(()=>{e.type==Events.CLIPBOARD_CUT&&this.erase()}),t.preventDefault())},e.SelectionManager.prototype.paste=function(n,e){navigator.clipboard.read().then(e=>{try{for(var t=0;t<e.length;t++){var i=e[t],r=i.types[0];if(/^image/i.test(r))return this.pasteImage_(i,r),void n.stopPropagation();if(/^text\/plain/i.test(r))return this.pasteText_(i,r),void n.stopPropagation()}}catch(e){}this.currentSelection&&this.currentSelection.hasPastedContent&&this.pastePixelsOnCurrentFrame_(this.currentSelection.pixels)})},e.SelectionManager.prototype.pasteImage_=function(e,t){e.getType(t).then(r=>{pskl.utils.FileUtils.readImageFile(r,function(e){let t=0,i=0;null!=this.currentSelection&&(t=this.currentSelection.pixels[0].col,i=this.currentSelection.pixels[0].row,console.log(t,i)),pskl.app.fileDropperService.dropPosition_={x:t,y:i},pskl.app.fileDropperService.onImageLoaded_(e,r,{x:t,y:i})}.bind(this))})},e.SelectionManager.prototype.pasteText_=function(e,t){e.getType(t).then(e=>{e.text().then(e=>{var e=JSON.parse(e),t=e.time,i=e.pixels;if(this.currentSelection&&(this.currentSelection.time>=t||void 0===this.currentSelection.time)){let t=!1,r=0,n=0;for(let e=0;e<this.currentSelection.pixels.length;e++){var a=this.currentSelection.pixels[e];n=0==e?(r=a.row,a.col):(r=Math.min(r,a.row),Math.min(n,a.col)),void 0===a.color&&(t=!0)}t||(i=this.currentSelection.pixels);let o=0,s=0;for(let e=0;e<i.length;e++){var l=i[e];s=0==e?(o=l.row,l.col):(o=Math.min(o,l.row),Math.min(s,l.col))}i.forEach(e=>{var t=e.row-o,i=e.col-s;e.row=r+t,e.col=n+i})}i&&this.pastePixelsOnCurrentFrame_(i)})})},e.SelectionManager.prototype.pastePixelsOnCurrentFrame_=function(e){var t=this.piskelController.getCurrentFrame();this.pastePixels_(t,e),$.publish(Events.PISKEL_SAVE_STATE,{type:pskl.service.HistoryService.REPLAY,scope:this,replay:{type:i,pixels:JSON.parse(JSON.stringify(e.slice(0)))}})},e.SelectionManager.prototype.commit=function(){var e=pskl.app.drawingController.currentToolBehavior;e instanceof pskl.tools.drawing.selection.BaseSelect&&e.commitSelection()},e.SelectionManager.prototype.replay=function(t,e){e.type===i?this.pastePixels_(t,e.pixels):e.type===n&&e.pixels.forEach(function(e){t.setPixel(e.col,e.row,Constants.TRANSPARENT_COLOR)})},e.SelectionManager.prototype.pastePixels_=function(t,e){e.forEach(function(e){e.color!==Constants.TRANSPARENT_COLOR&&null!==e.color&&t.setPixel(e.col,e.row,e.color)})},e.SelectionManager.prototype.onSelectionCreated_=function(e,t){t?this.currentSelection=t:console.error("No selection provided to SelectionManager")},e.SelectionManager.prototype.onSelectionMoved_=function(e,t,i){this.currentSelection?this.currentSelection.move(t,i):console.error("Bad state: No currentSelection set when trying to move it in SelectionManager")}}(),!function(){var e=$.namespace("pskl.selection");e.BaseSelection=function(){this.reset()},e.BaseSelection.prototype.stringify=function(){return JSON.stringify({pixels:this.pixels,time:this.time})},e.BaseSelection.prototype.parse=function(e){e=JSON.parse(e);this.pixels=e.pixels,this.time=e.time},e.BaseSelection.prototype.reset=function(){this.pixels=[],this.hasPastedContent=!1,this.time=-1},e.BaseSelection.prototype.move=function(e,t){for(var i=[],r=0,n=this.pixels.length;r<n;r++){var o=this.pixels[r];o.col+=e,o.row+=t,i.push(o)}this.pixels=i},e.BaseSelection.prototype.fillSelectionFromFrame=function(i){this.pixels.forEach(function(e){var t=i.getPixel(e.col,e.row);e.color=t||Constants.TRANSPARENT_COLOR}),this.hasPastedContent=!0,this.time=Date.now()}}(),!function(){var e=$.namespace("pskl.selection");e.LassoSelection=function(e,t){this.pixelsMap={},e.forEach(function(e){this.setPixelInMap_(e,1)}.bind(this)),this.pixels=this.getLassoPixels_(t)},pskl.utils.inherit(e.LassoSelection,e.BaseSelection),e.LassoSelection.prototype.getLassoPixels_=function(r){var n=[];return r.forEachPixel(function(e,t,i){t={col:t,row:i};this.isInSelection_(t,r)&&n.push(t)}.bind(this)),n},e.LassoSelection.prototype.isInSelection_=function(e,t){return this.getPixelInMap_(e)||this.visitPixel_(e,t),1==this.getPixelInMap_(e)},e.LassoSelection.prototype.visitPixel_=function(e,t){var i=!1;pskl.PixelUtils.visitConnectedPixels(e,t,function(e){return!(this.getPixelInMap_(e)||(t.containsPixel(e.col,e.row)?(this.setPixelInMap_(e,2),0):i=!0))}.bind(this)).forEach(function(e){this.setPixelInMap_(e,i?-1:1)}.bind(this))},e.LassoSelection.prototype.setPixelInMap_=function(e,t){this.pixelsMap[e.col]=this.pixelsMap[e.col]||{},this.pixelsMap[e.col][e.row]=t},e.LassoSelection.prototype.getPixelInMap_=function(e){return this.pixelsMap[e.col]&&this.pixelsMap[e.col][e.row]}}(),!function(){var e=$.namespace("pskl.selection");e.RectangularSelection=function(e,t,i,r){this.pixels=pskl.PixelUtils.getRectanglePixels(e,t,i,r)},pskl.utils.inherit(e.RectangularSelection,e.BaseSelection)}(),!function(){var e=$.namespace("pskl.selection");e.ShapeSelection=function(e){this.pixels=e},pskl.utils.inherit(e.ShapeSelection,e.BaseSelection)}(),!function(){var e=$.namespace("pskl.rendering");e.AbstractRenderer=function(){},e.AbstractRenderer.prototype.clear=Constants.ABSTRACT_FUNCTION,e.AbstractRenderer.prototype.render=Constants.ABSTRACT_FUNCTION,e.AbstractRenderer.prototype.getCoordinates=Constants.ABSTRACT_FUNCTION,e.AbstractRenderer.prototype.setGridWidth=Constants.ABSTRACT_FUNCTION,e.AbstractRenderer.prototype.getGridWidth=Constants.ABSTRACT_FUNCTION,e.AbstractRenderer.prototype.setZoom=Constants.ABSTRACT_FUNCTION,e.AbstractRenderer.prototype.getZoom=Constants.ABSTRACT_FUNCTION,e.AbstractRenderer.prototype.setOffset=Constants.ABSTRACT_FUNCTION,e.AbstractRenderer.prototype.getOffset=Constants.ABSTRACT_FUNCTION,e.AbstractRenderer.prototype.setDisplaySize=Constants.ABSTRACT_FUNCTION,e.AbstractRenderer.prototype.getDisplaySize=Constants.ABSTRACT_FUNCTION}(),!function(){var e=$.namespace("pskl.rendering");e.CompositeRenderer=function(){this.renderers=[]},pskl.utils.inherit(pskl.rendering.CompositeRenderer,pskl.rendering.AbstractRenderer),e.CompositeRenderer.prototype.add=function(e){return this.renderers.push(e),this},e.CompositeRenderer.prototype.clear=function(){this.renderers.forEach(function(e){e.clear()})},e.CompositeRenderer.prototype.setZoom=function(t){this.renderers.forEach(function(e){e.setZoom(t)})},e.CompositeRenderer.prototype.getZoom=function(){return this.getSampleRenderer_().getZoom()},e.CompositeRenderer.prototype.setDisplaySize=function(t,i){this.renderers.forEach(function(e){e.setDisplaySize(t,i)})},e.CompositeRenderer.prototype.getDisplaySize=function(){return this.getSampleRenderer_().getDisplaySize()},e.CompositeRenderer.prototype.setOffset=function(t,i){this.renderers.forEach(function(e){e.setOffset(t,i)})},e.CompositeRenderer.prototype.getOffset=function(){return this.getSampleRenderer_().getOffset()},e.CompositeRenderer.prototype.setGridWidth=function(t){this.renderers.forEach(function(e){e.setGridWidth(t)})},e.CompositeRenderer.prototype.getGridWidth=function(){return this.getSampleRenderer_().getGridWidth()},e.CompositeRenderer.prototype.getSampleRenderer_=function(){if(0<this.renderers.length)return this.renderers[0];throw"Renderer manager is empty"}}(),!function(){var e=$.namespace("pskl.rendering.layer");e.LayersRenderer=function(e,t,i){pskl.rendering.CompositeRenderer.call(this),this.piskelController=i,this.belowRenderer=new pskl.rendering.frame.FrameRenderer(e,t,["layers-canvas","layers-below-canvas"]),this.aboveRenderer=new pskl.rendering.frame.FrameRenderer(e,t,["layers-canvas","layers-above-canvas"]),this.add(this.belowRenderer),this.add(this.aboveRenderer),this.serializedRendering="",this.stylesheet_=document.createElement("style"),document.head.appendChild(this.stylesheet_),this.updateLayersCanvasOpacity_(pskl.UserSettings.get(pskl.UserSettings.LAYER_OPACITY)),$.subscribe(Events.PISKEL_RESET,this.flush.bind(this)),$.subscribe(Events.USER_SETTINGS_CHANGED,this.onUserSettingsChange_.bind(this))},pskl.utils.inherit(pskl.rendering.layer.LayersRenderer,pskl.rendering.CompositeRenderer),e.LayersRenderer.prototype.render=function(){var e=this.getOffset(),t=this.getDisplaySize(),i=this.piskelController.getLayers(),r=this.piskelController.getCurrentFrameIndex(),n=this.piskelController.getCurrentLayerIndex(),o=i.slice(0,n),n=i.slice(n+1,i.length),e=[this.getZoom(),this.getGridWidth(),e.x,e.y,t.width,t.height,pskl.utils.LayerUtils.getFrameHashAt(o,r),pskl.utils.LayerUtils.getFrameHashAt(n,r),i.length].join("-");this.serializedRendering!=e&&(this.serializedRendering=e,this.clear(),0<o.length&&(t=pskl.utils.LayerUtils.mergeFrameAt(o,r),this.belowRenderer.render(t)),0<n.length)&&(i=pskl.utils.LayerUtils.mergeFrameAt(n,r),this.aboveRenderer.render(i))},e.LayersRenderer.prototype.setDisplaySize=function(e,t){var i=this.getDisplaySize();i.width===e&&i.height===t||this.superclass.setDisplaySize.call(this,e,t)},e.LayersRenderer.prototype.onUserSettingsChange_=function(e,t,i){t==pskl.UserSettings.LAYER_OPACITY&&this.updateLayersCanvasOpacity_(i)},e.LayersRenderer.prototype.updateLayersCanvasOpacity_=function(e){this.stylesheet_.innerHTML=".layers-canvas { opacity : "+e+"}"},e.LayersRenderer.prototype.flush=function(){this.serializedRendering=""}}(),!function(){var e=$.namespace("pskl.rendering.frame");e.FrameRenderer=function(e,t,i){if(this.defaultRenderingOptions={supportGridRendering:!1,zoom:1},t=$.extend(!0,{},this.defaultRenderingOptions,t),void 0===e)throw"Bad FrameRenderer initialization. <container> undefined.";if(isNaN(t.zoom))throw"Bad FrameRenderer initialization. <zoom> not well defined.";this.container=e,this.zoom=t.zoom,this.offset={x:0,y:0},this.margin={x:0,y:0},this.supportGridRendering=t.supportGridRendering,this.classList=i||[],this.classList.push("canvas"),this.canvas=null,this.displayCanvas=null,this.setDisplaySize(t.width,t.height),this.setGridWidth(this.getUserGridWidth_()),this.setGridSpacing(this.getUserGridSpacing_()),$.subscribe(Events.USER_SETTINGS_CHANGED,this.onUserSettingsChange_.bind(this))},pskl.utils.inherit(pskl.rendering.frame.FrameRenderer,pskl.rendering.AbstractRenderer),e.FrameRenderer.prototype.render=function(e){e&&(this.clear(),this.renderFrame_(e))},e.FrameRenderer.prototype.clear=function(){pskl.utils.CanvasUtils.clear(this.canvas),pskl.utils.CanvasUtils.clear(this.displayCanvas)},e.FrameRenderer.prototype.setZoom=function(e){var t,i=Math.min(this.displayWidth,this.displayHeight)/10;(e=pskl.utils.Math.minmax(e,1,i))!=this.zoom&&(i=this.offset.x+this.displayWidth/(2*this.zoom),t=this.offset.y+this.displayHeight/(2*this.zoom),this.zoom=e,this.setOffset(i-this.displayWidth/(2*this.zoom),t-this.displayHeight/(2*this.zoom)))},e.FrameRenderer.prototype.getZoom=function(){return this.zoom},e.FrameRenderer.prototype.setDisplaySize=function(e,t){this.displayWidth=e,this.displayHeight=t,this.displayCanvas&&(this.displayCanvas.parentNode.removeChild(this.displayCanvas),this.displayCanvas=null),this.createDisplayCanvas_()},e.FrameRenderer.prototype.getDisplaySize=function(){return{height:this.displayHeight,width:this.displayWidth}},e.FrameRenderer.prototype.getOffset=function(){return{x:this.offset.x,y:this.offset.y}},e.FrameRenderer.prototype.setOffset=function(e,t){var i=pskl.app.piskelController.getWidth(),r=pskl.app.piskelController.getHeight(),i=i-this.displayWidth/this.zoom,i=(e=pskl.utils.Math.minmax(e,0,i),r-this.displayHeight/this.zoom);t=pskl.utils.Math.minmax(t,0,i),this.offset.x=e,this.offset.y=t},e.FrameRenderer.prototype.getGridColor=function(){return pskl.UserSettings.get(pskl.UserSettings.GRID_COLOR)},e.FrameRenderer.prototype.setGridWidth=function(e){this.gridWidth_=e},e.FrameRenderer.prototype.setGridSpacing=function(e){this.gridSpacing_=e},e.FrameRenderer.prototype.getGridWidth=function(){return this.supportGridRendering?this.gridWidth_:0},e.FrameRenderer.prototype.getGridSpacing=function(){return this.supportGridRendering?this.gridSpacing_:0},e.FrameRenderer.prototype.computeGridWidthForDisplay_=function(){var e=this.getGridSpacing();if(this.zoom*e<6)return 0;for(var t=this.getGridWidth();1<t&&this.zoom<6*t;)t--;return t},e.FrameRenderer.prototype.updateMargins_=function(e){var t=this.displayWidth-this.zoom*e.getWidth(),t=(this.margin.x=Math.max(0,t)/2,this.displayHeight-this.zoom*e.getHeight());this.margin.y=Math.max(0,t)/2},e.FrameRenderer.prototype.createDisplayCanvas_=function(){var e=this.displayHeight,t=this.displayWidth;this.displayCanvas=pskl.utils.CanvasUtils.createCanvas(t,e,this.classList),pskl.utils.CanvasUtils.disableImageSmoothing(this.displayCanvas),this.container.appendChild(this.displayCanvas)},e.FrameRenderer.prototype.onUserSettingsChange_=function(e,t,i){var r=pskl.UserSettings;t!=r.GRID_WIDTH&&t!=r.GRID_SPACING&&t!=r.GRID_ENABLED||(this.setGridWidth(this.getUserGridWidth_()),this.setGridSpacing(this.getUserGridSpacing_()))},e.FrameRenderer.prototype.getUserGridWidth_=function(){var e=pskl.UserSettings.get(pskl.UserSettings.GRID_ENABLED),t=pskl.UserSettings.get(pskl.UserSettings.GRID_WIDTH);return e?t:0},e.FrameRenderer.prototype.getUserGridSpacing_=function(){var e=pskl.UserSettings.get(pskl.UserSettings.GRID_ENABLED),t=pskl.UserSettings.get(pskl.UserSettings.GRID_SPACING);return e?t:0},e.FrameRenderer.prototype.getCoordinates=function(e,t){var i=this.container.getBoundingClientRect(),i=(e-=i.left,t-=i.top,e-=this.margin.x,t-=this.margin.y,this.zoom);return e+=this.offset.x*i,t+=this.offset.y*i,{x:Math.floor(e/i),y:Math.floor(t/i)}},e.FrameRenderer.prototype.reverseCoordinates=function(e,t){var i=this.zoom,r=(e=e*i-this.offset.x*i,t=t*i-this.offset.y*i,e+=this.margin.x,t+=this.margin.y,this.container.getBoundingClientRect());return{x:(e+=r.left)+i/2,y:(t+=r.top)+i/2}},e.FrameRenderer.prototype.renderFrame_=function(e){this.canvas&&e.getWidth()==this.canvas.width&&e.getHeight()==this.canvas.height||(this.canvas=pskl.utils.CanvasUtils.createCanvas(e.getWidth(),e.getHeight()));var t=this.canvas.width,i=this.canvas.height,r=this.zoom,n=(pskl.utils.FrameUtils.drawToCanvas(e,this.canvas),this.updateMargins_(e),this.displayCanvas.getContext("2d")),o=(n.save(),this.margin.x-this.offset.x*r),s=this.margin.y-this.offset.y*r,a=((0<o||0<s)&&(n.fillStyle=Constants.ZOOMED_OUT_BACKGROUND_COLOR,n.fillRect(0,0,this.displayCanvas.width-1,this.displayCanvas.height-1)),n.translate(o,s),n.scale(r,r),pskl.UserSettings.get("SEAMLESS_MODE")?n.clearRect(-1*t,-1*i,3*t,3*i):n.clearRect(0,0,t,i),pskl.UserSettings.get("SEAMLESS_MODE")&&this.drawTiledFrames_(n,this.canvas,t,i,1),n.drawImage(this.canvas,0,0),this.computeGridWidthForDisplay_()),l=this.getGridSpacing();if(0<a){o=this.getGridColor();n.scale(1/r,1/r);for(var c=(o===Constants.TRANSPARENT_COLOR?n.clearRect:(n.fillStyle=o,n.fillRect)).bind(n),p=1;p<e.getWidth();p++)p%l==0&&c(p*r-a/2,0,a,i*r);for(var h=1;h<e.getHeight();h++)h%l==0&&c(0,h*r-a/2,t*r,a)}n.restore()},e.FrameRenderer.prototype.drawTiledFrames_=function(t,i,r,n,o){var e=pskl.UserSettings.get("SEAMLESS_OPACITY"),e=pskl.utils.Math.minmax(e,0,1);t.fillStyle="rgba(255, 255, 255, "+e+")",[[0,-1],[0,1],[-1,-1],[-1,0],[-1,1],[1,-1],[1,0],[1,1]].forEach(function(e){t.drawImage(i,e[0]*r*o,e[1]*n*o),t.fillRect(e[0]*r*o,e[1]*n*o,r*o,n*o)})}}(),!function(){var r=$.namespace("pskl.rendering");r.OnionSkinRenderer=function(e,t){pskl.rendering.CompositeRenderer.call(this),this.piskelController=t,this.renderer=e,this.add(this.renderer),this.hash=""},r.OnionSkinRenderer.createInContainer=function(e,t,i){e=new pskl.rendering.frame.FrameRenderer(e,t,["onion-skin-canvas"]);return new r.OnionSkinRenderer(e,i)},pskl.utils.inherit(pskl.rendering.OnionSkinRenderer,pskl.rendering.CompositeRenderer),r.OnionSkinRenderer.prototype.render=function(){var e=this.getOnionFrames_(),t=this.computeHash_(e);this.hash!=t&&(this.hash=t,this.clear(),0<e.length)&&(t=pskl.utils.FrameUtils.merge(e),this.renderer.render(t))},r.OnionSkinRenderer.prototype.getOnionFrames_=function(){var e=[],t=this.piskelController.getCurrentFrameIndex(),i=this.piskelController.getCurrentLayer(),r=i.getFrameAt(t-1);r&&e.push(r);r=i.getFrameAt(t+1);return r&&e.push(r),e},r.OnionSkinRenderer.prototype.computeHash_=function(e){var t=this.getOffset(),i=this.getDisplaySize(),r=this.piskelController.getLayers();return[this.getZoom(),this.getGridWidth(),t.x,t.y,i.width,i.height,e.map(function(e){return e.getHash()}).join("-"),r.length].join("-")},r.OnionSkinRenderer.prototype.setDisplaySize=function(e,t){var i=this.getDisplaySize();i.width===e&&i.height===t||this.superclass.setDisplaySize.call(this,e,t)},r.OnionSkinRenderer.prototype.flush=function(){this.hash=""}}(),!function(){var e=$.namespace("pskl.rendering.frame");e.BackgroundImageFrameRenderer=function(e,t){this.container=e,this.setZoom(t);t=e.ownerDocument;this.frameContainer=t.createElement("div"),this.frameContainer.classList.add("background-image-frame-container"),e.appendChild(this.frameContainer),this.cachedFrameProcessor=new pskl.model.frame.CachedFrameProcessor,this.cachedFrameProcessor.setFrameProcessor(this.frameToDataUrl_.bind(this))},e.BackgroundImageFrameRenderer.prototype.frameToDataUrl_=function(e){e=e instanceof pskl.model.frame.RenderedFrame?pskl.utils.ImageResizer.scale(e.getRenderedFrame(),this.zoom):pskl.utils.FrameUtils.toImage(e,this.zoom);return e.toDataURL("image/png")},e.BackgroundImageFrameRenderer.prototype.render=function(e){e=this.cachedFrameProcessor.get(e,this.zoom);this.frameContainer.style.backgroundImage="url("+e+")"},e.BackgroundImageFrameRenderer.prototype.show=function(){this.frameContainer&&(this.frameContainer.style.display="block")},e.BackgroundImageFrameRenderer.prototype.setZoom=function(e){this.zoom=e},e.BackgroundImageFrameRenderer.prototype.getZoom=function(){return this.zoom},e.BackgroundImageFrameRenderer.prototype.setRepeated=function(e){e=e?"repeat":"no-repeat";this.frameContainer.style.backgroundRepeat=e}}(),!function(){var e=$.namespace("pskl.rendering.frame");e.CachedFrameRenderer=function(e,t,i){pskl.rendering.frame.FrameRenderer.call(this,e,t,i),this.serializedFrame=""},pskl.utils.inherit(pskl.rendering.frame.CachedFrameRenderer,pskl.rendering.frame.FrameRenderer),e.CachedFrameRenderer.prototype.setDisplaySize=function(e,t){this.displayWidth===e&&this.displayHeight===t||this.superclass.setDisplaySize.call(this,e,t)},e.CachedFrameRenderer.prototype.render=function(e){var t=this.getOffset(),i=this.getDisplaySize(),t=[this.getZoom(),this.getGridWidth(),this.getGridSpacing(),this.getGridColor(),pskl.UserSettings.get("SEAMLESS_MODE"),pskl.UserSettings.get("SEAMLESS_OPACITY"),t.x,t.y,i.width,i.height,e.getHash()].join("-");this.serializedFrame!=t&&(this.serializedFrame=t,this.superclass.render.call(this,e))}}(),!function(){var e=$.namespace("pskl.rendering");e.CanvasRenderer=function(e,t){this.frame=e,this.zoom=t,this.opacity_=1,this.transparentColor_="white"},e.CanvasRenderer.prototype.drawTransparentAs=function(e){this.transparentColor_=e},e.CanvasRenderer.prototype.setOpacity=function(e){this.opacity_=e},e.CanvasRenderer.prototype.render=function(){var e=this.createCanvas_(),t=(pskl.utils.FrameUtils.drawToCanvas(this.frame,e,this.transparentColor_,this.opacity_),this.createCanvas_(this.zoom)),i=t.getContext("2d");return pskl.utils.CanvasUtils.disableImageSmoothing(t),i.scale(this.zoom,this.zoom),i.drawImage(e,0,0),t},e.CanvasRenderer.prototype.createCanvas_=function(e){e=e||1;var t=this.frame.getWidth()*e,e=this.frame.getHeight()*e;return pskl.utils.CanvasUtils.createCanvas(t,e)}}(),!function(){var e=$.namespace("pskl.rendering");e.FramesheetRenderer=function(e){if(!(0<e.length))throw"FramesheetRenderer : Invalid argument : frames is empty";this.frames=e},e.FramesheetRenderer.prototype.renderAsCanvas=function(e){e=e||this.frames.length;for(var t=Math.ceil(this.frames.length/e),i=this.createCanvas_(e,t),r=0;r<this.frames.length;r++){var n=this.frames[r],o=r%e*n.getWidth(),s=Math.floor(r/e)*n.getHeight();this.drawFrameInCanvas_(n,i,o,s)}return i},e.FramesheetRenderer.prototype.drawFrameInCanvas_=function(e,t,i,r){var t=t.getContext("2d"),n=t.createImageData(e.getWidth(),e.getHeight()),e=e.getPixels(),e=new Uint8ClampedArray(e.buffer);n.data.set(e),t.putImageData(n,i,r)},e.FramesheetRenderer.prototype.createCanvas_=function(e,t){var i=this.frames[0],e=e*i.getWidth(),t=t*i.getHeight();return pskl.utils.CanvasUtils.createCanvas(e,t)}}(),!function(){var e=$.namespace("pskl.rendering");e.PiskelRenderer=function(e){for(var t=[],i=0;i<e.getFrameCount();i++)t.push(e.renderFrameAt(i,!0));this.piskelController=e,this.frames=t},e.PiskelRenderer.prototype.renderAsCanvas=function(e){e=e||this.frames.length;for(var t=Math.ceil(this.frames.length/e),i=this.createCanvas_(e,t),r=0;r<this.frames.length;r++){var n=this.frames[r],o=r%e*this.piskelController.getWidth(),s=Math.floor(r/e)*this.piskelController.getHeight();this.drawFrameInCanvas_(n,i,o,s)}return i},e.PiskelRenderer.prototype.drawFrameInCanvas_=function(e,t,i,r){t.getContext("2d").drawImage(e,i,r,e.width,e.height)},e.PiskelRenderer.prototype.createCanvas_=function(e,t){e*=this.piskelController.getWidth(),t*=this.piskelController.getHeight();return pskl.utils.CanvasUtils.createCanvas(e,t)}}(),!function(){var e=$.namespace("pskl.controller.piskel");e.PiskelController=function(e){if(!e)throw"A piskel instance is mandatory for instanciating PiskelController";this.defaultPiskel=e.clone(),this.piskels=[]},e.PiskelController.prototype.newPiskel=function(){return this.addPiskel(this.defaultPiskel.clone())},e.PiskelController.prototype.addPiskel=function(e){var t=this._uuidv4();return this.piskels.push({index:t,piskel:e}),this.currentLayerIndex=0,this.currentFrameIndex=0,this.layerIdCounter=1,t},e.PiskelController.prototype.setPiskel=function(e,t){this._setPiskel(this.selectedPiskel,e),(t=t||{}).preserveState||(this.currentLayerIndex=0,this.currentFrameIndex=0),this.layerIdCounter=1},e.PiskelController.prototype.clearPiskels=function(){this.piskels=[]},e.PiskelController.prototype.selectPiskel=function(e){this.selectedPiskel=e},e.PiskelController.prototype.init=function(){},e.PiskelController.prototype.getHeight=function(){return this._getPiskel(this.selectedPiskel).getHeight()},e.PiskelController.prototype.getWidth=function(){return this._getPiskel(this.selectedPiskel).getWidth()},e.PiskelController.prototype.getFPS=function(){return this._getPiskel(this.selectedPiskel).fps},e.PiskelController.prototype.setFPS=function(e){"number"==typeof e&&(this._getPiskel(this.selectedPiskel).fps=e,$.publish(Events.FPS_CHANGED))},e.PiskelController.prototype.getLayers=function(){return this._getPiskel(this.selectedPiskel).getLayers()},e.PiskelController.prototype.getCurrentLayer=function(){return this.getLayerAt(this.currentLayerIndex)},e.PiskelController.prototype.getLayerAt=function(e){return this._getPiskel(this.selectedPiskel).getLayerAt(e)},e.PiskelController.prototype.hasLayerAt=function(e){return!!this.getLayerAt(e)},e.PiskelController.prototype.getLayerByIndex=function(e){var t=this.getLayers();return t[e]||null},e.PiskelController.prototype.getCurrentFrame=function(){var e=this.getCurrentLayer();return this.clampCurrentFrameIndex(),e.getFrameAt(this.currentFrameIndex,!0)},e.PiskelController.prototype.clampCurrentFrameIndex=function(){var e=this.getCurrentLayer().frames.length;this.setCurrentFrameIndex(Math.min(Math.max(this.currentFrameIndex,0),e-1))},e.PiskelController.prototype.getCurrentLayerIndex=function(){return this.currentLayerIndex},e.PiskelController.prototype.getCurrentFrameIndex=function(){return this.currentFrameIndex},e.PiskelController.prototype.getPiskel=function(){return this._getPiskel(this.selectedPiskel)},e.PiskelController.prototype.getPiskelData=function(){return this._getPiskelData(this.selectedPiskel)},e.PiskelController.prototype.isTransparent=function(){return this.getLayers().some(function(e){return e.isTransparent()})},e.PiskelController.prototype.renderFrameAt=function(e,t){return pskl.utils.LayerUtils.flattenFrameAt(this.getLayers(),e,t)},e.PiskelController.prototype.hasFrameAt=function(e){return!!this.getCurrentLayer().getFrameAt(e)},e.PiskelController.prototype.addFrame=function(){this.addFrameAt(this.getFrameCount())},e.PiskelController.prototype.addFrameAtCurrentIndex=function(){this.addFrameAt(this.currentFrameIndex+1)},e.PiskelController.prototype.addFrameAt=function(t){this.getLayers().forEach(function(e){e.addFrameAt(this.createEmptyFrame_(),t)}.bind(this)),this.onFrameAddedAt_(t)},e.PiskelController.prototype.onFrameAddedAt_=function(t){this._getPiskel(this.selectedPiskel).hiddenFrames=this._getPiskel(this.selectedPiskel).hiddenFrames.map(function(e){return t<=e?e+1:e}),this.setCurrentFrameIndex(t)},e.PiskelController.prototype.createEmptyFrame_=function(){var e=this._getPiskel(this.selectedPiskel).getWidth(),t=this._getPiskel(this.selectedPiskel).getHeight();return new pskl.model.Frame(e,t)},e.PiskelController.prototype.removeFrameAt=function(t){this.getLayers().forEach(function(e){e.removeFrameAt(t)}),this._getPiskel(this.selectedPiskel).hiddenFrames=this._getPiskel(this.selectedPiskel).hiddenFrames.map(function(e){return t<e?e-1:e}),this.currentFrameIndex>=t&&0<this.currentFrameIndex&&this.setCurrentFrameIndex(this.currentFrameIndex-1)},e.PiskelController.prototype.duplicateCurrentFrame=function(){this.duplicateFrameAt(this.currentFrameIndex)},e.PiskelController.prototype.duplicateFrameAt=function(t){this.getLayers().forEach(function(e){e.duplicateFrameAt(t)}),this.onFrameAddedAt_(t+1)},e.PiskelController.prototype.toggleFrameVisibilityAt=function(t){var e=this._getPiskel(this.selectedPiskel).hiddenFrames;-1===e.indexOf(t)?e.push(t):e=e.filter(function(e){return e!==t}),this._getPiskel(this.selectedPiskel).hiddenFrames=e.sort()},e.PiskelController.prototype.moveFrame=function(t,i){this.getLayers().forEach(function(e){e.moveFrame(t,i)}),this._getPiskel(this.selectedPiskel).hiddenFrames=this._getPiskel(this.selectedPiskel).hiddenFrames.map(function(e){return e===t?i:e>=Math.min(t,i)&&e<=Math.max(t,i)?t<i?e-1:e+1:void 0})},e.PiskelController.prototype.hasVisibleFrameAt=function(e){return-1===this._getPiskel(this.selectedPiskel).hiddenFrames.indexOf(e)},e.PiskelController.prototype.getVisibleFrameIndexes=function(){return this.getCurrentLayer().getFrames().map(function(e,t){return t}).filter(function(e){return-1===this._getPiskel(this.selectedPiskel).hiddenFrames.indexOf(e)}.bind(this))},e.PiskelController.prototype.getFrameCount=function(){return this._getPiskel(this.selectedPiskel).getFrameCount()},e.PiskelController.prototype.setCurrentFrameIndex=function(e){this.hasFrameAt(e)?this.currentFrameIndex=e:window.console.error("Could not set current frame index to "+e)},e.PiskelController.prototype.selectNextFrame=function(){var e=this.currentFrameIndex+1;e<this.getFrameCount()&&this.setCurrentFrameIndex(e)},e.PiskelController.prototype.selectPreviousFrame=function(){var e=this.currentFrameIndex-1;0<=e&&this.setCurrentFrameIndex(e)},e.PiskelController.prototype.setCurrentLayerIndex=function(e){this.hasLayerAt(e)?this.currentLayerIndex=e:window.console.error("Could not set current layer index to "+e)},e.PiskelController.prototype.selectLayer=function(e){e=this.getLayers().indexOf(e);-1!=e&&this.setCurrentLayerIndex(e)},e.PiskelController.prototype.renameLayerAt=function(e,t){e=this.getLayerByIndex(e);e&&e.setName(t)},e.PiskelController.prototype.setLayerOpacityAt=function(e,t){e=this.getLayerByIndex(e);e&&e.setOpacity(t)},e.PiskelController.prototype.mergeDownLayerAt=function(e){var t=this.getLayerByIndex(e),i=this.getLayerByIndex(e-1);t&&i&&(t=pskl.utils.LayerUtils.mergeLayers(t,i),this.removeLayerAt(e),this._getPiskel(this.selectedPiskel).addLayerAt(t,e),this.removeLayerAt(e-1),this.selectLayer(t))},e.PiskelController.prototype.generateLayerName_=function(){for(var e="Layer "+this.layerIdCounter;this.hasLayerForName_(e);)this.layerIdCounter++,e="Layer "+this.layerIdCounter;return e},e.PiskelController.prototype.duplicateCurrentLayer=function(){var e=this.getCurrentLayer(),e=pskl.utils.LayerUtils.clone(e),t=this.getCurrentLayerIndex();this._getPiskel(this.selectedPiskel).addLayerAt(e,t+1),this.setCurrentLayerIndex(t+1)},e.PiskelController.prototype.createLayer=function(e){if(e=e||this.generateLayerName_(),this.hasLayerForName_(e))throw"Layer name should be unique";for(var t=new pskl.model.Layer(e),i=0;i<this.getFrameCount();i++)t.addFrame(this.createEmptyFrame_());e=this.getCurrentLayerIndex();this._getPiskel(this.selectedPiskel).addLayerAt(t,e+1),this.setCurrentLayerIndex(e+1)},e.PiskelController.prototype.hasLayerForName_=function(e){return 0<this._getPiskel(this.selectedPiskel).getLayersByName(e).length},e.PiskelController.prototype.moveLayerUp=function(e){var t=this.getCurrentLayer();this._getPiskel(this.selectedPiskel).moveLayerUp(t,e),this.selectLayer(t)},e.PiskelController.prototype.moveLayerDown=function(e){var t=this.getCurrentLayer();this._getPiskel(this.selectedPiskel).moveLayerDown(t,e),this.selectLayer(t)},e.PiskelController.prototype.removeCurrentLayer=function(){var e=this.getCurrentLayerIndex();this.removeLayerAt(e)},e.PiskelController.prototype.removeLayerAt=function(e){var t;this.hasLayerAt(e)&&(t=this.getLayerAt(e),this._getPiskel(this.selectedPiskel).removeLayer(t),this.getCurrentLayerIndex()===e)&&this.setCurrentLayerIndex(Math.max(0,e-1))},e.PiskelController.prototype.serialize=function(){return pskl.utils.serialization.Serializer.serialize(this._getPiskel(this.selectedPiskel))},e.PiskelController.prototype.isEmpty=function(){return 0===pskl.app.currentColorsService.getCurrentColors().length},e.PiskelController.prototype.getPiskelIds=function(){return this.piskels.map(e=>e.index)},e.PiskelController.prototype.getSelectedPiskel=function(){return this.selectedPiskel},e.PiskelController.prototype.removePiskel=function(t){var e=this.piskels.findIndex(e=>e.index==t);0<=e&&(this.piskels.splice(e,1),this.selectPiskel(this.piskels[this.piskels.length-1].index))},e.PiskelController.prototype.closePiskel=function(t){const i=this.piskels.findIndex(e=>e.index==t);if(0<=i){if(pskl.app.savedStatusService.isDirty(t))if(!window.confirm("Your current sprite has unsaved changes. Are you sure you want to quit?"))return!1;return this.piskels=this.piskels.filter(e=>e.piskel!==this.piskels[i].piskel),this.selectPiskel(this.piskels[i-(0<i?1:0)].index),!0}return!1},e.PiskelController.prototype.debug=function(){console.log(this.piskels)},e.PiskelController.prototype._uuidv4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},e.PiskelController.prototype._getPiskel=function(e){return this._getPiskelData(e).piskel},e.PiskelController.prototype._getPiskelData=function(t){var e=this.piskels.findIndex(e=>e.index==t);if(0<=e)return this.piskels[e]},e.PiskelController.prototype._setPiskel=function(t,e){var i=this.piskels.findIndex(e=>e.index==t);0<=i&&(this.piskels[i].piskel=e)}}(),!function(){var e=$.namespace("pskl.controller.piskel");e.PublicPiskelController=function(e){this.piskelController=e,pskl.utils.wrap(this,this.piskelController)},e.PublicPiskelController.prototype.init=function(){this.resetWrap_("setCurrentFrameIndex"),this.resetWrap_("selectNextFrame"),this.resetWrap_("selectPreviousFrame"),this.resetWrap_("setCurrentLayerIndex"),this.resetWrap_("selectLayer"),this.saveWrap_("renameLayerAt",!1),this.saveWrap_("removeCurrentLayer",!0),this.saveWrap_("addFrame",!0),this.saveWrap_("addFrameAtCurrentIndex",!0),this.saveWrap_("addFrameAt",!0),this.saveWrap_("removeFrameAt",!0),this.saveWrap_("duplicateCurrentFrame",!0),this.saveWrap_("duplicateFrameAt",!0),this.saveWrap_("moveFrame",!0),this.saveWrap_("createLayer",!0),this.saveWrap_("duplicateCurrentLayer",!0),this.saveWrap_("mergeDownLayerAt",!0),this.saveWrap_("moveLayerUp",!0),this.saveWrap_("moveLayerDown",!0),this.saveWrap_("removeCurrentLayer",!0),this.saveWrap_("setLayerOpacityAt",!0),this.saveWrap_("toggleFrameVisibilityAt",!0);var e=pskl.service.keyboard.Shortcuts;pskl.app.shortcutService.registerShortcut(e.MISC.PREVIOUS_FRAME,this.selectPreviousFrame.bind(this)),pskl.app.shortcutService.registerShortcut(e.MISC.NEXT_FRAME,this.selectNextFrame.bind(this)),pskl.app.shortcutService.registerShortcut(e.MISC.NEW_FRAME,this.addFrameAtCurrentIndex.bind(this)),pskl.app.shortcutService.registerShortcut(e.MISC.DUPLICATE_FRAME,this.duplicateCurrentFrame.bind(this))},e.PublicPiskelController.prototype.getWrappedPiskelController=function(){return this.piskelController},e.PublicPiskelController.prototype.newPiskel=function(){var e=this.piskelController.newPiskel();return $.publish(Events.PISKEL_ADDED,e),e},e.PublicPiskelController.prototype.addPiskel=function(e){e=this.piskelController.addPiskel(e);return $.publish(Events.PISKEL_ADDED,e),e},e.PublicPiskelController.prototype.setPiskel=function(e,t){this.piskelController.setPiskel(e,t),$.publish(Events.FRAME_SIZE_CHANGED),$.publish(Events.PISKEL_RESET),t&&t.noSnapshot||$.publish(Events.PISKEL_SAVE_STATE,{type:pskl.service.HistoryService.SNAPSHOT})},e.PublicPiskelController.prototype.selectPiskel=function(e){this.piskelController.selectPiskel(e),$.publish(Events.FRAME_SIZE_CHANGED),$.publish(Events.PISKEL_RESET)},e.PublicPiskelController.prototype.resetWrap_=function(e){this[e]=function(){this.piskelController[e].apply(this.piskelController,arguments),$.publish(Events.PISKEL_RESET)}},e.PublicPiskelController.prototype.saveWrap_=function(t,e){this[t]=e?function(){var e=this.getStateInfo_();this.piskelController[t].apply(this.piskelController,arguments),this.raiseSaveStateEvent_(this.piskelController[t],arguments,e),$.publish(Events.PISKEL_RESET)}:function(){var e=this.getStateInfo_();this.piskelController[t].apply(this.piskelController,arguments),this.raiseSaveStateEvent_(this.piskelController[t],arguments,e)}},e.PublicPiskelController.prototype.getStateInfo_=function(){return{frameIndex:this.piskelController.currentFrameIndex,layerIndex:this.piskelController.currentLayerIndex}},e.PublicPiskelController.prototype.raiseSaveStateEvent_=function(e,t,i){$.publish(Events.PISKEL_SAVE_STATE,{type:pskl.service.HistoryService.REPLAY,scope:this,replay:{fn:e,args:t},state:i})},e.PublicPiskelController.prototype.replay=function(e,t){t.fn.apply(this.piskelController,t.args)},e.PublicPiskelController.prototype.getPiskelIds=function(){return this.piskelController.getPiskelIds()},e.PublicPiskelController.prototype.getSelectedPiskel=function(){return this.piskelController.getSelectedPiskel()},e.PublicPiskelController.prototype.closePiskel=function(e){return!!this.piskelController.closePiskel(e)&&($.publish(Events.PISKEL_REMOVED,e),!0)}}(),!function(){var e=$.namespace("pskl.controller");e.CursorCoordinatesController=function(e){this.piskelController=e,this.origin=null,this.coordinates={x:-1,y:-1}},e.CursorCoordinatesController.prototype.init=function(){this.coordinatesContainer=document.querySelector(".cursor-coordinates"),$.subscribe(Events.CURSOR_MOVED,this.onCursorMoved_.bind(this)),$.subscribe(Events.DRAG_START,this.onDragStart_.bind(this)),$.subscribe(Events.DRAG_END,this.onDragEnd_.bind(this)),$.subscribe(Events.FRAME_SIZE_CHANGED,this.redraw.bind(this)),$.subscribe(Events.ZOOM_CHANGED,this.redraw.bind(this)),$.subscribe(Events.PISKEL_RESET,this.redraw.bind(this)),this.redraw()},e.CursorCoordinatesController.prototype.redraw=function(){var e="",t=(this.origin&&(e+=this.origin.x+":"+this.origin.y+" to "),this.coordinates.x),i=this.coordinates.y,r=this.piskelController.getCurrentFrame();void 0!==r&&r.containsPixel(t,i)&&(e+="Cursor: ("+t+":"+i+") ",this.origin)&&(e+=" ("+(Math.abs(t-this.origin.x)+1)+"x"+(Math.abs(i-this.origin.y)+1)+")"),pskl.app.drawingController&&(e+="Zoom ("+pskl.app.drawingController.compositeRenderer.getZoom().toFixed(2)+") "),this.coordinatesContainer.innerHTML=this.getFrameSizeHTML_()+e+this.getCurrentFrameIndexHTML_()},e.CursorCoordinatesController.prototype.getCurrentFrameIndexHTML_=function(){return"Frame ("+(this.piskelController.getCurrentFrameIndex()+1)+"/"+this.piskelController.getFrameCount()+")"},e.CursorCoordinatesController.prototype.getFrameSizeHTML_=function(){return"Size ["+this.piskelController.getWidth()+"x"+this.piskelController.getHeight()+"] "},e.CursorCoordinatesController.prototype.onCursorMoved_=function(e,t,i){this.coordinates={x:t,y:i},this.redraw()},e.CursorCoordinatesController.prototype.onDragStart_=function(e,t,i){this.origin={x:t,y:i},this.redraw()},e.CursorCoordinatesController.prototype.onDragEnd_=function(e){this.origin=null,this.redraw()}}(),!function(){var i=$.namespace("pskl.controller");i.DrawingController=function(e,t){this.piskelController=e,this.dragHandler=new i.drawing.DragHandler(this),this.overlayFrame=pskl.model.Frame.createEmptyFromFrame(e.getCurrentFrame()),this.container=t;t={zoom:this.calculateZoom_(),supportGridRendering:!1,height:this.getContainerHeight_(),width:this.getContainerWidth_(),xOffset:0,yOffset:0};this.overlayRenderer=new pskl.rendering.frame.CachedFrameRenderer(this.container,t,["canvas-overlay"]),this.onionSkinRenderer=pskl.rendering.OnionSkinRenderer.createInContainer(this.container,t,e),this.layersRenderer=new pskl.rendering.layer.LayersRenderer(this.container,t,e),t.supportGridRendering=!0,this.renderer=new pskl.rendering.frame.CachedFrameRenderer(this.container,t,["drawing-canvas"]),this.compositeRenderer=new pskl.rendering.CompositeRenderer,this.compositeRenderer.add(this.overlayRenderer).add(this.renderer).add(this.layersRenderer).add(this.onionSkinRenderer),this.isClicked=!1,this.previousMousemoveTime=0,this.currentToolBehavior=null},i.DrawingController.prototype.init=function(){this.initMouseBehavior(),$.subscribe(Events.TOOL_SELECTED,function(e,t){this.currentToolBehavior=t,this.overlayFrame.clear()}.bind(this)),window.addEventListener("resize",this.startResizeTimer_.bind(this)),$.subscribe(Events.USER_SETTINGS_CHANGED,this.onUserSettingsChange_.bind(this)),$.subscribe(Events.FRAME_SIZE_CHANGED,this.onFrameSizeChange_.bind(this)),$.subscribe(Events.FORCE_REFRESH,this.forceRefresh_.bind(this));var e=pskl.service.keyboard.Shortcuts;pskl.app.shortcutService.registerShortcut(e.MISC.RESET_ZOOM,this.resetZoom_.bind(this)),pskl.app.shortcutService.registerShortcut(e.MISC.INCREASE_ZOOM,this.updateZoom_.bind(this,1)),pskl.app.shortcutService.registerShortcut(e.MISC.DECREASE_ZOOM,this.updateZoom_.bind(this,-1)),pskl.app.shortcutService.registerShortcut(e.MISC.OFFSET_UP,this.updateOffset_.bind(this,"up")),pskl.app.shortcutService.registerShortcut(e.MISC.OFFSET_RIGHT,this.updateOffset_.bind(this,"right")),pskl.app.shortcutService.registerShortcut(e.MISC.OFFSET_DOWN,this.updateOffset_.bind(this,"down")),pskl.app.shortcutService.registerShortcut(e.MISC.OFFSET_LEFT,this.updateOffset_.bind(this,"left")),window.setTimeout(function(){this.afterWindowResize_(),this.resetZoom_()}.bind(this),100)},i.DrawingController.prototype.initMouseBehavior=function(){this.container.addEventListener("mousedown",this.onMousedown_.bind(this)),pskl.utils.UserAgent.isChrome||pskl.utils.UserAgent.isIE11?this.container.addEventListener("mousewheel",this.onMousewheel_.bind(this)):this.container.addEventListener("wheel",this.onMousewheel_.bind(this)),window.addEventListener("mouseup",this.onMouseup_.bind(this)),window.addEventListener("mousemove",this.onMousemove_.bind(this)),window.addEventListener("keyup",this.onKeyup_.bind(this)),this.container.addEventListener("touchstart",this.onTouchstart_.bind(this)),this.container.addEventListener("touchmove",this.onTouchmove_.bind(this)),this.container.addEventListener("touchend",this.onTouchend_.bind(this)),document.body.addEventListener("contextmenu",this.onCanvasContextMenu_.bind(this))},i.DrawingController.prototype.startResizeTimer_=function(){this.resizeTimer&&window.clearInterval(this.resizeTimer),this.resizeTimer=window.setTimeout(this.afterWindowResize_.bind(this),200)},i.DrawingController.prototype.afterWindowResize_=function(){var e=this.compositeRenderer.getDisplaySize().width;this.compositeRenderer.setDisplaySize(this.getContainerWidth_(),this.getContainerHeight_());e=this.compositeRenderer.getDisplaySize().width/e*this.compositeRenderer.getZoom();this.compositeRenderer.setZoom(e),$.publish(Events.ZOOM_CHANGED)},i.DrawingController.prototype.onUserSettingsChange_=function(e,t,i){t==pskl.UserSettings.SHOW_GRID?console.warn("DrawingController:onUserSettingsChange_ not implemented !"):t!=pskl.UserSettings.ONION_SKIN&&t!=pskl.UserSettings.LAYER_PREVIEW||(this.onionSkinRenderer.clear(),this.onionSkinRenderer.flush(),this.layersRenderer.clear(),this.layersRenderer.flush(),this.render())},i.DrawingController.prototype.onFrameSizeChange_=function(){this.compositeRenderer.setDisplaySize(this.getContainerWidth_(),this.getContainerHeight_()),this.compositeRenderer.setZoom(this.calculateZoom_()),this.compositeRenderer.setOffset(0,0),$.publish(Events.ZOOM_CHANGED)},i.DrawingController.prototype.onTouchstart_=function(e){this.onMousedown_(e)},i.DrawingController.prototype.onTouchmove_=function(e){this.onMousemove_(e),e.preventDefault()},i.DrawingController.prototype.onTouchend_=function(e){this.onMouseup_(e)},i.DrawingController.prototype.forceRefresh_=function(e){this.currentToolBehavior.moveUnactiveToolAt(0,0,this.piskelController.getCurrentFrame(),this.overlayFrame,e)},i.DrawingController.prototype.onMousedown_=function(e){$.publish(Events.MOUSE_EVENT,[e,this]);var t=this.piskelController.getCurrentFrame(),i=this.getSpriteCoordinates(e.clientX,e.clientY);e.changedTouches&&e.changedTouches[0]&&(i=this.getSpriteCoordinates(e.changedTouches[0].clientX,e.changedTouches[0].clientY)),t.containsPixel(i.x,i.y)&&(this.isClicked=!0,e.button===Constants.MIDDLE_BUTTON?this.dragHandler.startDrag(e.clientX,e.clientY):e.altKey&&!this.currentToolBehavior.supportsAlt()?(this.currentToolBehavior.hideHighlightedPixel(this.overlayFrame),this.isPickingColor=!0):(this.currentToolBehavior.hideHighlightedPixel(this.overlayFrame),$.publish(Events.TOOL_PRESSED),this.currentToolBehavior.applyToolAt(i.x,i.y,t,this.overlayFrame,e)))},i.DrawingController.prototype.onMousemove_=function(e){var t=this.piskelController.getCurrentFrame(),i=(this._clientX=e.clientX,this._clientY=e.clientY,e.changedTouches&&e.changedTouches[0]&&(this._clientX=e.changedTouches[0].clientX,this._clientY=e.changedTouches[0].clientY),this.getSpriteCoordinates(this._clientX,this._clientY));(void 0===t||t.containsPixel(i.x,i.y))&&(t=(new Date).getTime())-this.previousMousemoveTime>Constants.MOUSEMOVE_THROTTLING&&(this.moveTool_(this._clientX,this._clientY,e),this.previousMousemoveTime=t)},i.DrawingController.prototype.onKeyup_=function(e){this.moveTool_(this._clientX,this._clientY,e)},i.DrawingController.prototype.moveTool_=function(e,t,i){var r=this.getSpriteCoordinates(e,t),n=this.piskelController.getCurrentFrame();this.isClicked?pskl.app.mouseStateService.isMiddleButtonPressed()?this.dragHandler.updateDrag(e,t):this.isPickingColor||($.publish(Events.MOUSE_EVENT,[i,this]),this.currentToolBehavior.moveToolAt(0|r.x,0|r.y,n,this.overlayFrame,i)):this.currentToolBehavior.moveUnactiveToolAt(r.x,r.y,n,this.overlayFrame,i),$.publish(Events.CURSOR_MOVED,[r.x,r.y])},i.DrawingController.prototype.onMousewheel_=function(e){var t=pskl.utils.UserAgent.isIE11?e.wheelDelta:pskl.utils.UserAgent.isFirefox?-40*e.deltaY:e.wheelDeltaY,t=(t=t||0)/120,e=((pskl.utils.UserAgent.isMac?e.metaKey:e.ctrlKey)&&(t*=5,e.preventDefault()),this.getSpriteCoordinates(e.clientX,e.clientY));this.updateZoom_(t,e)},i.DrawingController.prototype.updateOffset_=function(e){var t=this.getOffset();"up"===e?--t.y:"right"===e?t.x+=1:"down"===e?t.y+=1:"left"===e&&--t.x,this.setOffset(t.x,t.y)},i.DrawingController.prototype.updateZoom_=function(e,t){var i,r,n,o,s;0!==e&&(i=this.getOffset(),r=this.getContainerWidth_()/this.renderer.getZoom(),n=this.getContainerHeight_()/this.renderer.getZoom(),e=e*this.getZoomStep_(),this.setZoom_(this.renderer.getZoom()+e),"object"==typeof t)&&(e=(t.x-i.x)/r,t=(t.y-i.y)/n,o=this.getContainerWidth_()/this.renderer.getZoom(),s=this.getContainerHeight_()/this.renderer.getZoom(),this.setOffset(i.x-(o-r)*e,i.y-(s-n)*t))},i.DrawingController.prototype.onMouseup_=function(e){var t,i,r;this.isClicked&&(t=this.getSpriteCoordinates(e.clientX,e.clientY),e.changedTouches&&e.changedTouches[0]&&(t=this.getSpriteCoordinates(e.changedTouches[0].clientX,e.changedTouches[0].clientY)),this.isClicked=!1,i=(r=pskl.app.mouseStateService.isMiddleButtonPressed())&&!this.dragHandler.isDragging(),r=r&&this.dragHandler.isDragging(),this.isPickingColor||i?(this.pickColorAt_(t),this.isPickingColor=!1,this.flashColorPicker_()):r?this.dragHandler.stopDrag():(this.currentToolBehavior.releaseToolAt(t.x,t.y,this.piskelController.getCurrentFrame(),this.overlayFrame,e),$.publish(Events.TOOL_RELEASED)),$.publish(Events.MOUSE_EVENT,[e,this]))},i.DrawingController.prototype.pickColorAt_=function(e){var t=this.piskelController.getCurrentFrame();t.containsPixel(e.x,e.y)&&(t=pskl.utils.intToColor(t.getPixel(e.x,e.y)),e=pskl.app.mouseStateService.isRightButtonPressed()?Events.SELECT_SECONDARY_COLOR:Events.SELECT_PRIMARY_COLOR,$.publish(e,[t]))},i.DrawingController.prototype.flashColorPicker_=function(){document.body.classList.add("tool-colorpicker"),document.body.classList.remove(this.currentToolBehavior.toolId),window.clearTimeout(this.flashColorPickerTimer),this.flashColorPickerTimer=window.setTimeout(function(){document.body.classList.remove("tool-colorpicker"),document.body.classList.add(this.currentToolBehavior.toolId)}.bind(this),200)},i.DrawingController.prototype.getSpriteCoordinates=function(e,t){return this.renderer.getCoordinates(e,t)},i.DrawingController.prototype.getScreenCoordinates=function(e,t){return this.renderer.reverseCoordinates(e,t)},i.DrawingController.prototype.onCanvasContextMenu_=function(e){if(e.target.closest&&e.target.closest("#drawing-canvas-container"))return e.preventDefault(),e.stopPropagation(),!(e.cancelBubble=!0)},i.DrawingController.prototype.render=function(){var e=this.piskelController.getCurrentFrame();void 0===e||e.isSameSize(this.overlayFrame)||(this.overlayFrame=pskl.model.Frame.createEmptyFromFrame(e)),pskl.UserSettings.get(pskl.UserSettings.ONION_SKIN)&&this.onionSkinRenderer.render(),pskl.UserSettings.get(pskl.UserSettings.LAYER_PREVIEW)&&this.layersRenderer.render(),this.renderer.render(e),this.overlayRenderer.render(this.overlayFrame)},i.DrawingController.prototype.calculateZoom_=function(){var e=this.piskelController.getCurrentFrame().getHeight(),t=this.piskelController.getCurrentFrame().getWidth();return Math.min(this.getAvailableWidth_()/t,this.getAvailableHeight_()/e)},i.DrawingController.prototype.getAvailableHeight_=function(){return document.querySelector("#main-wrapper").getBoundingClientRect().height},i.DrawingController.prototype.getSelectorWidth_=function(e){return document.querySelector(e).getBoundingClientRect().width},i.DrawingController.prototype.getAvailableWidth_=function(){var e=this.getSelectorWidth_(".left-column")+this.getSelectorWidth_(".right-column")+this.getSelectorWidth_("#tool-section")+this.getSelectorWidth_("#application-action-section");return this.getSelectorWidth_("#main-wrapper")-e-10},i.DrawingController.prototype.getContainerHeight_=function(){return this.getAvailableHeight_()},i.DrawingController.prototype.getContainerWidth_=function(){return this.getAvailableWidth_()},i.DrawingController.prototype.getRenderer=function(){return this.compositeRenderer},i.DrawingController.prototype.getOffset=function(){return this.compositeRenderer.getOffset()},i.DrawingController.prototype.setOffset=function(e,t){this.compositeRenderer.setOffset(e,t),$.publish(Events.ZOOM_CHANGED)},i.DrawingController.prototype.resetZoom_=function(){this.setZoom_(this.calculateZoom_())},i.DrawingController.prototype.getZoomStep_=function(){return Math.max(.1,this.renderer.getZoom()/15)},i.DrawingController.prototype.setZoom_=function(e){this.compositeRenderer.setZoom(e),$.publish(Events.ZOOM_CHANGED)}}(),!function(){var e=$.namespace("pskl.controller.drawing");e.DragHandler=function(e){this.drawingController=e,this.isDragging_=!1,this.updateOrigin_(-1,-1)},e.DragHandler.prototype.startDrag=function(e,t){e=this.drawingController.getSpriteCoordinates(e,t);this.updateOrigin_(e.x,e.y)},e.DragHandler.prototype.updateDrag=function(e,t){var i=this.drawingController.getOffset(),r=this.calculateOffset_(e,t);i.y===r.y&&i.x===r.x||(this.isDragging_=!0,this.drawingController.setOffset(r.x,r.y),i=this.drawingController.getSpriteCoordinates(e,t),this.updateOrigin_(i.x,i.y))},e.DragHandler.prototype.stopDrag=function(){this.isDragging_=!1,this.origin=null},e.DragHandler.prototype.isDragging=function(){return this.isDragging_},e.DragHandler.prototype.calculateOffset_=function(e,t){e=this.drawingController.getSpriteCoordinates(e,t),t=this.drawingController.getOffset();return{x:t.x-2*(e.x-this.origin.x),y:t.y-2*(e.y-this.origin.y)}},e.DragHandler.prototype.updateOrigin_=function(e,t){this.origin=this.origin||{},this.origin.x=e,this.origin.y=t}}(),!function(){var e=$.namespace("pskl.controller"),o="select",n="newframe",s="toggle";e.FramesListController=function(e,t){this.piskelController=e,this.container=t,this.previewList=t.querySelector("#preview-list"),this.duplicateButton=t.querySelector(".duplicate-frame-action"),this.deleteButton=t.querySelector(".delete-frame-action"),this.refreshZoom_(),this.redrawFlag=!0,this.regenerateDomFlag=!0,this.justDropped=!1,this.cachedFrameProcessor=new pskl.model.frame.CachedFrameProcessor,this.cachedFrameProcessor.setFrameProcessor(this.frameToPreviewCanvas_.bind(this)),this.cachedFrameProcessor.setOutputCloner(this.clonePreviewCanvas_.bind(this)),this.initDragndropBehavior_()},e.FramesListController.prototype.init=function(){$.subscribe(Events.TOOL_RELEASED,this.flagForRedraw_.bind(this)),$.subscribe(Events.PISKEL_RESET,this.flagForRedraw_.bind(this,!0)),$.subscribe(Events.USER_SETTINGS_CHANGED,this.flagForRedraw_.bind(this)),$.subscribe(Events.PISKEL_RESET,this.refreshZoom_.bind(this)),this.previewListScroller=document.querySelector("#preview-list-scroller"),this.previewListScroller.addEventListener("scroll",this.updateScrollerOverflows.bind(this)),this.container.addEventListener("click",this.onContainerClick_.bind(this)),this.duplicateButton.addEventListener("click",this.onDuplicateClick_.bind(this)),this.deleteButton.addEventListener("click",this.onDeleteClick_.bind(this)),this.updateScrollerOverflows()},e.FramesListController.prototype.flagForRedraw_=function(e){this.redrawFlag=!0,e&&(this.regenerateDomFlag=!0)},e.FramesListController.prototype.refreshZoom_=function(){this.zoom=this.calculateZoom_()},e.FramesListController.prototype.render=function(){this.redrawFlag&&(this.regenerateDomFlag&&(this.tiles=[],this.addFrameTile=null,this.createPreviews_(),this.regenerateDomFlag=!1),this.updatePreviews_(),this.redrawFlag=!1)},e.FramesListController.prototype.updateScrollerOverflows=function(){var e=this.previewListScroller,t=e.offsetHeight,e=e.scrollTop,i=this.previewList.offsetHeight,r=this.container.querySelector(".top-overflow").offsetHeight,n=!1,o=!1;t<i&&(r<e&&(n=!0),r<i-e-t)&&(o=!0),this.container.classList.toggle("top-overflow-visible",n),this.container.classList.toggle("bottom-overflow-visible",o)},e.FramesListController.prototype.onDuplicateClick_=function(){var e=this.piskelController.getCurrentFrameIndex(),t=(this.piskelController.duplicateFrameAt(e),this.createPreviewTile_(e+1));this.previewList.insertBefore(t,this.tiles[e].nextSibling),this.tiles.splice(e,0,t),this.updateScrollerOverflows()},e.FramesListController.prototype.onDeleteClick_=function(){var e=this.piskelController.getCurrentFrameIndex();this.piskelController.removeFrameAt(e),this.previewList.removeChild(this.tiles[e]),this.tiles.splice(e,1),this.updateScrollerOverflows()},e.FramesListController.prototype.onContainerClick_=function(e){var t,i,e=pskl.utils.Dom.getParentWithData(e.target,"tileAction");e&&(t=e.dataset.tileAction,e=parseInt(e.dataset.tileNumber,10),t!==o||this.justDropped?t===n?(this.piskelController.addFrame(),i=this.createPreviewTile_(this.tiles.length),this.tiles.push(i),this.previewList.insertBefore(i,this.addFrameTile),this.updateScrollerOverflows()):t==s&&this.piskelController.toggleFrameVisibilityAt(e):this.piskelController.setCurrentFrameIndex(e),$.publish(Events.FORCE_REFRESH,null),this.flagForRedraw_())},e.FramesListController.prototype.updatePreviews_=function(){for(var e=0,t=this.tiles.length;e<t;e++){this.tiles[e].classList.remove("selected"),this.tiles[e].querySelector(".tile-count").classList.remove("toggled"),this.tiles[e].setAttribute("data-tile-number",e),this.tiles[e].querySelector(".tile-count").innerHTML=e+1,this.piskelController.hasVisibleFrameAt(e)&&this.tiles[e].querySelector(".tile-count").classList.add("toggled");var i=this.piskelController.getCurrentLayer().getFrameAt(e).getHash();this.tiles[e].getAttribute("data-tile-hash")!==i&&(this.tiles[e].querySelector("canvas")?this.tiles[e].querySelector(".canvas-container").replaceChild(this.getCanvasForFrame(this.piskelController.getCurrentLayer().getFrameAt(e)),this.tiles[e].querySelector("canvas")):this.tiles[e].querySelector(".canvas-container").appendChild(this.getCanvasForFrame(this.piskelController.getCurrentLayer().getFrameAt(e))))}var r=this.container.querySelectorAll(".delete-frame-action, .dnd-action"),n=1<this.piskelController.getFrameCount()?"block":"none";for(e=0,t=r.length;e<t;e++)r[e].style.display=n;this.tiles[this.piskelController.getCurrentFrameIndex()].classList.add("selected")},e.FramesListController.prototype.createPreviews_=function(){this.previewList.innerHTML="";for(var e=document.querySelectorAll(".tooltip"),t=(Array.prototype.forEach.call(e,function(e){e.parentNode.removeChild(e)}),this.piskelController.getFrameCount()),i=0;i<t;i++){var r=this.createPreviewTile_(i);this.previewList.appendChild(r),this.tiles[i]=r}e=document.createElement("div");e.id="add-frame-action",e.className="add-frame-action",e.setAttribute("data-tile-action",n),e.innerHTML='<div class="add-frame-action-icon icon-frame-plus-white"></div><div class="label">Add new frame</div>',this.previewList.appendChild(e),this.addFrameTile=e,this.updateScrollerOverflows()},e.FramesListController.prototype.initDragndropBehavior_=function(){$(this.previewList).sortable({placeholder:"preview-tile preview-tile-drop-proxy",update:this.onUpdate_.bind(this),stop:this.onSortableStop_.bind(this),items:".preview-tile",axis:"y",tolerance:"pointer"}),$(this.previewList).disableSelection()},e.FramesListController.prototype.onUpdate_=function(e,t){var t=t.item.get(0),i=parseInt(t.dataset.tileNumber,10),r=document.querySelectorAll(".preview-tile"),r=Array.prototype.indexOf.call(r,t),t=(this.piskelController.moveFrame(i,r),this.piskelController.setCurrentFrameIndex(r),this.tiles.splice(i,1)[0]);this.tiles.splice(r,0,t),this.flagForRedraw_()},e.FramesListController.prototype.onSortableStop_=function(e,t){this.justDropped=!0,this.resizeTimer=window.setTimeout(function(){this.justDropped=!1}.bind(this),200)},e.FramesListController.prototype.createPreviewTile_=function(e){var t=this.piskelController.getCurrentLayer().getFrameAt(e),i=document.createElement("li"),r=(i.setAttribute("data-tile-number",e),i.setAttribute("data-tile-hash",t.getHash()),i.setAttribute("data-tile-action",o),i.classList.add("preview-tile"),this.piskelController.getCurrentFrame()==t&&i.classList.add("selected"),document.createElement("div")),n=(r.classList.add("canvas-container",pskl.UserSettings.get(pskl.UserSettings.CANVAS_BACKGROUND)),this.zoom*this.piskelController.getCurrentFrame().getHeight()),n=(Constants.PREVIEW_FILM_SIZE-n)/2,n=(r.style.marginTop=n+"px",this.zoom*this.piskelController.getCurrentFrame().getWidth()),n=(Constants.PREVIEW_FILM_SIZE-n)/2,n=(r.style.marginLeft=n+"px",r.style.marginRight=n+"px",document.createElement("div")),n=(n.className="canvas-background",r.appendChild(n),r.appendChild(this.getCanvasForFrame(t)),i.appendChild(r),document.createElement("button"));return n.setAttribute("rel","tooltip"),n.setAttribute("title","Toggle for preview"),n.setAttribute("data-tile-number",e),n.setAttribute("data-tile-action",s),n.className="tile-overlay tile-count toggle-frame-action",n.innerHTML=e+1,i.appendChild(n),i},e.FramesListController.prototype.getCanvasForFrame=function(e){return this.cachedFrameProcessor.get(e,this.zoom)},e.FramesListController.prototype.frameToPreviewCanvas_=function(e){e=new pskl.rendering.CanvasRenderer(e,this.zoom),e.drawTransparentAs(Constants.TRANSPARENT_COLOR),e=e.render();return e.classList.add("tile-view","canvas"),e},e.FramesListController.prototype.clonePreviewCanvas_=function(e){e=pskl.utils.CanvasUtils.clone(e);return e.classList.add("tile-view","canvas"),e},e.FramesListController.prototype.calculateZoom_=function(){var e=this.piskelController.getCurrentFrame(),e=Math.max(e.getHeight(),e.getWidth());return Constants.PREVIEW_FILM_SIZE/e}}(),!function(){var e=$.namespace("pskl.controller");e.HeaderController=function(e,t){this.piskelController=e,this.savedStatusService=t},e.HeaderController.prototype.init=function(){this.piskelName_=document.querySelector(".piskel-name"),$.subscribe(Events.BEFORE_SAVING_PISKEL,this.onBeforeSavingPiskelEvent_.bind(this)),$.subscribe(Events.AFTER_SAVING_PISKEL,this.onAfterSavingPiskelEvent_.bind(this)),$.subscribe(Events.PISKEL_DESCRIPTOR_UPDATED,this.updateHeader_.bind(this)),$.subscribe(Events.PISKEL_RESET,this.updateHeader_.bind(this)),$.subscribe(Events.PISKEL_SAVED_STATUS_UPDATE,this.updateHeader_.bind(this)),$.subscribe(Events.PISKEL_CHANGED,this.updateHeader_.bind(this)),this.updateHeader_()},e.HeaderController.prototype.updateHeader_=function(){try{var e=this.piskelController.getPiskel().getDescriptor().name;this.savedStatusService.isDirty()&&(e+=" *"),this.piskelName_&&(this.piskelName_.textContent=e)}catch(e){console.warn("Could not update header : "+e.message)}},e.HeaderController.prototype.onBeforeSavingPiskelEvent_=function(){this.piskelName_&&this.piskelName_.classList.add("piskel-name-saving")},e.HeaderController.prototype.onAfterSavingPiskelEvent_=function(){this.piskelName_&&this.piskelName_.classList.remove("piskel-name-saving")}}(),!function(){var e=$.namespace("pskl.controller");e.LayersListController=function(e){this.piskelController=e,this.layerPreviewShortcut=pskl.service.keyboard.Shortcuts.MISC.LAYER_PREVIEW,this.startRenamingCurrentLayer_=this.startRenamingCurrentLayer_.bind(this),this.onRenameInput_=this.onRenameInput_.bind(this)},e.LayersListController.prototype.init=function(){this.isRenaming=!1,this.layerItemTemplate_=pskl.utils.Template.get("layer-item-template"),this.layerNameInputTemplate_=pskl.utils.Template.get("layer-name-input-template"),this.rootEl=document.querySelector(".layers-list-container"),this.layersListEl=document.querySelector(".layers-list"),this.toggleLayerPreviewEl=document.querySelector(".layers-toggle-preview"),this.rootEl.addEventListener("click",this.onClick_.bind(this)),this.toggleLayerPreviewEl.addEventListener("click",this.toggleLayerPreview_.bind(this)),this.createButtonTooltips_(),this.initToggleLayerPreview_(),this.renderLayerList_(),this.updateToggleLayerPreview_(),$.subscribe(Events.PISKEL_RESET,this.renderLayerList_.bind(this)),$.subscribe(Events.USER_SETTINGS_CHANGED,this.onUserSettingsChange_.bind(this))},e.LayersListController.prototype.renderLayerList_=function(){var e=this.layersListEl.scrollTop;this.layersListEl.innerHTML="";this.piskelController.getLayers().forEach(this.addLayerItem.bind(this)),this.updateButtonStatus_(),this.layersListEl.scrollTop=e;e=this.layersListEl.querySelector(".current-layer-item");e&&e.scrollIntoViewIfNeeded(!1)},e.LayersListController.prototype.createButtonTooltips_=function(){var e=pskl.utils.TooltipFormatter.format("Create a layer",null,[{key:"shift",description:"Clone current layer"}]),e=(this.rootEl.querySelector('[data-action="add"]').setAttribute("title",e),pskl.utils.TooltipFormatter.format("Move layer down",null,[{key:"shift",description:"Move to the bottom"}])),e=(this.rootEl.querySelector('[data-action="down"]').setAttribute("title",e),pskl.utils.TooltipFormatter.format("Move layer up",null,[{key:"shift",description:"Move to the top"}]));this.rootEl.querySelector('[data-action="up"]').setAttribute("title",e)},e.LayersListController.prototype.initToggleLayerPreview_=function(){pskl.app.shortcutService.registerShortcut(this.layerPreviewShortcut,this.toggleLayerPreview_.bind(this));var e=pskl.utils.TooltipFormatter.format("Preview all layers",this.layerPreviewShortcut,[{description:"Opacity defined in PREFERENCES"}]);this.toggleLayerPreviewEl.setAttribute("title",e)},e.LayersListController.prototype.updateButtonStatus_=function(){var e=this.piskelController.getLayers(),t=this.piskelController.getCurrentLayerIndex(),i=0===t,r=1===e.length,t=t===e.length-1;this.toggleButtonDisabledState_("up",t),this.toggleButtonDisabledState_("down",i),this.toggleButtonDisabledState_("merge",i),this.toggleButtonDisabledState_("delete",r)},e.LayersListController.prototype.toggleButtonDisabledState_=function(e,t){e=document.querySelector('.layers-button[data-action="'+e+'"]');t?(e.setAttribute("disabled","disabled"),e.blur()):e.removeAttribute("disabled")},e.LayersListController.prototype.updateToggleLayerPreview_=function(){var e="layers-toggle-preview-enabled";pskl.UserSettings.get(pskl.UserSettings.LAYER_PREVIEW)?this.toggleLayerPreviewEl.classList.add(e):this.toggleLayerPreviewEl.classList.remove(e)},e.LayersListController.prototype.onUserSettingsChange_=function(e,t,i){t==pskl.UserSettings.LAYER_PREVIEW&&this.updateToggleLayerPreview_()},e.LayersListController.prototype.addLayerItem=function(e,t){var i,r=this.piskelController.getCurrentLayer()===e,n=r&&this.isRenaming,t=pskl.utils.Template.replace(this.layerItemTemplate_,{layername:e.getName(),layerindex:t,"isselected:current-layer-item":r,opacity:e.getOpacity()}),t=pskl.utils.Template.createFromHTML(t),r=(this.layersListEl.insertBefore(t,this.layersListEl.firstChild),t.offsetWidth<t.scrollWidth&&((i=t.querySelector(".layer-name")).classList.add("overflowing-name"),i.setAttribute("title",e.getName()),i.setAttribute("rel","tooltip")),r&&(t.removeEventListener("dblclick",this.startRenamingCurrentLayer_),t.addEventListener("dblclick",this.startRenamingCurrentLayer_)),n&&(r=pskl.utils.Template.replace(this.layerNameInputTemplate_,{layername:e.getName()}),n=pskl.utils.Template.createFromHTML(r),i=t.querySelector(".layer-name"),t.replaceChild(n,i),n.removeEventListener("blur",this.onRenameInput_),n.removeEventListener("keydown",this.onRenameInput_),n.addEventListener("blur",this.onRenameInput_),n.addEventListener("keydown",this.onRenameInput_),n.focus(),n.select()),e.getOpacity());t.querySelector(".layer-item-opacity").style.color=1==r?"#039BE5":0==r?"#969696":"#ffffff"},e.LayersListController.prototype.onClick_=function(e){var t,i=e.target||e.srcElement;i.classList.contains("button")?this.onButtonClick_(i,e):i.classList.contains("layer-name")?(e=this.piskelController.getCurrentLayerIndex(),(t=pskl.utils.Dom.getData(i,"layerIndex"))!=e&&(i.parentElement.parentElement.querySelector(".current-layer-item").removeEventListener("dblclick",this.startRenamingCurrentLayer_),this.piskelController.setCurrentLayerIndex(parseInt(t,10)))):i.classList.contains("layer-item-opacity")&&(t=pskl.utils.Dom.getData(i,"layerIndex"),e=this.piskelController.getLayerAt(parseInt(t,10)),i=window.prompt("Set layer opacity (value between 0 and 1)",e.getOpacity()),this.piskelController.setLayerOpacityAt(t,i))},e.LayersListController.prototype.startRenamingCurrentLayer_=function(){this.isRenaming=!0,this.renderLayerList_()},e.LayersListController.prototype.onRenameInput_=function(e){var t=e.target||e.srcElement;"Enter"===e.key?this.finishRenamingCurrentLayer_(t,t.value):e.key&&"Escape"!==e.key||this.finishRenamingCurrentLayer_(t)},e.LayersListController.prototype.finishRenamingCurrentLayer_=function(e,t){var i;t&&(i=this.piskelController.getCurrentLayerIndex(),this.piskelController.renameLayerAt(i,t)),e.removeEventListener("blur",this.onRenameInput_),e.removeEventListener("keydown",this.onRenameInput_),this.isRenaming=!1,this.renderLayerList_()},e.LayersListController.prototype.mergeDownCurrentLayer_=function(){var e=this.piskelController.getCurrentLayerIndex();this.piskelController.mergeDownLayerAt(e),this.renderLayerList_()},e.LayersListController.prototype.onButtonClick_=function(e,t){e=e.getAttribute("data-action");"up"==e?this.piskelController.moveLayerUp(t.shiftKey):"down"==e?this.piskelController.moveLayerDown(t.shiftKey):"add"==e?t.shiftKey?this.piskelController.duplicateCurrentLayer():this.piskelController.createLayer():"delete"==e?this.piskelController.removeCurrentLayer():"merge"==e?this.mergeDownCurrentLayer_():"edit"==e&&this.startRenamingCurrentLayer_()},e.LayersListController.prototype.toggleLayerPreview_=function(){var e=pskl.UserSettings.get(pskl.UserSettings.LAYER_PREVIEW),t=pskl.UserSettings.get(pskl.UserSettings.LAYER_OPACITY),e=!e;pskl.UserSettings.set(pskl.UserSettings.LAYER_PREVIEW,e),e&&0===t&&pskl.UserSettings.set(pskl.UserSettings.LAYER_OPACITY,Constants.DEFAULT.LAYER_OPACITY)}}(),!function(){var e=$.namespace("pskl.controller.preview");e.PopupPreviewController=function(e){this.piskelController=e,this.popup=null,this.renderer=null,this.renderFlag=!1},e.PopupPreviewController.prototype.init=function(){pskl.utils.Event.addEventListener(window,"unload",this.onMainWindowUnload_,this)},e.PopupPreviewController.prototype.isOpen=function(){return!!this.popup},e.PopupPreviewController.prototype.open=function(){this.isOpen()?this.popup.focus():(this.popup=window.open("about:blank","","width=320,height=320"),window.setTimeout(this.onPopupLoaded.bind(this),500))},e.PopupPreviewController.prototype.onPopupLoaded=function(){this.popup.document.title="Piskel - preview",this.popup.document.body.innerHTML=pskl.utils.Template.get("popup-preview-partial"),pskl.utils.Event.addEventListener(this.popup,"resize",this.onWindowResize_,this),pskl.utils.Event.addEventListener(this.popup,"unload",this.onPopupClosed_,this);var e=this.popup.document.querySelector(".preview-container");this.renderer=new pskl.rendering.frame.BackgroundImageFrameRenderer(e),this.updateZoom_(),this.renderFlag=!0},e.PopupPreviewController.prototype.render=function(e){this.isOpen()&&this.renderer&&(this.renderer.render(e),this.renderFlag=!1)},e.PopupPreviewController.prototype.onWindowResize_=function(e){this.updateZoom_(),this.renderFlag=!0},e.PopupPreviewController.prototype.updateZoom_=function(){var e=this.popup.document.documentElement,t=e.clientWidth/this.piskelController.getWidth(),i=e.clientHeight/this.piskelController.getHeight(),t=Math.min(t,i),i=(this.renderer.setZoom(t),this.piskelController.getHeight()*t),t=this.piskelController.getWidth()*t,r=this.popup.document.querySelector(".preview-container"),i=(r.style.height=i+"px",r.style.width=t+"px",(e.clientHeight-i)/2),i=(r.style.marginTop=i+"px",r.style.marginBottom=i+"px",(e.clientWidth-t)/2);r.style.marginLeft=i+"px",r.style.marginRight=i+"px"},e.PopupPreviewController.prototype.onPopupClosed_=function(){this.popup;this.popup=null},e.PopupPreviewController.prototype.onMainWindowUnload_=function(){this.isOpen()&&this.popup.close()}}(),!function(){var e=$.namespace("pskl.controller.preview");e.PreviewActionsController=function(e,t){this.previewController=e,this.piskelController=e.piskelController,this.container=t,this.onionSkinShortcut=pskl.service.keyboard.Shortcuts.MISC.ONION_SKIN,this.toggleGridShortcut=pskl.service.keyboard.Shortcuts.MISC.TOGGLE_GRID,this.fpsRangeInput=document.querySelector("#preview-fps"),this.fpsCounterDisplay=document.querySelector("#display-fps"),this.openPopupPreview=document.querySelector(".open-popup-preview-button"),this.toggleGridButton=document.querySelector(".toggle-grid-button"),this.previewSizeDropdown=document.querySelector(".preview-drop-down"),this.previewSizes={original:{button:document.querySelector(".original-size-button"),shortcut:pskl.service.keyboard.Shortcuts.MISC.X1_PREVIEW,tooltip:"Original size preview"},best:{button:document.querySelector(".best-size-button"),shortcut:pskl.service.keyboard.Shortcuts.MISC.BEST_PREVIEW,tooltip:"Best size preview"},full:{button:document.querySelector(".full-size-button"),shortcut:pskl.service.keyboard.Shortcuts.MISC.FULL_PREVIEW,tooltip:"Full size preview"}},this.toggleOnionSkinButton=document.querySelector(".preview-toggle-onion-skin")},e.PreviewActionsController.prototype.init=function(){this.fpsRangeInput.addEventListener("change",this.onFpsRangeInputUpdate_.bind(this)),this.fpsRangeInput.addEventListener("input",this.onFpsRangeInputUpdate_.bind(this));var e,t,i,r=pskl.utils.Event.addEventListener,n=(r(this.toggleOnionSkinButton,"click",this.toggleOnionSkin_,this),r(this.openPopupPreview,"click",this.onOpenPopupPreviewClick_,this),r(this.toggleGridButton,"click",this.toggleGrid_,this),pskl.app.shortcutService.registerShortcut.bind(pskl.app.shortcutService)),o=(n(this.onionSkinShortcut,this.toggleOnionSkin_.bind(this)),n(this.toggleGridShortcut,this.toggleGrid_.bind(this)),pskl.utils.TooltipFormatter.format("Toggle onion skin",this.onionSkinShortcut));for(e in this.toggleOnionSkinButton.setAttribute("title",o),this.previewSizes)this.previewSizes.hasOwnProperty(e)&&(r((t=this.previewSizes[e]).button,"click",this.onChangePreviewSize_,this,e),n(t.shortcut,this.onChangePreviewSize_.bind(this,e)),i=pskl.utils.TooltipFormatter.format(t.tooltip,t.shortcut),t.button.setAttribute("title",i));$.subscribe(Events.FRAME_SIZE_CHANGED,this.updatePreviewSizeButtons_.bind(this)),$.subscribe(Events.USER_SETTINGS_CHANGED,this.onUserSettingsChange_.bind(this)),$.subscribe(Events.FPS_CHANGED,this.updateFPS_.bind(this)),$.subscribe(Events.PISKEL_RESET,this.updateFPS_.bind(this)),this.updatePreviewSizeButtons_(),this.updateOnionSkinPreview_(),this.selectPreviewSizeButton_(),this.updateFPS_(),this.updateMaxFPS_(),this.updateToggleGridButton_()},e.PreviewActionsController.prototype.updateToggleGridButton_=function(){var e=pskl.UserSettings.get(pskl.UserSettings.GRID_ENABLED);this.toggleGridButton.classList.toggle("icon-minimap-grid-white",!e),this.toggleGridButton.classList.toggle("icon-minimap-grid-gold",e),this.toggleGridButton.classList.toggle("preview-contextual-action-enabled",e)},e.PreviewActionsController.prototype.toggleGrid_=function(){var e=pskl.UserSettings.get(pskl.UserSettings.GRID_ENABLED);pskl.UserSettings.set(pskl.UserSettings.GRID_ENABLED,!e)},e.PreviewActionsController.prototype.updatePreviewSizeButtons_=function(){var e,t,i=this.previewController.getZoom(),r=Math.floor(i),n=pskl.UserSettings.get(pskl.UserSettings.SEAMLESS_MODE),o=i<1?(this.disablePreviewSizeWidget_("No other option available"),["full"]):1===i?(this.disablePreviewSizeWidget_("No other option available"),["original"]):n?(this.disablePreviewSizeWidget_("Disabled in tile mode"),["original"]):(this.enablePreviewSizeWidget_(),i===r?["original","best"]:1===r?["full","original"]:["full","original","best"]);for(e in this.previewSizes.best.button.textContent=Math.floor(i)+"x",this.previewSizes)this.previewSizes.hasOwnProperty(e)&&(t=this.previewSizes[e],-1!=o.indexOf(e)?t.button.classList.remove("preview-contextual-action-hidden"):t.button.classList.add("preview-contextual-action-hidden"));n=pskl.UserSettings.get(pskl.UserSettings.PREVIEW_SIZE);-1===o.indexOf(n)&&this.onChangePreviewSize_(o[0])},e.PreviewActionsController.prototype.enablePreviewSizeWidget_=function(){this.previewSizeDropdown.classList.remove("preview-drop-down-disabled")},e.PreviewActionsController.prototype.disablePreviewSizeWidget_=function(e){document.querySelector(".preview-disable-overlay").setAttribute("data-original-title",e),this.previewSizeDropdown.classList.add("preview-drop-down-disabled")},e.PreviewActionsController.prototype.onOpenPopupPreviewClick_=function(){this.previewController.openPopupPreview()},e.PreviewActionsController.prototype.onChangePreviewSize_=function(e){this.previewSizes[e].button.classList.contains("preview-contextual-action-hidden")||pskl.UserSettings.set(pskl.UserSettings.PREVIEW_SIZE,e)},e.PreviewActionsController.prototype.onUserSettingsChange_=function(e,t,i){t==pskl.UserSettings.ONION_SKIN?this.updateOnionSkinPreview_():t==pskl.UserSettings.MAX_FPS?this.updateMaxFPS_():t===pskl.UserSettings.SEAMLESS_MODE?this.updatePreviewSizeButtons_():t===pskl.UserSettings.GRID_ENABLED?this.updateToggleGridButton_():this.selectPreviewSizeButton_()},e.PreviewActionsController.prototype.updateOnionSkinPreview_=function(){var e="preview-toggle-onion-skin-enabled";pskl.UserSettings.get(pskl.UserSettings.ONION_SKIN)?this.toggleOnionSkinButton.classList.add(e):this.toggleOnionSkinButton.classList.remove(e)},e.PreviewActionsController.prototype.selectPreviewSizeButton_=function(){var e=document.querySelector(".size-button-selected"),e=(e&&e.classList.remove("size-button-selected"),pskl.UserSettings.get(pskl.UserSettings.PREVIEW_SIZE));this.previewSizes[e].button.classList.add("size-button-selected")},e.PreviewActionsController.prototype.updateMaxFPS_=function(){var e=pskl.UserSettings.get(pskl.UserSettings.MAX_FPS);this.fpsRangeInput.setAttribute("max",e),this.piskelController.setFPS(Math.min(e,this.piskelController.getFPS()))},e.PreviewActionsController.prototype.onFpsRangeInputUpdate_=function(e){var t=parseInt(this.fpsRangeInput.value,10);this.piskelController.setFPS(t),"change"===e.type&&this.fpsRangeInput.blur()},e.PreviewActionsController.prototype.updateFPS_=function(){var e=this.piskelController.getFPS();e!==this.fpsRangeInput.value&&(this.fpsRangeInput.value=0,this.fpsRangeInput.value=e,this.fpsCounterDisplay.innerHTML=e+" FPS")},e.PreviewActionsController.prototype.toggleOnionSkin_=function(){var e=pskl.UserSettings.get(pskl.UserSettings.ONION_SKIN);pskl.UserSettings.set(pskl.UserSettings.ONION_SKIN,!e)}}(),!function(){var i=$.namespace("pskl.controller.preview");i.PreviewController=function(e,t){this.piskelController=e,this.container=t,this.elapsedTime=0,this.currentIndex=0,this.lastRenderTime=0,this.renderFlag=!0,this.renderer=new pskl.rendering.frame.BackgroundImageFrameRenderer(this.container),this.popupPreviewController=new i.PopupPreviewController(e),this.previewActionsController=new i.PreviewActionsController(this,t)},i.PreviewController.prototype.init=function(){var e=Constants.ANIMATED_PREVIEW_WIDTH+Constants.RIGHT_COLUMN_PADDING_LEFT;document.querySelector(".right-column").style.width=e+"px",$.subscribe(Events.FRAME_SIZE_CHANGED,this.onFrameSizeChange_.bind(this)),$.subscribe(Events.USER_SETTINGS_CHANGED,this.onUserSettingsChange_.bind(this)),$.subscribe(Events.PISKEL_SAVE_STATE,this.setRenderFlag_.bind(this,!0)),$.subscribe(Events.PISKEL_RESET,this.setRenderFlag_.bind(this,!0)),this.popupPreviewController.init(),this.previewActionsController.init(),this.updateZoom_(),this.updateContainerDimensions_()},i.PreviewController.prototype.openPopupPreview=function(){this.popupPreviewController.open()},i.PreviewController.prototype.onUserSettingsChange_=function(e,t,i){t===pskl.UserSettings.SEAMLESS_MODE?this.onFrameSizeChange_():(this.updateZoom_(),this.updateContainerDimensions_())},i.PreviewController.prototype.updateZoom_=function(){var e,t=pskl.UserSettings.get(pskl.UserSettings.PREVIEW_SIZE);"original"===t?e=1:"best"===t?e=Math.floor(this.calculateZoom_()):"full"===t&&(e=this.calculateZoom_()),this.renderer.setZoom(e),this.setRenderFlag_(!0)},i.PreviewController.prototype.getZoom=function(){return this.calculateZoom_()},i.PreviewController.prototype.getCoordinates=function(e,t){var i=this.container.getBoundingClientRect(),i=(e-=i.left,t-=i.top,this.getZoom());return{x:Math.floor(e/i),y:Math.floor(t/i)}},i.PreviewController.prototype.render=function(e){this.elapsedTime+=e;var e=this.getNextIndex_(e);!this.shouldRender_()&&this.currentIndex==e||(this.currentIndex=e,e=pskl.utils.LayerUtils.mergeFrameAt(this.piskelController.getLayers(),e),this.renderer.render(e),this.renderFlag=!1,this.lastRenderTime=Date.now(),this.popupPreviewController.render(e))},i.PreviewController.prototype.getNextIndex_=function(e){var t,i=this.piskelController.getFPS();return 0===i?this.piskelController.getCurrentFrameIndex():(i=Math.floor(this.elapsedTime/(1e3/i)),(t=this.piskelController.getVisibleFrameIndexes()).length<=i?(this.elapsedTime=0,t.length?t[0]:this.piskelController.getCurrentFrameIndex()):t[i])},i.PreviewController.prototype.calculateZoom_=function(){var e=this.piskelController.getCurrentFrame(),t=200/e.getHeight(),e=200/e.getWidth();return Math.min(t,e)},i.PreviewController.prototype.onFrameSizeChange_=function(){this.updateZoom_(),this.updateContainerDimensions_()},i.PreviewController.prototype.updateContainerDimensions_=function(){var e,t=pskl.UserSettings.get(pskl.UserSettings.SEAMLESS_MODE),t=(this.renderer.setRepeated(t),e=t?i=200:(t=this.getZoom(),i=(e=this.piskelController.getCurrentFrame()).getHeight()*t,e.getWidth()*t),this.container),i=(t.style.height=i+"px",t.style.width=e+"px",(200-i)/2),i=(t.style.marginTop=i+"px",t.style.marginBottom=i+"px",(200-e)/2);t.style.marginLeft=i+"px",t.style.marginRight=i+"px"},i.PreviewController.prototype.setRenderFlag_=function(e){this.renderFlag=e},i.PreviewController.prototype.shouldRender_=function(){return(this.renderFlag||this.popupPreviewController.renderFlag)&&300<Date.now()-this.lastRenderTime}}(),!function(){var e=$.namespace("pskl.controller");e.MinimapController=function(e,t,i,r){this.piskelController=e,this.previewController=t,this.drawingController=i,this.container=r,this.isClicked=!1,this.isVisible=!1},e.MinimapController.prototype.init=function(){this.minimapEl=document.createElement("DIV"),this.minimapEl.className="minimap-crop-frame",this.minimapEl.style.display="none",this.container.appendChild(this.minimapEl),this.container.addEventListener("mousedown",this.onMinimapMousedown_.bind(this)),document.body.addEventListener("mousemove",this.onMinimapMousemove_.bind(this)),document.body.addEventListener("mouseup",this.onMinimapMouseup_.bind(this)),this.container.addEventListener("touchstart",this.onMinimapMousedown_.bind(this)),this.container.addEventListener("touchmove",this.onMinimapMousemove_.bind(this)),this.container.addEventListener("touchend",this.onMinimapMouseup_.bind(this)),$.subscribe(Events.ZOOM_CHANGED,this.renderMinimap_.bind(this))},e.MinimapController.prototype.renderMinimap_=function(){var e=this.getVerticalRatio_(),t=this.getHorizontalRatio_();1<e||1<t?this.displayMinimap_():this.hideMinimap_()},e.MinimapController.prototype.displayMinimap_=function(){var e=this.getMinimapSize_(),t=this.getPreviewSize_(),i=this.container.getBoundingClientRect(),r=i.height,i=i.width,n=this.drawingController.getRenderer().getOffset(),o=(i-Math.max(e.width,t.width))/2+n.x*this.previewController.getZoom(),t=(r-Math.max(e.height,t.height))/2+n.y*this.previewController.getZoom();this.minimapEl.style.display="block",this.minimapEl.style.width=Math.min(e.width,i)+"px",this.minimapEl.style.height=Math.min(e.height,r)+"px",this.minimapEl.style.left=Math.max(0,o)+Constants.RIGHT_COLUMN_PADDING_LEFT+"px",this.minimapEl.style.top=Math.max(0,t)+"px",this.isVisible=!0},e.MinimapController.prototype.getMinimapSize_=function(){var e=this.drawingController.getRenderer().getZoom()/this.previewController.getZoom(),t=this.drawingController.getRenderer().getDisplaySize();return{width:t.width/e,height:t.height/e}},e.MinimapController.prototype.getPreviewSize_=function(){var e=this.piskelController.getCurrentFrame();return{width:e.getWidth()*this.previewController.getZoom(),height:e.getHeight()*this.previewController.getZoom()}},e.MinimapController.prototype.hideMinimap_=function(){this.minimapEl.style.display="none",this.isVisible=!1},e.MinimapController.prototype.onMinimapMousemove_=function(e){var t;this.isVisible&&this.isClicked&&(t=this.getCoordinatesCenteredAround_(e.clientX,e.clientY),void 0!==e.changedTouches&&(e=e.changedTouches[0],t=this.getCoordinatesCenteredAround_(e.clientX,e.clientY)),this.drawingController.setOffset(t.x,t.y))},e.MinimapController.prototype.onMinimapMousedown_=function(e){this.isClicked=!0},e.MinimapController.prototype.onMinimapMouseup_=function(e){this.isClicked=!1},e.MinimapController.prototype.getCoordinatesCenteredAround_=function(e,t){var e=this.previewController.getCoordinates(e,t),t=this.piskelController.getCurrentFrame().getWidth(),i=this.piskelController.getCurrentFrame().getHeight(),t=t/this.getHorizontalRatio_(),i=i/this.getVerticalRatio_();return{x:e.x-t/2,y:e.y-i/2}},e.MinimapController.prototype.getVerticalRatio_=function(){var e=this.drawingController.getRenderer().getZoom();return this.piskelController.getCurrentFrame().getHeight()*e/this.drawingController.getRenderer().getDisplaySize().height},e.MinimapController.prototype.getHorizontalRatio_=function(){var e=this.drawingController.getRenderer().getZoom();return this.piskelController.getCurrentFrame().getWidth()*e/this.drawingController.getRenderer().getDisplaySize().width}}(),!function(){var e=$.namespace("pskl.controller");e.ToolController=function(){this.tools=[new pskl.tools.drawing.SimplePen,new pskl.tools.drawing.VerticalMirrorPen,new pskl.tools.drawing.PaintBucket,new pskl.tools.drawing.ColorSwap,new pskl.tools.drawing.Eraser,new pskl.tools.drawing.Stroke,new pskl.tools.drawing.Rectangle,new pskl.tools.drawing.Circle,new pskl.tools.drawing.Move,new pskl.tools.drawing.selection.ShapeSelect,new pskl.tools.drawing.selection.RectangleSelect,new pskl.tools.drawing.selection.LassoSelect,new pskl.tools.drawing.Lighten,new pskl.tools.drawing.DitheringTool,new pskl.tools.drawing.ColorPicker,new pskl.tools.drawing.NoiseTool,new pskl.tools.drawing.NoiseFillTool,new pskl.tools.drawing.Outliner],this.toolIconBuilder=new pskl.tools.ToolIconBuilder},e.ToolController.prototype.init=function(){this.createToolsDom_(),this.addKeyboardShortcuts_(),this.selectTool_(this.tools[0]),document.querySelector("#tool-section").addEventListener("mousedown",this.onToolIconClicked_.bind(this)),$.subscribe(Events.SELECT_TOOL,this.onSelectToolEvent_.bind(this)),$.subscribe(Events.SHORTCUTS_CHANGED,this.createToolsDom_.bind(this))},e.ToolController.prototype.activateToolOnStage_=function(e){var t=document.body,i=t.dataset.selectedToolClass;i&&(t.classList.remove(i),t.classList.remove(pskl.tools.drawing.Move.TOOL_ID)),t.classList.add(e.toolId),t.dataset.selectedToolClass=e.toolId},e.ToolController.prototype.onSelectToolEvent_=function(e,t){t=this.getToolById_(t);t&&this.selectTool_(t)},e.ToolController.prototype.selectTool_=function(e){this.currentSelectedTool=e,this.activateToolOnStage_(this.currentSelectedTool);var t=document.querySelector("#tool-section .tool-icon.selected");t&&t.classList.remove("selected"),document.querySelector("[data-tool-id="+e.toolId+"]").classList.add("selected"),$.publish(Events.TOOL_SELECTED,[e])},e.ToolController.prototype.onToolIconClicked_=function(e){var e=e.target,e=pskl.utils.Dom.getParentWithData(e,"toolId");e&&(e=e.dataset.toolId,e=this.getToolById_(e))&&this.selectTool_(e)},e.ToolController.prototype.onKeyboardShortcut_=function(e,t){e=this.getToolById_(e);null!==e&&this.selectTool_(e)},e.ToolController.prototype.getToolById_=function(t){return pskl.utils.Array.find(this.tools,function(e){return e.toolId==t})},e.ToolController.prototype.createToolsDom_=function(){for(var e="",t=0;t<this.tools.length;t++){var i=this.tools[t];e+=this.toolIconBuilder.createIcon(i)}document.querySelector("#tools-container").innerHTML=e},e.ToolController.prototype.addKeyboardShortcuts_=function(){for(var e=0;e<this.tools.length;e++){var t=this.tools[e];pskl.app.shortcutService.registerShortcut(t.shortcut,this.onKeyboardShortcut_.bind(this,t.toolId))}}}(),!function(){var e=$.namespace("pskl.controller");e.PaletteController=function(){},e.PaletteController.prototype.init=function(){$.subscribe(Events.SELECT_PRIMARY_COLOR,this.onColorSelected_.bind(this,{isPrimary:!0})),$.subscribe(Events.SELECT_SECONDARY_COLOR,this.onColorSelected_.bind(this,{isPrimary:!1}));var e=pskl.service.keyboard.Shortcuts,e=(pskl.app.shortcutService.registerShortcut(e.COLOR.SWAP,this.swapColors.bind(this)),pskl.app.shortcutService.registerShortcut(e.COLOR.RESET,this.resetColors.bind(this)),{showPalette:!0,showButtons:!1,showInput:!0,palette:[["rgba(0,0,0,0)"]],clickoutFiresChange:!0,beforeShow:function(e){e.setAlpha(1)}}),t=$("#color-picker"),t=(t.spectrum($.extend({color:Constants.DEFAULT_PEN_COLOR},e)),t.change({isPrimary:!0},this.onPickerChange_.bind(this)),this.setTitleOnPicker_(Constants.DEFAULT_PEN_COLOR,t.get(0)),$("#secondary-color-picker"));t.spectrum($.extend({color:Constants.TRANSPARENT_COLOR},e)),t.change({isPrimary:!1},this.onPickerChange_.bind(this)),this.setTitleOnPicker_(Constants.TRANSPARENT_COLOR,t.get(0)),document.querySelector(".swap-colors-button").addEventListener("click",this.swapColors.bind(this))},e.PaletteController.prototype.onPickerChange_=function(e){var t=e.target.value;t!=Constants.TRANSPARENT_COLOR&&(t=window.tinycolor(t).toHexString()),e.data.isPrimary?this.setPrimaryColor_(t):this.setSecondaryColor_(t)},e.PaletteController.prototype.onColorSelected_=function(e,t,i){e.isPrimary?this.setPrimaryColor_(i):this.setSecondaryColor_(i)},e.PaletteController.prototype.setPrimaryColor_=function(e){this.updateColorPicker_(e,document.querySelector("#color-picker")),$.publish(Events.PRIMARY_COLOR_SELECTED,[e])},e.PaletteController.prototype.setSecondaryColor_=function(e){this.updateColorPicker_(e,document.querySelector("#secondary-color-picker")),$.publish(Events.SECONDARY_COLOR_SELECTED,[e])},e.PaletteController.prototype.swapColors=function(){var e=pskl.app.selectedColorsService.getPrimaryColor();this.setPrimaryColor_(pskl.app.selectedColorsService.getSecondaryColor()),this.setSecondaryColor_(e)},e.PaletteController.prototype.resetColors=function(){this.setPrimaryColor_(Constants.DEFAULT_PEN_COLOR),this.setSecondaryColor_(Constants.TRANSPARENT_COLOR)},e.PaletteController.prototype.updateColorPicker_=function(e,t){var i=$(t);e==Constants.TRANSPARENT_COLOR?(i.spectrum("set",Constants.TRANSPARENT_COLOR),t.value=Constants.TRANSPARENT_COLOR):i.spectrum("set",e),this.setTitleOnPicker_(e,t)},e.PaletteController.prototype.setTitleOnPicker_=function(e,t){t=t.parentNode;e=t.dataset.initialTitle+"<br/>"+e,t.dataset.originalTitle=e}}(),!function(){var e=$.namespace("pskl.controller"),i="palettes-list-primary-color",t="palettes-list-secondary-color";e.PalettesListController=function(e){this.usedColorService=e,this.paletteService=pskl.app.paletteService},e.PalettesListController.prototype.init=function(){this.paletteColorTemplate_=pskl.utils.Template.get("palette-color-template"),this.colorListContainer_=document.querySelector(".palettes-list-colors"),this.colorPaletteSelect_=document.querySelector(".palettes-list-select");var e=document.querySelector(".create-palette-button"),t=document.querySelector(".edit-palette-button"),e=(this.colorPaletteSelect_.addEventListener("change",this.onPaletteSelected_.bind(this)),this.colorListContainer_.addEventListener("mouseup",this.onColorContainerMouseup.bind(this)),this.colorListContainer_.addEventListener("contextmenu",this.onColorContainerContextMenu.bind(this)),e.addEventListener("click",this.onCreatePaletteClick_.bind(this)),t.addEventListener("click",this.onEditPaletteClick_.bind(this)),$.subscribe(Events.PALETTE_LIST_UPDATED,this.onPaletteListUpdated.bind(this)),$.subscribe(Events.CURRENT_COLORS_UPDATED,this.fillColorListContainer.bind(this)),$.subscribe(Events.PRIMARY_COLOR_SELECTED,this.highlightSelectedColors.bind(this)),$.subscribe(Events.SECONDARY_COLOR_SELECTED,this.highlightSelectedColors.bind(this)),$.subscribe(Events.USER_SETTINGS_CHANGED,this.onUserSettingsChange_.bind(this)),pskl.service.keyboard.Shortcuts);pskl.app.shortcutService.registerShortcut(e.COLOR.PREVIOUS_COLOR,this.selectPreviousColor_.bind(this)),pskl.app.shortcutService.registerShortcut(e.COLOR.NEXT_COLOR,this.selectNextColor_.bind(this)),pskl.app.shortcutService.registerShortcut(e.COLOR.SELECT_COLOR,this.selectColorForKey_.bind(this)),this.fillPaletteList(),this.updateFromUserSettings(),this.fillColorListContainer()},e.PalettesListController.prototype.fillPaletteList=function(){var e=this.paletteService.getPalettes().map(function(e){return pskl.utils.Template.replace('<option value="{{id}}">{{name}}</option>',e)}).join("");this.colorPaletteSelect_.innerHTML=e},e.PalettesListController.prototype.fillColorListContainer=function(){var e,t=this.getSelectedPaletteColors_();0<t.length?(e=t.filter(function(e){return!!e}).map(function(e,t){return pskl.utils.Template.replace(this.paletteColorTemplate_,{color:e,index:t+1,title:e.toUpperCase()})}.bind(this)).join(""),this.colorListContainer_.innerHTML=e,this.highlightSelectedColors()):this.colorListContainer_.innerHTML=pskl.utils.Template.get("palettes-list-no-colors-partial"),this.colorListContainer_.classList.toggle("tiny",10<t.length)},e.PalettesListController.prototype.selectPalette=function(e){pskl.UserSettings.set(pskl.UserSettings.SELECTED_PALETTE,e)},e.PalettesListController.prototype.getSelectedPaletteColors_=function(){var e=[],t=this.getSelectedPalette_();return e=(e=t?t.getColors():e).length>Constants.MAX_PALETTE_COLORS?e.slice(0,Constants.MAX_PALETTE_COLORS):e},e.PalettesListController.prototype.getSelectedPalette_=function(){var e=pskl.UserSettings.get(pskl.UserSettings.SELECTED_PALETTE);return this.paletteService.getPaletteById(e)},e.PalettesListController.prototype.selectNextColor_=function(){this.selectColor_(this.getCurrentColorIndex_()+1)},e.PalettesListController.prototype.selectPreviousColor_=function(){this.selectColor_(this.getCurrentColorIndex_()-1)},e.PalettesListController.prototype.getCurrentColorIndex_=function(){var e=0,t=document.querySelector("."+i);return e=t?parseInt(t.dataset.colorIndex,10)-1:e},e.PalettesListController.prototype.selectColorForKey_=function(e){e=parseInt(e,10);this.selectColor_((e+9)%10)},e.PalettesListController.prototype.selectColor_=function(e){e=this.getSelectedPaletteColors_()[e];e&&$.publish(Events.SELECT_PRIMARY_COLOR,[e])},e.PalettesListController.prototype.onUserSettingsChange_=function(e,t,i){t==pskl.UserSettings.SELECTED_PALETTE&&this.updateFromUserSettings()},e.PalettesListController.prototype.updateFromUserSettings=function(){var e=pskl.UserSettings.get(pskl.UserSettings.SELECTED_PALETTE);this.fillColorListContainer(),this.colorPaletteSelect_.value=e},e.PalettesListController.prototype.onPaletteSelected_=function(e){var t=this.colorPaletteSelect_.value;this.selectPalette(t),this.colorPaletteSelect_.blur()},e.PalettesListController.prototype.onCreatePaletteClick_=function(e){$.publish(Events.DIALOG_SHOW,{dialogId:"create-palette"})},e.PalettesListController.prototype.onEditPaletteClick_=function(e){var t=this.colorPaletteSelect_.value;$.publish(Events.DIALOG_SHOW,{dialogId:"create-palette",initArgs:t})},e.PalettesListController.prototype.onColorContainerContextMenu=function(e){e.preventDefault()},e.PalettesListController.prototype.onColorContainerMouseup=function(e){var t=e.target.dataset.color;t&&(e.button==Constants.LEFT_BUTTON?$.publish(Events.SELECT_PRIMARY_COLOR,[t]):e.button==Constants.RIGHT_BUTTON&&$.publish(Events.SELECT_SECONDARY_COLOR,[t]))},e.PalettesListController.prototype.highlightSelectedColors=function(){this.removeClass_(i),this.removeClass_(t);var e=this.getColorContainer_(pskl.app.selectedColorsService.getSecondaryColor());e&&(e.classList.remove(i),e.classList.add(t)),(e=this.getColorContainer_(pskl.app.selectedColorsService.getPrimaryColor()))&&(e.classList.remove(t),e.classList.add(i))},e.PalettesListController.prototype.getColorContainer_=function(e){return this.colorListContainer_.querySelector('.palettes-list-color[data-color="'+e+'"]')},e.PalettesListController.prototype.removeClass_=function(e){var t=document.querySelector("."+e);t&&t.classList.remove(e)},e.PalettesListController.prototype.onPaletteListUpdated=function(){this.fillPaletteList(),this.updateFromUserSettings()}}(),!function(){var e=$.namespace("pskl.controller");e.TouchButtonsController=function(e,t){this.historyService=e,this.drawingController=t,this.tools=[{toolId:"touch-copy",help:"Copy seleciton"},{toolId:"touch-cut",help:"Cut seleciton"},{toolId:"touch-delete",help:"Delete seleciton"},{toolId:"touch-paste",help:"Paste seleciton"},{toolId:"touch-undo",help:"Undo"},{toolId:"touch-zoom-in",help:"Zoom In"},{toolId:"touch-zoom-out",help:"Zoom Out"},{toolId:"touch-redo",help:"Redo"}],this.toolIconBuilder=new pskl.tools.ToolIconBuilder},e.TouchButtonsController.prototype.init=function(){this.container=document.querySelector(".touch-buttons-container"),this.createToolsDom_(),this.copyButton=document.querySelector(".icon-touch-copy"),this.copyButton.addEventListener("click",this.copy.bind(this)),this.cutButton=document.querySelector(".icon-touch-cut"),this.cutButton.addEventListener("click",this.cut.bind(this)),this.deleteButton=document.querySelector(".icon-touch-delete"),this.deleteButton.addEventListener("click",this.delete.bind(this)),this.pasteButton=document.querySelector(".icon-touch-paste"),this.pasteButton.addEventListener("click",this.paste.bind(this)),this.undoButton=document.querySelector(".icon-touch-undo"),this.undoButton.addEventListener("click",this.undo.bind(this)),this.redoButton=document.querySelector(".icon-touch-redo"),this.redoButton.addEventListener("click",this.redo.bind(this)),this.zoomInButton=document.querySelector(".icon-touch-zoom-in"),this.zoomInButton.addEventListener("click",this.zoomIn.bind(this)),this.zoomOutButton=document.querySelector(".icon-touch-zoom-out"),this.zoomOutButton.addEventListener("click",this.zoomOut.bind(this))},e.TouchButtonsController.prototype.copy=function(e){$.publish(Events.CLIPBOARD_COPY,e)},e.TouchButtonsController.prototype.cut=function(e){$.publish(Events.CLIPBOARD_CUT,e)},e.TouchButtonsController.prototype.delete=function(e){$.publish(Events.CLIPBOARD_CUT,e)},e.TouchButtonsController.prototype.paste=function(e){$.publish(Events.CLIPBOARD_PASTE,e)},e.TouchButtonsController.prototype.undo=function(e){this.historyService.undo()},e.TouchButtonsController.prototype.redo=function(e){this.historyService.redo()},e.TouchButtonsController.prototype.zoomIn=function(e){this.drawingController.onMousewheel_({wheelDeltaY:150,clientX:230,clientY:50})},e.TouchButtonsController.prototype.zoomOut=function(e){this.drawingController.onMousewheel_({wheelDeltaY:-150,clientX:230,clientY:50})},e.TouchButtonsController.prototype.createToolsDom_=function(){var e=this.tools.reduce(function(e,t){return e+this.createIcon(t,"left")}.bind(this),"");this.container.querySelector(".tools-wrapper").innerHTML=e},e.TouchButtonsController.prototype.createIcon=function(e,t){t=t||"right";var i=pskl.utils.Template.get("drawingTool-item-template");return pskl.utils.Template.replace(i,{cssclass:["tool-icon","icon-"+e.toolId].join(" "),toolid:e.toolId,title:this.getTooltipText(e),tooltipposition:t})},e.TouchButtonsController.prototype.getTooltipText=function(e){var t=e.tooltipDescriptors;return pskl.utils.TooltipFormatter.format(e.help,e.shortcut,t)}}(),!function(){var e=$.namespace("pskl.controller");e.PenSizeController=function(){this.sizePicker=new pskl.widgets.SizePicker(this.onSizePickerChanged_.bind(this))},e.PenSizeController.prototype.init=function(){this.sizePicker.init(document.querySelector(".pen-size-container")),$.subscribe(Events.PEN_SIZE_CHANGED,this.onPenSizeChanged_.bind(this)),this.updateSelectedOption_()},e.PenSizeController.prototype.onSizePickerChanged_=function(e){pskl.app.penSizeService.setPenSize(e)},e.PenSizeController.prototype.onPenSizeChanged_=function(e){this.updateSelectedOption_()},e.PenSizeController.prototype.updateSelectedOption_=function(){var e=pskl.app.penSizeService.getPenSize();this.sizePicker.setSize(e)}}(),!function(){var e=$.namespace("pskl.controller");e.ProgressBarController=function(){this.template=pskl.utils.Template.get("progress-bar-template"),this.progressBar=null,this.progressBarStatus=null,this.showProgressTimer_=0},e.ProgressBarController.prototype.init=function(){$.subscribe(Events.SHOW_PROGRESS,this.showProgress_.bind(this)),$.subscribe(Events.UPDATE_PROGRESS,this.updateProgress_.bind(this)),$.subscribe(Events.HIDE_PROGRESS,this.hideProgress_.bind(this))},e.ProgressBarController.prototype.showProgress_=function(e,t){this.removeProgressBar_(),this.showProgressTimer_=window.setTimeout(this.onTimerExpired_.bind(this,t),300)},e.ProgressBarController.prototype.onTimerExpired_=function(e){e=pskl.utils.Template.replace(this.template,{name:e.name,status:0}),e=pskl.utils.Template.createFromHTML(e);document.body.appendChild(e),this.progressBar=document.querySelector(".progress-bar"),this.progressBarStatus=document.querySelector(".progress-bar-status")},e.ProgressBarController.prototype.updateProgress_=function(e,t){var i;this.progressBar&&this.progressBarStatus&&(t=t.progress,i=this.progressBar.offsetWidth,this.progressBar.style.backgroundPosition=-(i-t*i/100)+"px 0",this.progressBarStatus.innerHTML=t+"%")},e.ProgressBarController.prototype.hideProgress_=function(e,t){this.showProgressTimer_&&window.clearTimeout(this.showProgressTimer_),this.removeProgressBar_()},e.ProgressBarController.prototype.removeProgressBar_=function(){var e=document.querySelector(".progress-bar-container");e&&(e.parentNode.removeChild(e),this.progressBar=null,this.progressBarStatus=null)}}(),!function(){var e=$.namespace("pskl.controller");e.NotificationController=function(){},e.NotificationController.prototype.init=function(){$.subscribe(Events.SHOW_NOTIFICATION,this.displayMessage_.bind(this)),$.subscribe(Events.HIDE_NOTIFICATION,this.removeMessage_.bind(this))},e.NotificationController.prototype.displayMessage_=function(e,t){this.removeMessage_();var i=document.createElement("div");i.id="user-message",i.className="user-message",i.innerHTML=t.content,i.innerHTML=i.innerHTML+'<div title="Close message" class="close">x</div>',document.body.appendChild(i),i.querySelector(".close").addEventListener("click",this.removeMessage_.bind(this)),t.hideDelay&&window.setTimeout(this.removeMessage_.bind(this),t.hideDelay)},e.NotificationController.prototype.removeMessage_=function(e){var t=document.querySelector("#user-message");t&&t.parentNode.removeChild(t)}}(),!function(){var e=$.namespace("pskl.controller");e.TransformationsController=function(){this.tools=[new pskl.tools.transform.Flip,new pskl.tools.transform.Rotate,new pskl.tools.transform.Clone,new pskl.tools.transform.Center,new pskl.tools.transform.Crop],this.toolIconBuilder=new pskl.tools.ToolIconBuilder},e.TransformationsController.prototype.init=function(){this.container=document.querySelector(".transformations-container"),this.container.addEventListener("click",this.onTransformationClick_.bind(this)),this.showMoreLink=this.container.querySelector(".transformations-show-more-link"),this.showMoreLink.addEventListener("click",this.toggleShowMoreTools_.bind(this)),this.createToolsDom_(),this.updateShowMoreLink_(),$.subscribe(Events.USER_SETTINGS_CHANGED,this.onUserSettingsChange_.bind(this))},e.TransformationsController.prototype.applyTool=function(t,i){this.tools.forEach(function(e){e.toolId===t&&($.publish(Events.TRANSFORMATION_EVENT,[t,i]),e.applyTransformation(i))}.bind(this))},e.TransformationsController.prototype.onTransformationClick_=function(e){var t=e.target.dataset.toolId;t&&this.applyTool(t,e)},e.TransformationsController.prototype.toggleShowMoreTools_=function(e){var t=pskl.UserSettings.get(pskl.UserSettings.TRANSFORM_SHOW_MORE);pskl.UserSettings.set(pskl.UserSettings.TRANSFORM_SHOW_MORE,!t)},e.TransformationsController.prototype.onUserSettingsChange_=function(e,t){t==pskl.UserSettings.TRANSFORM_SHOW_MORE&&this.updateShowMoreLink_()},e.TransformationsController.prototype.updateShowMoreLink_=function(){var e=pskl.UserSettings.get(pskl.UserSettings.TRANSFORM_SHOW_MORE);this.container.classList.toggle("show-more",e),this.showMoreLink.classList.toggle("hidden",this.tools.length<5)},e.TransformationsController.prototype.createToolsDom_=function(){var e=this.tools.reduce(function(e,t){return e+this.toolIconBuilder.createIcon(t,"left")}.bind(this),"");this.container.querySelector(".tools-wrapper").innerHTML=e}}(),!function(){var e=$.namespace("pskl.controller");e.CanvasBackgroundController=function(){this.body=document.body},e.CanvasBackgroundController.prototype.init=function(){$.subscribe(Events.USER_SETTINGS_CHANGED,this.onUserSettingsChange_.bind(this)),this.updateBackgroundClass_(pskl.UserSettings.get(pskl.UserSettings.CANVAS_BACKGROUND))},e.CanvasBackgroundController.prototype.onUserSettingsChange_=function(e,t,i){t==pskl.UserSettings.CANVAS_BACKGROUND&&this.updateBackgroundClass_(i)},e.CanvasBackgroundController.prototype.updateBackgroundClass_=function(e){var t=this.body.dataset.currentBackgroundClass;t&&this.body.classList.remove(t),this.body.classList.add(e),this.body.dataset.currentBackgroundClass=e}}(),!function(){var e=$.namespace("pskl.controller");e.UserWarningController=function(e,t){this.piskelController=e,this.currentColorsService=t},e.UserWarningController.showPerformanceInfoDialog=function(){$.publish(Events.DIALOG_SHOW,{dialogId:"performance-info"})},e.UserWarningController.prototype.init=function(){$.subscribe(Events.PERFORMANCE_REPORT_CHANGED,this.onPerformanceReportChanged_.bind(this)),this.performanceLinkEl=document.querySelector(".performance-link"),pskl.utils.Event.addEventListener(this.performanceLinkEl,"click",e.UserWarningController.showPerformanceInfoDialog,this)},e.UserWarningController.prototype.destroy=function(){pskl.utils.Event.removeAllEventListeners(this),this.performanceLinkEl=null},e.UserWarningController.prototype.onPerformanceReportChanged_=function(e,t){var t=t.hasProblem(),i=this.performanceLinkEl.classList.contains("visible");t?this.performanceLinkEl.classList.add("visible"):this.performanceLinkEl.classList.remove("visible"),t&&!i&&$.publish(Events.SHOW_NOTIFICATION,[{content:'Performance problem detected, <a href="#" style="color:red;"onclick="pskl.controller.UserWarningController.showPerformanceInfoDialog()">learn more?</a>',hideDelay:5e3}])}}(),!function(){var e=$.namespace("pskl.controller");e.TabsController=function(e,t){this.historyService=t,this.piskelController=e,this.tabControllers=[],this.selectedTab=null,this.tabsContainer=document.querySelector("#tabsContainer"),this.addCurrent(),this.setCurrent(this.piskelController.getSelectedPiskel()),document.querySelector(".addTabButton").addEventListener("click",this._newPiskel.bind(this)),$.subscribe(Events.PISKEL_ADDED,this._refreshButtons.bind(this)),$.subscribe(Events.PISKEL_REMOVED,this._piskelRemoved.bind(this))},e.TabsController.prototype.addCurrent=function(){this.piskelController.getPiskelIds().forEach(this.add.bind(this)),this._refreshButtons()},e.TabsController.prototype.addEmpty=function(){},e.TabsController.prototype.add=function(e){var t=document.createElement("div"),i=(t.classList.add("tab"),t.classList.add("tab"+e),document.createElement("div")),r=(i.classList.add("tabPreview"),i.classList.add("tabPreview"+e),document.createElement("div")),r=(r.classList.add("canvas-background"),i.append(r),t.append(i),i.addEventListener("click",this._onTabSelect.bind(this,e)),document.createElement("button"));r.classList.add("closeButton"),r.setAttribute("type","button"),r.textContent="x",r.addEventListener("click",this._onTabClose.bind(this,e)),t.append(r),this.tabsContainer.append(t),this.tabControllers.push({controller:new pskl.controller.preview.TabPreviewController(this,i,e),index:e})},e.TabsController.prototype.setCurrent=function(t){this.piskelController.selectPiskel(t),this.piskelController.getPiskelIds().forEach(e=>{t==e?document.querySelector(".tab"+e).classList.add("active"):document.querySelector(".tab"+e).classList.remove("active")})},e.TabsController.prototype.render=function(t){this.tabControllers.forEach(e=>{e.controller.render(t)})},e.TabsController.prototype.isSelected=function(e){return this.piskelController.getSelectedPiskel()==e},e.TabsController.prototype._onTabSelect=function(e,t){this.setCurrent(e),$.publish(Events.PISKEL_CHANGED,e)},e.TabsController.prototype._onTabClose=function(e){this.piskelController.closePiskel(e)&&(document.querySelector(".tab"+e).remove(),this._refreshButtons())},e.TabsController.prototype._newPiskel=function(){var e=this.piskelController.newPiskel();this.add(e),this._onTabSelect(e)},e.TabsController.prototype._refreshButtons=function(){document.querySelector(".closeButton").setAttribute("style","display: none"),1<this.piskelController.getPiskelIds().length&&document.querySelector(".closeButton").setAttribute("style","display: block")},e.TabsController.prototype._piskelRemoved=function(e,t){var i=this.tabControllers.findIndex(e=>e.index==t);0<=i&&(this.tabControllers.splice(i,1),document.querySelector(".tab"+t).remove(),this._refreshButtons())}}(),!function(){var e=$.namespace("pskl.controller.preview");e.TabPreviewController=function(e,t,i){this.piskelController=e.piskelController,this.container=t,this.tabsController=e,this.index=i,this.elapsedTime=0,this.lastRenderTime=0,this.renderFlag=!0,this.renderer=new pskl.rendering.frame.BackgroundImageFrameRenderer(this.container),this.init()},e.TabPreviewController.prototype.init=function(){var e=Constants.ANIMATED_PREVIEW_WIDTH+Constants.RIGHT_COLUMN_PADDING_LEFT;document.querySelector(".right-column").style.width=e+"px",$.subscribe(Events.FRAME_SIZE_CHANGED,this.onFrameSizeChange_.bind(this)),$.subscribe(Events.USER_SETTINGS_CHANGED,this.onUserSettingsChange_.bind(this)),$.subscribe(Events.PISKEL_SAVE_STATE,this.setRenderFlag_.bind(this,!0)),$.subscribe(Events.PISKEL_RESET,this.setRenderFlag_.bind(this,!0)),this.updateZoom_(),this.updateContainerDimensions_()},e.TabPreviewController.prototype.onUserSettingsChange_=function(e,t,i){this.tabsController.isSelected(this.index)&&(t===pskl.UserSettings.SEAMLESS_MODE?this.onFrameSizeChange_():(this.updateZoom_(),this.updateContainerDimensions_()))},e.TabPreviewController.prototype.updateZoom_=function(){var e=this.calculateZoom_();this.renderer.setZoom(e),this.setRenderFlag_(!0)},e.TabPreviewController.prototype.getZoom=function(){return this.calculateZoom_()},e.TabPreviewController.prototype.getCoordinates=function(e,t){var i=this.container.getBoundingClientRect(),i=(e-=i.left,t-=i.top,this.getZoom());return{x:Math.floor(e/i),y:Math.floor(t/i)}},e.TabPreviewController.prototype.render=function(e){this.elapsedTime+=e;this.shouldRender_()&&(e=this.piskelController._getPiskel(this.index),e=pskl.utils.LayerUtils.mergeFrameAt(e.getLayers(),0),this.renderer.render(e),this.renderFlag=!1,this.lastRenderTime=Date.now())},e.TabPreviewController.prototype.getNextIndex_=function(e){var t,i=this.piskelController.getFPS();return 0===i?0:(i=Math.floor(this.elapsedTime/(1e3/i)),(t=this.piskelController.getVisibleFrameIndexes()).length<=i?(this.elapsedTime=0,t.length?t[0]:0):t[i])},e.TabPreviewController.prototype.calculateZoom_=function(){var e=this.piskelController._getPiskel(this.index).layers[0].frames[0],t=52/e.getHeight(),e=52/e.getWidth();return Math.min(t,e)},e.TabPreviewController.prototype.onFrameSizeChange_=function(){this.tabsController.isSelected(this.index)&&(this.updateZoom_(),this.updateContainerDimensions_())},e.TabPreviewController.prototype.updateContainerDimensions_=function(){var e,t=pskl.UserSettings.get(pskl.UserSettings.SEAMLESS_MODE),t=(this.renderer.setRepeated(t),e=t?i=52:(t=this.getZoom(),i=(e=this.piskelController._getPiskel(this.index).layers[0].frames[0]).getHeight()*t,e.getWidth()*t),this.container),i=(t.style.height=i+"px",t.style.width=e+"px",(52-i)/2),i=(t.style.marginTop=i+"px",t.style.marginBottom=i+"px",(52-e)/2);t.style.marginLeft=i+"px",t.style.marginRight=i+"px"},e.TabPreviewController.prototype.setRenderFlag_=function(e){this.tabsController.isSelected(this.index)&&(this.renderFlag=e)},e.TabPreviewController.prototype.shouldRender_=function(){return this.renderFlag&&300<Date.now()-this.lastRenderTime}}(),!function(){var e=$.namespace("pskl.controller.settings");e.AbstractSettingController=function(){},e.AbstractSettingController.prototype.addEventListener=function(e,t,i){pskl.utils.Event.addEventListener(e,t,i,this)},e.AbstractSettingController.prototype.destroy=function(){pskl.utils.Event.removeAllEventListeners(this),this.nullifyDomReferences_()},e.AbstractSettingController.prototype.nullifyDomReferences_=function(){for(var e in this)this.hasOwnProperty(e)&&this[e]&&this[e].nodeName&&(this[e]=null)}}(),!function(){var e=$.namespace("pskl.controller.settings.preferences"),s={transparent:Constants.TRANSPARENT_COLOR,white:"#FFF1E8","light-gray":"#C2C3C7","dark-gray":"#5F574F",black:"#000000",blue:"#29ADFF","dark-blue":"#1D2B53",green:"#00E436","dark-green":"#008751",peach:"#FFCCAA",pink:"#FF77A8",yellow:"#FFEC27",orange:"#FFA300",red:"#FF004D"};e.GridPreferencesController=function(e,t){this.piskelController=e,this.preferencesController=t,this.sizePicker=new pskl.widgets.SizePicker(this.onSizePickerChanged_.bind(this)),this.spacingPicker=new pskl.widgets.SizePicker(this.onSpacingPickerChanged_.bind(this))},pskl.utils.inherit(e.GridPreferencesController,pskl.controller.settings.AbstractSettingController),e.GridPreferencesController.prototype.init=function(){var e=pskl.UserSettings.get(pskl.UserSettings.GRID_ENABLED),t=document.querySelector(".enable-grid-checkbox"),e=(e&&t.setAttribute("checked","true"),this.addEventListener(t,"change",this.onEnableGridChange_),pskl.UserSettings.get(pskl.UserSettings.GRID_WIDTH)),t=(this.sizePicker.init(document.querySelector(".grid-size-container")),this.sizePicker.setSize(e),pskl.UserSettings.get(pskl.UserSettings.GRID_SPACING)),r=(this.spacingPicker.init(document.querySelector(".grid-spacing-container")),this.spacingPicker.setSize(t),pskl.utils.Template.get("color-list-item-template")),n=pskl.UserSettings.get(pskl.UserSettings.GRID_COLOR),o=(document.querySelector("#grid-color"),"");Object.keys(s).forEach(function(e,t){var i="transparent"===e?"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAIAAADZF8uwAAAAGUlEQVQYV2M4gwH+YwCGIasIUwhT25BVBADtzYNYrHvv4gAAAABJRU5ErkJggg==)":s[e];o+=pskl.utils.Template.replace(r,{color:s[e],title:e,background:i,":selected":n===s[e]})}),this.gridColorList=document.querySelector(".grid-colors-list"),this.gridColorList.innerHTML=o,this.addEventListener(this.gridColorList,"click",this.onGridColorClicked_.bind(this))},e.GridPreferencesController.prototype.destroy=function(){this.sizePicker.destroy(),this.spacingPicker.destroy(),this.superclass.destroy.call(this)},e.GridPreferencesController.prototype.onSizePickerChanged_=function(e){pskl.UserSettings.set(pskl.UserSettings.GRID_WIDTH,e)},e.GridPreferencesController.prototype.onSpacingPickerChanged_=function(e){pskl.UserSettings.set(pskl.UserSettings.GRID_SPACING,e)},e.GridPreferencesController.prototype.onEnableGridChange_=function(e){pskl.UserSettings.set(pskl.UserSettings.GRID_ENABLED,e.currentTarget.checked)},e.GridPreferencesController.prototype.onGridColorClicked_=function(e){var t=e.target.dataset.color;t&&(pskl.UserSettings.set(pskl.UserSettings.GRID_COLOR,t),this.gridColorList.querySelector(".selected").classList.remove("selected"),e.target.classList.add("selected"))}}(),!function(){var e=$.namespace("pskl.controller.settings.preferences");e.MiscPreferencesController=function(e,t){this.piskelController=e,this.preferencesController=t},pskl.utils.inherit(e.MiscPreferencesController,pskl.controller.settings.AbstractSettingController),e.MiscPreferencesController.prototype.init=function(){this.backgroundContainer=document.querySelector(".background-picker-wrapper"),this.addEventListener(this.backgroundContainer,"click",this.onBackgroundClick_);var e=pskl.UserSettings.get(pskl.UserSettings.CANVAS_BACKGROUND),e=this.backgroundContainer.querySelector("[data-background="+e+"]"),e=(e&&e.classList.add("selected"),document.querySelector(".max-fps-input")),e=(e.value=pskl.UserSettings.get(pskl.UserSettings.MAX_FPS),this.addEventListener(e,"change",this.onMaxFpsChange_),pskl.UserSettings.get(pskl.UserSettings.COLOR_FORMAT)),t=document.querySelector(".color-format-select"),e=t.querySelector('option[value="'+e+'"]'),e=(e&&e.setAttribute("selected","selected"),this.addEventListener(t,"change",this.onColorFormatChange_),document.querySelector(".layer-opacity-input"));e.value=pskl.UserSettings.get(pskl.UserSettings.LAYER_OPACITY),this.addEventListener(e,"change",this.onLayerOpacityChange_),this.addEventListener(e,"input",this.onLayerOpacityChange_),this.updateLayerOpacityText_(e.value)},e.MiscPreferencesController.prototype.onBackgroundClick_=function(e){var e=e.target,t=e.dataset.background;t&&(pskl.UserSettings.set(pskl.UserSettings.CANVAS_BACKGROUND,t),(t=this.backgroundContainer.querySelector(".selected"))&&t.classList.remove("selected"),e.classList.add("selected"))},e.MiscPreferencesController.prototype.onColorFormatChange_=function(e){pskl.UserSettings.set(pskl.UserSettings.COLOR_FORMAT,e.target.value)},e.MiscPreferencesController.prototype.onMaxFpsChange_=function(e){var e=e.target,t=parseInt(e.value,10);t&&!isNaN(t)?pskl.UserSettings.set(pskl.UserSettings.MAX_FPS,t):e.value=pskl.UserSettings.get(pskl.UserSettings.MAX_FPS)},e.MiscPreferencesController.prototype.onLayerOpacityChange_=function(e){var e=e.target,t=parseFloat(e.value);isNaN(t)?e.value=pskl.UserSettings.get(pskl.UserSettings.LAYER_OPACITY):(pskl.UserSettings.set(pskl.UserSettings.LAYER_OPACITY,t),pskl.UserSettings.set(pskl.UserSettings.LAYER_PREVIEW,0!==t),this.updateLayerOpacityText_(t))},e.MiscPreferencesController.prototype.updateLayerOpacityText_=function(e){document.querySelector(".layer-opacity-text").innerHTML=(+e).toFixed(2)}}(),!function(){var e=$.namespace("pskl.controller.settings.preferences");e.TilePreferencesController=function(e,t){this.piskelController=e,this.preferencesController=t},pskl.utils.inherit(e.TilePreferencesController,pskl.controller.settings.AbstractSettingController),e.TilePreferencesController.prototype.init=function(){var e=pskl.UserSettings.get(pskl.UserSettings.SEAMLESS_MODE),t=document.querySelector(".tile-mode-checkbox"),e=(e&&t.setAttribute("checked",e),this.addEventListener(t,"change",this.onTileModeChange_),document.querySelector(".tile-mask-opacity-input"));e.value=pskl.UserSettings.get(pskl.UserSettings.SEAMLESS_OPACITY),this.addEventListener(e,"change",this.onTileMaskOpacityChange_),this.addEventListener(e,"input",this.onTileMaskOpacityChange_),this.updateTileMaskOpacityText_(e.value)},e.TilePreferencesController.prototype.onTileModeChange_=function(e){pskl.UserSettings.set(pskl.UserSettings.SEAMLESS_MODE,e.currentTarget.checked)},e.TilePreferencesController.prototype.onTileMaskOpacityChange_=function(e){var e=e.target,t=parseFloat(e.value);isNaN(t)?e.value=pskl.UserSettings.get(pskl.UserSettings.SEAMLESS_OPACITY):(pskl.UserSettings.set(pskl.UserSettings.SEAMLESS_OPACITY,t),this.updateTileMaskOpacityText_(t))},e.TilePreferencesController.prototype.updateTileMaskOpacityText_=function(e){document.querySelector(".tile-mask-opacity-text").innerHTML=(+e).toFixed(2)}}(),!function(){var e=$.namespace("pskl.controller.settings"),t={misc:{template:"templates/settings/preferences/misc.html",controller:e.preferences.MiscPreferencesController},grid:{template:"templates/settings/preferences/grid.html",controller:e.preferences.GridPreferencesController},tile:{template:"templates/settings/preferences/tile.html",controller:e.preferences.TilePreferencesController}};e.PreferencesController=function(){this.tabsWidget=new pskl.widgets.Tabs(t,this,pskl.UserSettings.PREFERENCES_TAB)},pskl.utils.inherit(e.PreferencesController,pskl.controller.settings.AbstractSettingController),e.PreferencesController.prototype.init=function(){var e=document.querySelector(".settings-section-preferences");this.tabsWidget.init(e)},e.PreferencesController.prototype.destroy=function(){this.tabsWidget.destroy(),this.superclass.destroy.call(this)}}(),!function(){var e=$.namespace("pskl.controller.settings.exportimage");e.GifExportController=function(e,t){this.piskelController=e,this.exportController=t},pskl.utils.inherit(e.GifExportController,pskl.controller.settings.AbstractSettingController),e.GifExportController.prototype.init=function(){this.uploadStatusContainerEl=document.querySelector(".gif-upload-status"),this.previewContainerEl=document.querySelector(".gif-export-preview"),this.uploadButton=document.querySelector(".gif-upload-button"),this.downloadButton=document.querySelector(".gif-download-button"),this.repeatCheckbox=document.querySelector(".gif-repeat-checkbox"),this.repeatCheckbox.checked=this.getRepeatSetting_(),this.addEventListener(this.uploadButton,"click",this.onUploadButtonClick_),this.addEventListener(this.downloadButton,"click",this.onDownloadButtonClick_),this.addEventListener(this.repeatCheckbox,"change",this.onRepeatCheckboxChange_);var e=256<=pskl.app.currentColorsService.getCurrentColors().length;document.querySelector(".gif-export-warning").classList.toggle("visible",e)},e.GifExportController.prototype.getZoom_=function(){return this.exportController.getExportZoom()},e.GifExportController.prototype.onUploadButtonClick_=function(e){e.preventDefault();var e=this.getZoom_(),t=this.piskelController.getFPS();this.renderAsImageDataAnimatedGIF(e,t,this.uploadImageData_.bind(this))},e.GifExportController.prototype.onDownloadButtonClick_=function(e){var t=this.getZoom_(),i=this.piskelController.getFPS();this.renderAsImageDataAnimatedGIF(t,i,this.downloadImageData_.bind(this))},e.GifExportController.prototype.downloadImageData_=function(e){var t=this.piskelController.getPiskel().getDescriptor().name+".gif";pskl.utils.BlobUtils.dataToBlob(e,"image/gif",function(e){pskl.utils.FileUtils.downloadAsFile(e,t)})},e.GifExportController.prototype.uploadImageData_=function(e){this.updatePreview_(e),this.previewContainerEl.classList.add("preview-upload-ongoing"),pskl.app.imageUploadService.upload(e,this.onImageUploadCompleted_.bind(this),this.onImageUploadFailed_.bind(this))},e.GifExportController.prototype.onImageUploadCompleted_=function(e){this.updatePreview_(e),this.updateStatus_(e),this.previewContainerEl.classList.remove("preview-upload-ongoing")},e.GifExportController.prototype.onImageUploadFailed_=function(e,t){500===t.status&&$.publish(Events.SHOW_NOTIFICATION,[{content:"Upload failed : "+t.responseText,hideDelay:5e3}])},e.GifExportController.prototype.updatePreview_=function(e){this.previewContainerEl.innerHTML='<div><img style="max-width:32px;" src="'+e+'"/></div>'},e.GifExportController.prototype.renderAsImageDataAnimatedGIF=function(e,t,i){var r,n=pskl.app.currentColorsService.getCurrentColors(),o=!this.piskelController.getLayers().some(function(e){return e.isTransparent()})&&n.length<256,n=o?(r=this.getTransparentColor(n),parseInt(r.substring(1),16)):(r="#FFFFFF",null),s=this.piskelController.getWidth(),a=this.piskelController.getHeight(),l=new window.GIF({workers:5,quality:1,width:s*e,height:a*e,preserveColors:o,repeat:this.getRepeatSetting_()?0:-1,transparent:n}),c=pskl.utils.CanvasUtils.createCanvas(s,a),p=c.getContext("2d");p.fillStyle=r;for(var h=0;h<this.piskelController.getFrameCount();h++){var u=this.piskelController.renderFrameAt(h,!0),u=(p.clearRect(0,0,s,a),p.fillRect(0,0,s,a),p.drawImage(u,0,0,s,a),pskl.utils.ImageResizer.scale(c,e));l.addFrame(u.getContext("2d"),{delay:1e3/t})}$.publish(Events.SHOW_PROGRESS,[{name:"Building animated GIF ..."}]),l.on("progress",function(e){$.publish(Events.UPDATE_PROGRESS,[{progress:(100*e).toFixed(1)}])}.bind(this)),l.on("finished",function(e){$.publish(Events.HIDE_PROGRESS),pskl.utils.FileUtils.readFile(e,i)}.bind(this)),l.render()},e.GifExportController.prototype.getTransparentColor=function(e){e=pskl.utils.ColorUtils.getUnusedColor(e);return e||(console.error("Unable to find unused color to use as transparent color in the current sprite"),e="#FF00FF"),e},e.GifExportController.prototype.onRepeatCheckboxChange_=function(){var e=this.repeatCheckbox.checked;pskl.UserSettings.set(pskl.UserSettings.EXPORT_GIF_REPEAT,e)},e.GifExportController.prototype.getRepeatSetting_=function(){return pskl.UserSettings.get(pskl.UserSettings.EXPORT_GIF_REPEAT)},e.GifExportController.prototype.updateStatus_=function(e,t){e&&(e=pskl.utils.Template.replace('<a class="highlight" href="{{link}}" target="_blank">{{shortLink}}</a>',{link:e,shortLink:this.shorten_(e,30,"...")}),this.uploadStatusContainerEl.innerHTML="Your image is now available at : "+e)},e.GifExportController.prototype.shorten_=function(e,t,i){return e.length>t&&(t=Math.round((t-i.length)/2),e=e.substring(0,t)+i+e.substring(e.length-t,e.length)),e}}(),!function(){function o(e,t){return 1===t?"1 "+e:t+" "+e+"s"}var e=$.namespace("pskl.controller.settings.exportimage"),s=pskl.utils.Template.replace;e.PngExportController=function(e,t){this.piskelController=e,this.exportController=t,this.onScaleChanged_=this.onScaleChanged_.bind(this)},pskl.utils.inherit(e.PngExportController,pskl.controller.settings.AbstractSettingController),e.PngExportController.prototype.init=function(){this.layoutContainer=document.querySelector(".png-export-layout-section"),this.dimensionInfo=document.querySelector(".png-export-dimension-info"),this.rowsInput=document.querySelector("#png-export-rows"),this.columnsInput=document.querySelector("#png-export-columns");var e=document.querySelector(".png-download-button"),t=document.querySelector(".png-pixi-download-button"),i=document.querySelector(".datauri-open-button"),r=document.querySelector(".selected-frame-download-button");this.pixiInlineImageCheckbox=document.querySelector(".png-pixi-inline-image-checkbox"),this.initLayoutSection_(),this.updateDimensionLabel_(),this.addEventListener(this.columnsInput,"input",this.onColumnsInput_),this.addEventListener(e,"click",this.onDownloadClick_),this.addEventListener(t,"click",this.onPixiDownloadClick_),this.addEventListener(i,"click",this.onDataUriClick_),this.addEventListener(r,"click",this.onDownloadSelectedFrameClick_),$.subscribe(Events.EXPORT_SCALE_CHANGED,this.onScaleChanged_)},e.PngExportController.prototype.destroy=function(){$.unsubscribe(Events.EXPORT_SCALE_CHANGED,this.onScaleChanged_),this.superclass.destroy.call(this)},e.PngExportController.prototype.initLayoutSection_=function(){var e=this.piskelController.getFrameCount();1===e?this.layoutContainer.style.display="none":(this.columnsInput.setAttribute("max",e),this.columnsInput.value=this.getBestFit_(),this.onColumnsInput_())},e.PngExportController.prototype.updateDimensionLabel_=function(){var e=this.exportController.getExportZoom(),t=this.piskelController.getFrameCount(),i=this.piskelController.getWidth()*e,e=this.piskelController.getHeight()*e,r=this.getColumns_(),n=this.getRows_();this.dimensionInfo.innerHTML=s("{{width}} x {{height}} px, {{frames}}<br/>{{columns}}, {{rows}}.",{width:i*=r,height:e*=n,rows:o("row",n),columns:o("column",r),frames:o("frame",t)})},e.PngExportController.prototype.getColumns_=function(){return parseInt(this.columnsInput.value||1,10)},e.PngExportController.prototype.getRows_=function(){return parseInt(this.rowsInput.value||1,10)},e.PngExportController.prototype.getBestFit_=function(){var e=this.piskelController.getWidth()/this.piskelController.getHeight(),t=this.piskelController.getFrameCount(),e=Math.round(Math.sqrt(t/e));return pskl.utils.Math.minmax(e,1,t)},e.PngExportController.prototype.onScaleChanged_=function(){this.updateDimensionLabel_()},e.PngExportController.prototype.onColumnsInput_=function(){var e=this.columnsInput.value;""!==e&&(e=parseInt(e,10),isNaN(e)&&(e=1),e=pskl.utils.Math.minmax(e,1,this.piskelController.getFrameCount()),this.columnsInput.value=e,this.rowsInput.value=Math.ceil(this.piskelController.getFrameCount()/e),this.updateDimensionLabel_())},e.PngExportController.prototype.createPngSpritesheet_=function(){var e=new pskl.rendering.PiskelRenderer(this.piskelController).renderAsCanvas(this.getColumns_(),this.getRows_()),t=e.width,i=e.height,r=this.exportController.getExportZoom();return e=1!=r?pskl.utils.ImageResizer.resize(e,t*r,i*r,!1):e},e.PngExportController.prototype.onDownloadClick_=function(e){var t=this.createPngSpritesheet_();this.downloadCanvas_(t)},e.PngExportController.prototype.downloadCanvas_=function(e,t){var i=(t=t||this.piskelController.getPiskel().getDescriptor().name)+".png";pskl.utils.BlobUtils.canvasToBlob(e,function(e){pskl.utils.FileUtils.downloadAsFile(e,i)})},e.PngExportController.prototype.onPixiDownloadClick_=function(){for(var e=new window.JSZip,t=this.createPngSpritesheet_(),i=this.piskelController.getPiskel().getDescriptor().name,r=(this.pixiInlineImageCheckbox.checked?p=t.toDataURL("image/png"):e.file(p=i+".png",pskl.utils.CanvasUtils.getBase64FromCanvas(t)+"\n",{base64:!0}),t.width/this.getColumns_()),n=t.height/this.getRows_(),o=this.piskelController.getFrameCount(),s={},a=0;a<o;a++){var l=a%this.getColumns_(),c=(a-l)/this.getColumns_();s[i+a+".png"]={frame:{x:r*l,y:n*c,w:r,h:n},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:r,h:n},sourceSize:{w:r,h:n}}}var p={frames:s,meta:{app:"https://github.com/piskelapp/piskel/",version:"1.0",image:p,format:"RGBA8888",size:{w:t.width,h:t.height}}},t=(e.file(i+".json",JSON.stringify(p)),e.generate({type:"blob"}));pskl.utils.FileUtils.downloadAsFile(t,i+".zip")},e.PngExportController.prototype.onDataUriClick_=function(e){var t=window.open("about:blank"),i=this.createPngSpritesheet_().toDataURL("image/png");window.setTimeout(function(){var e=pskl.utils.Template.getAndReplace("data-uri-export-partial",{src:i});t.document.title=i,t.document.body.innerHTML=e}.bind(this),500)},e.PngExportController.prototype.onDownloadSelectedFrameClick_=function(e){var t=this.piskelController.getCurrentFrameIndex(),i=this.piskelController.getPiskel().getDescriptor().name,r=this.piskelController.renderFrameAt(t,!0),n=this.exportController.getExportZoom(),n=(1!=n&&(r=pskl.utils.ImageResizer.resize(r,r.width*n,r.height*n,!1)),i+"-"+(t+1)+".png");this.downloadCanvas_(r,n)}}(),!function(){var e=$.namespace("pskl.controller.settings.exportimage");e.ZipExportController=function(e,t){this.piskelController=e,this.exportController=t},pskl.utils.inherit(e.ZipExportController,pskl.controller.settings.AbstractSettingController),e.ZipExportController.prototype.init=function(){this.pngFilePrefixInput=document.querySelector(".zip-prefix-name"),this.pngFilePrefixInput.value="sprite_",this.splitByLayersCheckbox=document.querySelector(".zip-split-layers-checkbox"),this.addEventListener(this.splitByLayersCheckbox,"change",this.onSplitLayersClick_),this.useLayerNamesContainer=document.querySelector(".use-layer-names-container"),this.useLayerNamesCheckbox=document.querySelector(".zip-use-layer-names-checkbox"),this.toggleHideUseLayerNamesCheckbox();var e=document.querySelector(".zip-generate-button");this.addEventListener(e,"click",this.onZipButtonClick_)},e.ZipExportController.prototype.toggleHideUseLayerNamesCheckbox=function(){this.useLayerNamesContainer.style.display=this.splitByLayersCheckbox.checked?"block":"none"},e.ZipExportController.prototype.onSplitLayersClick_=function(){this.toggleHideUseLayerNamesCheckbox()},e.ZipExportController.prototype.onZipButtonClick_=function(){var e=new window.JSZip,t=(this.splitByLayersCheckbox.checked?this.splittedExport_(e):this.mergedExport_(e),this.getPiskelName_()+".zip"),e=e.generate({type:"blob"});pskl.utils.FileUtils.downloadAsFile(e,t)},e.ZipExportController.prototype.mergedExport_=function(e){for(var t=(""+this.piskelController.getFrameCount()).length,i=this.exportController.getExportZoom(),r=0;r<this.piskelController.getFrameCount();r++){var n=this.piskelController.renderFrameAt(r,!0),n=pskl.utils.ImageResizer.scale(n,i),o=this.pngFilePrefixInput.value,s=pskl.utils.StringUtils.leftPad(r,t,"0");e.file(o+s+".png",pskl.utils.CanvasUtils.getBase64FromCanvas(n)+"\n",{base64:!0})}},e.ZipExportController.prototype.splittedExport_=function(e){for(var t=this.piskelController.getLayers(),i=(""+this.piskelController.getFrameCount()).length,r=(""+t.length).length,n=this.exportController.getExportZoom(),o=0;this.piskelController.hasLayerAt(o);o++)for(var s=this.piskelController.getLayerAt(o),a=pskl.utils.StringUtils.leftPad(o,r,"0"),l=0;l<this.piskelController.getFrameCount();l++){var c=pskl.utils.LayerUtils.renderFrameAt(s,l,!0),c=pskl.utils.ImageResizer.scale(c,n),p=this.pngFilePrefixInput.value,h=pskl.utils.StringUtils.leftPad(l+1,i,"0"),u="l"+a+"_"+p+h+".png";this.useLayerNamesCheckbox.checked&&(u=s.getName()+"_"+p+h+".png"),e.file(u,pskl.utils.CanvasUtils.getBase64FromCanvas(c)+"\n",{base64:!0})}},e.ZipExportController.prototype.getPiskelName_=function(){return this.piskelController.getPiskel().getDescriptor().name}}(),!function(){var i=$.namespace("pskl.controller.settings.resize");i.ResizeController=function(e){this.piskelController=e,this.container=document.querySelector(".resize-canvas");var t=this.container.querySelector(".resize-anchor-container");this.anchorWidget=new pskl.widgets.AnchorWidget(t),this.defaultSizeController=new i.DefaultSizeController(e)},pskl.utils.inherit(i.ResizeController,pskl.controller.settings.AbstractSettingController),i.ResizeController.prototype.init=function(){this.widthInput=this.container.querySelector('[name="resize-width"]'),this.heightInput=this.container.querySelector('[name="resize-height"]'),this.resizeForm=this.container.querySelector("form"),this.resizeContentCheckbox=this.container.querySelector(".resize-content-checkbox"),this.maintainRatioCheckbox=this.container.querySelector(".resize-ratio-checkbox"),this.sizeInputWidget=new pskl.widgets.SizeInput({widthInput:this.widthInput,heightInput:this.heightInput,initWidth:this.piskelController.getWidth(),initHeight:this.piskelController.getHeight()});var e=pskl.UserSettings.get("RESIZE_SETTINGS"),t=pskl.widgets.AnchorWidget.ORIGIN[e.origin]||"TOPLEFT";this.anchorWidget.setOrigin(t),e.resizeContent&&(this.resizeContentCheckbox.checked=!0,this.anchorWidget.disable()),e.maintainRatio?this.maintainRatioCheckbox.checked=!0:this.sizeInputWidget.disableSync(),this.addEventListener(this.resizeForm,"submit",this.onResizeFormSubmit_),this.addEventListener(this.resizeContentCheckbox,"change",this.onResizeContentChange_),this.addEventListener(this.maintainRatioCheckbox,"change",this.onMaintainRatioChange_),this.defaultSizeController.init()},i.ResizeController.prototype.destroy=function(){this.updateUserPreferences_(),this.anchorWidget.destroy(),this.sizeInputWidget.destroy(),this.superclass.destroy.call(this)},i.ResizeController.prototype.onResizeFormSubmit_=function(e){e.preventDefault();e=this.piskelController.getPiskel(),e=pskl.utils.ResizeUtils.resizePiskel(e,{width:parseInt(this.widthInput.value,10),height:parseInt(this.heightInput.value,10),origin:this.anchorWidget.getOrigin(),resizeContent:this.resizeContentCheckbox.checked});pskl.app.piskelController.setPiskel(e,{preserveState:!0}),$.publish(Events.CLOSE_SETTINGS_DRAWER)},i.ResizeController.prototype.onResizeContentChange_=function(e){e.target.checked?this.anchorWidget.disable():this.anchorWidget.enable()},i.ResizeController.prototype.onMaintainRatioChange_=function(e){e.target.checked?this.sizeInputWidget.enableSync():this.sizeInputWidget.disableSync()},i.ResizeController.prototype.updateUserPreferences_=function(){pskl.UserSettings.set("RESIZE_SETTINGS",{origin:this.anchorWidget.getOrigin(),resizeContent:!!this.resizeContentCheckbox.checked,maintainRatio:!!this.maintainRatioCheckbox.checked})}}(),!function(){var e=$.namespace("pskl.controller.settings.resize");e.DefaultSizeController=function(e){this.piskelController=e},pskl.utils.inherit(e.DefaultSizeController,pskl.controller.settings.AbstractSettingController),e.DefaultSizeController.prototype.init=function(){this.container=document.querySelector(".settings-default-size");var e=pskl.UserSettings.get(pskl.UserSettings.DEFAULT_SIZE);this.widthInput=this.container.querySelector('[name="default-width"]'),this.heightInput=this.container.querySelector('[name="default-height"]'),this.widthInput.value=e.width,this.heightInput.value=e.height,this.defaultSizeForm=this.container.querySelector("form"),this.addEventListener(this.defaultSizeForm,"submit",this.onFormSubmit_)},e.DefaultSizeController.prototype.onFormSubmit_=function(e){e.preventDefault();var e=pskl.UserSettings.get(pskl.UserSettings.DEFAULT_SIZE),t=this.toNumber_(this.widthInput.value,e.width),e=this.toNumber_(this.heightInput.value,e.height);pskl.UserSettings.set(pskl.UserSettings.DEFAULT_SIZE,{width:t,height:e}),$.publish(Events.CLOSE_SETTINGS_DRAWER)},e.DefaultSizeController.prototype.toNumber_=function(e,t){e=parseInt(e,10);return e=0!==e&&!isNaN(e)?e:t}}(),!function(){var e=$.namespace("pskl.controller.settings"),t=$.namespace("pskl.controller.settings.exportimage"),i="save-desktop-partial",r="save-file-download-partial",n={png:{template:"templates/settings/export/png.html",controller:t.PngExportController},gif:{template:"templates/settings/export/gif.html",controller:t.GifExportController},zip:{template:"templates/settings/export/zip.html",controller:t.ZipExportController}};e.FileController=function(e){this.piskelController=e,this.tabsWidget=new pskl.widgets.Tabs(n,this,pskl.UserSettings.EXPORT_TAB),this.onSizeInputChange_=this.onSizeInputChange_.bind(this)},pskl.utils.inherit(e.FileController,pskl.controller.settings.AbstractSettingController),e.FileController.prototype.init=function(){this.hiddenOpenInput=document.querySelector('[name="open-input"]'),this.addEventListener(".browse-backups-button","click",this.onBrowseBackupsClick_),this.addEventListener(this.hiddenOpenInput,"change",this.onOpenChange_),(pskl.utils.Environment.detectNative()?(this.addEventListener(".open-native-button","click",this.onOpenNativeClick_),document.querySelector(".open-button")):(this.addEventListener(".open-button","click",this.onOpenClick_),document.querySelector(".open-native-button"))).remove(),this.saveForm=document.querySelector(".save-form"),this.insertSavePartials_(),this.piskelName=document.querySelector(".piskel-name"),this.descriptionInput=document.querySelector("#save-description"),this.nameInput=document.querySelector("#save-name"),this.isPublicCheckbox=document.querySelector("input[name=save-public-checkbox]"),this.updateDescriptorInputs_(),this.saveDesktopButton=document.querySelector("#save-desktop-button"),this.saveDesktopAsNewButton=document.querySelector("#save-desktop-as-new-button"),this.saveFileDownloadButton=document.querySelector("#save-file-download-button"),this.safeAddEventListener_(this.saveDesktopButton,"click",this.saveToDesktop_),this.safeAddEventListener_(this.saveDesktopAsNewButton,"click",this.saveToDesktopAsNew_),this.safeAddEventListener_(this.saveFileDownloadButton,"click",this.saveToFileDownload_),this.addEventListener(this.saveForm,"submit",this.onSaveFormSubmit_),pskl.app.storageService.isSaving()&&this.disableSaveButtons_(),$.subscribe(Events.BEFORE_SAVING_PISKEL,this.disableSaveButtons_.bind(this)),$.subscribe(Events.AFTER_SAVING_PISKEL,this.enableSaveButtons_.bind(this)),this.scaleInput=document.querySelector(".export-scale .scale-input"),this.addEventListener(this.scaleInput,"change",this.onScaleChange_),this.addEventListener(this.scaleInput,"input",this.onScaleChange_),this.widthInput=document.querySelector(".export-resize .resize-width"),this.heightInput=document.querySelector(".export-resize .resize-height");var e=pskl.UserSettings.get(pskl.UserSettings.EXPORT_SCALE);this.sizeInputWidget=new pskl.widgets.SizeInput({widthInput:this.widthInput,heightInput:this.heightInput,initWidth:this.piskelController.getWidth()*e,initHeight:this.piskelController.getHeight()*e,onChange:this.onSizeInputChange_}),this.onSizeInputChange_(),this.tabsWidget.init(document.querySelector(".settings-section-file"))},e.FileController.prototype.closeDrawer_=function(){$.publish(Events.CLOSE_SETTINGS_DRAWER)},e.FileController.prototype.onFileUploadChange_=function(e){void 0===e&&(e=this.hiddenOpenInput.files),Array.prototype.every.call(e,function(e){return pskl.utils.FileUtils.isFileImage(e)})?($.publish(Events.DIALOG_SHOW,{dialogId:"import",initArgs:{rawFiles:e}}),this.closeDrawer_()):(this.closeDrawer_(),console.error("Some files are not images"))},e.FileController.prototype.onOpenChange_=function(e){var t=this.hiddenOpenInput.files;1==t.length&&this.isPiskel_(t[0])?this.openPiskelFile_(t[0]):this.onFileUploadChange_(void 0)},e.FileController.prototype.openDesktop_=function(e){this.closeDrawer_(),pskl.app.desktopStorageService.openPiskel()},e.FileController.prototype.onOpenClick_=function(e){this.hiddenOpenInput.click()},e.FileController.prototype.onOpenNativeClick_=function(e){pskl.utils.FileUtilsDesktop.chooseFilenameDialogOpen().then(e=>{1==e.length&&this.isPiskel_(e[0])?this.openPiskelFile_(e[0]):this.onFileUploadChange_(e)})},e.FileController.prototype.onBrowseBackupsClick_=function(e){$.publish(Events.DIALOG_SHOW,{dialogId:"browse-backups"}),this.closeDrawer_()},e.FileController.prototype.openPiskelFile_=function(e){this.isPiskel_(e)?($.publish(Events.DIALOG_SHOW,{dialogId:"import",initArgs:{rawFiles:[e]}}),this.closeDrawer_()):(this.closeDrawer_(),console.error("The selected file is not a piskel file"))},e.FileController.prototype.isPiskel_=function(e){return pskl.utils.FileUtils.isFilePiskel(e)},e.FileController.prototype.onRestorePreviousSessionClick_=function(){window.confirm("This will erase your current workspace. Continue ?")&&(pskl.app.backupService.load(),$.publish(Events.CLOSE_SETTINGS_DRAWER))},e.FileController.prototype.insertSavePartials_=function(){this.getPartials_().forEach(function(e){this.saveForm.insertAdjacentHTML("beforeend",pskl.utils.Template.get(e))}.bind(this))},e.FileController.prototype.getPartials_=function(){return pskl.utils.Environment.detectNative()?[i]:[r]},e.FileController.prototype.updateDescriptorInputs_=function(e){var t=this.piskelController.getPiskel().getDescriptor();this.descriptionInput.value=t.description,this.nameInput.value=t.name,t.isPublic&&this.isPublicCheckbox.setAttribute("checked",!0)},e.FileController.prototype.onSaveFormSubmit_=function(e){e.preventDefault(),e.stopPropagation()},e.FileController.prototype.saveToFileDownload_=function(){this.saveTo_("saveToFileDownload",!1)},e.FileController.prototype.saveToDesktop_=function(){this.saveTo_("saveToDesktop",!1)},e.FileController.prototype.saveToDesktopAsNew_=function(){this.saveTo_("saveToDesktop",!0)},e.FileController.prototype.saveTo_=function(e,t){var i=this.piskelController.getPiskel();i.setDescriptor(this.getDescriptor_()),pskl.app.storageService[e](i,!!t).then(this.onSaveSuccess_)},e.FileController.prototype.getDescriptor_=function(){var e=this.nameInput.value,t=this.descriptionInput.value;return new pskl.model.piskel.Descriptor(e,t,!1)},e.FileController.prototype.onSaveSuccess_=function(){$.publish(Events.CLOSE_SETTINGS_DRAWER)},e.FileController.prototype.disableSaveButtons_=function(){this.setDisabled_(this.saveDesktopButton,!0),this.setDisabled_(this.saveDesktopAsNewButton,!0),this.setDisabled_(this.saveFileDownloadButton,!0)},e.FileController.prototype.enableSaveButtons_=function(){this.setDisabled_(this.saveDesktopButton,!1),this.setDisabled_(this.saveDesktopAsNewButton,!1),this.setDisabled_(this.saveFileDownloadButton,!1)},e.FileController.prototype.setDisabled_=function(e,t){e&&(t?e.setAttribute("disabled","disabled"):e.removeAttribute("disabled"))},e.FileController.prototype.safeAddEventListener_=function(e,t,i){e&&this.addEventListener(e,t,i)},e.FileController.prototype.destroy=function(){this.sizeInputWidget.destroy(),this.tabsWidget.destroy(),this.superclass.destroy.call(this)},e.FileController.prototype.onScaleChange_=function(){var e=parseFloat(this.scaleInput.value);isNaN(e)||(Math.round(this.getExportZoom())!=e&&this.sizeInputWidget.setWidth(this.piskelController.getWidth()*e),pskl.UserSettings.set(pskl.UserSettings.EXPORT_SCALE,e))},e.FileController.prototype.updateScaleText_=function(e){e=e.toFixed(1),document.querySelector(".export-scale .scale-text").innerHTML=e+"x"},e.FileController.prototype.onSizeInputChange_=function(){var e=this.getExportZoom();isNaN(e)||(this.updateScaleText_(e),$.publish(Events.EXPORT_SCALE_CHANGED),this.scaleInput.value=Math.round(e),1<=e&&e<=32&&this.onScaleChange_())},e.FileController.prototype.getExportZoom=function(){return parseInt(this.widthInput.value,10)/this.piskelController.getWidth()}}(),!function(){var e=$.namespace("pskl.controller.settings"),t={file:{template:"templates/settings/file.html",controller:e.FileController},user:{template:"templates/settings/preferences.html",controller:e.PreferencesController},resize:{template:"templates/settings/resize.html",controller:e.resize.ResizeController},localstorage:{template:"templates/settings/localstorage.html",controller:e.LocalStorageController}},i="has-expanded-drawer";e.SettingsController=function(e){this.piskelController=e,this.closeDrawerShortcut=pskl.service.keyboard.Shortcuts.MISC.CLOSE_POPUP,this.settingsContainer=document.querySelector("[data-pskl-controller=settings]"),this.drawerContainer=document.getElementById("drawer-container"),this.isExpanded=!1,this.currentSetting=null},e.SettingsController.prototype.init=function(){pskl.utils.Event.addEventListener(this.settingsContainer,"click",this.onSettingsContainerClick_,this),pskl.utils.Event.addEventListener(document.body,"click",this.onBodyClick_,this),$.subscribe(Events.CLOSE_SETTINGS_DRAWER,this.closeDrawer_.bind(this))},e.SettingsController.prototype.onSettingsContainerClick_=function(e){var t=pskl.utils.Dom.getData(e.target,"setting");t&&(this.currentSetting!=t?this.loadSetting_(t):this.closeDrawer_(),e.stopPropagation(),e.preventDefault())},e.SettingsController.prototype.onBodyClick_=function(e){var e=e.target,t=pskl.utils.Dom.isParent(e,this.drawerContainer),e=e.dataset.setting;this.isExpanded&&!(t||e)&&this.closeDrawer_()},e.SettingsController.prototype.loadSetting_=function(e){this.drawerContainer.innerHTML=pskl.utils.Template.get(t[e].template),this.destroyCurrentController_(),this.currentSetting=e,this.currentController=new t[e].controller(this.piskelController),this.currentController.init(),pskl.app.shortcutService.registerShortcut(this.closeDrawerShortcut,this.closeDrawer_.bind(this)),pskl.utils.Dom.removeClass(i);e=document.querySelector("[data-setting="+e+"]");e&&e.classList.add(i),this.settingsContainer.classList.add("expanded"),this.isExpanded=!0},e.SettingsController.prototype.closeDrawer_=function(){pskl.utils.Dom.removeClass(i),this.settingsContainer.classList.remove("expanded"),this.isExpanded=!1,this.currentSetting=null,document.activeElement.blur(),this.destroyCurrentController_()},e.SettingsController.prototype.destroyCurrentController_=function(){this.currentController&&(pskl.app.shortcutService.unregisterShortcut(this.closeDrawerShortcut),this.currentController.destroy)&&(this.currentController.destroy(),this.currentController=null)}}(),!function(){var e=$.namespace("pskl.controller.dialogs");e.AbstractDialogController=function(){},e.AbstractDialogController.prototype.init=function(){var e=document.querySelector(".dialog-close");this.addEventListener(e,"click",this.closeDialog)},e.AbstractDialogController.prototype.addEventListener=function(e,t,i){pskl.utils.Event.addEventListener(e,t,i,this)},e.AbstractDialogController.prototype.destroy=function(){pskl.utils.Event.removeAllEventListeners(this)},e.AbstractDialogController.prototype.closeDialog=function(){$.publish(Events.DIALOG_HIDE)},e.AbstractDialogController.prototype.setTitle=function(e){var t=document.querySelector(".dialog-title");t&&(t.innerText=e)}}(),!function(){var e=$.namespace("pskl.controller.dialogs");e.CreatePaletteController=function(e){this.paletteService=pskl.app.paletteService,this.paletteImportService=pskl.app.paletteImportService},pskl.utils.inherit(e.CreatePaletteController,e.AbstractDialogController),e.CreatePaletteController.prototype.init=function(e){this.superclass.init.call(this),this.hiddenFileInput=document.querySelector(".create-palette-import-input"),this.nameInput=document.querySelector('input[name="palette-name"]');var t=document.querySelector(".create-palette-actions"),i=document.querySelector(".create-palette-delete"),r=document.querySelector(".create-palette-download-button"),n=document.querySelector(".create-palette-import-button"),t=(this.addEventListener(this.nameInput,"input",this.onNameInputChange_),this.addEventListener(this.hiddenFileInput,"change",this.onFileInputChange_),this.addEventListener(t,"click",this.onButtonClick_),this.addEventListener(r,"click",this.onDownloadButtonClick_),this.addEventListener(n,"click",this.onImportFileButtonClick_),document.querySelector(".colors-container")),t=(this.colorsListWidget=new pskl.widgets.ColorsList(t),e==Constants.CURRENT_COLORS_PALETTE_ID);n=e&&!t?(n.style.display="none",this.setTitle("Edit Palette"),n=this.paletteService.getPaletteById(e),pskl.model.Palette.fromObject(n)):(r.style.display="none",i.style.display="none",this.setTitle("Create Palette"),e=pskl.utils.Uuid.generate(),t?new pskl.model.Palette(e,"Current colors clone",this.getCurrentColors_()):new pskl.model.Palette(e,"New palette",[])),this.setPalette_(n)},e.CreatePaletteController.prototype.getCurrentColors_=function(){return this.paletteService.getPaletteById(Constants.CURRENT_COLORS_PALETTE_ID).getColors()},e.CreatePaletteController.prototype.setPalette_=function(e){this.palette=e,this.nameInput.value=pskl.utils.unescapeHtml(e.name),this.colorsListWidget.setColors(e.getColors())},e.CreatePaletteController.prototype.destroy=function(){this.colorsListWidget.destroy(),this.superclass.destroy.call(this),this.nameInput=null,this.hiddenFileInput=null},e.CreatePaletteController.prototype.onButtonClick_=function(e){e=e.target;"submit"===e.dataset.action?this.saveAndSelectPalette_():"cancel"===e.dataset.action?this.closeDialog():"delete"===e.dataset.action&&this.deletePalette_()},e.CreatePaletteController.prototype.saveAndSelectPalette_=function(){this.palette.setColors(this.colorsListWidget.getColors()),this.paletteService.savePalette(this.palette),pskl.UserSettings.set(pskl.UserSettings.SELECTED_PALETTE,this.palette.id),this.closeDialog()},e.CreatePaletteController.prototype.deletePalette_=function(){window.confirm("Are you sure you want to delete palette "+this.palette.name)&&(this.paletteService.deletePaletteById(this.palette.id),pskl.UserSettings.set(pskl.UserSettings.SELECTED_PALETTE,Constants.CURRENT_COLORS_PALETTE_ID),this.closeDialog())},e.CreatePaletteController.prototype.onDownloadButtonClick_=function(){var e=new pskl.service.palette.PaletteGplWriter(this.palette).write();pskl.utils.BlobUtils.stringToBlob(e,function(e){pskl.utils.FileUtils.downloadAsFile(e,this.palette.name+".gpl")}.bind(this),"application/json")},e.CreatePaletteController.prototype.onImportFileButtonClick_=function(){this.hiddenFileInput.click()},e.CreatePaletteController.prototype.onFileInputChange_=function(e){var t=this.hiddenFileInput.files;1==t.length&&this.paletteImportService.read(t[0],this.setPalette_.bind(this),this.displayErrorMessage_.bind(this))},e.CreatePaletteController.prototype.displayErrorMessage_=function(e){e="Could not import palette : "+e,$.publish(Events.SHOW_NOTIFICATION,[{content:e}]),window.setTimeout($.publish.bind($,Events.HIDE_NOTIFICATION),2e3)},e.CreatePaletteController.prototype.onNameInputChange_=function(e){this.palette.name=pskl.utils.escapeHtml(this.nameInput.value)}}(),!function(){var e=$.namespace("pskl.controller.dialogs.backups.steps");e.SelectSession=function(e,t,i){this.piskelController=e,this.backupsController=t,this.container=i},e.SelectSession.prototype.addEventListener=function(e,t,i){pskl.utils.Event.addEventListener(e,t,i,this)},e.SelectSession.prototype.init=function(){this.addEventListener(this.container,"click",this.onContainerClick_)},e.SelectSession.prototype.onShow=function(){this.update()},e.SelectSession.prototype.update=function(){pskl.app.backupService.list().then(function(e){e=this.getMarkupForSessions_(e);this.container.querySelector(".session-list").innerHTML=e}.bind(this)).catch(function(){var e=pskl.utils.Template.get("session-list-error");this.container.querySelector(".session-list").innerHTML=e}.bind(this))},e.SelectSession.prototype.getMarkupForSessions_=function(e){var i;return 0===e.length?pskl.utils.Template.get("session-list-empty"):(i=pskl.utils.Template.get("session-list-item"),e.reduce(function(e,t){return t.id===pskl.app.sessionId?e:(t={id:t.id,name:t.name,description:t.description?"- "+t.description:"",date:pskl.utils.DateUtils.format(t.endDate,"the {{Y}}/{{M}}/{{D}} at {{H}}:{{m}}"),count:1===t.count?"1 snapshot":t.count+" snapshots"},e+pskl.utils.Template.replace(i,t))},""))},e.SelectSession.prototype.destroy=function(){pskl.utils.Event.removeAllEventListeners(this)},e.SelectSession.prototype.onContainerClick_=function(e){var t,i,r=e.target.dataset.sessionId;r&&("view"==(t=e.target.dataset.action)?(this.backupsController.backupsData.selectedSession=r,this.backupsController.next()):"delete"==t&&window.confirm("Are you sure you want to delete this session?")&&(e.target.closest(".session-item").classList.add("deleting"),Q.all([pskl.app.backupService.deleteSession(r),(t=500,i=Q.defer(),setTimeout(function(){i.resolve()},t),i.promise)]).then(function(){this.update()}.bind(this))))}}(),!function(){var e=$.namespace("pskl.controller.dialogs.backups.steps");e.SessionDetails=function(e,t,i){this.piskelController=e,this.backupsController=t,this.container=i},e.SessionDetails.prototype.init=function(){this.backButton=this.container.querySelector(".back-button"),this.addEventListener(this.backButton,"click",this.onBackClick_),this.addEventListener(this.container,"click",this.onContainerClick_)},e.SessionDetails.prototype.destroy=function(){pskl.utils.Event.removeAllEventListeners(this)},e.SessionDetails.prototype.addEventListener=function(e,t,i){pskl.utils.Event.addEventListener(e,t,i,this)},e.SessionDetails.prototype.onShow=function(){var e=this.backupsController.backupsData.selectedSession;pskl.app.backupService.getSnapshotsBySessionId(e).then(function(e){var t=this.getMarkupForSnapshots_(e);this.container.querySelector(".snapshot-list").innerHTML=t,e.forEach(function(e){this.updateSnapshotPreview_(e)}.bind(this))}.bind(this)).catch(function(){var e=pskl.utils.Template.get("snapshot-list-error");this.container.querySelector(".snapshot-list").innerHTML=e}.bind(this))},e.SessionDetails.prototype.getMarkupForSnapshots_=function(e){var i;return 0===e.length?(console.warn("Could not retrieve snapshots for a session"),pskl.utils.Template.get("snapshot-list-empty")):(i=pskl.utils.Template.get("snapshot-list-item"),e.reduce(function(e,t){t={id:t.id,name:t.name,description:t.description?"- "+t.description:"",date:pskl.utils.DateUtils.format(t.date,"the {{Y}}/{{M}}/{{D}} at {{H}}:{{m}}"),frames:1===t.frames?"1 frame":t.frames+" frames",resolution:pskl.utils.StringUtils.formatSize(t.width,t.height),fps:t.fps};return e+pskl.utils.Template.replace(i,t)},""))},e.SessionDetails.prototype.updateSnapshotPreview_=function(i){pskl.utils.serialization.Deserializer.deserialize(JSON.parse(i.serialized),function(e){var t='.snapshot-item[data-snapshot-id="'+i.id+'"] .snapshot-preview',t=this.container.querySelector(t);t&&(e=this.getFirstFrameAsImage_(e),t.appendChild(e))}.bind(this))},e.SessionDetails.prototype.getFirstFrameAsImage_=function(e){var t=pskl.utils.LayerUtils.mergeFrameAt(e.getLayers(),0),i=60/e.width,e=60/e.height,e=Math.min(e,i);return pskl.utils.FrameUtils.toImage(t,e)},e.SessionDetails.prototype.onBackClick_=function(){this.backupsController.back(this)},e.SessionDetails.prototype.onContainerClick_=function(e){"load"==e.target.dataset.action&&window.confirm(Constants.CONFIRM_OVERWRITE)&&(e=+e.target.dataset.snapshotId,pskl.app.backupService.loadSnapshotById(e).then(function(){$.publish(Events.DIALOG_HIDE)}))}}(),!function(){var e=$.namespace("pskl.controller.dialogs.backups"),n={SELECT_SESSION:{controller:e.steps.SelectSession,template:"backups-select-session"},SESSION_DETAILS:{controller:e.steps.SessionDetails,template:"backups-session-details"}};e.BrowseBackups=function(e,t){this.piskelController=e,this.backupsData={sessions:[],selectedSession:null}},pskl.utils.inherit(e.BrowseBackups,pskl.controller.dialogs.AbstractDialogController),e.BrowseBackups.prototype.init=function(){this.superclass.init.call(this),this.steps=this.createSteps_();var e=document.querySelector(".backups-wizard-container");this.wizard=new pskl.widgets.Wizard(this.steps,e),this.wizard.init(),this.wizard.goTo("SELECT_SESSION")},e.BrowseBackups.prototype.back=function(){this.wizard.back(),this.wizard.getCurrentStep().instance.onShow()},e.BrowseBackups.prototype.next=function(){"SELECT_SESSION"===this.wizard.getCurrentStep().name&&this.wizard.goTo("SESSION_DETAILS")},e.BrowseBackups.prototype.destroy=function(e){Object.keys(this.steps).forEach(function(e){e=this.steps[e];e.instance.destroy(),e.instance=null,e.el=null}.bind(this)),this.superclass.destroy.call(this)},e.BrowseBackups.prototype.createSteps_=function(){var r={};return Object.keys(n).forEach(function(e){var t=n[e],i=pskl.utils.Template.getAsHTML(t.template),t=new t.controller(this.piskelController,this,i);t.init(),r[e]={name:e,el:i,instance:t}}.bind(this)),r}}(),!function(){var e=$.namespace("pskl.controller.dialogs.importwizard.steps");e.AbstractImportStep=function(e,t,i){this.piskelController=e,this.container=i,this.importController=t,this.mergeData=this.importController.mergeData},e.AbstractImportStep.prototype.init=function(){this.nextButton=this.container.querySelector(".import-next-button"),this.backButton=this.container.querySelector(".import-back-button"),this.addEventListener(this.nextButton,"click",this.onNextClick),this.addEventListener(this.backButton,"click",this.onBackClick)},e.AbstractImportStep.prototype.addEventListener=function(e,t,i){pskl.utils.Event.addEventListener(e,t,i,this)},e.AbstractImportStep.prototype.destroy=function(){this.framePickerWidget&&this.framePickerWidget.destroy(),pskl.utils.Event.removeAllEventListeners(this)},e.AbstractImportStep.prototype.onNextClick=function(){this.importController.next(this)},e.AbstractImportStep.prototype.onBackClick=function(){this.importController.back(this)},e.AbstractImportStep.prototype.onShow=function(){var e,t=this.mergeData.mergePiskel;t&&(this.framePickerWidget?this.framePickerWidget.piskel!=t&&(this.framePickerWidget.piskel=t,this.framePickerWidget.setFrameIndex(1)):(e=this.container.querySelector(".import-preview"),this.framePickerWidget=new pskl.widgets.FramePicker(t,e),this.framePickerWidget.init()),e=pskl.utils.Template.getAndReplace("import-meta-content",{name:t.getDescriptor().name,dimensions:pskl.utils.StringUtils.formatSize(t.getWidth(),t.getHeight()),frames:t.getFrameCount(),layers:t.getLayers().length}),this.container.querySelector(".import-meta").innerHTML=e)}}(),!function(){var n=$.namespace("pskl.controller.dialogs.importwizard.steps");n.AdjustSize=function(e,t,i){this.superclass.constructor.apply(this,arguments)},n.AdjustSize.OPTIONS={KEEP:"keep",EXPAND:"expand"},pskl.utils.inherit(n.AdjustSize,n.AbstractImportStep),n.AdjustSize.prototype.init=function(){this.superclass.init.call(this);var e=this.container.querySelector(".import-resize-anchor-container");this.anchorWidget=new pskl.widgets.AnchorWidget(e,this.onAnchorChange_.bind(this)),this.anchorWidget.setOrigin("TOPLEFT"),this.resizeInfoContainer=this.container.querySelector(".import-resize-info"),this.addEventListener(this.resizeInfoContainer,"change",this.onResizeOptionChange_),this.mergeData.resize=n.AdjustSize.OPTIONS.EXPAND},n.AdjustSize.prototype.destroy=function(){this.anchorWidget.destroy(),this.superclass.destroy.call(this)},n.AdjustSize.prototype.onShow=function(){this.refresh_(),this.superclass.onShow.call(this)},n.AdjustSize.prototype.refresh_=function(){var e=this.isImportedPiskelBigger_(),t=this.mergeData.resize===n.AdjustSize.OPTIONS.KEEP,i=this.formatPiskelSize_(this.piskelController.getPiskel()),r=this.formatPiskelSize_(this.mergeData.mergePiskel),i=e?pskl.utils.Template.getAndReplace("import-resize-bigger-partial",{size:i,newSize:r,keepChecked:t?'checked="checked"':"",expandChecked:t?"":'checked="checked"'}):pskl.utils.Template.getAndReplace("import-resize-smaller-partial",{size:i,newSize:r}),r=(this.resizeInfoContainer.innerHTML=i,this.mergeData.origin&&this.anchorWidget.setOrigin(this.mergeData.origin),this.container.querySelector(".import-resize-anchor-info"));r.innerHTML=e&&t?['<div class="import-resize-warning">',"  Imported content will be cropped!","</div>","Select crop anchor:"].join(""):e?"Select resize anchor:":"Select position anchor:"},n.AdjustSize.prototype.onAnchorChange_=function(e){this.mergeData.origin=e},n.AdjustSize.prototype.onResizeOptionChange_=function(){var e=this.resizeInfoContainer.querySelector(":checked").value;this.mergeData.resize!=e&&(this.mergeData.resize=e,this.refresh_())},n.AdjustSize.prototype.isImportedPiskelBigger_=function(){var e=this.mergeData.mergePiskel;return!!e&&(e.width>this.piskelController.getWidth()||e.height>this.piskelController.getHeight())},n.AdjustSize.prototype.formatPiskelSize_=function(e){return pskl.utils.StringUtils.formatSize(e.width,e.height)}}(),!function(){var e=$.namespace("pskl.controller.dialogs.importwizard.steps");e.ImageImport=function(e,t,i){this.superclass.constructor.apply(this,arguments),this.importedImage_=null,this.file_=null},pskl.utils.inherit(e.ImageImport,e.AbstractImportStep),e.ImageImport.prototype.init=function(e){this.superclass.init.call(this),this.file_=this.mergeData.rawFiles[0],this.importPreview=this.container.querySelector(".import-section-preview"),this.fileNameContainer=this.container.querySelector(".import-image-file-name"),this.singleImportType=this.container.querySelector("[name=import-type][value=single]"),this.sheetImportType=this.container.querySelector("[name=import-type][value=sheet]"),this.resizeWidth=this.container.querySelector("[name=resize-width]"),this.resizeHeight=this.container.querySelector("[name=resize-height]"),this.smoothResize=this.container.querySelector("[name=smooth-resize-checkbox]"),this.frameSizeX=this.container.querySelector("[name=frame-size-x]"),this.frameSizeY=this.container.querySelector("[name=frame-size-y]"),this.frameOffsetX=this.container.querySelector("[name=frame-offset-x]"),this.frameOffsetY=this.container.querySelector("[name=frame-offset-y]"),this.addEventListener(this.singleImportType,"change",this.onImportTypeChange_),this.addEventListener(this.sheetImportType,"change",this.onImportTypeChange_),this.addEventListener(this.resizeWidth,"keyup",this.onResizeInputKeyUp_),this.addEventListener(this.resizeHeight,"keyup",this.onResizeInputKeyUp_),this.addEventListener(this.frameSizeX,"keyup",this.onFrameInputKeyUp_),this.addEventListener(this.frameSizeY,"keyup",this.onFrameInputKeyUp_),this.addEventListener(this.frameOffsetX,"keyup",this.onFrameInputKeyUp_),this.addEventListener(this.frameOffsetY,"keyup",this.onFrameInputKeyUp_),pskl.utils.FileUtils.readImageFile(this.file_,this.onImageLoaded_.bind(this)),this.piskelController.isEmpty()&&(this.nextButton.textContent="import")},e.ImageImport.prototype.onNextClick=function(){this.container.classList.add("import-image-loading"),this.createPiskelFromImage().then(function(e){this.mergeData.mergePiskel=e,this.container.classList.remove("import-image-loading"),this.superclass.onNextClick.call(this)}.bind(this)).catch(function(e){console.error(e)})},e.ImageImport.prototype.onShow=function(){this.container.classList.remove("import-image-loading")},e.ImageImport.prototype.createPiskelFromImage=function(){var e=(e=this.extractFileNameFromPath_(pskl.utils.FileUtils.getFilePath(this.file_))).replace(/\.[a-zA-Z]+$/,""),t=Q.defer();return pskl.app.importService.newPiskelFromImage(this.importedImage_,{importType:this.getImportType_(),frameSizeX:"single"===this.getImportType_()?this.resizeWidth.value:this.sanitizeInputValue_(this.frameSizeX,1),frameSizeY:"single"===this.getImportType_()?this.resizeHeight.value:this.sanitizeInputValue_(this.frameSizeY,1),frameOffsetX:this.sanitizeInputValue_(this.frameOffsetX,0),frameOffsetY:this.sanitizeInputValue_(this.frameOffsetY,0),smoothing:!!this.smoothResize.checked,name:e},t.resolve),t.promise},e.ImageImport.prototype.onImportTypeChange_=function(e){var t,i,r,n;"single"===this.getImportType_()?this.hideFrameGrid_():(t=this.sanitizeInputValue_(this.frameOffsetX,0),i=this.sanitizeInputValue_(this.frameOffsetY,0),r=this.sanitizeInputValue_(this.frameSizeX,1),n=this.sanitizeInputValue_(this.frameSizeY,1),this.drawFrameGrid_(t,i,r,n))},e.ImageImport.prototype.onResizeInputKeyUp_=function(e){var t=e.target.getAttribute("name");this.importedImage_&&this.synchronizeResizeFields_(e.target.value,t)},e.ImageImport.prototype.onFrameInputKeyUp_=function(e){this.importedImage_&&this.synchronizeFrameFields_(e.target.value)},e.ImageImport.prototype.synchronizeResizeFields_=function(e,t){e=parseInt(e,10),isNaN(e)&&(e=0);var i=this.importedImage_.height,r=this.importedImage_.width;this.singleImportType.checked=!0,"resize-width"===t?this.resizeHeight.value=Math.round(e*i/r):this.resizeWidth.value=Math.round(e*r/i)},e.ImageImport.prototype.synchronizeFrameFields_=function(e){e=parseInt(e,10),isNaN(e)&&(e=0);var e=this.sanitizeInputValue_(this.frameSizeX,1),t=this.sanitizeInputValue_(this.frameSizeY,1),i=this.sanitizeInputValue_(this.frameOffsetX,0),r=this.sanitizeInputValue_(this.frameOffsetY,0);this.sheetImportType.checked=!0,this.drawFrameGrid_(i,r,e,t)},e.ImageImport.prototype.sanitizeInputValue_=function(e,t){var i=parseInt(e.value,10);return i=i<=t||isNaN(i)?e.value=t:i},e.ImageImport.prototype.getImportType_=function(){if(this.singleImportType.checked)return this.singleImportType.value;if(this.sheetImportType.checked)return this.sheetImportType.value;throw"Could not find the currently selected import type"},e.ImageImport.prototype.onImageLoaded_=function(e){this.importedImage_=e;var e=this.importedImage_.width,t=this.importedImage_.height,i=(this.importedImage_.onload=function(){},this.extractFileNameFromPath_(pskl.utils.FileUtils.getFilePath(this.file_)));this.fileNameContainer.textContent=i,this.fileNameContainer.setAttribute("title",i),this.resizeWidth.value=e,this.resizeHeight.value=t,this.frameSizeX.value=e,this.frameSizeY.value=t,this.frameOffsetX.value=0,this.frameOffsetY.value=0,this.importPreview.innerHTML="",this.importPreview.appendChild(this.createImagePreview_())},e.ImageImport.prototype.createImagePreview_=function(){var e=document.createElement("IMG");return e.src=this.importedImage_.src,e},e.ImageImport.prototype.extractFileNameFromPath_=function(e){var t=[];return(t=-1!==e.indexOf("/")?e.split("/"):-1!==e.indexOf("\\")?e.split("\\"):[e])[t.length-1]},e.ImageImport.prototype.drawFrameGrid_=function(e,t,i,r){if(this.importedImage_){var n=this.importedImage_.width,o=this.importedImage_.height,s=this.importPreview.querySelector("img"),a=s.offsetWidth,s=s.offsetHeight,l=this.importPreview.querySelector("canvas"),c=(l||(l=pskl.utils.CanvasUtils.createCanvas(a+1,s+1),this.importPreview.appendChild(l)),l.getContext("2d")),p=(c.clearRect(0,0,l.width,l.height),c.beginPath(),Math.floor((n-e)/i)),h=Math.floor((o-t)/r);if(0<p&&0<h){for(var u=a/n,d=s/o,f=p*i+e,g=h*r+t,m=e+.5;m<f+1&&m<n+1;m+=i)c.moveTo(m*u,t*d),c.lineTo(m*u,g*d);for(var y=t+.5;y<g+1&&y<o+1;y+=r)c.moveTo(e*u,y*d),c.lineTo(f*u,y*d);c.lineWidth=1,c.strokeStyle="#039BE5",c.stroke(),l.style.display="block"}else this.hideFrameGrid_()}},e.ImageImport.prototype.hideFrameGrid_=function(){var e=this.importPreview.querySelector("canvas");e&&(e.style.display="none")}}(),!function(){var t=$.namespace("pskl.controller.dialogs.importwizard.steps");t.InsertLocation=function(){this.superclass.constructor.apply(this,arguments)},t.InsertLocation.MODES={ADD:"add",INSERT:"insert"},pskl.utils.inherit(t.InsertLocation,t.AbstractImportStep),t.InsertLocation.prototype.init=function(){this.superclass.init.call(this),this.framePreview=this.container.querySelector(".insert-frame-preview"),this.currentPiskelFramePickerWidget=new pskl.widgets.FramePicker(this.piskelController.getPiskel(),this.framePreview),this.insertModeContainer=this.container.querySelector(".insert-mode-container"),this.addEventListener(this.insertModeContainer,"change",this.onInsertModeChange_),this.mergeData.insertMode=t.InsertLocation.MODES.ADD},t.InsertLocation.prototype.onInsertModeChange_=function(){var e=this.insertModeContainer.querySelector(":checked").value;this.mergeData.insertMode=e,this.mergeData.insertMode===t.InsertLocation.MODES.ADD?this.currentPiskelFramePickerWidget.setFirstFrameIndex(0):this.currentPiskelFramePickerWidget.setFirstFrameIndex(1)},t.InsertLocation.prototype.onShow=function(){this.currentPiskelFramePickerWidget.init();var e=this.piskelController.getCurrentFrameIndex();this.currentPiskelFramePickerWidget.setFrameIndex(e+1),this.currentPiskelFramePickerWidget.setFirstFrameIndex(0),this.superclass.onShow.call(this)},t.InsertLocation.prototype.onNextClick=function(){var e=this.currentPiskelFramePickerWidget.getFrameIndex();this.mergeData.insertIndex=e,this.superclass.onNextClick.call(this)},t.InsertLocation.prototype.destroy=function(){this.currentPiskelFramePickerWidget.destroy(),this.superclass.destroy.call(this)}}(),!function(){var e=$.namespace("pskl.controller.dialogs.importwizard.steps");e.SelectMode=function(e,t,i){this.superclass.constructor.apply(this,arguments)},e.SelectMode.MODES={REPLACE:"replace",MERGE:"merge"},pskl.utils.inherit(e.SelectMode,e.AbstractImportStep),e.SelectMode.prototype.init=function(){this.superclass.init.call(this);var e=this.container.querySelector(".import-mode-replace-button"),t=this.container.querySelector(".import-mode-merge-button");this.addEventListener(e,"click",this.onReplaceButtonClick_),this.addEventListener(t,"click",this.onMergeButtonClick_)},e.SelectMode.prototype.onShow=function(){this.superclass.onShow.call(this)},e.SelectMode.prototype.destroy=function(){this.superclass.destroy.call(this)},e.SelectMode.prototype.onReplaceButtonClick_=function(){this.mergeData.importMode=e.SelectMode.MODES.REPLACE,this.onNextClick()},e.SelectMode.prototype.onMergeButtonClick_=function(){this.mergeData.importMode=e.SelectMode.MODES.MERGE,this.onNextClick()}}(),!function(){var i=$.namespace("pskl.controller.dialogs.importwizard"),o={IMAGE_IMPORT:{controller:i.steps.ImageImport,template:"import-image-import"},ADJUST_SIZE:{controller:i.steps.AdjustSize,template:"import-adjust-size"},INSERT_LOCATION:{controller:i.steps.InsertLocation,template:"import-insert-location"},SELECT_MODE:{controller:i.steps.SelectMode,template:"import-select-mode"}};i.ImportWizard=function(e,t){this.piskelController=e,this.mergeData={rawFiles:[],mergePiskel:null,origin:null,resize:null,insertIndex:null,insertMode:null}},pskl.utils.inherit(i.ImportWizard,pskl.controller.dialogs.AbstractDialogController),i.ImportWizard.prototype.init=function(e){this.superclass.init.call(this),this.mergeData.rawFiles=e.rawFiles,this.steps=this.createSteps_();e=document.querySelector(".import-wizard-container");this.wizard=new pskl.widgets.Wizard(this.steps,e),this.wizard.init(),this.hasSingleImage_()?this.wizard.goTo("IMAGE_IMPORT"):this.hasSinglePiskelFile_()?pskl.utils.PiskelFileUtils.loadFromFile(this.mergeData.rawFiles[0],function(e){this.mergeData.mergePiskel=e,this.wizard.goTo("SELECT_MODE")}.bind(this),function(e){this.closeDialog(),$.publish(Events.PISKEL_FILE_IMPORT_FAILED,[e])}.bind(this)):(console.error("Unsupported import. Only single piskel or single image are supported at the moment."),this.closeDialog())},i.ImportWizard.prototype.back=function(){this.wizard.back(),this.wizard.getCurrentStep().instance.onShow()},i.ImportWizard.prototype.next=function(){var e=this.wizard.getCurrentStep();"IMAGE_IMPORT"===e.name?this.piskelController.isEmpty()?(this.mergeData.importMode=i.steps.SelectMode.MODES.REPLACE,this.finalizeImport_()):this.wizard.goTo("SELECT_MODE"):"SELECT_MODE"===e.name?this.mergeData.importMode===i.steps.SelectMode.MODES.REPLACE?this.finalizeImport_():this.hasSameSize_()?this.wizard.goTo("INSERT_LOCATION"):this.wizard.goTo("ADJUST_SIZE"):"ADJUST_SIZE"===e.name?this.wizard.goTo("INSERT_LOCATION"):"INSERT_LOCATION"===e.name&&this.finalizeImport_()},i.ImportWizard.prototype.destroy=function(e){Object.keys(this.steps).forEach(function(e){e=this.steps[e];e.instance.destroy(),e.instance=null,e.el=null}.bind(this)),this.superclass.destroy.call(this)},i.ImportWizard.prototype.createSteps_=function(){var r=this.hasSingleImage_(),n={};return Object.keys(o).forEach(function(e){var t,i;"IMAGE_IMPORT"===e&&!r||(i=o[e],t=pskl.utils.Template.getAsHTML(i.template),(i=new i.controller(this.piskelController,this,t)).init(),n[e]={name:e,el:t,instance:i})}.bind(this)),(r?n.IMAGE_IMPORT:n.SELECT_MODE).el.classList.add("import-first-step"),n},i.ImportWizard.prototype.finalizeImport_=function(){var e=this.mergeData.mergePiskel,t=this.mergeData.importMode;t===i.steps.SelectMode.MODES.REPLACE?window.confirm(Constants.CONFIRM_OVERWRITE)&&(this.piskelController.setPiskel(e),this.closeDialog()):t===i.steps.SelectMode.MODES.MERGE&&(t=pskl.utils.MergeUtils.merge(this.piskelController.getPiskel(),e,{insertIndex:this.mergeData.insertIndex,insertMode:this.mergeData.insertMode,origin:this.mergeData.origin,resize:this.mergeData.resize}),this.piskelController.setPiskel(t),t=e.getLayers().length,e=this.piskelController.getLayers().length,this.piskelController.setCurrentLayerIndex(e-t),this.closeDialog())},i.ImportWizard.prototype.hasSameSize_=function(){var e=this.mergeData.mergePiskel;return!!e&&e.width===this.piskelController.getWidth()&&e.height===this.piskelController.getHeight()},i.ImportWizard.prototype.hasSingleImage_=function(){var e;return 1===this.mergeData.rawFiles.length&&(e=this.mergeData.rawFiles[0],pskl.utils.FileUtils.isFileImage(e))},i.ImportWizard.prototype.hasSinglePiskelFile_=function(){var e;return 1===this.mergeData.rawFiles.length&&(e=this.mergeData.rawFiles[0],pskl.utils.FileUtils.isFilePiskel(e))}}(),!function(){var e=$.namespace("pskl.controller.dialogs");e.PerformanceInfoController=function(){},pskl.utils.inherit(e.PerformanceInfoController,e.AbstractDialogController),e.PerformanceInfoController.prototype.init=function(){this.superclass.init.call(this)}}(),!function(){var e=$.namespace("pskl.controller.dialogs");e.UnsupportedBrowserController=function(){},pskl.utils.inherit(e.UnsupportedBrowserController,e.AbstractDialogController),e.UnsupportedBrowserController.prototype.init=function(){this.superclass.init.call(this),document.querySelector("#current-user-agent").innerText=pskl.utils.UserAgent.getDisplayName()}}(),!function(){var e=$.namespace("pskl.controller.dialogs"),r={"create-palette":{template:"templates/dialogs/create-palette.html",controller:e.CreatePaletteController},import:{template:"templates/dialogs/import.html",controller:e.importwizard.ImportWizard},"performance-info":{template:"templates/dialogs/performance-info.html",controller:e.PerformanceInfoController},"unsupported-browser":{template:"templates/dialogs/unsupported-browser.html",controller:e.UnsupportedBrowserController},"browse-backups":{template:"templates/dialogs/browse-backups.html",controller:e.backups.BrowseBackups}};e.DialogsController=function(e){this.piskelController=e,this.closePopupShortcut=pskl.service.keyboard.Shortcuts.MISC.CLOSE_POPUP,this.currentDialog_=null},e.DialogsController.prototype.init=function(){this.dialogContainer_=document.getElementById("dialog-container"),this.dialogWrapper_=document.getElementById("dialog-container-wrapper"),$.subscribe(Events.DIALOG_SHOW,this.onDialogDisplayEvent_.bind(this)),$.subscribe(Events.DIALOG_HIDE,this.hideDialog.bind(this));var e=pskl.service.keyboard.Shortcuts.COLOR.CREATE_PALETTE;pskl.app.shortcutService.registerShortcut(e,this.onCreatePaletteShortcut_.bind(this)),this.dialogWrapper_.classList.add("animated"),pskl.utils.Event.addEventListener(this.dialogWrapper_,"click",this.onWrapperClicked_,this)},e.DialogsController.prototype.onCreatePaletteShortcut_=function(){this.toggleDialog_("create-palette")},e.DialogsController.prototype.toggleDialog_=function(e){this.isDisplayingDialog_()?this.getCurrentDialogId_()===e&&this.hideDialog():this.showDialog(e)},e.DialogsController.prototype.onDialogDisplayEvent_=function(e,t){this.showDialog(t.dialogId,t.initArgs)},e.DialogsController.prototype.onWrapperClicked_=function(e){e.target===this.dialogWrapper_&&this.hideDialog()},e.DialogsController.prototype.showDialog=function(e,t){var i;this.isDisplayingDialog_()||((i=r[e])?(this.dialogContainer_.classList.add(e),this.dialogContainer_.innerHTML=pskl.utils.Template.get(i.template),(i=new i.controller(this.piskelController)).init(t),this.currentDialog_={id:e,controller:i},pskl.app.shortcutService.registerShortcut(this.closePopupShortcut,this.hideDialog.bind(this)),this.dialogWrapper_.classList.add("show")):console.error("Could not find dialog configuration for dialogId : "+e))},e.DialogsController.prototype.hideDialog=function(){!this.isHiding_&&this.isDisplayingDialog_()&&(pskl.app.shortcutService.unregisterShortcut(this.closePopupShortcut),this.dialogWrapper_.classList.remove("show"),window.setTimeout(this.cleanupDialogContainer_.bind(this),500),this.isHiding_=!0)},e.DialogsController.prototype.cleanupDialogContainer_=function(){this.dialogContainer_.classList.remove(this.currentDialog_.id),this.currentDialog_.controller.destroy(),this.currentDialog_=null,this.dialogContainer_.innerHTML="",this.isHiding_=!1},e.DialogsController.prototype.isDisplayingDialog_=function(){return null!==this.currentDialog_},e.DialogsController.prototype.getCurrentDialogId_=function(){return this.currentDialog_?this.currentDialog_.id:null}}(),!function(){var t=$.namespace("pskl.widgets"),r="anchor-option";t.AnchorWidget=function(e,t){this.onChangeCallback=t,this.wrapper=document.createElement("div"),this.wrapper.classList.add("anchor-wrapper"),this.wrapper.innerHTML='<div class="anchor-option"  title="top left"      data-origin="TOPLEFT"></div><div class="anchor-option"  title="top"           data-origin="TOP"></div><div class="anchor-option"  title="top right"     data-origin="TOPRIGHT"></div><div class="anchor-option"  title="middle left"   data-origin="MIDDLELEFT"></div><div class="anchor-option"  title="middle"        data-origin="MIDDLE"></div><div class="anchor-option"  title="middle right"  data-origin="MIDDLERIGHT"></div><div class="anchor-option"  title="bottom left"   data-origin="BOTTOMLEFT"></div><div class="anchor-option"  title="bottom"        data-origin="BOTTOM"></div><div class="anchor-option"  title="bottom right"  data-origin="BOTTOMRIGHT"></div>',e.innerHTML="",e.appendChild(this.wrapper),this.disabled=!1,pskl.utils.Event.addEventListener(this.wrapper,"click",this.onResizeOriginClick_,this)},t.AnchorWidget.ORIGIN={TOPLEFT:"TOPLEFT",TOP:"TOP",TOPRIGHT:"TOPRIGHT",MIDDLELEFT:"MIDDLELEFT",MIDDLE:"MIDDLE",MIDDLERIGHT:"MIDDLERIGHT",BOTTOMLEFT:"BOTTOMLEFT",BOTTOM:"BOTTOM",BOTTOMRIGHT:"BOTTOMRIGHT"},t.AnchorWidget.prototype.destroy=function(e){pskl.utils.Event.removeAllEventListeners(this),this.wrapper=null},t.AnchorWidget.prototype.onResizeOriginClick_=function(e){e=e.target.dataset.origin;e&&t.AnchorWidget.ORIGIN[e]&&!this.disabled&&this.setOrigin(e)},t.AnchorWidget.prototype.setOrigin=function(e){this.origin=e;var t=this.wrapper.querySelector("."+r+".selected"),t=(t&&t.classList.remove("selected"),this.wrapper.querySelector("."+r+'[data-origin="'+e+'"]'));t&&(t.classList.add("selected"),this.refreshNeighbors_(t)),"function"==typeof this.onChangeCallback&&this.onChangeCallback(e)},t.AnchorWidget.prototype.getOrigin=function(){return this.origin},t.AnchorWidget.prototype.disable=function(){this.disabled=!0,this.wrapper.classList.add("transition"),this.wrapper.classList.add("disabled")},t.AnchorWidget.prototype.enable=function(){this.disabled=!1,this.wrapper.classList.remove("disabled"),window.setTimeout(this.wrapper.classList.remove.bind(this.wrapper.classList,"transition"),250)},t.AnchorWidget.prototype.refreshNeighbors_=function(e){for(var t=this.wrapper.querySelectorAll("."+r),i=0;i<t.length;i++)t[i].removeAttribute("data-neighbor");e=Array.prototype.indexOf.call(t,e);this.setNeighborhood_(t[e-1],"left"),this.setNeighborhood_(t[e+1],"right"),this.setNeighborhood_(t[e-3],"top"),this.setNeighborhood_(t[e+3],"bottom")},t.AnchorWidget.prototype.setNeighborhood_=function(e,t){-1===this.origin.toLowerCase().indexOf(t)&&e.setAttribute("data-neighbor",t)}}(),!function(){var e=$.namespace("pskl.widgets");e.ColorsList=function(e){this.selectedIndex=-1,this.palette=new pskl.model.Palette("tmp","tmp",[]),this.container=e,this.colorsList=this.container.querySelector(".colors-list"),this.colorPreviewEl=this.container.querySelector(".color-preview"),$(e).sortable({placeholder:"colors-list-drop-proxy",update:this.onColorDrop_.bind(this),items:".create-palette-color"}),pskl.utils.Event.addEventListener(this.colorsList,"click",this.onColorContainerClick_,this);e=e.querySelector(".color-picker-container");this.hslRgbColorPicker=new pskl.widgets.HslRgbColorPicker(e,this.onColorUpdated_.bind(this)),this.hslRgbColorPicker.init()},e.ColorsList.prototype.setColors=function(e){0===e.length&&e.push("#000000"),this.palette.setColors(e),this.selectColor_(0),this.refresh_()},e.ColorsList.prototype.getColors=function(){return this.palette.getColors()},e.ColorsList.prototype.destroy=function(){pskl.utils.Event.removeAllEventListeners(this),$(this.container).sortable("destroy"),this.hslRgbColorPicker.destroy(),this.container=null,this.colorsList=null,this.colorPreviewEl=null},e.ColorsList.prototype.refreshColorElement_=function(e){var t=this.palette.get(this.selectedIndex),e=document.querySelector('[data-palette-index="'+e+'"]');e&&(e.style.background=t,e.classList.toggle("light-color",this.isLight_(t)))},e.ColorsList.prototype.onColorContainerClick_=function(e){var t=e.target;t.classList.contains("create-palette-color")?this.onPaletteColorClick_(e,t):t.classList.contains("create-palette-new-color")?this.onNewColorClick_(e,t):t.classList.contains("create-palette-remove-color")&&this.onRemoveColorClick_(e,t),this.refresh_()},e.ColorsList.prototype.onColorUpdated_=function(e){e=e.toHexString();this.colorPreviewEl.style.background=e,this.palette&&(this.palette.set(this.selectedIndex,e),this.refreshColorElement_(this.selectedIndex))},e.ColorsList.prototype.onPaletteColorClick_=function(e,t){t=parseInt(t.dataset.paletteIndex,10);this.selectColor_(t)},e.ColorsList.prototype.onRemoveColorClick_=function(e,t){t=t.parentNode,t=parseInt(t.dataset.paletteIndex,10);this.removeColor_(t)},e.ColorsList.prototype.onNewColorClick_=function(e,t){var i=this.palette.get(this.selectedIndex)||"#000000";this.palette.add(i),this.selectColor_(this.palette.size()-1)},e.ColorsList.prototype.refresh_=function(){var r="",n=pskl.utils.Template.get("create-palette-color-template");this.palette.getColors().forEach(function(e,t){var i=t===this.selectedIndex;r+=pskl.utils.Template.replace(n,{color:e,index:t,":selected":i,":light-color":this.isLight_(e)})}.bind(this)),r+='<li class="create-palette-new-color">+</li>',this.colorsList.innerHTML=r},e.ColorsList.prototype.selectColor_=function(e){this.selectedIndex=e,this.hslRgbColorPicker.setColor(this.palette.get(e))},e.ColorsList.prototype.removeColor_=function(e){this.palette.removeAt(e),this.refresh_()},e.ColorsList.prototype.isLight_=function(e){e=window.tinycolor(e).toRgb();return 384<e.r+e.b+e.g},e.ColorsList.prototype.onColorDrop_=function(e,t){var t=t.item.get(0),i=parseInt(t.dataset.paletteIndex,10),r=document.querySelectorAll(".create-palette-color"),r=Array.prototype.indexOf.call(r,t);this.palette.move(i,r),this.selectedIndex=r,this.refresh_()}}(),!function(){var e=$.namespace("pskl.widgets");e.FramePicker=function(e,t){this.piskel=e,this.container=t,this.firstFrameIndex=1,this.wrapper=document.createElement("div"),this.wrapper.innerHTML='<div class="frame-viewer"></div><div class="frame-nav"><button class="button frame-nav-first">&lt;&lt;</button><button class="button frame-nav-previous">&lt;</button><input class="textfield frame-nav-input" type="text"><button class="button frame-nav-next">&gt;</button><button class="button frame-nav-last">&gt;&gt;</button></div>',this.wrapper.classList.add("frame-picker-wrapper"),this.frameViewer=this.wrapper.querySelector(".frame-viewer"),this.firstButton=this.wrapper.querySelector(".frame-nav-first"),this.previousButton=this.wrapper.querySelector(".frame-nav-previous"),this.nextButton=this.wrapper.querySelector(".frame-nav-next"),this.lastButton=this.wrapper.querySelector(".frame-nav-last"),this.input=this.wrapper.querySelector(".frame-nav-input")},e.FramePicker.prototype.init=function(){this.container.appendChild(this.wrapper),this.addEventListener(this.firstButton,"click",this.onFirstClicked_),this.addEventListener(this.previousButton,"click",this.onPreviousClicked_),this.addEventListener(this.nextButton,"click",this.onNextClicked_),this.addEventListener(this.lastButton,"click",this.onLastClicked_),this.addEventListener(this.input,"change",this.onInputChange_),this.setFrameIndex(1)},e.FramePicker.prototype.setFirstFrameIndex=function(e){this.firstFrameIndex=e,this.setFrameIndex(this.currentFrameIndex)},e.FramePicker.prototype.destroy=function(){this.wrapper.parentNode&&this.wrapper.parentNode.removeChild(this.wrapper),pskl.utils.Event.removeAllEventListeners(this)},e.FramePicker.prototype.onFirstClicked_=function(){this.setFrameIndex(this.firstFrameIndex)},e.FramePicker.prototype.onPreviousClicked_=function(){this.setFrameIndex(this.currentFrameIndex-1)},e.FramePicker.prototype.onNextClicked_=function(){this.setFrameIndex(this.currentFrameIndex+1)},e.FramePicker.prototype.onLastClicked_=function(){this.setFrameIndex(this.piskel.getFrameCount())},e.FramePicker.prototype.onInputChange_=function(){var e=parseInt(this.input.value,10);isNaN(e)?this.input.value=1:(e=Math.max(this.firstFrameIndex,e),(e=Math.min(this.getFrameCount_(),e))!==this.currentFrameIndex&&this.setFrameIndex(e))},e.FramePicker.prototype.getFrameCount_=function(){return this.piskel.getLayerAt(0).getFrames().length},e.FramePicker.prototype.addEventListener=function(e,t,i){pskl.utils.Event.addEventListener(e,t,i,this)},e.FramePicker.prototype.getFrameIndex=function(){return this.currentFrameIndex},e.FramePicker.prototype.setFrameIndex=function(e){e=Math.max(this.firstFrameIndex,e),e=Math.min(this.getFrameCount_(),e),this.currentFrameIndex=e,this.input.value=e;var t=this.getFrameAsImage_(e),t=(t.classList.add("canvas-background"),this.frameViewer.innerHTML="",this.frameViewer.appendChild(t),this.getFrameCount_());this.setEnabled_(this.firstButton,e!==this.firstFrameIndex),this.setEnabled_(this.previousButton,e!==this.firstFrameIndex),this.setEnabled_(this.nextButton,e!==t),this.setEnabled_(this.lastButton,e!==t),0===e&&(this.previousButton.setAttribute("disabled",!0),this.firstButton.setAttribute("disabled",!0))},e.FramePicker.prototype.getFrameAsImage_=function(e){var t;return 0===e?new Image:(e=pskl.utils.LayerUtils.mergeFrameAt(this.piskel.getLayers(),e-1),t=this.getZoomLevel_(),pskl.utils.FrameUtils.toImage(e,t))},e.FramePicker.prototype.getZoomLevel_=function(){var e=this.frameViewer.offsetWidth,t=this.frameViewer.offsetHeight,e=e/this.piskel.width,t=t/this.piskel.height;return Math.min(t,e)},e.FramePicker.prototype.setEnabled_=function(e,t){t?e.removeAttribute("disabled"):e.setAttribute("disabled",!0)}}(),!function(){var e=$.namespace("pskl.widgets");e.HslRgbColorPicker=function(e,t){this.container=e,this.colorUpdatedCallback=t,this.tinyColor=null,this.hsvColor=null,this.rgbColor=null,this.lastInputTimestamp_=0},e.HslRgbColorPicker.prototype.init=function(){var e=pskl.utils.UserAgent.isFirefox,t=pskl.utils.UserAgent.isChrome;pskl.utils.Event.addEventListener(this.container,t||e?"input":"change",this.onPickerChange_,this),pskl.utils.Event.addEventListener(this.container,"keydown",this.onPickerChange_,this),this.onBlur_=this.onBlur_.bind(this),this.container.addEventListener("blur",this.onBlur_,!0),this.spectrumEl=this.container.querySelector(".color-picker-spectrum"),$(this.spectrumEl).spectrum({flat:!0,showButtons:!1,move:this.setColor.bind(this),change:this.setColor.bind(this)}),this.setColor("#000000")},e.HslRgbColorPicker.prototype.destroy=function(){pskl.utils.Event.removeAllEventListeners(this),this.container.removeEventListener("blur",this.onBlur_,!0),$(this.spectrumEl).spectrum("destroy"),this.container=null,this.spectrumEl=null},e.HslRgbColorPicker.prototype.onPickerChange_=function(e){var t,i,e=e.target;e.dataset.dimension&&(t=e.dataset.model,i=e.dataset.dimension,e=e.value,this.updateColor_(e,t,i))},e.HslRgbColorPicker.prototype.onKeydown_=function(e){var t,i,r=e.target;"text"!==r.getAttribute("type").toLowerCase()||!r.dataset.dimension||"rgb"!==(t=r.dataset.model)&&"hsv"!==t||(e=this.getIncrement_(e))&&(i=r.dataset.dimension,r=parseInt(r.value,10),this.updateColor_(r+e,t,i))},e.HslRgbColorPicker.prototype.getIncrement_=function(e){var t=0,i=pskl.service.keyboard.KeycodeTranslator.toChar(e.keyCode);return"up"===i?t=1:"down"===i&&(t=-1),e.shiftKey&&(t*=5),t},e.HslRgbColorPicker.prototype.updateColor_=function(e,t,i){var r,e=this.toModelValue_(e,t,i);"hsv"===t||"rgb"===t?isNaN(e)||((r=this.getColor_(t))[i]=this.normalizeDimension_(e,i),this.setColor(r)):"hex"===t&&/^#([a-f0-9]{3}){1,2}$/i.test(e)&&this.setColor(e)},e.HslRgbColorPicker.prototype.onBlur_=function(e){var t,i,e=e.target;"text"===e.getAttribute("type").toLowerCase()&&e.dataset.dimension&&(t=e.dataset.model,i=e.dataset.dimension,e.value=this.toInputValue_(t,i))},e.HslRgbColorPicker.prototype.setColor=function(e){this.unplugged||(this.unplugged=!0,this.hsvColor=this.toHsvColor_(e),this.tinyColor=this.toTinyColor_(e),this.rgbColor=this.tinyColor.toRgb(),this.updateInputs(),$(".color-picker-spectrum").spectrum("set",this.tinyColor),this.colorUpdatedCallback(this.tinyColor),this.unplugged=!1)},e.HslRgbColorPicker.prototype.updateInputs=function(){for(var e=this.container.querySelectorAll("input"),t=0;t<e.length;t++){var i=e[t],r=i.dataset.dimension,n=i.dataset.model,n=this.toInputValue_(n,r);i.value!=n&&(i.value=n),"range"===i.getAttribute("type")&&this.updateSliderBackground(i)}},e.HslRgbColorPicker.prototype.toInputValue_=function(e,t){var i;return"rgb"===e||"hsv"===e?(i=this.getColor_(e)[t],"v"!==t&&"s"!==t||(i*=100),i=Math.round(i)):"hex"===e&&(i=this.tinyColor.toHexString(!0)),i},e.HslRgbColorPicker.prototype.toModelValue_=function(e,t,i){var r;return"rgb"===t||"hsv"===t?(r=parseInt(e,10),"v"!==i&&"s"!==i||(r/=100)):"hex"===t&&(r=e),r},e.HslRgbColorPicker.prototype.toTinyColor_=function(e){return"object"==typeof e&&e.hasOwnProperty("_tc_id")?e:window.tinycolor(pskl.utils.copy(e))},e.HslRgbColorPicker.prototype.toHsvColor_=function(e){return["h","s","v"].every(e.hasOwnProperty.bind(e))?{h:this.normalizeDimension_(e.h,"h"),s:this.normalizeDimension_(e.s,"s"),v:this.normalizeDimension_(e.v,"v")}:this.toTinyColor_(e).toHsv()},e.HslRgbColorPicker.prototype.normalizeDimension_=function(e,t){t=this.getDimensionRange_(t);return Math.max(t[0],Math.min(t[1],e))},e.HslRgbColorPicker.prototype.updateSliderBackground=function(e){var t=e.dataset.dimension,i=e.dataset.model;"h"!==t&&(i=this.getSliderBackgroundColors_(i,t),e.style.backgroundImage="linear-gradient(to right, "+i.start+" 0, "+i.end+" 100%)")},e.HslRgbColorPicker.prototype.getSliderBackgroundColors_=function(e,t){var e=this.getColor_(e),i=pskl.utils.copy(e),e=pskl.utils.copy(e),r=this.getDimensionRange_(t);return i[t]=r[0],e[t]=r[1],{start:window.tinycolor(i).toRgbString(),end:window.tinycolor(e).toRgbString()}},e.HslRgbColorPicker.prototype.getDimensionRange_=function(e){return"h"===e?[0,359]:"s"===e||"v"===e?[0,1]:"r"===e||"g"===e||"b"===e?[0,255]:void 0},e.HslRgbColorPicker.prototype.getColor_=function(e){var t;return"hsv"===e?t=this.hsvColor:"rgb"===e&&(t=this.rgbColor),t}}(),!function(){var t=$.namespace("pskl.widgets");t.SizeInput=function(e){this.widthInput=e.widthInput,this.heightInput=e.heightInput,this.initWidth=e.initWidth,this.initHeight=e.initHeight,this.onChange=e.onChange,this.synchronizedInputs=new t.SynchronizedInputs({leftInput:this.widthInput,rightInput:this.heightInput,synchronize:this.synchronize_.bind(this)}),this.disableSync=this.synchronizedInputs.disableSync.bind(this.synchronizedInputs),this.enableSync=this.synchronizedInputs.enableSync.bind(this.synchronizedInputs),this.widthInput.value=this.initWidth,this.heightInput.value=this.initHeight},t.SizeInput.prototype.destroy=function(){this.synchronizedInputs.destroy(),this.widthInput=null,this.heightInput=null},t.SizeInput.prototype.setWidth=function(e){this.widthInput.value=e,this.synchronize_(this.widthInput)},t.SizeInput.prototype.setHeight=function(e){this.heightInput.value=e,this.synchronize_(this.heightInput)},t.SizeInput.prototype.synchronize_=function(e){var t=parseInt(e.value,10);isNaN(t)&&(t=0),e===this.widthInput?this.heightInput.value=Math.round(t*this.initHeight/this.initWidth):e===this.heightInput&&(this.widthInput.value=Math.round(t*this.initWidth/this.initHeight)),this.onChange&&this.onChange()}}(),!function(){var e=$.namespace("pskl.widgets");e.SizePicker=function(e){this.onChange=e},e.SizePicker.prototype.init=function(e){this.container=e,pskl.utils.Event.addEventListener(this.container,"click",this.onSizeOptionClick_,this)},e.SizePicker.prototype.destroy=function(){pskl.utils.Event.removeAllEventListeners(this)},e.SizePicker.prototype.getSize=function(){var e=this.container.querySelector(".selected");return e?e.dataset.size:null},e.SizePicker.prototype.setSize=function(e){var t;this.getSize()!==e&&(pskl.utils.Dom.removeClass("labeled",this.container),pskl.utils.Dom.removeClass("selected",this.container),(t=this.container.querySelector('[data-size="'+e+'"]'))||((t=this.container.querySelector("[data-size]:last-child")).classList.add("labeled"),t.setAttribute("real-size",e)),t)&&t.classList.add("selected")},e.SizePicker.prototype.onSizeOptionClick_=function(e){e=e.target.dataset.size;isNaN(e)||(e=parseInt(e,10),this.onChange(e),this.setSize(e))}}(),!function(){var e=$.namespace("pskl.widgets");e.SynchronizedInputs=function(e){this.leftInput=e.leftInput,this.rightInput=e.rightInput,this.synchronize=e.synchronize,this.syncEnabled=!0,this.lastInput=this.leftInput,pskl.utils.Event.addEventListener(this.leftInput,"input",this.onInput_,this),pskl.utils.Event.addEventListener(this.rightInput,"input",this.onInput_,this)},e.SynchronizedInputs.prototype.destroy=function(){pskl.utils.Event.removeAllEventListeners(this),this.leftInput=null,this.rightInput=null,this.lastInput=null},e.SynchronizedInputs.prototype.enableSync=function(){this.syncEnabled=!0,this.synchronize(this.lastInput)},e.SynchronizedInputs.prototype.disableSync=function(){this.syncEnabled=!1},e.SynchronizedInputs.prototype.onInput_=function(e){e=e.target;this.syncEnabled&&this.synchronize(e),this.lastInput=e}}(),!function(){var e=$.namespace("pskl.widgets");e.Tabs=function(e,t,i){this.tabs=e,this.parentController=t,this.settingsName=i,this.currentTab=null,this.currentController=null},e.Tabs.prototype.init=function(e){this.tabListEl=e.querySelector(".tab-list"),this.tabContentlEl=e.querySelector(".tab-content"),pskl.utils.Event.addEventListener(this.tabListEl,"click",this.onTabsClicked_,this);e=pskl.UserSettings.get(this.settingsName);e&&this.selectTab(e)},e.Tabs.prototype.destroy=function(){this.currentController&&this.currentController.destroy(),pskl.utils.Event.removeAllEventListeners(this)},e.Tabs.prototype.selectTab=function(e){var t;this.tabs[e]&&this.currentTab!=e&&(this.currentController&&this.currentController.destroy(),this.tabContentlEl.innerHTML=pskl.utils.Template.get(this.tabs[e].template),this.currentController=new this.tabs[e].controller(pskl.app.piskelController,this.parentController),this.currentController.init(),this.currentTab=e,pskl.UserSettings.set(this.settingsName,e),(t=this.tabListEl.querySelector(".selected"))&&t.classList.remove("selected"),this.tabListEl.querySelector('[data-tab-id="'+e+'"]').classList.add("selected"))},e.Tabs.prototype.onTabsClicked_=function(e){e=pskl.utils.Dom.getData(e.target,"tabId");this.selectTab(e)}}(),!function(){var e=$.namespace("pskl.widgets");e.Wizard=function(e,t){this.steps=e,this.container=t,this.wrapper=document.createElement("div"),this.wrapper.classList.add("wizard-wrapper"),this.currentStep=null,this.previousSteps=[]},e.Wizard.prototype.init=function(){Object.keys(this.steps).forEach(function(e){e=this.steps[e];e.el.classList.add("wizard-step"),this.wrapper.appendChild(e.el)}.bind(this)),this.container.appendChild(this.wrapper)},e.Wizard.prototype.getStep=function(e){return this.steps[e]},e.Wizard.prototype.getCurrentStep=function(){return this.currentStep},e.Wizard.prototype.goTo=function(e){var t,i=this.steps[e];i?(t=this.currentStep,this.currentStep=i,this.currentStep.instance.onShow(),t?(this.previousSteps.push(t),this.currentStep.el.classList.add("current-step-in"),window.setTimeout(function(){this.currentStep.el.classList.remove("current-step-in"),t.el.classList.remove("current-step"),this.currentStep.el.classList.add("current-step")}.bind(this),200)):this.currentStep.el.classList.add("current-step")):console.error("Wizard could not go to unknown step: "+e)},e.Wizard.prototype.back=function(){var e,t=this.previousSteps.pop();t?((e=this.currentStep)||console.error("Wizard is in an invalid state"),this.currentStep=t,e.el.classList.add("current-step-out"),e.el.classList.remove("current-step"),this.currentStep.el.classList.add("current-step"),window.setTimeout(function(){e.el.classList.remove("current-step-out")}.bind(this),200)):console.error("Wizard has no previous step to go to.")}}(),!function(){var e=$.namespace("pskl.service.storage");e.StorageService=function(e){this.piskelController=e,this.savingFlag_=!1,this.onSaveSuccess_=this.onSaveSuccess_.bind(this),this.onSaveError_=this.onSaveError_.bind(this)},e.StorageService.prototype.init=function(){var e=pskl.service.keyboard.Shortcuts;pskl.app.shortcutService.registerShortcut(e.STORAGE.OPEN,this.onOpenKey_.bind(this)),pskl.app.shortcutService.registerShortcut(e.STORAGE.SAVE,this.onSaveKey_.bind(this)),pskl.app.shortcutService.registerShortcut(e.STORAGE.SAVE_AS,this.onSaveAsKey_.bind(this)),$.subscribe(Events.BEFORE_SAVING_PISKEL,this.setSavingFlag_.bind(this,!0)),$.subscribe(Events.AFTER_SAVING_PISKEL,this.setSavingFlag_.bind(this,!1))},e.StorageService.prototype.isSaving=function(){return this.savingFlag_},e.StorageService.prototype.saveToFileDownload=function(e){return this.delegateSave_(pskl.app.fileDownloadStorageService,e)},e.StorageService.prototype.saveToDesktop=function(e,t){return this.delegateSave_(pskl.app.desktopStorageService,e,t)},e.StorageService.prototype.delegateSave_=function(e,t,i){return this.savingFlag_?Q.reject("Already saving"):($.publish(Events.BEFORE_SAVING_PISKEL),e.save(t,i).then(this.onSaveSuccess_,this.onSaveError_))},e.StorageService.prototype.onOpenKey_=function(){pskl.utils.Environment.detectNative()&&pskl.app.desktopStorageService.openPiskel()},e.StorageService.prototype.onSaveKey_=function(e){this.piskelController.getPiskel();pskl.app.isLoggedIn()?this.saveToGallery(this.piskelController.getPiskel()):pskl.utils.Environment.detectNative()?this.saveToDesktop(this.piskelController.getPiskel()):window.setTimeout(function(){this.saveToIndexedDb(this.piskelController.getPiskel())}.bind(this),0)},e.StorageService.prototype.onSaveAsKey_=function(){pskl.utils.Environment.detectNative()&&this.saveToDesktop(this.piskelController.getPiskel(),!0)},e.StorageService.prototype.onSaveSuccess_=function(){$.publish(Events.SHOW_NOTIFICATION,[{content:"Successfully saved !",hideDelay:3e3}]),$.publish(Events.PISKEL_SAVED),this.afterSaving_()},e.StorageService.prototype.onSaveError_=function(e){var t="Saving failed";return e&&(t+=" : "+e),$.publish(Events.SHOW_NOTIFICATION,[{content:t,hideDelay:1e4}]),this.afterSaving_(),Q.reject(e)},e.StorageService.prototype.afterSaving_=function(){$.publish(Events.AFTER_SAVING_PISKEL)},e.StorageService.prototype.setSavingFlag_=function(e){this.savingFlag_=e}}(),!function(){var e=$.namespace("pskl.service.storage");e.FileDownloadStorageService=function(){},e.FileDownloadStorageService.prototype.init=function(){},e.FileDownloadStorageService.prototype.save=function(i){var e=pskl.utils.serialization.Serializer.serialize(i),r=Q.defer();return pskl.utils.BlobUtils.stringToBlob(e,function(e){var t=i.getDescriptor().name+".piskel";try{pskl.utils.FileUtils.downloadAsFile(e,t),r.resolve()}catch(e){r.reject(e.message)}}.bind(this),"application/piskel+json"),r.promise}}(),!function(){var e=$.namespace("pskl.service.storage");e.IndexedDbStorageService=function(e){this.piskelController=e,this.piskelDatabase=new pskl.database.PiskelDatabase},e.IndexedDbStorageService.prototype.init=function(){this.piskelDatabase.init().catch(function(e){console.log("Failed to initialize PiskelDatabase, local browser saves will be unavailable.")})},e.IndexedDbStorageService.prototype.save=function(e){var t=e.getDescriptor().name,i=e.getDescriptor().description,r=Date.now(),e=pskl.utils.serialization.Serializer.serialize(e);return this.save_(t,i,r,e)},e.IndexedDbStorageService.prototype.save_=function(t,i,r,n){return this.piskelDatabase.get(t).then(function(e){return void 0!==e?this.piskelDatabase.update(t,i,r,n):this.piskelDatabase.create(t,i,r,n)}.bind(this))},e.IndexedDbStorageService.prototype.load=function(t){return this.piskelDatabase.get(t).then(function(e){void 0!==e?(e=e.serialized,pskl.utils.serialization.Deserializer.deserialize(JSON.parse(e),function(e){pskl.app.piskelController.setPiskel(e)})):console.log("no local browser save found for name: "+t)})},e.IndexedDbStorageService.prototype.remove=function(e){return this.piskelDatabase.delete(e)},e.IndexedDbStorageService.prototype.getKeys=function(){return this.piskelDatabase.list()}}(),!function(){var e=$.namespace("pskl.service.storage");e.LocalStorageService=function(e){if(void 0===e)throw"Bad LocalStorageService initialization: <undefined piskelController>";this.piskelController=e},e.LocalStorageService.prototype.init=function(){},e.LocalStorageService.prototype.save=function(e){var t=e.getDescriptor().name,i=e.getDescriptor().description,e=pskl.utils.serialization.Serializer.serialize(e);if(pskl.app.localStorageService.getPiskel(t)&&!window.confirm("There is already a piskel saved as "+t+". Overwrite ?"))return Q.reject('Cancelled by user, "'+t+'" already exists');try{return this.removeFromKeys_(t),this.addToKeys_(t,i,Date.now()),window.localStorage.setItem("piskel."+t,e),Q.resolve()}catch(e){return Q.reject(e.message)}},e.LocalStorageService.prototype.load=function(e){var t=this.getPiskel(e);this.getKey_(e);pskl.utils.serialization.Deserializer.deserialize(JSON.parse(t),function(e){pskl.app.piskelController.setPiskel(e)})},e.LocalStorageService.prototype.remove=function(e){this.removeFromKeys_(e),window.localStorage.removeItem("piskel."+e)},e.LocalStorageService.prototype.saveKeys_=function(e){window.localStorage.setItem("piskel.keys",JSON.stringify(e))},e.LocalStorageService.prototype.removeFromKeys_=function(t){var e=this.getKeys().filter(function(e){return e.name!==t});this.saveKeys_(e)},e.LocalStorageService.prototype.getKey_=function(t){var e=this.getKeys().filter(function(e){return e.name===t});return 0<e.length?e[0]:null},e.LocalStorageService.prototype.addToKeys_=function(e,t,i){var r=this.getKeys();r.push({name:e,description:t,date:i}),this.saveKeys_(r)},e.LocalStorageService.prototype.getPiskel=function(e){return window.localStorage.getItem("piskel."+e)},e.LocalStorageService.prototype.getKeys=function(e){var t=window.localStorage.getItem("piskel.keys");return JSON.parse(t)||[]}}(),!function(){var e=$.namespace("pskl.service.storage");e.GalleryStorageService=function(e){this.piskelController=e},e.GalleryStorageService.prototype.init=function(){},e.GalleryStorageService.prototype.save=function(e){var t=e.getDescriptor(),i=Q.defer(),e=pskl.utils.serialization.Serializer.serialize(e),r={framesheet:e,fps:this.piskelController.getFPS(),name:t.name,description:t.description,frames:this.piskelController.getFrameCount(),first_frame_as_png:pskl.app.getFirstFrameAsPng(),framesheet_as_png:pskl.app.getFramesheetAsPng()};e.length>Constants.APPENGINE_SAVE_LIMIT&&i.reject("This sprite is too big to be saved on the gallery. Try saving it as a .piskel file."),t.isPublic&&(r.public=!0);return pskl.utils.Xhr.post(Constants.APPENGINE_SAVE_URL,r,function(e){i.resolve()},function(e){i.reject(this.getErrorMessage_(e))}.bind(this)),i.promise},e.GalleryStorageService.prototype.getErrorMessage_=function(e){return 401===e.status?"Session expired, please log in again.":403===e.status?"Unauthorized action, this sprite belongs to another account.":500===e.status?"Unexpected server error, please contact us on Github (piskel) or Twitter (@piskelapp)":"Unknown error"}}(),!function(){var e=$.namespace("pskl.service.storage"),t=".piskel";e.DesktopStorageService=function(e){this.piskelController=e||pskl.app.piskelController,this.hideNotificationTimeoutID=0},e.DesktopStorageService.prototype.init=function(){},e.DesktopStorageService.prototype.save=function(e,t){return console.log(e),console.log(t),e.savePath&&!t?this.saveAtPath_(e,e.savePath):(t=e.getDescriptor().name,pskl.utils.FileUtilsDesktop.chooseFilenameDialogSave(t).then(this.saveAtPath_.bind(this,e)))},e.DesktopStorageService.prototype.saveAtPath_=function(e,t){var i;return t?(i=pskl.utils.serialization.Serializer.serialize(e),t=this.addExtensionIfNeeded_(t),e.savePath=t,e.setName(this.extractFilename_(t)),pskl.utils.FileUtilsDesktop.saveToFile(i,t)):Q.reject("Invalid file name")},e.DesktopStorageService.prototype.openPiskel=function(){return pskl.utils.FileUtilsDesktop.chooseFilenameDialogOpen().then(this.load)},e.DesktopStorageService.prototype.load=function(t){pskl.utils.FileUtilsDesktop.readFile(t).then(function(e){pskl.utils.PiskelFileUtils.decodePiskelFile(e,function(e){e.savePath=t,pskl.app.piskelController.setPiskel(e)})})},e.DesktopStorageService.prototype.addExtensionIfNeeded_=function(e){return e.substr(-t.length)===t?e:e+t},e.DesktopStorageService.prototype.extractFilename_=function(e){e=/[\/\\]([^\/\\]*)\.piskel$/gi.exec(e);if(e&&e[1])return e[1]}}(),!function(){var e=$.namespace("pskl.service");e.BackupService=function(e,t){this.piskelController=e,this.lastHash=this.piskelController.getPiskel().getHash(),this.nextSnapshotDate=-1,this.backupDatabase=t||new pskl.database.BackupDatabase},e.BackupService.prototype.init=function(){this.backupDatabase.init().then(function(){window.setInterval(this.backup.bind(this),6e4)}.bind(this))},e.BackupService.prototype.currentDate_=function(){return Date.now()},e.BackupService.prototype.backup=function(){var e=this.piskelController.getPiskel(),t=e.getHash();if(t===this.lastHash)return Q.resolve();this.lastHash=t;var t=e.getDescriptor(),i=this.currentDate_(),r={session_id:pskl.app.sessionId,date:i,name:t.name,description:t.description,frames:e.getFrameCount(),width:e.getWidth(),height:e.getHeight(),fps:e.getFPS(),serialized:pskl.utils.serialization.Serializer.serialize(e)};return this.getSnapshotsBySessionId(pskl.app.sessionId).then(function(e){var t=e[0];return t&&i<this.nextSnapshotDate?(r.id=t.id,this.backupDatabase.updateSnapshot(r)):(this.nextSnapshotDate=i+3e5,this.backupDatabase.createSnapshot(r).then(function(){if(12<=e.length)return this.backupDatabase.deleteSnapshot(e[e.length-1])}.bind(this)).then(function(){if(!t)return this.backupDatabase.getSessions().then(function(e){if(!(e.length<=10))return e=e.sort(function(e,t){return e.startDate-t.startDate}).map(function(e){return e.id}).slice(0,e.length-10),Q.all(e.map(function(e){return this.deleteSession(e)}.bind(this)))}.bind(this))}.bind(this)))}.bind(this)).catch(function(e){console.error(e)})},e.BackupService.prototype.getSnapshotsBySessionId=function(e){return this.backupDatabase.getSnapshotsBySessionId(e)},e.BackupService.prototype.deleteSession=function(e){return this.backupDatabase.deleteSnapshotsForSession(e)},e.BackupService.prototype.getPreviousPiskelInfo=function(){return this.backupDatabase.findLastSnapshot(function(e){return e.session_id!==pskl.app.sessionId})},e.BackupService.prototype.list=function(){return this.backupDatabase.getSessions()},e.BackupService.prototype.loadSnapshotById=function(e){var t=Q.defer();return this.backupDatabase.getSnapshot(e).then(function(e){pskl.utils.serialization.Deserializer.deserialize(JSON.parse(e.serialized),function(e){pskl.app.piskelController.setPiskel(e),t.resolve()})}),t.promise},e.BackupService.prototype.load=function(){var t=Q.defer();return this.getPreviousPiskelInfo().then(function(e){pskl.utils.serialization.Deserializer.deserialize(JSON.parse(e.serialized),function(e){pskl.app.piskelController.setPiskel(e),t.resolve()})}),t.promise}}(),!function(){var e=$.namespace("pskl.service");e.BeforeUnloadService=function(e){this.piskelController=e},e.BeforeUnloadService.prototype.init=function(){pskl.utils.Environment.detectNative()&&Neutralino.events.on("windowClose",this.onNativeWindowClose.bind(this)),window.addEventListener("beforeunload",this.onBeforeUnload.bind(this))},e.BeforeUnloadService.prototype.onNativeWindowClose=function(){var e=this.onBeforeUnload();if(console.log(e),e&&!window.confirm(e))return console.log("return false"),!1;console.log("exit"),Neutralino.app.exit()},e.BeforeUnloadService.prototype.onBeforeUnload=function(e){var t;if(pskl.app.backupService.backup(),pskl.app.savedStatusService.isDirtyAny())return t="Your current sprite has unsaved changes. Are you sure you want to quit?",(e=e||window.event)&&(e.returnValue=t),t}}(),!function(){var n=$.namespace("pskl.service");n.HistoryService=function(e,t,i,r){this.piskelController=e.getWrappedPiskelController(),this.shortcutService=t||pskl.app.shortcutService,this.deserializer=i||pskl.utils.serialization.arraybuffer.ArrayBufferDeserializer,this.serializer=r||pskl.utils.serialization.arraybuffer.ArrayBufferSerializer,this.states=[]},n.HistoryService.SNAPSHOT="SNAPSHOT",n.HistoryService.REPLAY="REPLAY",n.HistoryService.SNAPSHOT_PERIOD=50,n.HistoryService.LOAD_STATE_INTERVAL=50,n.HistoryService.MAX_SAVED_STATES=500,n.HistoryService.prototype.init=function(){$.subscribe(Events.PISKEL_SAVE_STATE,this.onSaveStateEvent.bind(this)),$.subscribe(Events.PISKEL_ADDED,this._piskelAdded.bind(this)),$.subscribe(Events.PISKEL_REMOVED,this._piskelRemoved.bind(this));this.piskelController.getPiskelIds().forEach(e=>{this.addPiskel(e)});var e=pskl.service.keyboard.Shortcuts;this.shortcutService.registerShortcut(e.MISC.UNDO,this.undo.bind(this)),this.shortcutService.registerShortcut(e.MISC.REDO,this.redo.bind(this)),this.saveState({type:n.HistoryService.SNAPSHOT})},n.HistoryService.prototype.clearHistory=function(){this.states=[]},n.HistoryService.prototype.onSaveStateEvent=function(e,t){this.saveState(t)},n.HistoryService.prototype.saveState=function(e){var t=this.getState(),i=(t.stateQueue=t.stateQueue.slice(0,t.currentIndex+1),t.currentIndex=t.currentIndex+1,{action:e,frameIndex:e.state?e.state.frameIndex:this.piskelController.currentFrameIndex,layerIndex:e.state?e.state.layerIndex:this.piskelController.currentLayerIndex,fps:this.piskelController.getFPS(),uuid:pskl.utils.Uuid.generate()}),e=e.type===n.HistoryService.SNAPSHOT,r=t.currentIndex%n.HistoryService.SNAPSHOT_PERIOD==0;(e||r)&&(e=this.piskelController.getPiskel(),i.piskel=this.serializer.serialize(e)),t.stateQueue.length>n.HistoryService.MAX_SAVED_STATES&&(r=this.getNextSnapshotIndex_(1),t.stateQueue.splice(0,r),t.currentIndex=t.currentIndex-r),t.stateQueue.push(i),this.setState(t),$.publish(Events.HISTORY_STATE_SAVED)},n.HistoryService.prototype.getCurrentStateId=function(e=null){null==e&&(e=this.piskelController.getSelectedPiskel());e=this._getState(e),e=e.stateQueue[e.currentIndex];return!!e&&e.uuid},n.HistoryService.prototype.undo=function(){var e=this.getState();this.loadState(e.currentIndex-1)},n.HistoryService.prototype.redo=function(){var e=this.getState();this.loadState(e.currentIndex+1)},n.HistoryService.prototype.isLoadStateAllowed_=function(e){var t=this.getState(),i=Date.now()-t.lastLoadState>n.HistoryService.LOAD_STATE_INTERVAL,e=0<=e&&e<t.stateQueue.length;return i&&e},n.HistoryService.prototype.getPreviousSnapshotIndex_=function(e){for(var t=this.getState();t.stateQueue[e]&&!t.stateQueue[e].piskel;)e-=1;return e},n.HistoryService.prototype.getNextSnapshotIndex_=function(e){for(var t=this.getState();t.stateQueue[e]&&!t.stateQueue[e].piskel;)e+=1;return e},n.HistoryService.prototype.loadState=function(e){var t=this.getState();try{if(this.isLoadStateAllowed_(e)){t.lastLoadState=Date.now();var i=this.getPreviousSnapshotIndex_(e);if(i<0)throw"Could not find previous SNAPSHOT saved in history stateQueue";var r=this.getSnapshotFromState_(i),n=this.onPiskelLoaded_.bind(this,e,i);this.deserializer.deserialize(r,n)}}catch(e){console.error("[CRITICAL ERROR] : Unable to load a history state."),this.logError_(e),t.stateQueue=[],t.currentIndex=-1,this.setState(t)}$.publish(Events.FORCE_REFRESH,null)},n.HistoryService.prototype.logError_=function(e){"string"==typeof e?console.error(e):(console.error(e.message),console.error(e.stack))},n.HistoryService.prototype.getSnapshotFromState_=function(e){var e=this.getState().stateQueue[e],t=e.piskel;return e.piskel=t},n.HistoryService.prototype.onPiskelLoaded_=function(e,t,i){var r=this.getState(),n=this.piskelController.getPiskel(),o=this.getPiskelSize_();i.setDescriptor(n.getDescriptor()),i.savePath=n.savePath,this.piskelController.setPiskel(i);for(var s=t+1;s<=e;s++){var a=r.stateQueue[s];this.setupState(a),this.replayState(a)}n=r.stateQueue[e+1];n&&this.setupState(n),r.currentIndex=e,this.setState(r),$.publish(Events.PISKEL_RESET),$.publish(Events.HISTORY_STATE_LOADED),o!==this.getPiskelSize_()&&$.publish(Events.FRAME_SIZE_CHANGED)},n.HistoryService.prototype.getPiskelSize_=function(){return this.piskelController.getWidth()+"x"+this.piskelController.getHeight()},n.HistoryService.prototype.setupState=function(e){this.piskelController.setCurrentFrameIndex(e.frameIndex),this.piskelController.setCurrentLayerIndex(e.layerIndex),this.piskelController.setFPS(e.fps)},n.HistoryService.prototype.replayState=function(e){var t=e.action,e=(t.type,this.piskelController.getLayerAt(e.layerIndex).getFrameAt(e.frameIndex));t.scope.replay(e,t.replay)},n.HistoryService.prototype.getState=function(){return this._getState(this.piskelController.getSelectedPiskel())},n.HistoryService.prototype.setState=function(t){var e=this.states.findIndex(e=>e.index==t.index);0<=e&&(this.states[e]=t)},n.HistoryService.prototype.addPiskel=function(e){this.states.push({stateQueue:[],currentIndex:-1,lastLoadState:-1,index:e})},n.HistoryService.prototype._piskelAdded=function(e,t){this.addPiskel(t)},n.HistoryService.prototype._piskelRemoved=function(t){var e=this.states.findIndex(e=>e.index==t);if(0<=e)return this.states.remove(this.states[e])},n.HistoryService.prototype._getState=function(t){var e=this.states.findIndex(e=>e.index==t);if(0<=e)return this.states[e]}}(),!function(){for(var e=$.namespace("pskl.service.color"),s=[],t=0;t<10;t++)s.push(36*t);e.ColorSorter=function(){this.colorsHslMap_={}},e.ColorSorter.prototype.sort=function(e){this.colorsHslMap_={},e.forEach(function(e){this.colorsHslMap_[e]=window.tinycolor(e).toHsl()}.bind(this));var t=e.filter(function(e){return this.colorsHslMap_[e].l<=.1}.bind(this)),i=e.filter(function(e){return.9<=this.colorsHslMap_[e].l}.bind(this)),r=e.filter(function(e){return-1===i.indexOf(e)&&-1===t.indexOf(e)}).filter(function(e){return this.colorsHslMap_[e].s<=.1}.bind(this)),t=this.sortOnHslProperty_(t,"l"),i=this.sortOnHslProperty_(i,"l"),r=this.sortOnHslProperty_(r,"h"),n=t.concat(i,r),o=e.filter(function(e){return-1===n.indexOf(e)}),r=s.map(function(t){var e=o.filter(function(e){e=this.colorsHslMap_[e];return e.h>=t&&e.h<t+36}.bind(this));return this.sortRegularColors_(e)}.bind(this));return Array.prototype.concat.apply(n,r)},e.ColorSorter.prototype.sortRegularColors_=function(e){return e.sort(function(e,t){var e=this.colorsHslMap_[e],t=this.colorsHslMap_[t],i=Math.abs(e.h-t.h),r=Math.abs(e.s-t.s),n=Math.abs(e.l-t.l);return i<10?n<r?this.compareValues_(e.s,t.s):this.compareValues_(e.l,t.l):this.compareValues_(e.h,t.h)}.bind(this))},e.ColorSorter.prototype.sortOnHslProperty_=function(e,i){return e.sort(function(e,t){e=this.colorsHslMap_[e],t=this.colorsHslMap_[t];return this.compareValues_(e[i],t[i])}.bind(this))},e.ColorSorter.prototype.compareValues_=function(e,t){return t<e?1:e<t?-1:0}}(),!function(){var e=$.namespace("pskl.service.palette");e.CurrentColorsPalette=function(){this.name="Current colors",this.id=Constants.CURRENT_COLORS_PALETTE_ID,this.colorSorter=new pskl.service.color.ColorSorter},e.CurrentColorsPalette.prototype.getColors=function(){var e=(e=pskl.app.currentColorsService.getCurrentColors()).slice(0,Constants.MAX_PALETTE_COLORS);return this.colorSorter.sort(e)}}(),!function(){var e=$.namespace("pskl.service.palette");e.PaletteService=function(){this.dynamicPalettes=[],this.localStorageGlobal=window.localStorage},e.PaletteService.prototype.getPalettes=function(){var e=this.localStorageGlobal.getItem("piskel.palettes"),e=(e=JSON.parse(e)||[]).map(function(e){return pskl.model.Palette.fromObject(e)});return this.dynamicPalettes.concat(e)},e.PaletteService.prototype.getPaletteById=function(e){var t=this.getPalettes();return this.findPaletteInArray_(e,t)},e.PaletteService.prototype.savePalette=function(e){var t=this.getPalettes(),i=this.findPaletteInArray_(e.id,t);i?(i=t.indexOf(i),t.splice(i,1,e)):t.push(e),this.savePalettes_(t),$.publish(Events.SHOW_NOTIFICATION,[{content:"Palette "+e.name+" successfully saved !"}]),window.setTimeout($.publish.bind($,Events.HIDE_NOTIFICATION),2e3)},e.PaletteService.prototype.addDynamicPalette=function(e){this.dynamicPalettes.push(e)},e.PaletteService.prototype.deletePaletteById=function(t){var e=this.getPalettes().filter(function(e){return e.id!==t});this.savePalettes_(e)},e.PaletteService.prototype.savePalettes_=function(e){e=e.filter(function(e){return-1===this.dynamicPalettes.indexOf(e)}.bind(this)),this.localStorageGlobal.setItem("piskel.palettes",JSON.stringify(e)),$.publish(Events.PALETTE_LIST_UPDATED)},e.PaletteService.prototype.findPaletteInArray_=function(t,e){var i=null;return e.forEach(function(e){e.id===t&&(i=e)}),i}}(),!function(){var e=$.namespace("pskl.service.palette");e.PaletteGplWriter=function(e){this.palette=e},e.PaletteGplWriter.prototype.write=function(){var t=[];return t.push("GIMP Palette"),t.push("Name: "+this.palette.name),t.push("Columns: 0"),t.push("#"),this.palette.getColors().forEach(function(e){t.push(this.writeColorLine(e))}.bind(this)),t.push("\r\n"),t.join("\r\n")},e.PaletteGplWriter.prototype.writeColorLine=function(e){var e=window.tinycolor(e).toRgb(),t=[];return t.push(this.padString(e.r,3)),t.push(this.padString(e.g,3)),t.push(this.padString(e.b,3)),t.push("Untitled"),t.join(" ")},e.PaletteGplWriter.prototype.padString=function(e,t){return e=e.toString(),new Array(1+t-e.length).join(" ")+e}}(),!function(){var e=$.namespace("pskl.service.palette.reader");e.AbstractPaletteFileReader=function(e,t,i,r){this.file=e,this.onSuccess=t,this.onError=i,this.colorLineRegexp=r},e.AbstractPaletteFileReader.prototype.extractColorFromLine=Constants.ABSTRACT_FUNCTION,e.AbstractPaletteFileReader.prototype.read=function(){pskl.utils.FileUtils.readFile(this.file,this.onFileLoaded_.bind(this))},e.AbstractPaletteFileReader.prototype.onFileLoaded_=function(e){var t,e=pskl.utils.Base64.toText(e).match(/[^\r\n]+/g).filter(function(e){return this.colorLineRegexp.test(e)}.bind(this)).map(this.extractColorFromLine.bind(this));e.length?(t=pskl.utils.Uuid.generate(),t=new pskl.model.Palette(t,this.file.name,e),this.onSuccess(t)):this.onError()}}(),!function(){var e=$.namespace("pskl.service.palette.reader"),r=/^(\s*\d{1,3})(\s*\d{1,3})(\s*\d{1,3})/;e.PaletteGplReader=function(e,t,i){this.superclass.constructor.call(this,e,t,i,r)},pskl.utils.inherit(e.PaletteGplReader,e.AbstractPaletteFileReader),e.PaletteGplReader.prototype.extractColorFromLine=function(e){e=e.match(r);return window.tinycolor({r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10)}).toHexString()}}(),!function(){var e=$.namespace("pskl.service.palette.reader");e.PaletteImageReader=function(e,t,i){this.file=e,this.onSuccess=t,this.onError=i,this.colorSorter_=new pskl.service.color.ColorSorter},e.PaletteImageReader.prototype.read=function(){pskl.utils.FileUtils.readImageFile(this.file,this.onImageLoaded_.bind(this))},e.PaletteImageReader.prototype.onImageLoaded_=function(e){e=new pskl.worker.imageprocessor.ImageProcessor(e,this.onWorkerSuccess_.bind(this),this.onWorkerStep_.bind(this),this.onWorkerError_.bind(this));$.publish(Events.SHOW_PROGRESS,[{name:"Processing image colors ..."}]),e.process()},e.PaletteImageReader.prototype.onWorkerSuccess_=function(e){var t,e=e.data.colorsMap,e=Object.keys(e);e.length>Constants.MAX_PALETTE_COLORS?this.onError("Too many colors : "+e.length):(t=pskl.utils.Uuid.generate(),e=this.colorSorter_.sort(e),t=new pskl.model.Palette(t,this.file.name+" palette",e),this.onSuccess(t)),$.publish(Events.HIDE_PROGRESS)},e.PaletteImageReader.prototype.onWorkerStep_=function(e){e=e.data.progress;$.publish(Events.UPDATE_PROGRESS,[{progress:e}])},e.PaletteImageReader.prototype.onWorkerError_=function(e){$.publish(Events.HIDE_PROGRESS),this.onError("Unable to process the image : "+e.data.message)}}(),!function(){var e=$.namespace("pskl.service.palette.reader"),r=/^(\d{1,3})\s+(\d{1,3})\s+(\d{1,3})/;e.PalettePalReader=function(e,t,i){this.superclass.constructor.call(this,e,t,i,r)},pskl.utils.inherit(e.PalettePalReader,e.AbstractPaletteFileReader),e.PalettePalReader.prototype.extractColorFromLine=function(e){e=e.match(r),e="rgb("+e[1]+","+e[2]+","+e[3]+")";return window.tinycolor(e).toHexString()}}(),!function(){var e=$.namespace("pskl.service.palette.reader"),r=/^[A-F0-9]{2}([A-F0-9]{2})([A-F0-9]{2})([A-F0-9]{2})/;e.PaletteTxtReader=function(e,t,i){this.superclass.constructor.call(this,e,t,i,r)},pskl.utils.inherit(e.PaletteTxtReader,e.AbstractPaletteFileReader),e.PaletteTxtReader.prototype.extractColorFromLine=function(e){e=e.match(r);return("#"+e[1]+e[2]+e[3]).toLowerCase()}}(),!function(){var e=$.namespace("pskl.service.palette"),t={gpl:e.reader.PaletteGplReader,pal:e.reader.PalettePalReader,txt:e.reader.PaletteTxtReader,img:e.reader.PaletteImageReader};e.PaletteImportService=function(){},e.PaletteImportService.prototype.init=function(){},e.PaletteImportService.prototype.read=function(e,t,i){t=this.getReader_(e,t,i);t?t.read():console.error("Could not find reader for file : %s",e.name)},e.PaletteImportService.prototype.isImage_=function(e){return 0===e.type.indexOf("image")},e.PaletteImportService.prototype.getReader_=function(e,t,i){var r=this.getReaderClass_(e);return r?new r(e,t,i):null},e.PaletteImportService.prototype.getReaderClass_=function(e){return this.isImage_(e)?t.img:(e=this.getExtension_(e),t[e])},e.PaletteImportService.prototype.getExtension_=function(e){e=e.name.split(".");return e[e.length-1].toLowerCase()}}(),!function(){var e=$.namespace("pskl.service.pensize");e.PenSizeService=function(){this.size=1},e.PenSizeService.prototype.init=function(){this.size=pskl.UserSettings.get(pskl.UserSettings.PEN_SIZE);var e=pskl.service.keyboard.Shortcuts;pskl.app.shortcutService.registerShortcut(e.MISC.INCREASE_PENSIZE,this.increasePenSize_.bind(this)),pskl.app.shortcutService.registerShortcut(e.MISC.DECREASE_PENSIZE,this.decreasePenSize_.bind(this))},e.PenSizeService.prototype.increasePenSize_=function(){this.setPenSize(this.size+1)},e.PenSizeService.prototype.decreasePenSize_=function(){this.setPenSize(this.size-1)},e.PenSizeService.prototype.getPenSize=function(){return this.size},e.PenSizeService.prototype.setPenSize=function(e){this.isPenSizeValid_(e)&&e!=this.size&&(this.size=e,pskl.UserSettings.set(pskl.UserSettings.PEN_SIZE,e),$.publish(Events.PEN_SIZE_CHANGED))},e.PenSizeService.prototype.isPenSizeValid_=function(e){return!isNaN(e)&&1<=e&&e<=32}}(),!function(){var e=$.namespace("pskl.service");e.SavedStatusService=function(e,t){this.piskelController=e,this.historyService=t,this.publishStatusUpdateEvent_=this.publishStatusUpdateEvent_.bind(this),this.stateIndexes=[]},e.SavedStatusService.prototype.init=function(){$.subscribe(Events.TOOL_RELEASED,this.publishStatusUpdateEvent_),$.subscribe(Events.PISKEL_RESET,this.publishStatusUpdateEvent_),$.subscribe(Events.PISKEL_SAVED,this.onPiskelSaved.bind(this)),$.subscribe(Events.PISKEL_ADDED,this._piskelAdded.bind(this)),$.subscribe(Events.PISKEL_REMOVED,this._piskelRemoved.bind(this)),this.piskelController.getPiskelIds().forEach(e=>{this._piskelAdded(null,e)})},e.SavedStatusService.prototype.clearStates=function(){this.stateIndexes=[]},e.SavedStatusService.prototype.onPiskelSaved=function(){var e=this.getState();e.stateIndex=this.historyService.getCurrentStateId(),this.setState(e),this.publishStatusUpdateEvent_()},e.SavedStatusService.prototype.publishStatusUpdateEvent_=function(){$.publish(Events.PISKEL_SAVED_STATUS_UPDATE)},e.SavedStatusService.prototype.isDirty=function(e=null){return null==e&&(e=this.piskelController.getSelectedPiskel()),this._getState(e).stateIndex!=this.historyService.getCurrentStateId(e)},e.SavedStatusService.prototype.isDirtyAny=function(){var e=this.piskelController.getPiskelIds();let t=!1;return e.forEach(e=>{this.isDirty(e)&&(t=!0)}),t},e.SavedStatusService.prototype.getState=function(){return this._getState(this.piskelController.getSelectedPiskel())},e.SavedStatusService.prototype.setState=function(t){var e=this.stateIndexes.findIndex(e=>e.index==t.index);0<=e&&(this.stateIndexes[e]=t)},e.SavedStatusService.prototype._piskelAdded=function(e,t){this.stateIndexes.push({stateIndex:this.historyService.getCurrentStateId(),index:t})},e.SavedStatusService.prototype._piskelRemoved=function(e,t){var i=this.stateIndexes.findIndex(e=>e.index==t);0<=i&&this.stateIndexes.splice(i,1)},e.SavedStatusService.prototype._getState=function(t){var e=this.stateIndexes.findIndex(e=>e.index==t);if(0<=e)return this.stateIndexes[e]}}(),!function(){var t={8:"back",13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down",46:"del",189:"-",109:"-",173:"-",187:"+",107:"+",61:"+",188:"<",190:">",191:"?",219:"[",221:"]"};$.namespace("pskl.service.keyboard").KeycodeTranslator={toChar:function(e){return 48<=e&&e<=57?e-48+"":96<=e&&e<=105?e-96+"":65<=e&&e<=90?(e-65+10).toString(36):t[e]}}}(),!function(){var i=$.namespace("pskl.service.keyboard");i.KeyUtils={createKeyFromString:function(e){var t={alt:-1!=(e=e.toLowerCase()).indexOf("alt+"),shift:-1!=e.indexOf("shift+"),ctrl:-1!=e.indexOf("ctrl+")},e=e.split(/\+(?!$)/);return{key:e[e.length-1].toUpperCase(),modifiers:t}},createKeyFromEvent:function(e){var t=e.which,t=i.KeycodeTranslator.toChar(t);return t?{key:t.toUpperCase(),modifiers:{alt:e.altKey,shift:e.shiftKey,ctrl:i.KeyUtils.isCtrlKeyPressed_(e)}}:null},equals:function(e,t){return e="string"==typeof e?i.KeyUtils.createKeyFromString(e):e,t="string"==typeof t?i.KeyUtils.createKeyFromString(t):t,e.key===t.key&&e.modifiers.alt===t.modifiers.alt&&e.modifiers.shift===t.modifiers.shift&&e.modifiers.ctrl===t.modifiers.ctrl},stringify:function(e){var t=i.KeyUtils.getModifiersString(e.modifiers);return t?t+"+"+e.key:e.key},getModifiersString:function(e){var t=[];return e.alt&&t.push("alt"),e.ctrl&&t.push("ctrl"),e.shift&&t.push("shift"),t.join("+")},isCtrlKeyPressed_:function(e){return pskl.utils.UserAgent.isMac?e.metaKey:e.ctrlKey}}}(),!function(){var r=$.namespace("pskl.service.keyboard");r.Shortcut=function(e,t,i,r){this.id_=e,this.description_=t,this.defaultKeys_=i="string"==typeof i?[i]:i,this.displayKey_=r},r.Shortcut.USER_SETTINGS_PREFIX="shortcut.",r.Shortcut.prototype.getId=function(){return this.id_},r.Shortcut.prototype.getDescription=function(){return this.description_},r.Shortcut.prototype.getKeys=function(){var e=pskl.UserSettings.get(this.getLocalStorageKey_())||this.defaultKeys_;return"string"==typeof e?[e]:Array.isArray(e)?e:[]},r.Shortcut.prototype.isEditable=function(){return 0===this.getKeys().length||1===this.getKeys().length&&-1===r.Shortcuts.FORBIDDEN_KEYS.indexOf(this.getKeys()[0])},r.Shortcut.prototype.isCustom=function(){var e=this.getKeys();return e.length!==this.defaultKeys_.length||this.defaultKeys_.some(function(t){return!e.some(function(e){return r.KeyUtils.equals(e,t)})})},r.Shortcut.prototype.isUndefined=function(){return 0===this.getKeys().length},r.Shortcut.prototype.getDisplayKey=function(){return this.isUndefined()?"???":this.displayKey_||this.getKeys()[0]},r.Shortcut.prototype.restoreDefault=function(e){pskl.UserSettings.set(this.getLocalStorageKey_(),"")},r.Shortcut.prototype.updateKeys=function(e){pskl.UserSettings.set(this.getLocalStorageKey_(),e)},r.Shortcut.prototype.removeKeys=function(e){var t,i;if(this.isEditable())return(i=(t=this.getKeys()).filter(function(t){return!e.some(function(e){return r.KeyUtils.equals(t,e)})})).length!==t.length&&(this.updateKeys(i),!0)},r.Shortcut.prototype.getLocalStorageKey_=function(){return r.Shortcut.USER_SETTINGS_PREFIX+this.id_}}(),!function(){function e(e,t,i,r){return new n.Shortcut(e,t,i,r)}var n=$.namespace("pskl.service.keyboard");n.Shortcuts={FORBIDDEN_KEYS:["1","2","3","4","5","6","7","8","9","?","shift+?","DEL","BACK","ENTER","ctrl+Y","ctrl+shift+Z"],TOOL:{PEN:e("tool-pen","Pen tool","P"),MIRROR_PEN:e("tool-vertical-mirror-pen","Vertical mirror pen tool","V"),PAINT_BUCKET:e("tool-paint-bucket","Paint bucket tool","B"),COLORSWAP:e("tool-colorswap","Magic bucket tool","A"),ERASER:e("tool-eraser","Eraser pen tool","E"),STROKE:e("tool-stroke","Stroke tool","L"),RECTANGLE:e("tool-rectangle","Rectangle tool","R"),CIRCLE:e("tool-circle","Circle tool","C"),MOVE:e("tool-move","Move tool","M"),SHAPE_SELECT:e("tool-shape-select","Shape selection","Z"),RECTANGLE_SELECT:e("tool-rectangle-select","Rectangle selection","S"),LASSO_SELECT:e("tool-lasso-select","Lasso selection","H"),LIGHTEN:e("tool-lighten","Lighten tool","U"),DITHERING:e("tool-dithering","Dithering tool","T"),NOISE_TOOL:e("tool-noise","Pixelart noise tool","Q"),NOISE_Fill_TOOL:e("tool-noise-fill","Pixelart noise fill tool","Q"),COLORPICKER:e("tool-colorpicker","Color picker","O")},SELECTION:{CUT:e("selection-cut","Cut selection","ctrl+X"),COPY:e("selection-copy","Copy selection","ctrl+C"),PASTE:e("selection-paste","Paste selection","ctrl+V"),DELETE:e("selection-delete","Delete selection",["DEL","BACK"]),COMMIT:e("selection-commit","Commit selection",["ENTER"])},MISC:{RESET_ZOOM:e("reset-zoom","Reset zoom level","0"),INCREASE_ZOOM:e("increase-zoom","Increase zoom level","+"),DECREASE_ZOOM:e("decrease-zoom","Decrease zoom level","-"),INCREASE_PENSIZE:e("increase-pensize","Increase pen size","]"),DECREASE_PENSIZE:e("decrease-pensize","Decrease pen size","["),UNDO:e("undo","Undo","ctrl+Z"),REDO:e("redo","Redo",["ctrl+Y","ctrl+shift+Z"]),PREVIOUS_FRAME:e("previous-frame","Select previous frame","up"),NEXT_FRAME:e("next-frame","Select next frame","down"),NEW_FRAME:e("new-frame","Create new empty frame","N"),DUPLICATE_FRAME:e("duplicate-frame","Duplicate selected frame","shift+N"),X1_PREVIEW:e("x1-preview","Select original size preview","alt+1"),BEST_PREVIEW:e("best-preview","Select best size preview","alt+2"),FULL_PREVIEW:e("full-preview","Select full size preview","alt+3"),ONION_SKIN:e("onion-skin","Toggle onion skin","alt+O"),TOGGLE_GRID:e("toggle-grid","Show/Hide grid","alt+G"),LAYER_PREVIEW:e("layer-preview","Toggle layer preview","alt+L"),MERGE_ANIMATION:e("import-animation","Open merge animation popup","ctrl+shift+M"),CLOSE_POPUP:e("close-popup","Close an opened popup","ESC"),OFFSET_UP:e("move-up","Move viewport up","shift+up"),OFFSET_RIGHT:e("move-right","Move viewport right","shift+right"),OFFSET_DOWN:e("move-down","Move viewport down","shift+down"),OFFSET_LEFT:e("move-left","Move viewport left","shift+left")},STORAGE:{SAVE:e("save","Save the current sprite","ctrl+S"),OPEN:e("open","(desktop) Open a .piskel file","ctrl+O"),SAVE_AS:e("save-as","(desktop) Save as new","ctrl+shift+S")},COLOR:{SWAP:e("swap-colors","Swap primary/secondary colors","X"),RESET:e("reset-colors","Reset default colors","D"),CREATE_PALETTE:e("create-palette","Open the palette creation popup","alt+P"),PREVIOUS_COLOR:e("previous-color","Select the previous color in the current palette","<"),NEXT_COLOR:e("next-color","Select the next color in the current palette",">"),SELECT_COLOR:e("select-color","Select a palette color in the current palette","123456789".split(""),"1 to 9")},DEBUG:{RELOAD_STYLES:e("move-left","Move viewport left","ctrl+alt+R")},CATEGORIES:["TOOL","SELECTION","MISC","STORAGE","COLOR"]}}(),!function(){var n=$.namespace("pskl.service.keyboard");n.ShortcutService=function(){this.shortcuts_=[]},n.ShortcutService.prototype.init=function(){document.body.addEventListener("keydown",this.onKeyDown_.bind(this))},n.ShortcutService.prototype.registerShortcut=function(e,t){if(e instanceof n.Shortcut){if("function"!=typeof t)throw"Invalid callback argument, please provide a function";this.shortcuts_.push({shortcut:e,callback:t})}},n.ShortcutService.prototype.unregisterShortcut=function(i){var r=-1;this.shortcuts_.forEach(function(e,t){e.shortcut===i&&(r=t)}),-1!=r&&this.shortcuts_.splice(r,1)},n.ShortcutService.prototype.onKeyDown_=function(i){var r=n.KeyUtils.createKeyFromEvent(i);!this.isInInput_(i)&&r&&this.shortcuts_.forEach(function(t){t.shortcut.getKeys().forEach(function(e){n.KeyUtils.equals(e,r)&&(!0!==t.callback(r.key)&&i.preventDefault(),$.publish(Events.KEYBOARD_EVENT,[i]))}.bind(this))}.bind(this))},n.ShortcutService.prototype.isInInput_=function(e){e=e.target.nodeName.toUpperCase();return"INPUT"===e||"TEXTAREA"===e},n.ShortcutService.prototype.getShortcutById=function(t){return pskl.utils.Array.find(this.getShortcuts(),function(e){return e.getId()===t})},n.ShortcutService.prototype.getShortcuts=function(){var i=[];return n.Shortcuts.CATEGORIES.forEach(function(e){var t=n.Shortcuts[e];Object.keys(t).forEach(function(e){i.push(t[e])})}),i},n.ShortcutService.prototype.updateShortcut=function(e,t){var i=t.replace(/\s/g,"");-1!=n.Shortcuts.FORBIDDEN_KEYS.indexOf(i)?$.publish(Events.SHOW_NOTIFICATION,[{content:"Key cannot be remapped ("+t+")",hideDelay:5e3}]):(this.removeKeyFromAllShortcuts_(i),e.updateKeys([i]),$.publish(Events.SHORTCUTS_CHANGED))},n.ShortcutService.prototype.removeKeyFromAllShortcuts_=function(t){this.getShortcuts().forEach(function(e){e.removeKeys([t])&&$.publish(Events.SHOW_NOTIFICATION,[{content:"Shortcut key removed for "+e.getId(),hideDelay:5e3}])})},n.ShortcutService.prototype.restoreDefaultShortcuts=function(){this.getShortcuts().forEach(function(e){e.restoreDefault()}),$.publish(Events.SHORTCUTS_CHANGED)}}(),!function(){var e=$.namespace("pskl.service");e.ImportService=function(e){this.piskelController_=e},e.ImportService.prototype.init=function(){$.subscribe(Events.PISKEL_FILE_IMPORT_FAILED,this.onPiskelFileImportFailed_)},e.ImportService.prototype.onPiskelFileImportFailed_=function(e,t){$.publish(Events.SHOW_NOTIFICATION,[{content:"Piskel file import failed ("+t+")",hideDelay:1e4}])},e.ImportService.prototype.newPiskelFromImage=function(t,e,i){i=i||Constants.EMPTY_FUNCTION;var r=e.importType,n=e.name,o=e.smoothing,s=e.frameSizeX,a=e.frameSizeY,l=e.frameOffsetX,c=e.frameOffsetY,p=new window.SuperGif({gif:t});p.load({success:function(){var e=p.getFrames().map(function(e){return pskl.utils.CanvasUtils.createFromImageData(e.data)});e="single"===r||1<e.length?this.createPiskelFromImages_(e,n,s,a,o):(e=this.createImagesFromSheet_(e[0],s,a,l,c),this.createPiskelFromImages_(e,n,s,a,o)),i(e)}.bind(this),error:function(){var e;e="single"===r?this.createPiskelFromImages_([t],n,s,a,o):(e=this.createImagesFromSheet_(t,s,a,l,c),this.createPiskelFromImages_(e,n,s,a,o)),i(e)}.bind(this)})},e.ImportService.prototype.createImagesFromSheet_=function(e,t,i,r,n){return pskl.utils.CanvasUtils.createFramesFromImage(e,r,n,t,i,!0,!0)},e.ImportService.prototype.createPiskelFromImages_=function(e,t,i,r,n){t=t||"Imported piskel";e=this.createFramesFromImages_(e,i,r,n),i=pskl.model.Layer.fromFrames("Layer 1",e),r=new pskl.model.piskel.Descriptor(t,"");return pskl.model.Piskel.fromLayers([i],Constants.DEFAULT.FPS,r)},e.ImportService.prototype.createFramesFromImages_=function(e,t,i,r){return e.map(function(e){e=pskl.utils.ImageResizer.resize(e,t,i,r);return pskl.utils.FrameUtils.createFromImage(e)})}}(),!function(){var e=$.namespace("pskl.service");e.ImageUploadService=function(){},e.ImageUploadService.prototype.init=function(){},e.ImageUploadService.prototype.upload=function(e,i,t){var e={data:e},r=pskl.utils.Environment.isHttps()?"https":"http",n=pskl.utils.Template.replace(Constants.IMAGE_SERVICE_UPLOAD_URL,{protocol:r});pskl.utils.Xhr.post(n,e,function(e){var t=pskl.utils.Template.replace(Constants.IMAGE_SERVICE_GET_URL,{protocol:r});i(t+e.responseText)},t)}}(),!function(){var e=$.namespace("pskl.service");e.ClipboardService=function(e){this.piskelController=e},e.ClipboardService.prototype.init=function(){window.addEventListener("copy",this._onCopy.bind(this),!0),window.addEventListener("cut",this._onCut.bind(this),!0),window.addEventListener("paste",this._onPaste.bind(this),!0)},e.ClipboardService.prototype._onCut=function(e){$.publish(Events.CLIPBOARD_CUT,e)},e.ClipboardService.prototype._onCopy=function(e){$.publish(Events.CLIPBOARD_COPY,e)},e.ClipboardService.prototype._onPaste=function(e){$.publish(Events.CLIPBOARD_PASTE,e)}}(),!function(){var e=$.namespace("pskl.service");e.CurrentColorsService=function(e){this.piskelController=e,this.cache={},this.currentColors=[],this.cachedFrameProcessor=new pskl.model.frame.AsyncCachedFrameProcessor,this.cachedFrameProcessor.setFrameProcessor(this.getFrameColors_.bind(this)),this.throttledUpdateCurrentColors_=pskl.utils.FunctionUtils.throttle(this.updateCurrentColors_.bind(this),1e3),this.paletteService=pskl.app.paletteService},e.CurrentColorsService.prototype.init=function(){$.subscribe(Events.HISTORY_STATE_SAVED,this.throttledUpdateCurrentColors_),$.subscribe(Events.HISTORY_STATE_LOADED,this.loadColorsFromCache_.bind(this))},e.CurrentColorsService.prototype.getCurrentColors=function(){return this.currentColors},e.CurrentColorsService.prototype.setCurrentColors=function(e){var t=pskl.app.historyService.currentIndex;(this.cache[t]=e).join("")!==this.currentColors.join("")&&(this.currentColors=e,$.publish(Events.CURRENT_COLORS_UPDATED))},e.CurrentColorsService.prototype.isCurrentColorsPaletteSelected_=function(){var e=pskl.UserSettings.get(pskl.UserSettings.SELECTED_PALETTE);return this.paletteService.getPaletteById(e).id===Constants.CURRENT_COLORS_PALETTE_ID},e.CurrentColorsService.prototype.loadColorsFromCache_=function(){var e=pskl.app.historyService.currentIndex,e=this.cache[e];e?this.setCurrentColors(e):this.updateCurrentColors_()};e.CurrentColorsService.prototype.updateCurrentColors_=function(){!function(e,i){var t=[];for(e=e.slice(0);e.length;)t.push(e.splice(0,10));var r=Q([]);return t.forEach(function(e){r=r.then(function(t){return Q.all(e.map(i)).then(function(e){return t.concat(e)})})}),r}(this.piskelController.getLayers().map(function(e){return e.getFrames()}).reduce(function(e,t){return e.concat(t)}),function(e){return this.cachedFrameProcessor.get(e)}.bind(this)).then(function(e){var t={},e=(e.forEach(function(e){Object.keys(e).forEach(function(e){t[e]=!0})}),delete t[pskl.utils.colorToInt(Constants.TRANSPARENT_COLOR)],Object.keys(t).map(function(e){return pskl.utils.intToHex(e)}));this.setCurrentColors(e)}.bind(this))},e.CurrentColorsService.prototype.isCurrentColorsPaletteSelected_=function(){var e=pskl.UserSettings.get(pskl.UserSettings.SELECTED_PALETTE),e=this.paletteService.getPaletteById(e);return e&&e.id===Constants.CURRENT_COLORS_PALETTE_ID},e.CurrentColorsService.prototype.loadColorsFromCache_=function(){var e=pskl.app.historyService.currentIndex,e=this.cache[e];e&&this.setCurrentColors(e)},e.CurrentColorsService.prototype.getFrameColors_=function(e,t){new pskl.worker.framecolors.FrameColors(e,function(e){t(e.data.colors)},function(){},function(e){t({})}).process()}}(),!function(){var e=$.namespace("pskl.service");e.FileDropperService=function(e){this.piskelController=e,this.dropPosition_=null},e.FileDropperService.prototype.init=function(){document.body.addEventListener("drop",this.onFileDrop.bind(this),!1),document.body.addEventListener("dragover",this.onFileDragOver.bind(this),!1)},e.FileDropperService.prototype.onFileDragOver=function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},e.FileDropperService.prototype.onFileDrop=function(e){e.preventDefault(),e.stopPropagation(),this.dropPosition_={x:e.clientX,y:e.clientY};var t=e.dataTransfer.files;this.isMultipleFiles_=1<t.length;for(var i=0;i<t.length;i++){var r=t[i],n=0===r.type.indexOf("image"),o=/\.piskel$/i.test(r.name),s=/\.(gpl|txt|pal)$/i.test(r.name);n?pskl.utils.FileUtils.readImageFile(r,function(e){this.onImageLoaded_(e,r)}.bind(this)):o?pskl.utils.PiskelFileUtils.loadFromFile(r,this.onPiskelFileLoaded_,this.onPiskelFileError_):s&&pskl.app.paletteImportService.read(r,this.onPaletteLoaded_.bind(this))}},e.FileDropperService.prototype.onPaletteLoaded_=function(e){pskl.app.paletteService.savePalette(e),pskl.UserSettings.set(pskl.UserSettings.SELECTED_PALETTE,e.id)},e.FileDropperService.prototype.onPiskelFileLoaded_=function(e){window.confirm(Constants.CONFIRM_OVERWRITE)&&pskl.app.piskelController.setPiskel(e)},e.FileDropperService.prototype.onPiskelFileError_=function(e){$.publish(Events.PISKEL_FILE_IMPORT_FAILED,[e])},e.FileDropperService.prototype.onImageLoaded_=function(e,t,i){var r=pskl.app.piskelController.getWidth(),n=pskl.app.piskelController.getHeight();if(this.isMultipleFiles_)this.piskelController.addFrameAtCurrentIndex(),this.piskelController.selectNextFrame();else if(e.width>r||e.height>n)return void $.publish(Events.DIALOG_SHOW,{dialogId:"import",initArgs:{rawFiles:[t]}});r=this.piskelController.getCurrentFrame(),n=(i=void 0===i?pskl.app.drawingController.getSpriteCoordinates(this.dropPosition_.x,this.dropPosition_.y):i).x,t=i.y;pskl.utils.FrameUtils.addImageToFrame(r,e,n,t),$.publish(Events.PISKEL_RESET),$.publish(Events.PISKEL_SAVE_STATE,{type:pskl.service.HistoryService.SNAPSHOT})}}(),!function(){var e=$.namespace("pskl.service");e.SelectedColorsService=function(){this.primaryColor_=Constants.DEFAULT_PEN_COLOR,this.secondaryColor_=Constants.TRANSPARENT_COLOR},e.SelectedColorsService.prototype.init=function(){$.subscribe(Events.PRIMARY_COLOR_SELECTED,this.onPrimaryColorUpdate_.bind(this)),$.subscribe(Events.SECONDARY_COLOR_SELECTED,this.onSecondaryColorUpdate_.bind(this))},e.SelectedColorsService.prototype.getPrimaryColor=function(){return this.primaryColor_},e.SelectedColorsService.prototype.getSecondaryColor=function(){return this.secondaryColor_},e.SelectedColorsService.prototype.onPrimaryColorUpdate_=function(e,t){this.primaryColor_=t},e.SelectedColorsService.prototype.onSecondaryColorUpdate_=function(e,t){this.secondaryColor_=t}}(),!function(){var e=$.namespace("pskl.service");e.MouseStateService=function(){this.lastButtonPressed_=null},e.MouseStateService.prototype.init=function(){$.subscribe(Events.MOUSE_EVENT,this.onMouseEvent_.bind(this))},e.MouseStateService.prototype.isLeftButtonPressed=function(){return this.isMouseButtonPressed_(Constants.LEFT_BUTTON)},e.MouseStateService.prototype.isRightButtonPressed=function(){return this.isMouseButtonPressed_(Constants.RIGHT_BUTTON)},e.MouseStateService.prototype.isMiddleButtonPressed=function(){return this.isMouseButtonPressed_(Constants.MIDDLE_BUTTON)},e.MouseStateService.prototype.isMouseButtonPressed_=function(e){return null!=this.lastButtonPressed_&&this.lastButtonPressed_==e},e.MouseStateService.prototype.onMouseEvent_=function(e,t){"mousedown"==t.type?this.lastButtonPressed_=t.button:"mouseup"==t.type&&(this.lastButtonPressed_=null)}}(),!function(){var t=$.namespace("pskl.service.performance");t.PerformanceReport=function(e,t){var i=e.getWidth()*e.getHeight(),r=(this.resolution=262144<i,e.getLayers().length),e=(this.layers=25<r,e.getLayerAt(0).size()),i=(this.frames=100<e,this.colors=256<=t,i/2620+4*r+e+100*t/256);this.overall=200<i},t.PerformanceReport.prototype.equals=function(e){return e instanceof t.PerformanceReport&&this.resolution==e.resolution&&this.layers==e.layers&&this.frames==e.frames&&this.colors==e.colors&&this.overall==e.overall},t.PerformanceReport.prototype.hasProblem=function(){return this.resolution||this.layers||this.frames||this.colors||this.overall}}(),!function(){var t=$.namespace("pskl.service.performance");t.PerformanceReportService=function(e,t){this.piskelController=e,this.currentColorsService=t,this.currentReport=null},t.PerformanceReportService.prototype.init=function(){$.subscribe(Events.HISTORY_STATE_SAVED,this.createReport_.bind(this))},t.PerformanceReportService.prototype.createReport_=function(){var e=new t.PerformanceReport(this.piskelController.getPiskel(),this.currentColorsService.getCurrentColors().length);e.equals(this.currentReport)||($.publish(Events.PERFORMANCE_REPORT_CHANGED,[e]),this.currentReport=e)},t.PerformanceReportService.prototype.hasProblem=function(){return this.currentReport&&this.currentReport.hasProblem()}}(),$.namespace("pskl.tools"));ns.ToolsHelper={getTargetFrames:function(e,i){var r=pskl.app.piskelController.getCurrentFrameIndex();return(e?pskl.app.piskelController.getLayers():[pskl.app.piskelController.getCurrentLayer()]).reduce(function(e,t){t=i?t.getFrames():[t.getFrameAt(r)];return e.concat(t)},[])}},function(){var e=$.namespace("pskl.tools");e.Tool=function(){this.toolId="tool",this.helpText="Abstract tool",this.tooltipDescriptors=[]},e.Tool.prototype.getHelpText=function(){return this.helpText},e.Tool.prototype.getId=function(){return this.toolId},e.Tool.prototype.raiseSaveStateEvent=function(e){$.publish(Events.PISKEL_SAVE_STATE,{type:pskl.service.HistoryService.REPLAY,scope:this,replay:e})}}(),function(){var e=$.namespace("pskl.tools");e.ToolIconBuilder=function(){},e.ToolIconBuilder.prototype.createIcon=function(e,t){t=t||"right";var i=pskl.utils.Template.get("drawingTool-item-template");return pskl.utils.Template.replace(i,{cssclass:["tool-icon","icon-"+e.toolId].join(" "),toolid:e.toolId,title:this.getTooltipText(e),tooltipposition:t})},e.ToolIconBuilder.prototype.getTooltipText=function(e){var t=e.tooltipDescriptors;return pskl.utils.TooltipFormatter.format(e.getHelpText(),e.shortcut,t)}}(),function(){var e=$.namespace("pskl.tools.drawing");e.BaseTool=function(){pskl.tool.Tool.call(this),this.toolId="tool-base"},pskl.utils.inherit(e.BaseTool,pskl.tools.Tool),e.BaseTool.prototype.applyToolAt=function(e,t,i,r,n){},e.BaseTool.prototype.moveToolAt=function(e,t,i,r,n){},e.BaseTool.prototype.replay=Constants.ABSTRACT_FUNCTION,e.BaseTool.prototype.supportsDynamicPenSize=function(){return!1},e.BaseTool.prototype.getToolColor=function(){return pskl.app.mouseStateService.isRightButtonPressed()?pskl.app.selectedColorsService.getSecondaryColor():pskl.app.selectedColorsService.getPrimaryColor()},e.BaseTool.prototype.moveUnactiveToolAt=function(e,t,i,r,n){r.containsPixel(e,t)?this.updateHighlightedPixel(i,r,e,t):this.hideHighlightedPixel(r)},e.BaseTool.prototype.updateHighlightedPixel=function(e,t,i,r){isNaN(this.highlightedPixelCol)||isNaN(this.highlightedPixelRow)||this.highlightedPixelRow==r&&this.highlightedPixelCol==i||t.clear();var e=pskl.utils.intToColor(e.getPixel(i,r)),n=this.getHighlightColor_(e),e=this.supportsDynamicPenSize()?pskl.app.penSizeService.getPenSize():1;pskl.PixelUtils.resizePixel(i,r,e).forEach(function(e){t.setPixel(e[0],e[1],n)}),this.highlightedPixelCol=i,this.highlightedPixelRow=r},e.BaseTool.prototype.getHighlightColor_=function(e){return!e||.5<window.tinycolor(e).toHsl().l?Constants.TOOL_HIGHLIGHT_COLOR_DARK:Constants.TOOL_HIGHLIGHT_COLOR_LIGHT},e.BaseTool.prototype.hideHighlightedPixel=function(e){null!==this.highlightedPixelRow&&null!==this.highlightedPixelCol&&(e.clear(),this.highlightedPixelRow=null,this.highlightedPixelCol=null)},e.BaseTool.prototype.releaseToolAt=function(e,t,i,r,n){},e.BaseTool.prototype.supportsAlt=function(){return!1}}(),function(){var e=$.namespace("pskl.tools.drawing");e.ShapeTool=function(){this.startCol=null,this.startRow=null,this.tooltipDescriptors=[{key:"shift",description:"Keep 1 to 1 ratio"}]},pskl.utils.inherit(e.ShapeTool,e.BaseTool),e.ShapeTool.prototype.supportsDynamicPenSize=function(){return!0},e.ShapeTool.prototype.applyToolAt=function(e,t,i,r,n){$.publish(Events.DRAG_START,[e,t]),this.startCol=e,this.startRow=t;var o=pskl.app.penSizeService.getPenSize();this.draw(e,t,this.getToolColor(),r,o)},e.ShapeTool.prototype.moveToolAt=function(e,t,i,r,n){e=this.getCoordinates_(e,t,n),$.publish(Events.CURSOR_MOVED,[e.col,e.row]),r.clear(),t=this.getToolColor(),t==Constants.TRANSPARENT_COLOR&&(t=Constants.SELECTION_TRANSPARENT_COLOR),n=pskl.app.penSizeService.getPenSize();this.draw(e.col,e.row,t,r,n)},e.ShapeTool.prototype.releaseToolAt=function(e,t,i,r,n){r.clear();r=this.getCoordinates_(e,t,n),e=this.getToolColor(),t=pskl.app.penSizeService.getPenSize();this.draw(r.col,r.row,e,i,t),$.publish(Events.DRAG_END),this.raiseSaveStateEvent({col:r.col,row:r.row,startCol:this.startCol,startRow:this.startRow,color:e,penSize:t})},e.ShapeTool.prototype.replay=function(e,t){this.startCol=t.startCol,this.startRow=t.startRow,this.draw(t.col,t.row,t.color,e,t.penSize)},e.ShapeTool.prototype.getCoordinates_=function(e,t,i){return i.shiftKey?this.getScaledCoordinates_(e,t):{col:e,row:t}},e.ShapeTool.prototype.getScaledCoordinates_=function(e,t){var i=this.startCol-e,r=Math.abs(i),n=this.startRow-t,o=Math.abs(n),s=Math.min(r,o);return t=this.startRow-n/o*s,{col:e=this.startCol-i/r*s,row:t}},e.ShapeTool.prototype.draw=Constants.ABSTRACT_FUNCTION}(),function(){var e=$.namespace("pskl.tools.drawing");e.SimplePen=function(){this.toolId="tool-pen",this.helpText="Pen tool",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.PEN,this.previousCol=null,this.previousRow=null,this.pixels=[]},pskl.utils.inherit(e.SimplePen,e.BaseTool),e.SimplePen.prototype.supportsDynamicPenSize=function(){return!0},e.SimplePen.prototype.applyToolAt=function(e,t,i,r,n){this.previousCol=e,this.previousRow=t;var o=this.getToolColor();this.drawUsingPenSize(o,e,t,i,r)},e.SimplePen.prototype.drawUsingPenSize=function(t,e,i,r,n){var o=pskl.app.penSizeService.getPenSize();pskl.PixelUtils.resizePixel(e,i,o).forEach(function(e){this.draw(t,e[0],e[1],r,n)}.bind(this))},e.SimplePen.prototype.draw=function(e,t,i,r,n){n.setPixel(t,i,e),e===Constants.TRANSPARENT_COLOR&&r.setPixel(t,i,e),this.pixels.push({col:t,row:i,color:e})},e.SimplePen.prototype.moveToolAt=function(e,t,i,r,n){if(1<Math.abs(e-this.previousCol)||1<Math.abs(t-this.previousRow))for(var o=pskl.PixelUtils.getLinePixels(e,this.previousCol,t,this.previousRow),s=0,a=o.length;s<a;s++){var l=o[s];this.applyToolAt(l.col,l.row,i,r,n)}else this.applyToolAt(e,t,i,r,n);this.previousCol=e,this.previousRow=t},e.SimplePen.prototype.releaseToolAt=function(e,t,i,r,n){this.setPixelsToFrame_(i,this.pixels),this.raiseSaveStateEvent({pixels:this.pixels.slice(0),color:this.getToolColor()}),this.resetUsedPixels_()},e.SimplePen.prototype.replay=function(e,t){this.setPixelsToFrame_(e,t.pixels,t.color)},e.SimplePen.prototype.setPixelsToFrame_=function(t,e,i){e.forEach(function(e){t.setPixel(e.col,e.row,e.color)})},e.SimplePen.prototype.resetUsedPixels_=function(){this.pixels=[]}}(),function(){var e=$.namespace("pskl.tools.drawing");e.Lighten=function(){this.superclass.constructor.call(this),this.toolId="tool-lighten",this.helpText="Lighten",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.LIGHTEN,this.tooltipDescriptors=[{key:"ctrl",description:"Darken"},{key:"shift",description:"Apply only once per pixel"}]},pskl.utils.inherit(e.Lighten,e.SimplePen),e.Lighten.prototype.applyToolAt=function(e,t,i,r,n){this.previousCol=e,this.previousRow=t;var o=pskl.app.penSizeService.getPenSize();pskl.PixelUtils.resizePixel(e,t,o).forEach(function(e){var t=this.getModifiedColor_(e[0],e[1],i,r,n);this.draw(t,e[0],e[1],i,r)}.bind(this))},e.Lighten.prototype.getModifiedColor_=function(e,t,i,r,n){var r=r.getPixel(e,t),i=i.getPixel(e,t),e=r!==pskl.utils.colorToInt(Constants.TRANSPARENT_COLOR),t=e?r:i;return t===pskl.utils.colorToInt(Constants.TRANSPARENT_COLOR)?Constants.TRANSPARENT_COLOR:(r=n.shiftKey)&&e?t:(i=r?6:3,((pskl.utils.UserAgent.isMac?n.metaKey:n.ctrlKey)?window.tinycolor.darken(pskl.utils.intToColor(t),i):window.tinycolor.lighten(pskl.utils.intToColor(t),i)).toHexString())}}(),function(){var e=$.namespace("pskl.tools.drawing");e.VerticalMirrorPen=function(){this.superclass.constructor.call(this),this.toolId="tool-vertical-mirror-pen",this.helpText="Vertical Mirror pen",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.MIRROR_PEN,this.tooltipDescriptors=[{key:"ctrl",description:"Use horizontal axis"},{key:"shift",description:"Use horizontal and vertical axis"}]},pskl.utils.inherit(e.VerticalMirrorPen,e.SimplePen),e.VerticalMirrorPen.prototype.applyToolAt=function(e,t,i,r,n){var o=this.getToolColor(),s=(this.drawUsingPenSize(o,e,t,i,r),this.getSymmetricCol_(e,i)),a=this.getSymmetricRow_(t,i),l=pskl.utils.UserAgent.isMac?n.metaKey:n.ctrlKey;l||this.drawUsingPenSize(o,s,t,i,r),(n.shiftKey||l)&&this.drawUsingPenSize(o,e,a,i,r),n.shiftKey&&this.drawUsingPenSize(o,s,a,i,r),this.previousCol=e,this.previousRow=t},e.VerticalMirrorPen.prototype.getSymmetricCol_=function(e,t){return t.getWidth()-e-this.getPenSizeOffset_()},e.VerticalMirrorPen.prototype.getSymmetricRow_=function(e,t){return t.getHeight()-e-this.getPenSizeOffset_()},e.VerticalMirrorPen.prototype.getPenSizeOffset_=function(e,t){return pskl.app.penSizeService.getPenSize()%2}}(),function(){var e=$.namespace("pskl.tools.drawing");e.Eraser=function(){this.superclass.constructor.call(this),this.toolId="tool-eraser",this.helpText="Eraser tool",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.ERASER},pskl.utils.inherit(e.Eraser,e.SimplePen),e.Eraser.prototype.getToolColor=function(){return Constants.TRANSPARENT_COLOR}}(),function(){var e=$.namespace("pskl.tools.drawing");e.Stroke=function(){this.toolId="tool-stroke",this.helpText="Stroke tool",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.STROKE,this.tooltipDescriptors=[{key:"shift",description:"Hold shift to draw straight lines"}],this.startCol=null,this.startRow=null},pskl.utils.inherit(e.Stroke,e.BaseTool),e.Stroke.prototype.supportsDynamicPenSize=function(){return!0},e.Stroke.prototype.applyToolAt=function(e,t,i,r,n){this.startCol=e,this.startRow=t,r.setPixel(e,t,this.getToolColor())},e.Stroke.prototype.moveToolAt=function(e,t,i,r,n){r.clear();var o=pskl.app.penSizeService.getPenSize(),n=n.shiftKey,s=this.getToolColor();s==Constants.TRANSPARENT_COLOR&&(s=Constants.SELECTION_TRANSPARENT_COLOR),this.draw_(e,t,s,r,o,n)},e.Stroke.prototype.releaseToolAt=function(e,t,i,r,n){var o=pskl.app.penSizeService.getPenSize(),n=n.shiftKey,s=this.getToolColor();this.draw_(e,t,s,i,o,n),r.clear(),this.raiseSaveStateEvent({col:e,row:t,startCol:this.startCol,startRow:this.startRow,color:s,penSize:o,isStraight:n})},e.Stroke.prototype.draw_=function(e,t,i,r,n,o){o=o?pskl.PixelUtils.getUniformLinePixels(this.startCol,e,this.startRow,t):pskl.PixelUtils.getLinePixels(e,this.startCol,t,this.startRow);pskl.PixelUtils.resizePixel(o[0].col,o[0].row,n).forEach(function(e){r.setPixel(e[0],e[1],i)}),pskl.PixelUtils.resizePixel(o[o.length-1].col,o[o.length-1].row,n).forEach(function(e){r.setPixel(e[0],e[1],i)}),o.forEach(function(e){for(var t=0;t<n;t++)r.setPixel(e.col-Math.floor(n/2)+t,e.row-Math.floor(n/2)+t,i),r.setPixel(e.col-Math.floor(n/2)+t,e.row+Math.ceil(n/2)-t-1,i),0!==t&&(r.setPixel(e.col-Math.floor(n/2)+t,e.row-Math.floor(n/2)+t-1,i),r.setPixel(e.col-Math.floor(n/2)+t,e.row+Math.ceil(n/2)-t,i))})},e.Stroke.prototype.replay=function(e,t){this.startCol=t.startCol,this.startRow=t.startRow,this.draw_(t.col,t.row,t.color,e,t.penSize,t.isStraight)}}(),function(){var e=$.namespace("pskl.tools.drawing");e.PaintBucket=function(){this.toolId="tool-paint-bucket",this.helpText="Paint bucket tool",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.PAINT_BUCKET},pskl.utils.inherit(e.PaintBucket,e.BaseTool),e.PaintBucket.prototype.applyToolAt=function(e,t,i,r,n){var o=this.getToolColor();pskl.PixelUtils.paintSimilarConnectedPixelsFromFrame(i,e,t,o),this.raiseSaveStateEvent({col:e,row:t,color:o})},e.PaintBucket.prototype.replay=function(e,t){pskl.PixelUtils.paintSimilarConnectedPixelsFromFrame(e,t.col,t.row,t.color)}}(),function(){var e=$.namespace("pskl.tools.drawing");e.Rectangle=function(){e.ShapeTool.call(this),this.toolId="tool-rectangle",this.helpText="Rectangle tool",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.RECTANGLE},pskl.utils.inherit(e.Rectangle,e.ShapeTool),e.Rectangle.prototype.draw=function(e,t,i,r,n){for(var o=pskl.PixelUtils.getOrderedRectangleCoordinates(this.startCol,this.startRow,e,t),s=o.x0;s<=o.x1;s++)for(var a=o.y0;a<=o.y1;a++)(s>o.x1-n||s<o.x0+n||a>o.y1-n||a<o.y0+n)&&r.setPixel(s,a,i)}}(),function(){var e=$.namespace("pskl.tools.drawing");e.Circle=function(){e.ShapeTool.call(this),this.toolId="tool-circle",this.helpText="Circle tool",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.CIRCLE},pskl.utils.inherit(e.Circle,e.ShapeTool),e.Circle.prototype.draw=function(e,t,i,r,n){this.getCirclePixels_(this.startCol,this.startRow,e,t,n).forEach(function(e){r.setPixel(e[0],e[1],i)})},e.Circle.prototype.getCirclePixels_=function(e,t,i,r,n){var o,s,a,l,e=pskl.PixelUtils.getOrderedRectangleCoordinates(e,t,i,r),c=[],p=Math.round((e.x0+e.x1)/2),h=Math.round((e.y0+e.y1)/2),u=(e.x0+e.x1)%2,d=(e.y0+e.y1)%2,f=e.x1-p,g=e.y1-h;if(1==n){for(o=e.x0;o<=p;o++)a=Math.acos((o-p)/f),s=Math.round(g*Math.sin(a)+h),c.push([o-u,s]),c.push([o-u,2*h-s-d]),c.push([2*p-o,s]),c.push([2*p-o,2*h-s-d]);for(s=e.y0;s<=h;s++)a=Math.asin((s-h)/g),o=Math.round(f*Math.cos(a)+p),c.push([o,s-d]),c.push([2*p-o-u,s-d]),c.push([o,2*h-s]),c.push([2*p-o-u,2*h-s])}else{var m=f-n,y=g-n;for(m<0&&(m=0),y<0&&(y=0),o=0;o<=f;o++)for(s=0;s<=g;s++)a=Math.atan(s/o),l=Math.sqrt(o*o+s*s),(f<=n||g<=n||l>m*y/Math.sqrt(y*y*Math.pow(Math.cos(a),2)+m*m*Math.pow(Math.sin(a),2))+.5)&&l<f*g/Math.sqrt(g*g*Math.pow(Math.cos(a),2)+f*f*Math.pow(Math.sin(a),2))+.5&&(c.push([p+o,h+s]),c.push([p-o-u,h+s]),c.push([p+o,h-s-d]),c.push([p-o-u,h-s-d]))}return c}}(),function(){var e=$.namespace("pskl.tools.drawing");e.Move=function(){this.toolId=e.Move.TOOL_ID,this.helpText="Move tool",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.MOVE,this.tooltipDescriptors=[{key:"ctrl",description:"Apply to all layers"},{key:"shift",description:"Apply to all frames"},{key:"alt",description:"Wrap canvas borders"}],this.startCol=null,this.startRow=null},e.Move.TOOL_ID="tool-move",pskl.utils.inherit(e.Move,e.BaseTool),e.Move.prototype.applyToolAt=function(e,t,i,r,n){this.startCol=e,this.startRow=t,this.currentFrame=i,this.currentFrameClone=i.clone()},e.Move.prototype.moveToolAt=function(e,t,i,r,n){e-=this.startCol,t-=this.startRow;this.shiftFrame(e,t,i,this.currentFrameClone,n)},e.Move.prototype.shiftFrame=function(e,t,i,r,n){for(var o=i.getWidth(),s=i.getHeight(),a=0;a<o;a++)for(var l=0;l<s;l++){var c=a-e,p=l-t;n.altKey&&(c=(c+o)%o,p=(p+s)%s),c=r.containsPixel(c,p)?r.getPixel(c,p):Constants.TRANSPARENT_COLOR,i.setPixel(a,l,c)}},e.Move.prototype.releaseToolAt=function(e,t,i,r,n){var o=e-this.startCol,s=t-this.startRow,e=pskl.utils.UserAgent.isMac?n.metaKey:n.ctrlKey;pskl.tools.ToolsHelper.getTargetFrames(e,n.shiftKey).forEach(function(e){var t=this.currentFrame==e?this.currentFrameClone:e.clone();this.shiftFrame(o,s,e,t,n)}.bind(this)),this.raiseSaveStateEvent({colDiff:o,rowDiff:s,ctrlKey:e,altKey:n.altKey,shiftKey:n.shiftKey})},e.Move.prototype.replay=function(e,t){var i={shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.ctrlKey};pskl.tools.ToolsHelper.getTargetFrames(i.ctrlKey,i.shiftKey).forEach(function(e){this.shiftFrame(t.colDiff,t.rowDiff,e,e.clone(),i)}.bind(this))},e.Move.prototype.supportsAlt=function(){return!0}}(),function(){var e=$.namespace("pskl.tools.drawing.selection");e.BaseSelect=function(){this.secondaryToolId=pskl.tools.drawing.Move.TOOL_ID,this.startCol=null,this.startRow=null,this.lastMoveCol=null,this.lastMoveRow=null,this.selection=null,this.hasSelection=!1,this.tooltipDescriptors=[{description:"Drag the selection to move it. You may switch to other layers and frames."},{key:"ctrl+c",description:"Copy the selected area"},{key:"ctrl+v",description:"Paste the copied area"},{key:"shift",description:"Hold to move the content"}],$.subscribe(Events.SELECTION_DISMISSED,this.onSelectionDismissed_.bind(this))},pskl.utils.inherit(e.BaseSelect,pskl.tools.drawing.BaseTool),e.BaseSelect.prototype.applyToolAt=function(e,t,i,r,n){this.startCol=e,this.startRow=t,this.lastMoveCol=e,this.lastMoveRow=t,this.isInSelection(e,t)?(this.mode="moveSelection",n.shiftKey&&!this.isMovingContent_&&(this.isMovingContent_=!0,$.publish(Events.CLIPBOARD_CUT),this.drawSelectionOnOverlay_(r)),this.onSelectionMoveStart_(e,t,i,r)):(this.mode="select",this.onSelectStart_(e,t,i,r))},e.BaseSelect.prototype.moveToolAt=function(e,t,i,r,n){"select"==this.mode?this.onSelect_(e,t,i,r):"moveSelection"==this.mode&&this.onSelectionMove_(e,t,i,r)},e.BaseSelect.prototype.releaseToolAt=function(e,t,i,r,n){"select"==this.mode?this.onSelectEnd_(e,t,i,r):"moveSelection"==this.mode&&this.onSelectionMoveEnd_(e,t,i,r)},e.BaseSelect.prototype.moveUnactiveToolAt=function(e,t,i,r,n){r.containsPixel(e,t)&&(this.isInSelection(e,t)?(document.body.classList.add(this.secondaryToolId),document.body.classList.remove(this.toolId)):(document.body.classList.add(this.toolId),document.body.classList.remove(this.secondaryToolId))),this.hasSelection||pskl.tools.drawing.BaseTool.prototype.moveUnactiveToolAt.apply(this,arguments)},e.BaseSelect.prototype.isInSelection=function(t,i){return this.selection&&this.selection.pixels.some(function(e){return e.col===t&&e.row===i})},e.BaseSelect.prototype.commitSelection=function(){this.isMovingContent_&&($.publish(Events.CLIPBOARD_PASTE),this.isMovingContent_=!1),$.publish(Events.SELECTION_DISMISSED)},e.BaseSelect.prototype.onSelectionDismissed_=function(){pskl.app.drawingController.overlayFrame.clear(),this.hasSelection=!1},e.BaseSelect.prototype.drawSelectionOnOverlay_=function(e){for(var t=this.selection.pixels,i=0,r=t.length;i<r;i++){var n=t[i],n=n.color&&n.color!==Constants.TRANSPARENT_COLOR?this.getTransparentVariant_(n.color):Constants.SELECTION_TRANSPARENT_COLOR;e.setPixel(t[i].col,t[i].row,n)}},e.BaseSelect.prototype.getTransparentVariant_=pskl.utils.FunctionUtils.memo(function(e){e=window.tinycolor(e);return(e=window.tinycolor.lighten(e,10)).setAlpha(.5),e.toRgbString()},{}),e.BaseSelect.prototype.onSelectStart_=function(e,t,i,r){},e.BaseSelect.prototype.onSelect_=function(e,t,i,r){},e.BaseSelect.prototype.onSelectEnd_=function(e,t,i,r){},e.BaseSelect.prototype.onSelectionMoveStart_=function(e,t,i,r){},e.BaseSelect.prototype.onSelectionMove_=function(e,t,i,r){var n=e-this.lastMoveCol,o=t-this.lastMoveRow;this.startCol,this.startRow;this.selection.move(n,o),r.clear(),this.drawSelectionOnOverlay_(r),this.lastMoveCol=e,this.lastMoveRow=t},e.BaseSelect.prototype.onSelectionMoveEnd_=function(e,t,i,r){this.onSelectionMove_(e,t,i,r)}}(),function(){var e=$.namespace("pskl.tools.drawing.selection");e.AbstractDragSelect=function(){e.BaseSelect.call(this)},pskl.utils.inherit(e.AbstractDragSelect,e.BaseSelect),e.AbstractDragSelect.prototype.onSelectStart_=function(e,t,i,r){this.hasSelection?(this.hasSelection=!1,this.commitSelection()):(this.hasSelection=!0,this.onDragSelectStart_(e,t),r.setPixel(e,t,this.getTransparentVariant_(Constants.SELECTION_TRANSPARENT_COLOR)))},e.AbstractDragSelect.prototype.onSelect_=function(e,t,i,r){this.hasSelection||this.startCol===e&&this.startRow===t||(this.hasSelection=!0,this.onDragSelectStart_(e,t)),this.hasSelection&&this.onDragSelect_(e,t,i,r)},e.AbstractDragSelect.prototype.onSelectEnd_=function(e,t,i,r){this.hasSelection&&this.onDragSelectEnd_(e,t,i,r)},e.AbstractDragSelect.prototype.startDragSelection_=function(e,t,i){this.hasSelection=!0,this.onDragSelectStart_(e,t),i.setPixel(e,t,this.getTransparentVariant_(Constants.SELECTION_TRANSPARENT_COLOR))},e.AbstractDragSelect.prototype.onDragSelectStart_=function(e,t,i,r){},e.AbstractDragSelect.prototype.onDragSelect_=function(e,t,i,r){},e.AbstractDragSelect.prototype.onDragSelectEnd_=function(e,t,i,r){}}(),function(){var e=$.namespace("pskl.tools.drawing.selection");e.LassoSelect=function(){e.AbstractDragSelect.call(this),this.toolId="tool-lasso-select",this.helpText="Lasso selection",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.LASSO_SELECT},pskl.utils.inherit(e.LassoSelect,e.AbstractDragSelect),e.LassoSelect.prototype.onDragSelectStart_=function(e,t){this.pixels=[{col:e,row:t}],this.startCol=e,this.startRow=t,this.previousCol=e,this.previousRow=t,$.publish(Events.DRAG_START,[e,t])},e.LassoSelect.prototype.onDragSelect_=function(e,t,i,r){this.addPixel_(e,t,i);e=new pskl.selection.ShapeSelection(this.getLassoPixels_());this.setSelection_(e,r)},e.LassoSelect.prototype.onDragSelectEnd_=function(e,t,i,r){this.addPixel_(e,t,i);e=new pskl.selection.LassoSelection(this.getLassoPixels_(),i);this.setSelection_(e,r),$.publish(Events.DRAG_END)},e.LassoSelect.prototype.getLassoPixels_=function(){var e=pskl.PixelUtils.getLinePixels(this.previousCol,this.startCol,this.previousRow,this.startRow);return this.pixels.concat(e)},e.LassoSelect.prototype.addPixel_=function(e,t,i){e=pskl.utils.Math.minmax(e,0,i.getWidth()-1),t=pskl.utils.Math.minmax(t,0,i.getHeight()-1);i=pskl.PixelUtils.getLinePixels(e,this.previousCol,t,this.previousRow);this.pixels=this.pixels.concat(i),this.previousCol=e,this.previousRow=t},e.LassoSelect.prototype.setSelection_=function(e,t){this.selection=e,$.publish(Events.SELECTION_CREATED,[this.selection]),t.clear(),this.drawSelectionOnOverlay_(t)}}(),function(){var e=$.namespace("pskl.tools.drawing.selection");e.RectangleSelect=function(){e.AbstractDragSelect.call(this),this.toolId="tool-rectangle-select",this.helpText="Rectangle selection",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.RECTANGLE_SELECT},pskl.utils.inherit(e.RectangleSelect,e.AbstractDragSelect),e.RectangleSelect.prototype.onDragSelectStart_=function(e,t){$.publish(Events.DRAG_START,[e,t])},e.RectangleSelect.prototype.onDragSelect_=function(e,t,i,r){r.clear(),this.selection=new pskl.selection.RectangularSelection(this.startCol,this.startRow,e,t),$.publish(Events.SELECTION_CREATED,[this.selection]),this.drawSelectionOnOverlay_(r)},e.RectangleSelect.prototype.onDragSelectEnd_=function(e,t,i,r){this.onSelect_(e,t,i,r),$.publish(Events.DRAG_END)}}(),function(){var e=$.namespace("pskl.tools.drawing.selection");e.ShapeSelect=function(){e.BaseSelect.call(this),this.toolId="tool-shape-select",this.helpText="Shape selection",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.SHAPE_SELECT},pskl.utils.inherit(e.ShapeSelect,e.BaseSelect),e.ShapeSelect.prototype.onSelectStart_=function(e,t,i,r){this.hasSelection?(this.hasSelection=!1,this.commitSelection()):(this.hasSelection=!0,i=pskl.PixelUtils.getSimilarConnectedPixelsFromFrame(i,e,t),this.selection=new pskl.selection.ShapeSelection(i),$.publish(Events.SELECTION_CREATED,[this.selection]),this.drawSelectionOnOverlay_(r))}}(),function(){var e=$.namespace("pskl.tools.drawing");e.ColorPicker=function(){this.toolId="tool-colorpicker",this.helpText="Color picker",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.COLORPICKER},pskl.utils.inherit(e.ColorPicker,e.BaseTool),e.ColorPicker.prototype.applyToolAt=function(e,t,i,r,n){i.containsPixel(e,t)&&(i=pskl.utils.intToColor(i.getPixel(e,t)),pskl.app.mouseStateService.isLeftButtonPressed()?$.publish(Events.SELECT_PRIMARY_COLOR,[i]):pskl.app.mouseStateService.isRightButtonPressed()&&$.publish(Events.SELECT_SECONDARY_COLOR,[i]))}}(),function(){var e=$.namespace("pskl.tools.drawing");e.ColorSwap=function(){this.toolId="tool-colorswap",this.helpText="Paint all pixels of the same color",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.COLORSWAP,this.tooltipDescriptors=[{key:"ctrl",description:"Apply to all layers"},{key:"shift",description:"Apply to all frames"}]},pskl.utils.inherit(e.ColorSwap,e.BaseTool),e.ColorSwap.prototype.applyToolAt=function(e,t,i,r,n){i.containsPixel(e,t)&&(i=i.getPixel(e,t),e=this.getToolColor(),t=pskl.utils.UserAgent.isMac?n.metaKey:n.ctrlKey,n=n.shiftKey,this.swapColors_(i,e,t,n),this.raiseSaveStateEvent({allLayers:t,allFrames:n,oldColor:i,newColor:e}))},e.ColorSwap.prototype.replay=function(e,t){this.swapColors_(t.oldColor,t.newColor,t.allLayers,t.allFrames)},e.ColorSwap.prototype.swapColors_=function(t,i,e,r){var n=pskl.app.piskelController.getCurrentFrameIndex();(e?pskl.app.piskelController.getLayers():[pskl.app.piskelController.getCurrentLayer()]).forEach(function(e){(r?e.getFrames():[e.getFrameAt(n)]).forEach(function(e){this.applyToolOnFrame_(e,t,i)}.bind(this))}.bind(this))},e.ColorSwap.prototype.applyToolOnFrame_=function(r,n,o){n=pskl.utils.colorToInt(n),o=pskl.utils.colorToInt(o),r.forEachPixel(function(e,t,i){null!==e&&e==n&&r.setPixel(t,i,o)})}}(),function(){var e=$.namespace("pskl.tools.drawing");e.DitheringTool=function(){e.SimplePen.call(this),this.toolId="tool-dithering",this.helpText="Dithering tool",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.DITHERING},pskl.utils.inherit(e.DitheringTool,e.SimplePen),e.DitheringTool.prototype.supportsDynamicPenSize=function(){return!0},e.DitheringTool.prototype.applyToolAt=function(e,t,i,r,n){this.previousCol=e,this.previousRow=t;var o=pskl.app.penSizeService.getPenSize();pskl.PixelUtils.resizePixel(e,t,o).forEach(function(e){this.applyToolOnPixel(e[0],e[1],i,r,n)}.bind(this))},e.DitheringTool.prototype.applyToolOnPixel=function(e,t,i,r,n){var o=(e+t)%2,o=(o=pskl.app.mouseStateService.isRightButtonPressed()?!o:o)?pskl.app.selectedColorsService.getPrimaryColor():pskl.app.selectedColorsService.getSecondaryColor();this.draw(o,e,t,i,r)}}(),function(){var e=$.namespace("pskl.tools.drawing");e.NoiseTool=function(){e.SimplePen.call(this),this.toolId="tool-noise",this.helpText="Pixelart Noise tool",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.NOISE_TOOL},pskl.utils.inherit(e.NoiseTool,e.SimplePen),e.NoiseTool.prototype.supportsDynamicPenSize=function(){return!0},e.NoiseTool.prototype.applyToolAt=function(e,t,i,r,n){this.previousCol=e,this.previousRow=t;var o=pskl.app.penSizeService.getPenSize();pskl.PixelUtils.resizePixel(e,t,o).forEach(function(e){this.applyToolOnPixel(e[0],e[1],i,r,n)}.bind(this))},e.NoiseTool.prototype.applyToolOnPixel=function(e,t,i,r,n){var o=pskl.PixelUtils.getNoiseColor();this.draw(o,e,t,i,r)}}(),function(){var e=$.namespace("pskl.tools.drawing");e.NoiseFillTool=function(){this.toolId="tool-noise-fill",this.helpText="Pixelart Noise fill tool",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.NOISE_FILL_TOOL},pskl.utils.inherit(e.NoiseFillTool,e.BaseTool),e.NoiseFillTool.prototype.applyToolAt=function(e,t,i,r,n){pskl.PixelUtils.paintNoiseSimilarConnectedPixelsFromFrame(i,e,t),this.raiseSaveStateEvent({col:e,row:t,color:this.getNoiseColor()})},e.NoiseFillTool.prototype.replay=function(e,t){pskl.PixelUtils.paintNoiseSimilarConnectedPixelsFromFrame(e,t.col,t.row)}}(),function(){var e=$.namespace("pskl.tools.drawing");e.Outliner=function(){this.toolId="tool-outliner",this.helpText="Outliner tool",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.OUTLINER,this.tooltipDescriptors=[{key:"ctrl",description:"Fill corners"}]},pskl.utils.inherit(e.Outliner,e.BaseTool),e.Outliner.prototype.applyToolAt=function(e,t,i,r,n){var n=pskl.utils.UserAgent.isMac?n.metaKey:n.ctrlKey,o=this.getToolColor();pskl.PixelUtils.outlineSimilarConnectedPixelsFromFrame(i,e,t,o,n),this.raiseSaveStateEvent({col:e,row:t,color:o,fillCorners:n})},e.Outliner.prototype.replay=function(e,t){pskl.PixelUtils.outlineSimilarConnectedPixelsFromFrame(e,t.col,t.row,t.color,t.fillCorners)}}(),function(){var e=$.namespace("pskl.tools.transform");e.AbstractTransformTool=function(){},pskl.utils.inherit(e.AbstractTransformTool,pskl.tools.Tool),e.AbstractTransformTool.prototype.applyTransformation=function(e){var t=e.shiftKey,i=pskl.utils.UserAgent.isMac?e.metaKey:e.ctrlKey;this.applyTool_(e.altKey,t,i),$.publish(Events.PISKEL_RESET),this.raiseSaveStateEvent({altKey:e.altKey,allFrames:t,allLayers:i})},e.AbstractTransformTool.prototype.applyTool_=function(t,i,e){var r=pskl.app.piskelController.getCurrentFrameIndex();(e?pskl.app.piskelController.getLayers():[pskl.app.piskelController.getCurrentLayer()]).forEach(function(e){(i?e.getFrames():[e.getFrameAt(r)]).forEach(function(e){this.applyToolOnFrame_(e,t)}.bind(this))}.bind(this))},e.AbstractTransformTool.prototype.replay=function(e,t){this.applyTool_(t.altKey,t.allFrames,t.allLayers)}}(),function(){var t=$.namespace("pskl.tools.transform");t.Center=function(){this.toolId="tool-center",this.helpText="Align image to the center",this.tooltipDescriptors=[{key:"ctrl",description:"Apply to all layers"},{key:"shift",description:"Apply to all frames"}]},pskl.utils.inherit(t.Center,t.AbstractTransformTool),t.Center.prototype.applyToolOnFrame_=function(e){t.TransformUtils.center(e)}}(),function(){var e=$.namespace("pskl.tools.transform");e.Clone=function(){this.toolId="tool-clone",this.helpText="Clone current layer to all frames",this.tooltipDescriptors=[]},pskl.utils.inherit(e.Clone,e.AbstractTransformTool),e.Clone.prototype.applyTool_=function(e,t,i){var r=pskl.app.piskelController.getCurrentFrame();pskl.app.piskelController.getCurrentLayer().getFrames().forEach(function(e){e!==r&&e.setPixels(r.getPixels())})}}(),function(){var e=$.namespace("pskl.tools.transform");e.Crop=function(){this.toolId="tool-crop",this.helpText="Crop the sprite",this.tooltipDescriptors=[{description:"Crop to fit the content or the selection. Applies to all frames and layers!"}]},pskl.utils.inherit(e.Crop,pskl.tools.Tool),e.Crop.prototype.applyTransformation=function(e){var t=this.getFrames_(),i=pskl.app.selectionManager.currentSelection?this.getBoundariesForSelection_():pskl.tools.transform.TransformUtils.getBoundaries(t);this.applyTool_(t,i)&&this.raiseSaveStateEvent({boundaries:i})},e.Crop.prototype.replay=function(e,t){var i=this.getFrames_();this.applyTool_(i,t.boundaries)},e.Crop.prototype.applyTool_=function(e,t){if(t.minx>=t.maxx)return!1;var i=pskl.app.piskelController.getPiskel(),r=1+t.maxx-t.minx,n=1+t.maxy-t.miny;if(r===i.getWidth()&&n===i.getHeight())return!1;e.forEach(function(e){pskl.tools.transform.TransformUtils.moveFramePixels(e,-t.minx,-t.miny)});r=pskl.utils.ResizeUtils.resizePiskel(i,{width:1+t.maxx-t.minx,height:1+t.maxy-t.miny,origin:"TOP-LEFT",resizeContent:!1});return $.publish(Events.SELECTION_DISMISSED),pskl.app.piskelController.setPiskel(r,{preserveState:!0,noSnapshot:!0}),!0},e.Crop.prototype.getFrames_=function(){return pskl.app.piskelController.getPiskel().getLayers().map(function(e){return e.getFrames()}).reduce(function(e,t){return e.concat(t)})},e.Crop.prototype.getBoundariesForSelection_=function(){var r=pskl.app.selectionManager.currentSelection.pixels,n=pskl.app.piskelController.getPiskel().getLayerAt(0).getFrameAt(0);return pskl.tools.transform.TransformUtils.getBoundaries([{forEachPixel:function(e){for(var t=0;t<r.length;t++){var i=r[t];n.containsPixel(i.col,i.row)&&e(1,i.col,i.row)}}}])}}(),function(){var i=$.namespace("pskl.tools.transform");i.Flip=function(){this.toolId="tool-flip",this.helpText="Flip horizontally",this.tooltipDescriptors=[{key:"alt",description:"Flip vertically"},{key:"ctrl",description:"Apply to all layers"},{key:"shift",description:"Apply to all frames"}]},pskl.utils.inherit(i.Flip,i.AbstractTransformTool),i.Flip.prototype.applyToolOnFrame_=function(e,t){t=t?i.TransformUtils.HORIZONTAL:i.TransformUtils.VERTICAL;i.TransformUtils.flip(e,t)}}(),function(){var i=$.namespace("pskl.tools.transform");i.Rotate=function(){this.toolId="tool-rotate",this.helpText="Counter-clockwise rotation",this.tooltipDescriptors=[{key:"alt",description:"Clockwise rotation"},{key:"ctrl",description:"Apply to all layers"},{key:"shift",description:"Apply to all frames"}]},pskl.utils.inherit(i.Rotate,i.AbstractTransformTool),i.Rotate.prototype.applyToolOnFrame_=function(e,t){t=t?i.TransformUtils.CLOCKWISE:i.TransformUtils.COUNTERCLOCKWISE;i.TransformUtils.rotate(e,t)}}(),function(){var d=$.namespace("pskl.tools.transform");d.TransformUtils={VERTICAL:"VERTICAL",HORIZONTAL:"HORIZONTAL",flip:function(r,n){var e=r.clone(),o=r.getWidth(),s=r.getHeight();return e.forEachPixel(function(e,t,i){n===d.TransformUtils.VERTICAL?t=o-t-1:n===d.TransformUtils.HORIZONTAL&&(i=s-i-1),r.setPixel(t,i,e)}),r},CLOCKWISE:"clockwise",COUNTERCLOCKWISE:"counterclockwise",rotate:function(a,l){var c=a.clone(),e=a.getWidth(),t=a.getHeight(),p=Math.max(e,t),h=Math.ceil((p-e)/2),u=Math.ceil((p-t)/2);return a.forEachPixel(function(e,t,i){var r=t,n=i,o=t+=h,s=i+=u;l===d.TransformUtils.CLOCKWISE?(t=s,i=p-1-o):l===d.TransformUtils.COUNTERCLOCKWISE&&(i=o,t=p-1-s),c.containsPixel(t-=h,i-=u)?a.setPixel(r,n,c.getPixel(t,i)):a.setPixel(r,n,Constants.TRANSPARENT_COLOR)}),a},getBoundaries:function(e){var r=1/0,n=1/0,o=0,s=0,a=pskl.utils.colorToInt(Constants.TRANSPARENT_COLOR);return e.forEach(function(e){e.forEachPixel(function(e,t,i){e!==a&&(r=Math.min(r,t),o=Math.max(o,t),n=Math.min(n,i),s=Math.max(s,i))})}),{minx:r,maxx:o,miny:n,maxy:s}},moveFramePixels:function(o,s,a){var l=o.clone();o.forEachPixel(function(e,t,i){var r=t,n=i;l.containsPixel(t-=s,i-=a)?o.setPixel(r,n,l.getPixel(t,i)):o.setPixel(r,n,Constants.TRANSPARENT_COLOR)})},center:function(e){var t=d.TransformUtils.getBoundaries([e]),i=(t.maxx-t.minx+1)/2,r=(t.maxy-t.miny+1)/2,n=e.width/2,o=e.height/2,n=Math.floor(n-i-t.minx),i=Math.floor(o-r-t.miny);return d.TransformUtils.moveFramePixels(e,n,i),e}}}(),function(){var e=$.namespace("pskl.worker.framecolors");if("rgba(0, 0, 0, 0)"!==Constants.TRANSPARENT_COLOR)throw"Constants.TRANSPARENT_COLOR, please update FrameColorsWorker";e.FrameColorsWorker=function(){this.onmessage=function(e){try{this.TRANSPARENT_COLOR=e.data[0],this.MAX_WORKER_COLORS=e.data[1];var t=function(e){for(var t={},i=this.TRANSPARENT_COLOR,r=0,n=0,o=e.length;n<o&&r<this.MAX_WORKER_COLORS;n++){var s=e[n];s===i||t[s]||(t[s]=!0,r++)}return t}(e.data[2]);this.postMessage({type:"SUCCESS",colors:t})}catch(e){this.postMessage({type:"ERROR",message:e.message})}}}}(),function(){var n=$.namespace("pskl.worker.framecolors");n.FrameColors=function(e,t,i,r){this.pixels=e.pixels,this.onStep=i,this.onSuccess=t,this.onError=r,this.worker=pskl.utils.WorkerUtils.createWorker(n.FrameColorsWorker,"frame-colors"),this.worker.onmessage=this.onWorkerMessage.bind(this)},n.FrameColors.prototype.process=function(){this.worker.postMessage([pskl.utils.colorToInt(Constants.TRANSPARENT_COLOR),Constants.MAX_WORKER_COLORS,this.pixels])},n.FrameColors.prototype.onWorkerMessage=function(e){"STEP"===e.data.type?this.onStep(e):"SUCCESS"===e.data.type?(this.onSuccess(e),this.worker.terminate()):"ERROR"===e.data.type&&(this.onError(e),this.worker.terminate())}}(),$.namespace("pskl.worker.hash").HashWorker=function(){this.onmessage=function(e){try{var t=function(e){var t=0;if(0!==e.length)for(var i=0,r=e.length;i<r;i++){t=(t<<5)-t+e.charCodeAt(i);t|=0}return t}(e.data.str);this.postMessage({type:"SUCCESS",hash:t})}catch(e){this.postMessage({type:"ERROR",message:e.message})}}},function(){var n=$.namespace("pskl.worker.hash");n.Hash=function(e,t,i,r){this.str=e,this.onStep=i,this.onSuccess=t,this.onError=r,this.worker=pskl.utils.WorkerUtils.createWorker(n.HashWorker,"hash"),this.worker.onmessage=this.onWorkerMessage.bind(this)},n.Hash.prototype.process=function(){this.worker.postMessage({str:this.str})},n.Hash.prototype.onWorkerMessage=function(e){"STEP"===e.data.type?this.onStep(e):"SUCCESS"===e.data.type?(this.onSuccess(e),this.worker.terminate()):"ERROR"===e.data.type&&(this.onError(e),this.worker.terminate())}}(),$.namespace("pskl.worker.imageprocessor").ImageProcessorWorker=function(){function r(e){return 1==(e=e.toString(16)).length?"0"+e:e}function n(e,t,i){for(var r=function(e,t,i,r){for(var n=[],o=0;o<t;o++){n[o]=[],h();for(var s=0;s<i;s++){var a=4*(s*t+o),l=e[a],c=e[1+a],p=e[2+a],a=e[3+a];n[o][s]=a<125?r:u(l,c,p)}}return n}(e,t,i,"transparent"),n={},o=0;o<r.length;o++){h();for(var s=0;s<r[o].length;s++){var a=r[o][s];"transparent"!=a&&(n[a]=!0)}}return n}var o,s,a,h=function(){var e=((o+=1)/a*100).toFixed(1);e!=s&&(s=e,this.postMessage({type:"STEP",progress:s,currentStep:o,total:a}))},u=function(e,t,i){return"#"+r(e)+r(t)+r(i)};this.onmessage=function(e){try{var t=e.data,i=(r=2*t.width,s=o=0,a=r,n(t.imageData,t.width,t.height));this.postMessage({type:"SUCCESS",colorsMap:i})}catch(e){this.postMessage({type:"ERROR",message:e.message})}var r}},function(){var n=$.namespace("pskl.worker.imageprocessor");n.ImageProcessor=function(e,t,i,r){this.image=e,this.onStep=i,this.onSuccess=t,this.onError=r,this.worker=pskl.utils.WorkerUtils.createWorker(n.ImageProcessorWorker,"image-colors-processor"),this.worker.onmessage=this.onWorkerMessage.bind(this)},n.ImageProcessor.prototype.process=function(){var e=pskl.utils.CanvasUtils.createFromImage(this.image),e=pskl.utils.CanvasUtils.getImageDataFromCanvas(e);this.worker.postMessage({imageData:e,width:this.image.width,height:this.image.height})},n.ImageProcessor.prototype.onWorkerMessage=function(e){"STEP"===e.data.type?this.onStep(e):"SUCCESS"===e.data.type?(this.onSuccess(e),this.worker.terminate()):"ERROR"===e.data.type&&(this.onError(e),this.worker.terminate())}}(),$.namespace("pskl").app={init:function(){this.isAppEngineVersion=!!pskl.appEngineToken_,this.sessionId=pskl.utils.Uuid.generate(),pskl.utils.Environment.detectNative()&&Neutralino.init(),this.shortcutService=new pskl.service.keyboard.ShortcutService,this.shortcutService.init();var e=pskl.UserSettings.get(pskl.UserSettings.DEFAULT_SIZE),t=Constants.DEFAULT.FPS,i=new pskl.model.piskel.Descriptor("New Piskel",""),t=new pskl.model.Piskel(e.width,e.height,t,i),i=new pskl.model.Layer("Layer 1"),e=new pskl.model.Frame(e.width,e.height);i.addFrame(e),t.addLayer(i),this.corePiskelController=new pskl.controller.piskel.PiskelController(t),this.corePiskelController.init(),this.piskelController=new pskl.controller.piskel.PublicPiskelController(this.corePiskelController),this.piskelController.init();const r=this.piskelController.newPiskel();this.piskelController.selectPiskel(r),this.paletteImportService=new pskl.service.palette.PaletteImportService,this.paletteImportService.init(),this.paletteService=new pskl.service.palette.PaletteService,this.paletteService.addDynamicPalette(new pskl.service.palette.CurrentColorsPalette),this.selectedColorsService=new pskl.service.SelectedColorsService,this.selectedColorsService.init(),this.mouseStateService=new pskl.service.MouseStateService,this.mouseStateService.init(),this.paletteController=new pskl.controller.PaletteController,this.paletteController.init(),this.currentColorsService=new pskl.service.CurrentColorsService(this.piskelController),this.currentColorsService.init(),this.palettesListController=new pskl.controller.PalettesListController(this.currentColorsService),this.palettesListController.init(),this.cursorCoordinatesController=new pskl.controller.CursorCoordinatesController(this.piskelController),this.cursorCoordinatesController.init(),this.drawingController=new pskl.controller.DrawingController(this.piskelController,document.querySelector("#drawing-canvas-container")),this.drawingController.init(),this.previewController=new pskl.controller.preview.PreviewController(this.piskelController,document.querySelector("#animated-preview-canvas-container")),this.previewController.init(),this.minimapController=new pskl.controller.MinimapController(this.piskelController,this.previewController,this.drawingController,document.querySelector(".minimap-container")),this.minimapController.init(),this.framesListController=new pskl.controller.FramesListController(this.piskelController,document.querySelector("#preview-list-wrapper")),this.framesListController.init(),this.layersListController=new pskl.controller.LayersListController(this.piskelController),this.layersListController.init(),this.settingsController=new pskl.controller.settings.SettingsController(this.piskelController),this.settingsController.init(),this.dialogsController=new pskl.controller.dialogs.DialogsController(this.piskelController),this.dialogsController.init(),this.toolController=new pskl.controller.ToolController,this.toolController.init(),this.selectionManager=new pskl.selection.SelectionManager(this.piskelController),this.selectionManager.init(),this.historyService=new pskl.service.HistoryService(this.piskelController),this.historyService.init(),this.touchButtonsController=new pskl.controller.TouchButtonsController(this.historyService,this.drawingController),this.touchButtonsController.init(),this.notificationController=new pskl.controller.NotificationController,this.notificationController.init(),this.transformationsController=new pskl.controller.TransformationsController,this.transformationsController.init(),this.progressBarController=new pskl.controller.ProgressBarController,this.progressBarController.init(),this.canvasBackgroundController=new pskl.controller.CanvasBackgroundController,this.canvasBackgroundController.init(),this.indexedDbStorageService=new pskl.service.storage.IndexedDbStorageService(this.piskelController),this.indexedDbStorageService.init(),this.localStorageService=new pskl.service.storage.LocalStorageService(this.piskelController),this.localStorageService.init(),this.fileDownloadStorageService=new pskl.service.storage.FileDownloadStorageService(this.piskelController),this.fileDownloadStorageService.init(),this.desktopStorageService=new pskl.service.storage.DesktopStorageService(this.piskelController),this.desktopStorageService.init(),this.galleryStorageService=new pskl.service.storage.GalleryStorageService(this.piskelController),this.galleryStorageService.init(),this.storageService=new pskl.service.storage.StorageService(this.piskelController),this.storageService.init(),this.importService=new pskl.service.ImportService(this.piskelController),this.importService.init(),this.imageUploadService=new pskl.service.ImageUploadService,this.imageUploadService.init(),this.savedStatusService=new pskl.service.SavedStatusService(this.piskelController,this.historyService),this.savedStatusService.init(),this.backupService=new pskl.service.BackupService(this.piskelController),this.backupService.init(),this.beforeUnloadService=new pskl.service.BeforeUnloadService(this.piskelController),this.beforeUnloadService.init(),this.headerController=new pskl.controller.HeaderController(this.piskelController,this.savedStatusService),this.headerController.init(),this.penSizeService=new pskl.service.pensize.PenSizeService,this.penSizeService.init(),this.penSizeController=new pskl.controller.PenSizeController,this.penSizeController.init(),this.fileDropperService=new pskl.service.FileDropperService(this.piskelController),this.fileDropperService.init(),this.userWarningController=new pskl.controller.UserWarningController(this.piskelController),this.userWarningController.init(),this.performanceReportService=new pskl.service.performance.PerformanceReportService(this.piskelController,this.currentColorsService),this.performanceReportService.init(),this.clipboardService=new pskl.service.ClipboardService(this.piskelController),this.clipboardService.init(),this.tabsController=new pskl.controller.TabsController(this.piskelController,this.historyService),this.drawingLoop=new pskl.rendering.DrawingLoop,this.drawingLoop.addCallback(this.render,this),this.drawingLoop.start(),this.initTooltips_(),pskl.utils.Environment.detectNative()&&1<window.NL_ARGS.length&&0<(e=window.NL_ARGS.filter(e=>{var t=/\.piskel$/i.test(e),i=/\.png$/i.test(e),r=/\.jpg$/i.test(e),n=/\.bmp$/i.test(e),e=/\.gif$/i.test(e);return t||i||r||n||e})).length&&$.namespace("pskl.utils").FileUtilsDesktop.addPiskels(e,()=>{this.piskelController.removePiskel(r),$.publish(Events.PISKEL_REMOVED,r)});i=this.getPiskelInitData_();i&&i.piskel&&this.loadPiskel_(i),pskl.devtools&&pskl.devtools.init(),pskl.utils.Environment.detectNative()&&pskl.utils.UserAgent.isMac&&((e=new(t=require("nw.gui")).Menu({type:"menubar"})).createMacBuiltin("Piskel"),t.Window.get().menu=e),!pskl.utils.Environment.isIntegrationTest()&&pskl.utils.UserAgent.isUnsupported()&&$.publish(Events.DIALOG_SHOW,{dialogId:"unsupported-browser"}),pskl.utils.Environment.isDebug()&&pskl.app.shortcutService.registerShortcut(pskl.service.keyboard.Shortcuts.DEBUG.RELOAD_STYLES,window.reloadStyles)},loadPiskel_:function(t){var e=t.piskel;pskl.utils.serialization.Deserializer.deserialize(e,function(e){pskl.app.piskelController.setPiskel(e),$.publish(Events.PISKEL_SAVED),t.descriptor&&e.setDescriptor(t.descriptor)})},getPiskelInitData_:function(){return pskl.appEnginePiskelData_},isLoggedIn:function(){var e=this.getPiskelInitData_();return e&&e.isLoggedIn},initTooltips_:function(){$("body").tooltip({selector:"[rel=tooltip]"})},render:function(e){this.drawingController.render(e),this.previewController.render(e),this.framesListController.render(e),this.tabsController.render(e)},getFirstFrameAsPng:function(){var e=pskl.utils.LayerUtils.mergeFrameAt(this.piskelController.getLayers(),0),e=e instanceof pskl.model.frame.RenderedFrame?pskl.utils.CanvasUtils.createFromImage(e.getRenderedFrame()):pskl.utils.FrameUtils.toImage(e);return e.toDataURL("image/png")},getFramesheetAsPng:function(){return new pskl.rendering.PiskelRenderer(this.piskelController).renderAsCanvas().toDataURL("image/png")}};